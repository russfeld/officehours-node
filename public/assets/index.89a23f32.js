import{a as rt,d as A,u as gt,o as H,L as d,r as q,b as l,c,e,f as s,w as C,g as a,R as N,h as O,i as v,t as _,p as U,j as J,k as $,S as bt,F as y,l as ut,m as V,n as E,s as Q,q as R,v as ft,x as K,y as et,z as ht,A as xt,B as wt,C as it,M as Y,D as nt,E as at,G as W,H as Z,I as lt,J as T,K as dt,N as vt,O as kt,P as yt,Q as _t,T as zt,U as qt,V as Ct,W as $t,X as Mt,Y as jt,Z as St,_ as Qt,$ as Et,a0 as Lt,a1 as Nt,a2 as Ot,a3 as It,a4 as Rt,a5 as Tt,a6 as At,a7 as Bt,a8 as Dt,a9 as Ut,aa as Jt,ab as Pt,ac as Ht,ad as Vt,ae as Ft,af as Kt,ag as Yt,ah as Wt,ai as Zt,aj as Gt,ak as Xt,al as te}from"./vendor.e9595d26.js";const ee=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const m of r)if(m.type==="childList")for(const p of m.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function n(r){const m={};return r.integrity&&(m.integrity=r.integrity),r.referrerpolicy&&(m.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?m.credentials="include":r.crossorigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function i(r){if(r.ep)return;r.ep=!0;const m=n(r);fetch(r.href,m)}};ee();const z=rt.create({baseURL:"/",headers:{Accept:"application/json","Content-Type":"application/json"}}),j=A("token",{state:()=>({token:gt("token","")}),getters:{refresh_token(){return this.token?H(this.token).refresh_token:""},eid(){return this.token?H(this.token).eid:""},id(){return this.token?H(this.token).user_id:""},is_admin(){return this.token?H(this.token).is_admin:!1}},actions:{async getToken(){d.info("token:get"),await z.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(d.info("token:get login failed - redirecting to CAS"),window.location.href="/auth/login"):(d.error("token:get error"+JSON.stringify(t)),this.token="")})},async tryToken(){d.info("token:try"),await z.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(async t=>{t.response&&t.response.status===401?(d.info("token:try login failed - trying refresh token"),await this.refreshToken()):(d.error("token:try error"+JSON.stringify(t)),this.token="")})},async refreshToken(){d.info("token:refresh"),await z.post("/auth/token",{refresh_token:this.refresh_token}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(d.info("token:refresh login failed - redirecting to CAS"),window.location.href="/auth/login"):(d.error("token:refresh error"+JSON.stringify(t)),this.token="")})},async logout(){this.token="",window.location.href="http://localhost:3000/auth/logout"}}});var I=(t,o)=>{const n=t.__vccOpts||t;for(const[i,r]of o)n[i]=r;return n};const oe=t=>(U("data-v-0d8040b6"),t=t(),J(),t),re={class:"navbar navbar-expand-md navbar-dark fixed-top bg-purple"},ie={class:"container"},ne=v("Office Hours"),ae=oe(()=>e("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarCollapse","aria-controls":"navbarCollapse","aria-expanded":"false","aria-label":"Toggle navigation"},[e("span",{class:"navbar-toggler-icon"})],-1)),le={id:"navbarCollapse",class:"collapse navbar-collapse"},de={class:"navbar-nav me-auto mb-2 mb-md-0"},se={class:"nav-item"},me=v("Queues"),ce={class:"nav-item"},pe=v("About"),ge={key:0,class:"nav-item"},be=v("Admin"),ue={class:""},fe={key:0},he={class:"navbar-nav me-auto mb-2 mb-md-0"},xe={class:"nav-item"},we={class:"nav-item"},ve=v(" Logout"),ke={key:1},ye=v(" Login"),_e={__name:"NavBar",setup(t){const o=j();return(n,i)=>{const r=q("font-awesome-icon");return l(),c("nav",re,[e("div",ie,[s(a(N),{to:"/",class:"navbar-brand"},{default:C(()=>[ne]),_:1}),ae,e("div",le,[e("ul",de,[e("li",se,[s(a(N),{to:"/queues","active-class":"active",class:"nav-link"},{default:C(()=>[me]),_:1})]),e("li",ce,[s(a(N),{to:"/about","active-class":"active",class:"nav-link"},{default:C(()=>[pe]),_:1})]),a(o).is_admin?(l(),c("li",ge,[s(a(N),{to:"/admin","active-class":"active",class:"nav-link"},{default:C(()=>[be]),_:1})])):O("",!0)]),e("div",ue,[a(o).token?(l(),c("div",fe,[e("ul",he,[e("li",xe,[s(a(N),{to:"/profile","active-class":"active",class:"nav-link"},{default:C(()=>[s(r,{icon:"user"}),v(" "+_(a(o).eid),1)]),_:1})]),e("li",we,[e("a",{class:"btn btn-success float-end",onClick:i[0]||(i[0]=m=>a(o).logout())},[s(r,{icon:"arrow-right-from-bracket"}),ve])])])])):(l(),c("div",ke,[e("a",{class:"btn btn-success",onClick:i[1]||(i[1]=m=>a(o).getToken())},[s(r,{icon:"arrow-right-to-bracket"}),ye])]))])])])])}}};var ze=I(_e,[["__scopeId","data-v-0d8040b6"]]);const qe={id:"main",class:"container px-4 py-5"},Ce={__name:"App",setup(t){return(o,n)=>(l(),c(y,null,[e("header",null,[s(ze)]),e("div",qe,[(l(),$(bt,null,{default:C(()=>[s(a(ut))]),_:1}))])],64))}};var $e=I(Ce,[["__scopeId","data-v-68e3a569"]]);const Me="modulepreload",ot={},je="/",Se=function(o,n){return!n||n.length===0?o():Promise.all(n.map(i=>{if(i=`${je}${i}`,i in ot)return;ot[i]=!0;const r=i.endsWith(".css"),m=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${m}`))return;const p=document.createElement("link");if(p.rel=r?"stylesheet":Me,r||(p.as="script",p.crossOrigin=""),p.href=i,document.head.appendChild(p),r)return new Promise((h,u)=>{p.addEventListener("load",h),p.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>o())};const Qe={},Ee=t=>(U("data-v-8c844e72"),t=t(),J(),t),Le={class:"pb-2 border-bottom"},Ne=v(" Office Hours Queue "),Oe=Ee(()=>e("div",{class:"row p-4 pb-0 pt-lg-4 pb-lg-4 align-items-center rounded-3 border shadow-lg"},[e("div",{class:"col-lg-10 mx-auto"},[e("p",{class:"lead-custom text-center"}," Welcome! Here you can join the queue for office hours. Let's get started! ")])],-1));function Ie(t,o){const n=q("font-awesome-icon");return l(),c(y,null,[e("h2",Le,[s(n,{icon:"chalkboard-teacher"}),Ne]),Oe],64)}var st=I(Qe,[["render",Ie],["__scopeId","data-v-8c844e72"]]);const Re=e("br",null,null,-1),Te={key:0},Ae=v("Queues List"),Be={key:1},De=v(" Login"),Ue={__name:"LoginMessage",setup(t){const o=j();return(n,i)=>{const r=q("RouterLink"),m=q("font-awesome-icon");return l(),c("main",null,[s(st),Re,a(o).token?(l(),c("div",Te,[s(r,{to:"/queues",class:"btn btn-success"},{default:C(()=>[Ae]),_:1})])):(l(),c("div",Be,[e("a",{class:"btn btn-success",onClick:i[0]||(i[0]=p=>a(o).getToken())},[s(m,{icon:"arrow-right-to-bracket"}),De])]))])}}},Je={__name:"HomeView",setup(t){return(o,n)=>(l(),$(Ue))}};const Pe={class:"col"},He={class:"card-header"},Ve={key:0,class:"float-end badge rounded-pill bg-success"},Fe={key:1,class:"float-end badge rounded-pill bg-danger"},Ke={class:"card-body"},Ye={class:"card-text"},We={__name:"QueueCard",props:{queue:{type:Object,default(){return{}}},helpers:{type:Number,default(){return 0}},requests:{type:Number,default(){return 0}}},setup(t){const o=t,n=V();function i(r){n.push("/queues/"+r)}return(r,m)=>{const p=q("font-awesome-icon");return l(),c("div",Pe,[e("div",{class:"card w-100 hvr-grow",onClick:m[0]||(m[0]=h=>i(o.queue.id))},[e("h5",He,[v(_(o.queue.name)+" ",1),o.queue.is_open===1?(l(),c("span",Ve,[v("Open | "+_(t.helpers)+" ",1),s(p,{icon:"user-graduate"}),v(" | "+_(t.requests)+" ",1),s(p,{icon:"circle-question"})])):(l(),c("span",Fe,"Closed"))]),e("div",Ke,[e("p",Ye,_(o.queue.snippet),1)])])])}}};var Ze=I(We,[["__scopeId","data-v-3451fb3b"]]);const S=A("queues",{state:()=>({queues:[],online:{}}),getters:{getQueue:t=>o=>t.queues.find(n=>n.id==o),sortedQueues:t=>[...t.queues].sort((o,n)=>n.is_open-o.is_open)},actions:{async hydrate(){d.info("queues:hydrate"),await z.get("/api/v1/queues").then(t=>{this.queues=t.data})},async hydrateOnline(){d.info("queues:hydrateOnline"),await z.get("/api/v1/queues/online").then(t=>{this.online=t.data})},async update(t){await z.post("/api/v1/queues/"+t.id,{queue:t}).then(async()=>{await this.hydrate()})},async deleteQueue(t){await z.delete("/api/v1/queues/"+t).then(async()=>{await this.hydrate()})},async addQueue(t){await z.put("/api/v1/queues/",{name:t}).then(async()=>{await this.hydrate()})}}}),Ge={class:"row row-cols-1 row-cols-lg-3 g-4"},Xe={__name:"QueueList",async setup(t){let o,n;const i=S();i.hydrate(),[o,n]=E(()=>i.hydrateOnline()),await o,n();const{sortedQueues:r,online:m}=Q(i);return(p,h)=>(l(),c("div",Ge,[(l(!0),c(y,null,R(a(r),(u,f)=>(l(),$(Ze,{key:u.id,queue:u,index:f,helpers:a(m).helpers[String(u.id)],requests:a(m).requests[String(u.id)]},null,8,["queue","index","helpers","requests"]))),128))]))}},to=e("br",null,null,-1),eo={__name:"QueueListView",setup(t){return(o,n)=>(l(),c("main",null,[s(st),to,s(Xe)]))}},P=A("requests",{state:()=>({requests:[],online:[],helpers:[],socket:void 0,connected:!1,error:!1}),getters:{getRequest:t=>o=>t.requests.find(n=>n.user_id===o),userOnline:t=>o=>t.online.find(n=>n==o)!==void 0,sortedRequests:t=>[...t.requests].sort(function(o,n){return o.status_id==n.status_id?o.id-n.id:n.status_id-o.status_id})},actions:{async connectQueue(t){this.socket&&this.socket.disconnect(),this.$reset();const o=j(),n="/";this.socket=ft(n,{auth:{token:o.token,queue_id:t}}),this.socket.on("connect",()=>{d.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",i=>{d.error("socket:connect_error - "+i),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{d.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("queue:update",async i=>{d.info("queue:update - "+JSON.stringify(i.id)),d.debug("|- updated: "+JSON.stringify(i));var r=this.requests.findIndex(m=>m.id===i.id);r<0?this.requests.push(i):this.requests[r]=i}),this.socket.on("queue:remove",async i=>{d.info("queue.remove - "+JSON.stringify(i));var r=this.requests.findIndex(m=>m.id===i);r>=0&&this.requests.splice(r,1)}),this.socket.on("user:online",async i=>{d.info("user:online - "+JSON.stringify(i)),this.online.push(String(i))}),this.socket.on("user:offline",async i=>{d.info("user:offline - "+JSON.stringify(i)),this.online.splice(this.online.indexOf(String(i)),1)}),this.socket.on("helper:online",async i=>{d.info("helper:online - "+JSON.stringify(i.id)),d.debug("|- helper: "+JSON.stringify(i)),this.helpers.push(i)}),this.socket.on("helper:offline",async i=>{d.info("helper:offline - "+JSON.stringify(i)),this.helpers.splice(this.helpers.findIndex(r=>r.id==i),1)}),this.socket.on("queue:opening",async()=>{d.info("queue:opening"),await S().hydrate()}),this.socket.on("connected",async(i,r)=>{d.info("socket:connected"),d.debug("|-online: "+JSON.stringify(i)),d.debug("|-helpers: "+JSON.stringify(r)),this.online=i,this.helpers=r}),this.socket.on("queue:closing",async()=>{d.info("queue:closing"),this.requests=[],await S().hydrate()}),d.info("emit queue:connect"),await this.socket.emit("queue:connect",async(i,r)=>{i==200?(d.info("queue:connect OK"),d.debug("|- requests: "+JSON.stringify(r)),this.requests=r):d.error("queue:connect error - "+JSON.stringify(i))})},async disconnectQueue(){this.socket&&(d.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async joinQueue(){d.info("emit queue:join"),await this.socket.emit("queue:join",async t=>{t==200?d.info("queue:join OK"):d.error("queue:join error - "+JSON.stringify(t))})},async openQueue(){d.info("emit queue:open"),await this.socket.emit("queue:open",async t=>{t==200?(d.info("queue:open OK"),S().hydrate()):d.error("queue:open error - "+JSON.stringify(t))})},async closeQueue(){d.info("emit queue:close"),await this.socket.emit("queue:close",async t=>{t==200?(d.info("queue:close OK"),this.requests=[],S().hydrate()):d.error("queue:close error - "+JSON.stringify(t))})},async takeRequest(t){d.info("emit request:take - "+t),await this.socket.emit("request:take",t,async o=>{o==200?d.info("request:take OK"):d.error("request:take error - "+JSON.stringify(o))})},async deleteRequest(t){d.info("emit request:delete - "+t),await this.socket.emit("request:delete",t,async o=>{o==200?d.info("request:delete OK"):d.error("request:delete error - "+JSON.stringify(o))})},async finishRequest(t){d.info("emit request:finish - "+t),await this.socket.emit("request:finish",t,async o=>{o==200?d.info("request:finish OK"):d.error("request:finish error - "+JSON.stringify(o))})},async requeueRequest(t){d.info("emit request:requeue - "+t),await this.socket.emit("request:requeue",t,async o=>{o==200?d.info("request:requeue OK"):d.error("request:requeue error - "+JSON.stringify(o))})}}});const oo=t=>(U("data-v-24558b2c"),t=t(),J(),t),ro={key:2,class:"badge bg-primary rounded-pill"},io=oo(()=>e("br",null,null,-1)),no={id:"tooltip",class:"text-muted"},ao={__name:"RequestItem",props:{request:{type:Object,default(){return{}}},helper:{type:Boolean,default(){return!1}},userId:{type:Number,default(){return-1}}},setup(t){const o=t;var n=K({now:et.utc()});const i=function(){n.now=et.utc(),setInterval(i,1e4)};setInterval(i,1e4);const r=P(),m=async function(){await r.deleteRequest(o.request.id)},p=async function(){await r.takeRequest(o.request.id)},h=async function(){await r.finishRequest(o.request.id)},u=async function(){await r.requeueRequest(o.request.id)},f=ht(()=>o.request.updated_at?n.now.to(o.request.updated_at):n.now.to(o.request.created_at));return(x,b)=>{const g=q("font-awesome-icon");return l(),c("li",{class:xt(["list-group-item",[t.request.status_id==2?"list-group-item-primary":"",t.request.user_id==t.userId?"current-user":"",a(r).userOnline(t.request.user_id)?"":"list-group-item-light"]])},[a(r).userOnline(t.request.user_id)?(l(),$(g,{key:0,icon:"link"})):(l(),$(g,{key:1,icon:"link-slash"})),v(" "+_(t.request.user.name)+" ",1),t.helper?(l(),c(y,{key:2},[e("button",{class:"float-end btn btn-danger btn-sm mx-1",onClick:m},[s(g,{icon:"times",size:"xl"})]),e("button",{class:"float-end btn btn-secondary btn-sm mx-1",onClick:u},[s(g,{icon:"redo",size:"lg"})]),t.request.status_id==1?(l(),c("button",{key:0,class:"float-end btn btn-primary btn-sm mx-1",onClick:p}," Take ")):(l(),c("button",{key:1,class:"float-end btn btn-success btn-sm mx-1",onClick:h}," Done ")),t.request.status_id==2?(l(),c("span",ro,_(t.request.helper.name),1)):O("",!0),io,e("small",no,_(a(f)),1)],64)):O("",!0)],2)}}};var lo=I(ao,[["__scopeId","data-v-24558b2c"]]);const so=e("h3",{class:"text-center"},"Students Waiting",-1),mo=e("hr",null,null,-1),co={class:"list-group list-group-numbered"},mt={__name:"RequestList",props:{id:{type:Number,default:-1}},setup(t){const o=j(),n=P(),{sortedRequests:i}=Q(n);return(r,m)=>(l(),c(y,null,[so,mo,e("ul",co,[(l(!0),c(y,null,R(a(i),(p,h)=>(l(),$(lo,wt({key:p.id,request:p,index:h},r.$attrs,{"user-id":a(o).id}),null,16,["request","index","user-id"]))),128))])],64))}},po=e("h3",{class:"text-center"},"Helpers Online",-1),go=e("hr",null,null,-1),bo={class:"list-group list-group-flush"},ct={__name:"HelperList",setup(t){const o=P(),{helpers:n}=Q(o);return(i,r)=>{const m=q("font-awesome-icon");return l(),c(y,null,[po,go,e("ul",bo,[(l(!0),c(y,null,R(a(n),(p,h)=>(l(),c("li",{key:h,class:"list-group-item"},[s(m,{icon:"link"}),v(" "+_(p.name),1)]))),128))])],64)}}};const B=t=>(U("data-v-38a96dbb"),t=t(),J(),t),uo={class:"queue-header mx-auto"},fo={key:0,class:"btn btn-outline-success float-end disabled"},ho=B(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),xo=B(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),wo=B(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),vo=B(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),ko=[wo,vo],yo=B(()=>e("h2",{class:"text-center"},"Moderate Queue",-1)),_o=B(()=>e("hr",null,null,-1)),zo={class:"row"},qo={class:"col-12 col-md-4 mb-4"},Co={class:"col-12 col-md-8 mb-4"},$o={__name:"HelperPane",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const i=t,r=S();[o,n]=E(()=>r.hydrate()),await o,n();const m=r.getQueue,p=P(),{connected:h,error:u}=Q(p);[o,n]=E(()=>p.connectQueue(i.id)),await o,n();const f=async function(){confirm("Are you sure? All pending requests will be lost!")&&await p.closeQueue()},x=async function(){await p.openQueue()},b=async function(){await p.connectQueue(i.id)};return it(async()=>{await p.disconnectQueue()}),(g,w)=>{const k=q("font-awesome-icon");return l(),c(y,null,[e("div",uo,[a(h)?(l(),c("button",fo,[s(k,{icon:"link"}),ho])):(l(),c(y,{key:1},[a(u)?(l(),c("button",{key:0,class:"btn btn-outline-danger float-end",onClick:b},[s(k,{icon:"link-slash"}),xo])):(l(),c("button",{key:1,class:"btn btn-outline-warning float-end",onClick:b},ko))],64)),yo,a(m)(t.id).is_open==1?(l(),c("a",{key:2,class:"w-100 btn btn-success",onClick:f},"Queue is Open - Click to Close")):(l(),c("a",{key:3,class:"w-100 btn btn-danger",onClick:x},"Queue is Closed - Click to Open"))]),_o,e("div",zo,[e("div",qo,[s(ct)]),e("div",Co,[s(mt,{id:t.id,helper:""},null,8,["id"])])])],64)}}};var Mo=I($o,[["__scopeId","data-v-38a96dbb"]]);const L=t=>(U("data-v-65524ea2"),t=t(),J(),t),jo={id:"studentModal",class:"modal fade",tabindex:"-1","aria-labelledby":"studentModalLabel","aria-hidden":"true"},So={class:"modal-dialog"},Qo={class:"modal-content"},Eo=L(()=>e("div",{class:"modal-header"},[e("h5",{id:"studentModalLabel",class:"modal-title"},"Your Turn!"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Lo={class:"modal-body"},No=v(" You will be helped by "),Oo=v(". Their contact info is below: "),Io=L(()=>e("hr",null,null,-1)),Ro=["innerHTML"],To=L(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," OK ")],-1)),Ao={class:"queue-header mx-auto"},Bo={key:0,class:"btn btn-outline-success float-end disabled"},Do=L(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),Uo=L(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),Jo=L(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),Po=L(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),Ho=[Jo,Po],Vo=L(()=>e("h2",{class:"text-center"},"Waiting Queue",-1)),Fo={key:0,class:"w-100 btn btn-success disabled",disabled:""},Ko={key:3,class:"w-100 btn btn-danger disabled",disabled:""},Yo=L(()=>e("hr",null,null,-1)),Wo={key:0,class:"row"},Zo={class:"col-12 col-md-4 mb-4"},Go={class:"col-12 col-md-8 mb-4"},Xo={__name:"StudentPane",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const i=t,r=j(),m=S();[o,n]=E(()=>m.hydrate()),await o,n();const p=m.getQueue,h=P(),u=h.getRequest,{connected:f,error:x}=Q(h);[o,n]=E(()=>h.connectQueue(i.id)),await o,n();var b,g=!1;h.$subscribe(()=>{const M=u(r.id);M&&M.status_id==2&&!g&&(g=!0,b=new Y("#studentModal",{}),b.show()),M||(g=!1)});const w=async function(){g=!1,await h.joinQueue()},k=async function(){await h.connectQueue(i.id)};return it(async()=>{await h.disconnectQueue()}),(M,X)=>{const tt=q("font-awesome-icon");return l(),c(y,null,[e("div",jo,[e("div",So,[e("div",Qo,[Eo,e("div",Lo,[a(u)(a(r).id)&&a(u)(a(r).id).helper?(l(),c(y,{key:0},[e("p",null,[No,e("strong",null,_(a(u)(a(r).id).helper.name),1),Oo]),Io,e("div",{innerHTML:a(nt).sanitize(a(at).parse(a(u)(a(r).id).helper.contact_info||""))},null,8,Ro)],64)):O("",!0)]),To])])]),e("div",Ao,[a(f)?(l(),c("button",Bo,[s(tt,{icon:"link"}),Do])):(l(),c(y,{key:1},[a(x)?(l(),c("button",{key:0,class:"btn btn-outline-danger float-end",onClick:k},[s(tt,{icon:"link-slash"}),Uo])):(l(),c("button",{key:1,class:"btn btn-outline-warning float-end",onClick:k},Ho))],64)),Vo,a(p)(t.id).is_open==1?(l(),c(y,{key:2},[a(u)(a(r).id)!=null?(l(),c("a",Fo,"Queue Joined")):(l(),c("a",{key:1,class:"w-100 btn btn-success",onClick:X[0]||(X[0]=_i=>w())},"Join Queue"))],64)):(l(),c("a",Ko,"Queue is Closed"))]),Yo,a(p)(t.id).is_open==1?(l(),c("div",Wo,[e("div",Zo,[s(ct)]),e("div",Go,[s(mt,{id:t.id},null,8,["id"])])])):O("",!0)],64)}}};var tr=I(Xo,[["__scopeId","data-v-65524ea2"]]);const er=v(" Back"),or=v(" Edit"),rr={class:"display-5 text-center"},ir=e("hr",null,null,-1),nr=["innerHTML"],ar=e("hr",null,null,-1),lr={__name:"QueueSingle",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const i=j(),r=S();[o,n]=E(()=>r.hydrate()),await o,n();const m=r.getQueue;return(p,h)=>{const u=q("font-awesome-icon");return l(),c("main",null,[s(a(N),{to:{name:"queues"},class:"btn btn-secondary float-start"},{default:C(()=>[s(u,{icon:"arrow-left"}),er]),_:1}),a(i).is_admin?(l(),$(a(N),{key:0,to:{name:"queue_edit",params:{id:t.id}},class:"btn btn-secondary float-end"},{default:C(()=>[s(u,{icon:"pen-to-square"}),or]),_:1},8,["to"])):O("",!0),e("h1",rr,_(a(m)(t.id).name),1),ir,e("div",{innerHTML:a(nt).sanitize(a(at).parse(a(m)(t.id).description))},null,8,nr),ar,a(m)(t.id).helper==1?(l(),$(Mo,{key:1,id:t.id},null,8,["id"])):(l(),$(tr,{key:2,id:t.id},null,8,["id"]))])}}},dr={__name:"QueueSingleView",setup(t){return(o,n)=>(l(),$(lr))}},G=A("users",{state:()=>({users:[]}),getters:{getUser:t=>o=>t.users.find(n=>n.id===o)},actions:{async hydrate(){d.info("users:hydrate"),await z.get("/api/v1/users").then(t=>{this.users=t.data})},async update(t){await z.post("/api/v1/users/"+t.id,{user:t}).then(async()=>{await this.hydrate()})},async deleteUser(t){await z.delete("/api/v1/users/"+t).then(async()=>{await this.hydrate()})},async addUser(t){await z.put("/api/v1/users/",{eid:t}).then(async()=>{await this.hydrate()})}}});const sr=e("h1",{class:"display-5 text-center"},"Edit Queue",-1),mr=e("hr",null,null,-1),cr={class:"mb-3"},pr=e("label",{for:"multiselect-users",class:"form-label"},"Helpers",-1),gr=e("div",{class:"form-text"}," Helpers who can manage the queue (usually TAs) - admins already have access ",-1),br={class:"row row-cols-1 row-cols-md-2"},ur=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),fr={class:"col d-grid mb-2"},hr=v(" Cancel"),xr={__name:"EditQueue",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const i=t,r=V(),m=S();[o,n]=E(()=>m.hydrate()),await o,n();const p=m.getQueue(i.id),h=G();h.hydrate();const{users:u}=Q(h);var f;W(()=>{f=new Z({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const x=async b=>{b=(({id:g,name:w,snippet:k})=>({id:g,name:w,snippet:k}))(b),b.description=f.value(),b.users=[];for(const g of p.users)b.users.push({id:g.id});try{await m.update(b),r.push("/queues/"+p.id)}catch(g){if(g.response&&g.response.status===422){let w={};if(g.response.data.data){for(const k in g.response.data.data){w[k]="";for(const M of g.response.data.data[k])w[k]=w[k]+M.message+" "}T("queueform",["The server rejected this submission. Please correct errors listed above"],w)}else T("queueform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(g)}};return(b,g)=>{const w=q("FormKit"),k=q("router-link");return l(),c("main",null,[sr,mr,s(w,{id:"queueform",type:"form",value:a(p),actions:!1,onSubmit:x},{default:C(()=>[s(w,{type:"text",name:"name",label:"Queue Name",help:"Name of the queue (usually the course)",validation:"required"}),s(w,{type:"text",name:"snippet",label:"Short Description",help:"Short description shown on the initial card"}),s(w,{type:"textarea",name:"description",label:"Long Description",help:"Long description shown on the queue page",rows:"10"}),e("div",cr,[pr,s(a(lt),{id:"multiselect-users",modelValue:a(p).users,"onUpdate:modelValue":g[0]||(g[0]=M=>a(p).users=M),class:"form-control",options:a(u),multiple:!0,"tag-placeholder":"Add this as new user",placeholder:"Type to search or add user",label:"eid","track-by":"id"},null,8,["modelValue","options"]),gr]),e("div",br,[ur,e("div",fr,[s(k,{to:{name:"queue_single",params:{id:a(p).id}},class:"btn btn-secondary"},{default:C(()=>[hr]),_:1},8,["to"])])])]),_:1},8,["value"])])}}},wr={__name:"QueueEditView",setup(t){return(o,n)=>(l(),$(xr))}},vr=A("profile",{state:()=>({user:{}}),actions:{async hydrate(){d.info("profile:hydrate"),await z.get("/api/v1/profile").then(t=>{this.user=t.data})},async update(t){await z.post("/api/v1/profile/",{user:t}).then(async()=>{await this.hydrate()})}}});const kr=e("h1",{class:"display-5 text-center"},"Edit User",-1),yr=e("hr",null,null,-1),_r={class:"row row-cols-1 row-cols-md-2"},zr=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),qr={class:"col d-grid mb-2"},Cr=v(" Cancel"),$r={__name:"EditProfile",async setup(t){let o,n;const i=V(),r=vr();[o,n]=E(()=>r.hydrate()),await o,n();const{user:m}=Q(r);var p;W(()=>{p=new Z({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const h=async u=>{const f={name:u.name,contact_info:p.value()};try{await r.update(f),i.push("/queues/")}catch(x){if(x.response&&x.response.status===422){let b={};if(x.response.data.data){for(const g in x.response.data.data){b[g]="";for(const w of x.response.data.data[g])b[g]=b[g]+w.message+" "}T("userform",["The server rejected this submission. Please correct errors listed above"],b)}else T("userform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(x)}};return(u,f)=>{const x=q("FormKit"),b=q("router-link");return l(),c("main",null,[kr,yr,s(x,{id:"userform",type:"form",value:a(m),actions:!1,onSubmit:h},{default:C(()=>[s(x,{type:"text",name:"eid",label:"eID",disabled:!0,help:"Your K-State eID (cannot be changed)",validation:"required"}),s(x,{type:"text",name:"name",label:"Name",help:"Your full name as you'd like it displayed on the site",validation:"required"}),s(x,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact you",rows:"10"}),e("div",_r,[zr,e("div",qr,[s(b,{to:{name:"queues"},class:"btn btn-secondary"},{default:C(()=>[Cr]),_:1})])])]),_:1},8,["value"])])}}};const Mr={__name:"ProfileView",setup(t){return(o,n)=>(l(),$($r))}},jr={id:"userModal",class:"modal fade",tabindex:"-1","aria-labelledby":"userModalLabel","aria-hidden":"true"},Sr={class:"modal-dialog"},Qr={class:"modal-content"},Er=e("div",{class:"modal-header"},[e("h5",{id:"userModalLabel",class:"modal-title"},"Delete User"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Lr={class:"modal-body"},Nr=e("h5",null,"Are you sure you want to delete this user?",-1),Or=e("strong",null,"eID: ",-1),Ir=e("br",null,null,-1),Rr=e("strong",null,"Name: ",-1),Tr={class:"modal-footer"},Ar=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),Br=v(" Delete User "),Dr=v(" User "),Ur=e("h1",{class:"text-center"},"Users",-1),Jr={class:"table table-striped table-hover"},Pr=e("thead",null,[e("tr",null,[e("th",null,"eID"),e("th",null,"Name"),e("th",null,"Roles"),e("th",null,"Actions")])],-1),Hr=["onClick"],Vr={__name:"UserAdmin",setup(t){const o=G();o.hydrate();const{users:n}=Q(o),i=j();var r=K({}),m;const p=function(f){r.id=f.id,r.eid=f.eid,r.name=f.name,m=new Y("#userModal",{}),m.show()},h=async function(f){await o.deleteUser(f),m.hide()},u=async function(){var f=prompt("Enter an eID to create a user");if(f)try{await o.addUser(f)}catch(x){x.response&&x.response.status===422?alert(JSON.stringify(x.response.data)):alert(x)}};return(f,x)=>{const b=q("font-awesome-icon");return l(),c(y,null,[e("div",jr,[e("div",Sr,[e("div",Qr,[Er,e("div",Lr,[Nr,e("p",null,[Or,v(_(a(r).eid)+" ",1),Ir,Rr,v(_(a(r).name),1)])]),e("div",Tr,[Ar,e("button",{type:"button",class:"btn btn-danger",onClick:x[0]||(x[0]=g=>h(a(r).id))},[s(b,{icon:"trash"}),Br])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:u},[s(b,{icon:"plus"}),Dr]),Ur,e("table",Jr,[Pr,e("tbody",null,[(l(!0),c(y,null,R(a(n),g=>(l(),c("tr",{key:g.id},[e("td",null,_(g.eid),1),e("td",null,_(g.name),1),e("td",null,[(l(!0),c(y,null,R(g.roles,w=>(l(),c("span",{key:w.id,class:"badge rounded-pill bg-success"},_(w.name),1))),128))]),e("td",null,[s(a(N),{to:{name:"admin_useredit",params:{id:g.id}},class:"btn btn-secondary btn-sm mx-1"},{default:C(()=>[s(b,{icon:"pen-to-square"})]),_:2},1032,["to"]),g.id!=a(i).id?(l(),c("button",{key:0,type:"button",class:"btn btn-danger btn-sm mx-1",onClick:dt(w=>p(g),["prevent"])},[s(b,{icon:"trash"})],8,Hr)):O("",!0)])]))),128))])])],64)}}},Fr={id:"queueModal",class:"modal fade",tabindex:"-1","aria-labelledby":"queueModalLabel","aria-hidden":"true"},Kr={class:"modal-dialog"},Yr={class:"modal-content"},Wr=e("div",{class:"modal-header"},[e("h5",{id:"queueModalLabel",class:"modal-title"},"Delete Queue"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Zr={class:"modal-body"},Gr=e("h5",null,"Are you sure you want to delete this queue?",-1),Xr=e("strong",null,"Name: ",-1),ti={class:"modal-footer"},ei=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),oi=v(" Delete Queue "),ri=v(" Queue "),ii=e("h1",{class:"text-center"},"Queues",-1),ni={class:"table table-striped table-hover"},ai=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Actions")])],-1),li=["onClick"],di={__name:"QueueAdmin",setup(t){const o=S();o.hydrate();const{queues:n}=Q(o);var i=K({}),r;const m=function(u){i.id=u.id,i.name=u.name,r=new Y("#queueModal",{}),r.show()},p=async function(u){await o.deleteQueue(u),r.hide()},h=async function(){var u=prompt("Enter a name for the new queue");if(u)try{await o.addQueue(u)}catch(f){f.response&&f.response.status===422?alert(JSON.stringify(f.response.data)):alert(f)}};return(u,f)=>{const x=q("font-awesome-icon");return l(),c(y,null,[e("div",Fr,[e("div",Kr,[e("div",Yr,[Wr,e("div",Zr,[Gr,e("p",null,[Xr,v(_(a(i).name),1)])]),e("div",ti,[ei,e("button",{type:"button",class:"btn btn-danger",onClick:f[0]||(f[0]=b=>p(a(i).id))},[s(x,{icon:"trash"}),oi])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:h},[s(x,{icon:"plus"}),ri]),ii,e("table",ni,[ai,e("tbody",null,[(l(!0),c(y,null,R(a(n),b=>(l(),c("tr",{key:b.id},[e("td",null,_(b.name),1),e("td",null,[e("button",{type:"button",class:"btn btn-danger btn-sm mx-1",onClick:dt(g=>m(b),["prevent"])},[s(x,{icon:"trash"})],8,li)])]))),128))])])],64)}}},si={__name:"AdminView",setup(t){return(o,n)=>(l(),c(y,null,[s(di),s(Vr)],64))}},mi=A("roles",{state:()=>({roles:[]}),actions:{async hydrate(){d.info("roles:hydrate"),await z.get("/api/v1/roles").then(t=>{this.roles=t.data})}}});const ci=e("h1",{class:"display-5 text-center"},"Edit User",-1),pi=e("hr",null,null,-1),gi={class:"mb-3"},bi=e("label",{for:"multiselect-roles",class:"form-label"},"Roles",-1),ui=e("div",{class:"form-text"},"Roles assigned to this user",-1),fi={class:"row row-cols-1 row-cols-md-2"},hi=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),xi={class:"col d-grid mb-2"},wi=v(" Cancel"),vi={__name:"UserEdit",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const i=t,r=V(),m=G();[o,n]=E(()=>m.hydrate()),await o,n();const p=m.users.find(b=>b.id===parseInt(i.id)),h=mi();h.hydrate();const{roles:u}=Q(h);var f;W(()=>{f=new Z({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const x=async b=>{b=(({id:g,name:w})=>({id:g,name:w}))(b),b.contact_info=f.value(),b.roles=[];for(const g of p.roles)b.roles.push({id:g.id});try{await m.update(b),r.push("/admin/")}catch(g){if(g.response&&g.response.status===422){let w={};if(g.response.data.data){for(const k in g.response.data.data){w[k]="";for(const M of g.response.data.data[k])w[k]=w[k]+M.message+" "}T("usersForm",["The server rejected this submission. Please correct errors listed above"],w)}else T("usersForm",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(g)}};return(b,g)=>{const w=q("FormKit"),k=q("router-link");return l(),c("main",null,[ci,pi,s(w,{id:"userform",type:"form",value:a(p),actions:!1,onSubmit:x},{default:C(()=>[s(w,{type:"text",name:"eid",label:"eID",disabled:!0,help:"The user's K-State eID (cannot be changed)",validation:"required"}),s(w,{type:"text",name:"name",label:"Name",help:"The user's full name as you'd like it displayed on the site",validation:"required"}),s(w,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact the user",rows:"10"}),e("div",gi,[bi,s(a(lt),{id:"multiselect-roles",modelValue:a(p).roles,"onUpdate:modelValue":g[0]||(g[0]=M=>a(p).roles=M),class:"form-control",options:a(u),multiple:!0,"tag-placeholder":"Add this as new role",placeholder:"Type to search or add role",label:"name","track-by":"id"},null,8,["modelValue","options"]),ui]),e("div",fi,[hi,e("div",xi,[s(k,{to:{name:"admin"},class:"btn btn-secondary"},{default:C(()=>[wi]),_:1})])])]),_:1},8,["value"])])}}},ki={__name:"UserEditView",setup(t){return(o,n)=>(l(),$(vi))}},F=()=>j().is_admin,pt=vt({history:kt("/"),routes:[{path:"/",name:"home",component:Je,beforeEnter:async()=>{const t=j();if(await t.tryToken(),t.token)return"/queues"}},{path:"/about",name:"about",component:()=>Se(()=>import("./AboutView.8861c4e8.js"),["assets/AboutView.8861c4e8.js","assets/vendor.e9595d26.js"])},{path:"/queues",name:"queues",component:eo},{path:"/queues/:id",name:"queue_single",component:dr,props:t=>({id:Number(t.params.id)})},{path:"/queues/:id/edit",name:"queue_edit",component:wr,props:!0,beforeEnter:F},{path:"/profile",name:"profile",component:Mr},{path:"/admin",name:"admin",component:si,beforeEnter:F},{path:"/admin/user/:id/edit",name:"admin_useredit",component:ki,props:!0,beforeEnter:F}]});pt.beforeEach(async function(t){if(t.name!=="home"&&t.name!=="about"){const o=j();if(o.token||await o.tryToken(),!o.token)return"/"}});const yi=()=>{z.interceptors.request.use(t=>{if(t.url!=="/auth/token"){const o=j();o.token&&(t.headers.Authorization="Bearer "+o.token)}return t},t=>Promise.reject(t)),z.interceptors.response.use(t=>t,async t=>{const o=t.config;if(o.url!=="/auth/token"&&t.response&&t.response.status===401&&!o._retry){o._retry=!0;try{return await j().refreshToken(),z(o)}catch(n){return Promise.reject(n)}}return Promise.reject(t)})};d.useDefaults();d.setLevel(d.WARN);yt.add(_t,zt,qt,Ct,$t,Mt,jt,St,Qt,Et,Lt,Nt,Ot,It,Rt,Tt,At,Bt,Dt,Ut,Jt,Pt,Ht,Vt,Ft);Kt.watch();yi();const D=Yt($e);D.use(Wt());D.use(pt);D.use(Zt,rt);D.use(Gt,Xt({config:{classes:{input:"form-control",label:"form-label",help:"form-text",outer:"mb-3"}}}));D.component("FontAwesomeIcon",te);D.mount("#app");export{I as _};
