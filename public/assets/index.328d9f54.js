import{a as it,d as O,u as bt,o as V,L as d,r as z,b as l,c as m,e,f as s,w as C,g as a,R as I,h as A,i as $,j as v,t as _,p as U,k as P,S as ut,F as y,l as ft,m as nt,s as Q,n as K,q as E,v as Y,x as T,y as W,z as ot,A as ht,B as xt,C as wt,M as J,D as at,E as lt,G as Z,H as G,I as dt,J as B,K as st,N as vt,O as kt,P as yt,Q as _t,T as zt,U as qt,V as Ct,W as $t,X as Mt,Y as jt,Z as St,_ as Qt,$ as Et,a0 as Lt,a1 as It,a2 as At,a3 as Rt,a4 as Tt,a5 as Bt,a6 as Ot,a7 as Dt,a8 as Nt,a9 as Ut,aa as Pt,ab as Ht,ac as Vt,ad as Kt,ae as Ft,af as Yt,ag as Wt,ah as Jt,ai as Zt,aj as Gt,ak as Xt,al as te,am as ee,an as oe}from"./vendor.a3919e84.js";const re=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&r(p)}).observe(document,{childList:!0,subtree:!0});function n(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerpolicy&&(c.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?c.credentials="include":i.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(i){if(i.ep)return;i.ep=!0;const c=n(i);fetch(i.href,c)}};re();const q=it.create({baseURL:"/",headers:{Accept:"application/json","Content-Type":"application/json"}}),M=O("token",{state:()=>({token:bt("token",""),sound:!0}),getters:{refresh_token(){return this.token?V(this.token).refresh_token:""},eid(){return this.token?V(this.token).eid:""},id(){return this.token?V(this.token).user_id:""},is_admin(){return this.token?V(this.token).is_admin:!1}},actions:{async getToken(){d.info("token:get"),await q.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(d.info("token:get login failed - redirecting to CAS"),window.location.href="/auth/login"):(d.error("token:get error"+t),this.token="")})},async tryToken(){d.info("token:try"),await q.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(async t=>{t.response&&t.response.status===401?(d.info("token:try login failed - trying refresh token"),await this.refreshToken()):(d.error("token:try error"+t),this.token="")})},async refreshToken(){d.info("token:refresh"),await q.post("/auth/token",{refresh_token:this.refresh_token}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(d.info("token:refresh login failed - redirecting to CAS"),window.location.href="/auth/login"):(d.error("token:refresh error"+t),this.token="")})},async logout(){this.token="",window.location.href="http://localhost:3000/auth/logout"},async toggleSound(){this.sound=!this.sound}}});var R=(t,o)=>{const n=t.__vccOpts||t;for(const[r,i]of o)n[r]=i;return n};const ie=t=>(U("data-v-7428fb78"),t=t(),P(),t),ne={class:"navbar navbar-expand-md navbar-dark fixed-top bg-purple"},ae={class:"container"},le=v("Office Hours"),de=ie(()=>e("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarCollapse","aria-controls":"navbarCollapse","aria-expanded":"false","aria-label":"Toggle navigation"},[e("span",{class:"navbar-toggler-icon"})],-1)),se={id:"navbarCollapse",class:"collapse navbar-collapse"},me={class:"navbar-nav me-auto mb-2 mb-md-0"},ce={class:"nav-item"},pe=v("Queues"),ge={class:"nav-item"},be=v("About"),ue={key:0,class:"nav-item"},fe=v("Admin"),he={class:""},xe={key:0},we={class:"navbar-nav me-auto mb-2 mb-md-0"},ve={class:"nav-item"},ke={class:"nav-item"},ye={class:"nav-item"},_e=v(" Logout"),ze={key:1},qe=v(" Login"),Ce={__name:"NavBar",setup(t){const o=M();return(n,r)=>{const i=z("font-awesome-icon");return l(),m("nav",ne,[e("div",ae,[s(a(I),{to:"/",class:"navbar-brand"},{default:C(()=>[le]),_:1}),de,e("div",se,[e("ul",me,[e("li",ce,[s(a(I),{to:"/queues","active-class":"active",class:"nav-link"},{default:C(()=>[pe]),_:1})]),e("li",ge,[s(a(I),{to:"/about","active-class":"active",class:"nav-link"},{default:C(()=>[be]),_:1})]),a(o).is_admin?(l(),m("li",ue,[s(a(I),{to:"/admin","active-class":"active",class:"nav-link"},{default:C(()=>[fe]),_:1})])):A("",!0)]),e("div",he,[a(o).token?(l(),m("div",xe,[e("ul",we,[e("li",ve,[e("a",{class:"nav-link",onClick:r[0]||(r[0]=(...c)=>a(o).toggleSound&&a(o).toggleSound(...c))},[a(o).sound?(l(),$(i,{key:0,icon:"bell"})):(l(),$(i,{key:1,icon:"bell-slash"}))])]),e("li",ke,[s(a(I),{to:"/profile","active-class":"active",class:"nav-link"},{default:C(()=>[s(i,{icon:"user"}),v(" "+_(a(o).eid),1)]),_:1})]),e("li",ye,[e("a",{class:"btn btn-success float-end",onClick:r[1]||(r[1]=c=>a(o).logout())},[s(i,{icon:"arrow-right-from-bracket"}),_e])])])])):(l(),m("div",ze,[e("a",{class:"btn btn-success",onClick:r[2]||(r[2]=c=>a(o).getToken())},[s(i,{icon:"arrow-right-to-bracket"}),qe])]))])])])])}}};var $e=R(Ce,[["__scopeId","data-v-7428fb78"]]);const Me={id:"main",class:"container px-4 py-5"},je={__name:"App",setup(t){return(o,n)=>(l(),m(y,null,[e("header",null,[s($e)]),e("div",Me,[(l(),$(ut,null,{default:C(()=>[s(a(ft))]),_:1}))])],64))}};var Se=R(je,[["__scopeId","data-v-68e3a569"]]);const Qe="modulepreload",rt={},Ee="/",Le=function(o,n){return!n||n.length===0?o():Promise.all(n.map(r=>{if(r=`${Ee}${r}`,r in rt)return;rt[r]=!0;const i=r.endsWith(".css"),c=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${c}`))return;const p=document.createElement("link");if(p.rel=i?"stylesheet":Qe,i||(p.as="script",p.crossOrigin=""),p.href=r,document.head.appendChild(p),i)return new Promise((f,u)=>{p.addEventListener("load",f),p.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>o())};const Ie={},Ae=t=>(U("data-v-8c844e72"),t=t(),P(),t),Re={class:"pb-2 border-bottom"},Te=v(" Office Hours Queue "),Be=Ae(()=>e("div",{class:"row p-4 pb-0 pt-lg-4 pb-lg-4 align-items-center rounded-3 border shadow-lg"},[e("div",{class:"col-lg-10 mx-auto"},[e("p",{class:"lead-custom text-center"}," Welcome! Here you can join the queue for office hours. Let's get started! ")])],-1));function Oe(t,o){const n=z("font-awesome-icon");return l(),m(y,null,[e("h2",Re,[s(n,{icon:"chalkboard-teacher"}),Te]),Be],64)}var mt=R(Ie,[["render",Oe],["__scopeId","data-v-8c844e72"]]);const De=e("br",null,null,-1),Ne={key:0},Ue=v("Queues List"),Pe={key:1},He=v(" Login"),Ve={__name:"LoginMessage",setup(t){const o=M();return(n,r)=>{const i=z("RouterLink"),c=z("font-awesome-icon");return l(),m("main",null,[s(mt),De,a(o).token?(l(),m("div",Ne,[s(i,{to:"/queues",class:"btn btn-success"},{default:C(()=>[Ue]),_:1})])):(l(),m("div",Pe,[e("a",{class:"btn btn-success",onClick:r[0]||(r[0]=p=>a(o).getToken())},[s(c,{icon:"arrow-right-to-bracket"}),He])]))])}}},Ke={__name:"HomeView",setup(t){return(o,n)=>(l(),$(Ve))}},S=O("queues",{state:()=>({queues:[],online:[],socket:void 0,connected:!1,error:!1}),getters:{getQueue:t=>o=>t.queues.find(n=>n.id==o),getOnline:t=>o=>t.online.find(n=>n.id==o)||{is_open:!1,helpers:0,requests:0},sortedQueues:t=>[...t.queues].sort((o,n)=>n.is_open-o.is_open)},actions:{async hydrate(){d.info("queues:hydrate"),await q.get("/api/v1/queues").then(t=>{this.queues=t.data})},async hydrateOnline(){d.info("queues:hydrateOnline"),this.socket&&(this.socket.disconnect(),this.online={});const t=M(),o="/status";this.socket=nt(o,{auth:{token:t.token}}),this.socket.on("connect",()=>{d.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",n=>{d.error("socket:connect_error - "+n),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{d.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("status:update",async n=>{d.info("status:update - "+n.id),d.debug("|- updated: "+n);var r=this.online.findIndex(i=>i.id===n.id);r<0?this.online.push(n):Object.assign(this.online[r],n)}),d.info("emit status:connect"),await this.socket.emit("status:connect",async(n,r)=>{n==200?(d.info("status:connect OK"),d.debug("|- online: "+r),this.online=r):d.error("status:connect error - "+n)})},async disconnectQueue(){this.socket&&(d.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async update(t){await q.post("/api/v1/queues/"+t.id,{queue:t}).then(async()=>{await this.hydrate()})},async deleteQueue(t){await q.delete("/api/v1/queues/"+t).then(async()=>{await this.hydrate()})},async addQueue(t){await q.put("/api/v1/queues/",{name:t}).then(async()=>{await this.hydrate()})}}});const Fe={class:"col"},Ye={class:"card-header"},We={key:0,class:"float-end badge rounded-pill bg-success"},Je={key:1,class:"float-end badge rounded-pill bg-danger"},Ze={class:"card-body"},Ge={class:"card-text"},Xe={__name:"QueueCard",props:{queue:{type:Object,default(){return{}}}},setup(t){const o=t,n=S(),{getOnline:r}=Q(n),i=K();function c(p){i.push("/queues/"+p)}return(p,f)=>{const u=z("font-awesome-icon");return l(),m("div",Fe,[e("div",{class:"card w-100 hvr-grow",onClick:f[0]||(f[0]=h=>c(o.queue.id))},[e("h5",Ye,[v(_(o.queue.name)+" ",1),a(r)(o.queue.id).is_open===1?(l(),m("span",We,[v("Open | "+_(a(r)(o.queue.id).helpers||0)+" ",1),s(u,{icon:"user-graduate"}),v(" | "+_(a(r)(o.queue.id).requests||0)+" ",1),s(u,{icon:"circle-question"})])):(l(),m("span",Je,"Closed"))]),e("div",Ze,[e("p",Ge,_(o.queue.snippet),1)])])])}}};var to=R(Xe,[["__scopeId","data-v-3228e55c"]]);const eo={class:"row row-cols-1 row-cols-lg-3 g-4"},oo={__name:"QueueList",async setup(t){let o,n;const r=S();r.hydrate(),[o,n]=E(()=>r.hydrateOnline()),await o,n();const{sortedQueues:i}=Q(r);return Y(async()=>{await r.disconnectQueue()}),(c,p)=>(l(),m("div",eo,[(l(!0),m(y,null,T(a(i),(f,u)=>(l(),$(to,{key:f.id,queue:f,index:u},null,8,["queue","index"]))),128))]))}},ro=e("br",null,null,-1),io={__name:"QueueListView",setup(t){return(o,n)=>(l(),m("main",null,[s(mt),ro,s(oo)]))}},H=O("requests",{state:()=>({requests:[],online:[],helpers:[],socket:void 0,connected:!1,error:!1}),getters:{getRequest:t=>o=>t.requests.find(n=>n.user_id===o),userOnline:t=>o=>t.online.find(n=>n==o)!==void 0,sortedRequests:t=>[...t.requests].sort(function(o,n){return o.status_id==n.status_id?o.id-n.id:n.status_id-o.status_id})},actions:{async connectQueue(t){this.socket&&this.socket.disconnect(),this.$reset();const o=M(),n="/";this.socket=nt(n,{auth:{token:o.token,queue_id:t}}),this.socket.on("connect",()=>{d.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",r=>{d.error("socket:connect_error - "+r),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{d.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("queue:update",async r=>{d.info("queue:update - "+r.id),d.debug("|- updated: "+r);var i=this.requests.findIndex(c=>c.id===r.id);i<0?(this.requests.push(r),o.sound&&new Audio("/ding-36029.mp3").play()):this.requests[i]=r}),this.socket.on("queue:remove",async r=>{d.info("queue.remove - "+r);var i=this.requests.findIndex(c=>c.id===r);i>=0&&this.requests.splice(i,1)}),this.socket.on("user:online",async r=>{d.info("user:online - "+r),this.online.push(String(r))}),this.socket.on("user:offline",async r=>{d.info("user:offline - "+r),this.online.splice(this.online.indexOf(String(r)),1)}),this.socket.on("helper:online",async r=>{d.info("helper:online - "+r.id),d.debug("|- helper: "+r),this.helpers.push(r)}),this.socket.on("helper:offline",async r=>{d.info("helper:offline - "+r),this.helpers.splice(this.helpers.findIndex(i=>i.id==r),1)}),this.socket.on("queue:opening",async()=>{d.info("queue:opening"),await S().hydrate()}),this.socket.on("connected",async(r,i)=>{d.info("socket:connected"),d.debug("|-online: "+r),d.debug("|-helpers: "+i),this.online=r,this.helpers=i}),this.socket.on("queue:closing",async()=>{d.info("queue:closing"),this.requests=[],await S().hydrate()}),d.info("emit queue:connect"),await this.socket.emit("queue:connect",async(r,i)=>{r==200?(d.info("queue:connect OK"),d.debug("|- requests: "+i),this.requests=i):d.error("queue:connect error - "+r)})},async disconnectQueue(){this.socket&&(d.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async joinQueue(){d.info("emit queue:join"),await this.socket.emit("queue:join",async t=>{t==200?d.info("queue:join OK"):d.error("queue:join error - "+t)})},async openQueue(){d.info("emit queue:open"),await this.socket.emit("queue:open",async t=>{t==200?(d.info("queue:open OK"),S().hydrate()):d.error("queue:open error - "+t)})},async closeQueue(){d.info("emit queue:close"),await this.socket.emit("queue:close",async t=>{t==200?(d.info("queue:close OK"),this.requests=[],S().hydrate()):d.error("queue:close error - "+t)})},async takeRequest(t){d.info("emit request:take - "+t),await this.socket.emit("request:take",t,async o=>{o==200?d.info("request:take OK"):d.error("request:take error - "+o)})},async deleteRequest(t){d.info("emit request:delete - "+t),await this.socket.emit("request:delete",t,async o=>{o==200?d.info("request:delete OK"):d.error("request:delete error - "+o)})},async finishRequest(t){d.info("emit request:finish - "+t),await this.socket.emit("request:finish",t,async o=>{o==200?d.info("request:finish OK"):d.error("request:finish error - "+o)})},async requeueRequest(t){d.info("emit request:requeue - "+t),await this.socket.emit("request:requeue",t,async o=>{o==200?d.info("request:requeue OK"):d.error("request:requeue error - "+o)})}}});const no=t=>(U("data-v-24558b2c"),t=t(),P(),t),ao={key:2,class:"badge bg-primary rounded-pill"},lo=no(()=>e("br",null,null,-1)),so={id:"tooltip",class:"text-muted"},mo={__name:"RequestItem",props:{request:{type:Object,default(){return{}}},helper:{type:Boolean,default(){return!1}},userId:{type:Number,default(){return-1}}},setup(t){const o=t;var n=W({now:ot.utc()});const r=function(){n.now=ot.utc(),setInterval(r,1e4)};setInterval(r,1e4);const i=H(),c=async function(){await i.deleteRequest(o.request.id)},p=async function(){await i.takeRequest(o.request.id)},f=async function(){await i.finishRequest(o.request.id)},u=async function(){await i.requeueRequest(o.request.id)},h=ht(()=>o.request.updated_at?n.now.to(o.request.updated_at):n.now.to(o.request.created_at));return(x,b)=>{const g=z("font-awesome-icon");return l(),m("li",{class:xt(["list-group-item",[t.request.status_id==2?"list-group-item-primary":"",t.request.user_id==t.userId?"current-user":"",a(i).userOnline(t.request.user_id)?"":"list-group-item-light"]])},[a(i).userOnline(t.request.user_id)?(l(),$(g,{key:0,icon:"link"})):(l(),$(g,{key:1,icon:"link-slash"})),v(" "+_(t.request.user.name)+" ",1),t.helper?(l(),m(y,{key:2},[e("button",{class:"float-end btn btn-danger btn-sm mx-1",onClick:c},[s(g,{icon:"times",size:"xl"})]),e("button",{class:"float-end btn btn-secondary btn-sm mx-1",onClick:u},[s(g,{icon:"redo",size:"lg"})]),t.request.status_id==1?(l(),m("button",{key:0,class:"float-end btn btn-primary btn-sm mx-1",onClick:p}," Take ")):(l(),m("button",{key:1,class:"float-end btn btn-success btn-sm mx-1",onClick:f}," Done ")),t.request.status_id==2?(l(),m("span",ao,_(t.request.helper.name),1)):A("",!0),lo,e("small",so,_(a(h)),1)],64)):A("",!0)],2)}}};var co=R(mo,[["__scopeId","data-v-24558b2c"]]);const po=e("h3",{class:"text-center"},"Students Waiting",-1),go=e("hr",null,null,-1),bo={class:"list-group list-group-numbered"},ct={__name:"RequestList",props:{id:{type:Number,default:-1}},setup(t){const o=M(),n=H(),{sortedRequests:r}=Q(n);return(i,c)=>(l(),m(y,null,[po,go,e("ul",bo,[(l(!0),m(y,null,T(a(r),(p,f)=>(l(),$(co,wt({key:p.id,request:p,index:f},i.$attrs,{"user-id":a(o).id}),null,16,["request","index","user-id"]))),128))])],64))}},uo=e("h3",{class:"text-center"},"Helpers Online",-1),fo=e("hr",null,null,-1),ho={class:"list-group list-group-flush"},pt={__name:"HelperList",setup(t){const o=H(),{helpers:n}=Q(o);return(r,i)=>{const c=z("font-awesome-icon");return l(),m(y,null,[uo,fo,e("ul",ho,[(l(!0),m(y,null,T(a(n),(p,f)=>(l(),m("li",{key:f,class:"list-group-item"},[s(c,{icon:"link"}),v(" "+_(p.name),1)]))),128))])],64)}}};const D=t=>(U("data-v-38a96dbb"),t=t(),P(),t),xo={class:"queue-header mx-auto"},wo={key:0,class:"btn btn-outline-success float-end disabled"},vo=D(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),ko=D(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),yo=D(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),_o=D(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),zo=[yo,_o],qo=D(()=>e("h2",{class:"text-center"},"Moderate Queue",-1)),Co=D(()=>e("hr",null,null,-1)),$o={class:"row"},Mo={class:"col-12 col-md-4 mb-4"},jo={class:"col-12 col-md-8 mb-4"},So={__name:"HelperPane",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const r=t,i=S();[o,n]=E(()=>i.hydrate()),await o,n();const c=i.getQueue,p=H(),{connected:f,error:u}=Q(p);[o,n]=E(()=>p.connectQueue(r.id)),await o,n();const h=async function(){confirm("Are you sure? All pending requests will be lost!")&&await p.closeQueue()},x=async function(){await p.openQueue()},b=async function(){await p.connectQueue(r.id)};return Y(async()=>{await p.disconnectQueue()}),(g,w)=>{const k=z("font-awesome-icon");return l(),m(y,null,[e("div",xo,[a(f)?(l(),m("button",wo,[s(k,{icon:"link"}),vo])):(l(),m(y,{key:1},[a(u)?(l(),m("button",{key:0,class:"btn btn-outline-danger float-end",onClick:b},[s(k,{icon:"link-slash"}),ko])):(l(),m("button",{key:1,class:"btn btn-outline-warning float-end",onClick:b},zo))],64)),qo,a(c)(t.id).is_open==1?(l(),m("a",{key:2,class:"w-100 btn btn-success",onClick:h},"Queue is Open - Click to Close")):(l(),m("a",{key:3,class:"w-100 btn btn-danger",onClick:x},"Queue is Closed - Click to Open"))]),Co,e("div",$o,[e("div",Mo,[s(pt)]),e("div",jo,[s(ct,{id:t.id,helper:""},null,8,["id"])])])],64)}}};var Qo=R(So,[["__scopeId","data-v-38a96dbb"]]);const L=t=>(U("data-v-3eaf00d9"),t=t(),P(),t),Eo={id:"studentModal",class:"modal fade",tabindex:"-1","aria-labelledby":"studentModalLabel","aria-hidden":"true"},Lo={class:"modal-dialog"},Io={class:"modal-content"},Ao=L(()=>e("div",{class:"modal-header"},[e("h5",{id:"studentModalLabel",class:"modal-title"},"Your Turn!"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Ro={class:"modal-body"},To=v(" You will be helped by "),Bo=v(". Their contact info is below: "),Oo=L(()=>e("hr",null,null,-1)),Do=["innerHTML"],No=L(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," OK ")],-1)),Uo={class:"queue-header mx-auto"},Po={key:0,class:"btn btn-outline-success float-end disabled"},Ho=L(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),Vo=L(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),Ko=L(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),Fo=L(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),Yo=[Ko,Fo],Wo=L(()=>e("h2",{class:"text-center"},"Waiting Queue",-1)),Jo={key:0,class:"w-100 btn btn-success disabled",disabled:""},Zo={key:3,class:"w-100 btn btn-danger disabled",disabled:""},Go=L(()=>e("hr",null,null,-1)),Xo={key:0,class:"row"},tr={class:"col-12 col-md-4 mb-4"},er={class:"col-12 col-md-8 mb-4"},or={__name:"StudentPane",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const r=t,i=M(),c=S();[o,n]=E(()=>c.hydrate()),await o,n();const p=c.getQueue,f=H(),u=f.getRequest,{connected:h,error:x}=Q(f);[o,n]=E(()=>f.connectQueue(r.id)),await o,n();var b,g=!1;f.$subscribe(()=>{const j=u(i.id);j&&j.status_id==2&&!g&&(g=!0,b=new J("#studentModal",{}),b.show(),i.sound&&new Audio("/ding-36029.mp3").play()),j||(g=!1)});const w=async function(){g=!1,await f.joinQueue()},k=async function(){await f.connectQueue(r.id)};return Y(async()=>{await f.disconnectQueue()}),(j,tt)=>{const et=z("font-awesome-icon");return l(),m(y,null,[e("div",Eo,[e("div",Lo,[e("div",Io,[Ao,e("div",Ro,[a(u)(a(i).id)&&a(u)(a(i).id).helper?(l(),m(y,{key:0},[e("p",null,[To,e("strong",null,_(a(u)(a(i).id).helper.name),1),Bo]),Oo,e("div",{innerHTML:a(at).sanitize(a(lt).parse(a(u)(a(i).id).helper.contact_info||""))},null,8,Do)],64)):A("",!0)]),No])])]),e("div",Uo,[a(h)?(l(),m("button",Po,[s(et,{icon:"link"}),Ho])):(l(),m(y,{key:1},[a(x)?(l(),m("button",{key:0,class:"btn btn-outline-danger float-end",onClick:k},[s(et,{icon:"link-slash"}),Vo])):(l(),m("button",{key:1,class:"btn btn-outline-warning float-end",onClick:k},Yo))],64)),Wo,a(p)(t.id).is_open==1?(l(),m(y,{key:2},[a(u)(a(i).id)!=null?(l(),m("a",Jo,"Queue Joined")):(l(),m("a",{key:1,class:"w-100 btn btn-success",onClick:tt[0]||(tt[0]=Ci=>w())},"Join Queue"))],64)):(l(),m("a",Zo,"Queue is Closed"))]),Go,a(p)(t.id).is_open==1?(l(),m("div",Xo,[e("div",tr,[s(pt)]),e("div",er,[s(ct,{id:t.id},null,8,["id"])])])):A("",!0)],64)}}};var rr=R(or,[["__scopeId","data-v-3eaf00d9"]]);const ir=v(" Back"),nr=v(" Edit"),ar={class:"display-5 text-center"},lr=e("hr",null,null,-1),dr=["innerHTML"],sr=e("hr",null,null,-1),mr={__name:"QueueSingle",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const r=M(),i=S();[o,n]=E(()=>i.hydrate()),await o,n();const c=i.getQueue;return(p,f)=>{const u=z("font-awesome-icon");return l(),m("main",null,[s(a(I),{to:{name:"queues"},class:"btn btn-secondary float-start"},{default:C(()=>[s(u,{icon:"arrow-left"}),ir]),_:1}),a(r).is_admin?(l(),$(a(I),{key:0,to:{name:"queue_edit",params:{id:t.id}},class:"btn btn-secondary float-end"},{default:C(()=>[s(u,{icon:"pen-to-square"}),nr]),_:1},8,["to"])):A("",!0),e("h1",ar,_(a(c)(t.id).name),1),lr,e("div",{innerHTML:a(at).sanitize(a(lt).parse(a(c)(t.id).description))},null,8,dr),sr,a(c)(t.id).helper==1?(l(),$(Qo,{key:1,id:t.id},null,8,["id"])):(l(),$(rr,{key:2,id:t.id},null,8,["id"]))])}}},cr={__name:"QueueSingleView",setup(t){return(o,n)=>(l(),$(mr))}},X=O("users",{state:()=>({users:[]}),getters:{getUser:t=>o=>t.users.find(n=>n.id===o)},actions:{async hydrate(){d.info("users:hydrate"),await q.get("/api/v1/users").then(t=>{this.users=t.data})},async update(t){await q.post("/api/v1/users/"+t.id,{user:t}).then(async()=>{await this.hydrate()})},async deleteUser(t){await q.delete("/api/v1/users/"+t).then(async()=>{await this.hydrate()})},async addUser(t){await q.put("/api/v1/users/",{eid:t}).then(async()=>{await this.hydrate()})}}});const pr=e("h1",{class:"display-5 text-center"},"Edit Queue",-1),gr=e("hr",null,null,-1),br={class:"mb-3"},ur=e("label",{for:"multiselect-users",class:"form-label"},"Helpers",-1),fr=e("div",{class:"form-text"}," Helpers who can manage the queue (usually TAs) - admins already have access ",-1),hr={class:"row row-cols-1 row-cols-md-2"},xr=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),wr={class:"col d-grid mb-2"},vr=v(" Cancel"),kr={__name:"EditQueue",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const r=t,i=K(),c=S();[o,n]=E(()=>c.hydrate()),await o,n();const p=c.getQueue(r.id),f=X();f.hydrate();const{users:u}=Q(f);var h;Z(()=>{h=new G({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const x=async b=>{b=(({id:g,name:w,snippet:k})=>({id:g,name:w,snippet:k}))(b),b.description=h.value(),b.users=[];for(const g of p.users)b.users.push({id:g.id});try{await c.update(b),i.push("/queues/"+p.id)}catch(g){if(g.response&&g.response.status===422){let w={};if(g.response.data.data){for(const k in g.response.data.data){w[k]="";for(const j of g.response.data.data[k])w[k]=w[k]+j.message+" "}B("queueform",["The server rejected this submission. Please correct errors listed above"],w)}else B("queueform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(g)}};return(b,g)=>{const w=z("FormKit"),k=z("router-link");return l(),m("main",null,[pr,gr,s(w,{id:"queueform",type:"form",value:a(p),actions:!1,onSubmit:x},{default:C(()=>[s(w,{type:"text",name:"name",label:"Queue Name",help:"Name of the queue (usually the course)",validation:"required"}),s(w,{type:"text",name:"snippet",label:"Short Description",help:"Short description shown on the initial card"}),s(w,{type:"textarea",name:"description",label:"Long Description",help:"Long description shown on the queue page",rows:"10"}),e("div",br,[ur,s(a(dt),{id:"multiselect-users",modelValue:a(p).users,"onUpdate:modelValue":g[0]||(g[0]=j=>a(p).users=j),class:"form-control",options:a(u),multiple:!0,"tag-placeholder":"Add this as new user",placeholder:"Type to search or add user",label:"eid","track-by":"id"},null,8,["modelValue","options"]),fr]),e("div",hr,[xr,e("div",wr,[s(k,{to:{name:"queue_single",params:{id:a(p).id}},class:"btn btn-secondary"},{default:C(()=>[vr]),_:1},8,["to"])])])]),_:1},8,["value"])])}}},yr={__name:"QueueEditView",setup(t){return(o,n)=>(l(),$(kr))}},_r=O("profile",{state:()=>({user:{}}),actions:{async hydrate(){d.info("profile:hydrate"),await q.get("/api/v1/profile").then(t=>{this.user=t.data})},async update(t){await q.post("/api/v1/profile/",{user:t}).then(async()=>{await this.hydrate()})}}});const zr=e("h1",{class:"display-5 text-center"},"Edit User",-1),qr=e("hr",null,null,-1),Cr={class:"row row-cols-1 row-cols-md-2"},$r=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),Mr={class:"col d-grid mb-2"},jr=v(" Cancel"),Sr={__name:"EditProfile",async setup(t){let o,n;const r=K(),i=_r();[o,n]=E(()=>i.hydrate()),await o,n();const{user:c}=Q(i);var p;Z(()=>{p=new G({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const f=async u=>{const h={name:u.name,contact_info:p.value()};try{await i.update(h),r.push("/queues/")}catch(x){if(x.response&&x.response.status===422){let b={};if(x.response.data.data){for(const g in x.response.data.data){b[g]="";for(const w of x.response.data.data[g])b[g]=b[g]+w.message+" "}B("userform",["The server rejected this submission. Please correct errors listed above"],b)}else B("userform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(x)}};return(u,h)=>{const x=z("FormKit"),b=z("router-link");return l(),m("main",null,[zr,qr,s(x,{id:"userform",type:"form",value:a(c),actions:!1,onSubmit:f},{default:C(()=>[s(x,{type:"text",name:"eid",label:"eID",disabled:!0,help:"Your K-State eID (cannot be changed)",validation:"required"}),s(x,{type:"text",name:"name",label:"Name",help:"Your full name as you'd like it displayed on the site",validation:"required"}),s(x,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact you",rows:"10"}),e("div",Cr,[$r,e("div",Mr,[s(b,{to:{name:"queues"},class:"btn btn-secondary"},{default:C(()=>[jr]),_:1})])])]),_:1},8,["value"])])}}};const Qr={__name:"ProfileView",setup(t){return(o,n)=>(l(),$(Sr))}},Er={id:"userModal",class:"modal fade",tabindex:"-1","aria-labelledby":"userModalLabel","aria-hidden":"true"},Lr={class:"modal-dialog"},Ir={class:"modal-content"},Ar=e("div",{class:"modal-header"},[e("h5",{id:"userModalLabel",class:"modal-title"},"Delete User"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Rr={class:"modal-body"},Tr=e("h5",null,"Are you sure you want to delete this user?",-1),Br=e("strong",null,"eID: ",-1),Or=e("br",null,null,-1),Dr=e("strong",null,"Name: ",-1),Nr={class:"modal-footer"},Ur=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),Pr=v(" Delete User "),Hr=v(" User "),Vr=e("h1",{class:"text-center"},"Users",-1),Kr={class:"table table-striped table-hover"},Fr=e("thead",null,[e("tr",null,[e("th",null,"eID"),e("th",null,"Name"),e("th",null,"Roles"),e("th",null,"Actions")])],-1),Yr=["onClick"],Wr={__name:"UserAdmin",setup(t){const o=X();o.hydrate();const{users:n}=Q(o),r=M();var i=W({}),c;const p=function(h){i.id=h.id,i.eid=h.eid,i.name=h.name,c=new J("#userModal",{}),c.show()},f=async function(h){await o.deleteUser(h),c.hide()},u=async function(){var h=prompt("Enter an eID to create a user");if(h)try{await o.addUser(h)}catch(x){x.response&&x.response.status===422?alert(JSON.stringify(x.response.data)):alert(x)}};return(h,x)=>{const b=z("font-awesome-icon");return l(),m(y,null,[e("div",Er,[e("div",Lr,[e("div",Ir,[Ar,e("div",Rr,[Tr,e("p",null,[Br,v(_(a(i).eid)+" ",1),Or,Dr,v(_(a(i).name),1)])]),e("div",Nr,[Ur,e("button",{type:"button",class:"btn btn-danger",onClick:x[0]||(x[0]=g=>f(a(i).id))},[s(b,{icon:"trash"}),Pr])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:u},[s(b,{icon:"plus"}),Hr]),Vr,e("table",Kr,[Fr,e("tbody",null,[(l(!0),m(y,null,T(a(n),g=>(l(),m("tr",{key:g.id},[e("td",null,_(g.eid),1),e("td",null,_(g.name),1),e("td",null,[(l(!0),m(y,null,T(g.roles,w=>(l(),m("span",{key:w.id,class:"badge rounded-pill bg-success"},_(w.name),1))),128))]),e("td",null,[s(a(I),{to:{name:"admin_useredit",params:{id:g.id}},class:"btn btn-secondary btn-sm mx-1"},{default:C(()=>[s(b,{icon:"pen-to-square"})]),_:2},1032,["to"]),g.id!=a(r).id?(l(),m("button",{key:0,type:"button",class:"btn btn-danger btn-sm mx-1",onClick:st(w=>p(g),["prevent"])},[s(b,{icon:"trash"})],8,Yr)):A("",!0)])]))),128))])])],64)}}},Jr={id:"queueModal",class:"modal fade",tabindex:"-1","aria-labelledby":"queueModalLabel","aria-hidden":"true"},Zr={class:"modal-dialog"},Gr={class:"modal-content"},Xr=e("div",{class:"modal-header"},[e("h5",{id:"queueModalLabel",class:"modal-title"},"Delete Queue"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ti={class:"modal-body"},ei=e("h5",null,"Are you sure you want to delete this queue?",-1),oi=e("strong",null,"Name: ",-1),ri={class:"modal-footer"},ii=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),ni=v(" Delete Queue "),ai=v(" Queue "),li=e("h1",{class:"text-center"},"Queues",-1),di={class:"table table-striped table-hover"},si=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Actions")])],-1),mi=["onClick"],ci={__name:"QueueAdmin",setup(t){const o=S();o.hydrate();const{queues:n}=Q(o);var r=W({}),i;const c=function(u){r.id=u.id,r.name=u.name,i=new J("#queueModal",{}),i.show()},p=async function(u){await o.deleteQueue(u),i.hide()},f=async function(){var u=prompt("Enter a name for the new queue");if(u)try{await o.addQueue(u)}catch(h){h.response&&h.response.status===422?alert(JSON.stringify(h.response.data)):alert(h)}};return(u,h)=>{const x=z("font-awesome-icon");return l(),m(y,null,[e("div",Jr,[e("div",Zr,[e("div",Gr,[Xr,e("div",ti,[ei,e("p",null,[oi,v(_(a(r).name),1)])]),e("div",ri,[ii,e("button",{type:"button",class:"btn btn-danger",onClick:h[0]||(h[0]=b=>p(a(r).id))},[s(x,{icon:"trash"}),ni])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:f},[s(x,{icon:"plus"}),ai]),li,e("table",di,[si,e("tbody",null,[(l(!0),m(y,null,T(a(n),b=>(l(),m("tr",{key:b.id},[e("td",null,_(b.name),1),e("td",null,[e("button",{type:"button",class:"btn btn-danger btn-sm mx-1",onClick:st(g=>c(b),["prevent"])},[s(x,{icon:"trash"})],8,mi)])]))),128))])])],64)}}},pi={__name:"AdminView",setup(t){return(o,n)=>(l(),m(y,null,[s(ci),s(Wr)],64))}},gi=O("roles",{state:()=>({roles:[]}),actions:{async hydrate(){d.info("roles:hydrate"),await q.get("/api/v1/roles").then(t=>{this.roles=t.data})}}});const bi=e("h1",{class:"display-5 text-center"},"Edit User",-1),ui=e("hr",null,null,-1),fi={class:"mb-3"},hi=e("label",{for:"multiselect-roles",class:"form-label"},"Roles",-1),xi=e("div",{class:"form-text"},"Roles assigned to this user",-1),wi={class:"row row-cols-1 row-cols-md-2"},vi=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),ki={class:"col d-grid mb-2"},yi=v(" Cancel"),_i={__name:"UserEdit",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const r=t,i=K(),c=X();[o,n]=E(()=>c.hydrate()),await o,n();const p=c.users.find(b=>b.id===parseInt(r.id)),f=gi();f.hydrate();const{roles:u}=Q(f);var h;Z(()=>{h=new G({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const x=async b=>{b=(({id:g,name:w})=>({id:g,name:w}))(b),b.contact_info=h.value(),b.roles=[];for(const g of p.roles)b.roles.push({id:g.id});try{await c.update(b),i.push("/admin/")}catch(g){if(g.response&&g.response.status===422){let w={};if(g.response.data.data){for(const k in g.response.data.data){w[k]="";for(const j of g.response.data.data[k])w[k]=w[k]+j.message+" "}B("usersForm",["The server rejected this submission. Please correct errors listed above"],w)}else B("usersForm",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(g)}};return(b,g)=>{const w=z("FormKit"),k=z("router-link");return l(),m("main",null,[bi,ui,s(w,{id:"userform",type:"form",value:a(p),actions:!1,onSubmit:x},{default:C(()=>[s(w,{type:"text",name:"eid",label:"eID",disabled:!0,help:"The user's K-State eID (cannot be changed)",validation:"required"}),s(w,{type:"text",name:"name",label:"Name",help:"The user's full name as you'd like it displayed on the site",validation:"required"}),s(w,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact the user",rows:"10"}),e("div",fi,[hi,s(a(dt),{id:"multiselect-roles",modelValue:a(p).roles,"onUpdate:modelValue":g[0]||(g[0]=j=>a(p).roles=j),class:"form-control",options:a(u),multiple:!0,"tag-placeholder":"Add this as new role",placeholder:"Type to search or add role",label:"name","track-by":"id"},null,8,["modelValue","options"]),xi]),e("div",wi,[vi,e("div",ki,[s(k,{to:{name:"admin"},class:"btn btn-secondary"},{default:C(()=>[yi]),_:1})])])]),_:1},8,["value"])])}}},zi={__name:"UserEditView",setup(t){return(o,n)=>(l(),$(_i))}},F=()=>M().is_admin,gt=vt({history:kt("/"),routes:[{path:"/",name:"home",component:Ke,beforeEnter:async()=>{const t=M();if(await t.tryToken(),t.token)return"/queues"}},{path:"/about",name:"about",component:()=>Le(()=>import("./AboutView.5ec8b2d8.js"),["assets/AboutView.5ec8b2d8.js","assets/vendor.a3919e84.js"])},{path:"/queues",name:"queues",component:io},{path:"/queues/:id",name:"queue_single",component:cr,props:t=>({id:Number(t.params.id)})},{path:"/queues/:id/edit",name:"queue_edit",component:yr,props:!0,beforeEnter:F},{path:"/profile",name:"profile",component:Qr},{path:"/admin",name:"admin",component:pi,beforeEnter:F},{path:"/admin/user/:id/edit",name:"admin_useredit",component:zi,props:!0,beforeEnter:F}]});gt.beforeEach(async function(t){if(t.name!=="home"&&t.name!=="about"){const o=M();if(o.token||await o.tryToken(),!o.token)return"/"}});const qi=()=>{q.interceptors.request.use(t=>{if(t.url!=="/auth/token"){const o=M();o.token&&(t.headers.Authorization="Bearer "+o.token)}return t},t=>Promise.reject(t)),q.interceptors.response.use(t=>t,async t=>{const o=t.config;if(o.url!=="/auth/token"&&t.response&&t.response.status===401&&!o._retry){o._retry=!0;try{return await M().refreshToken(),q(o)}catch(n){return Promise.reject(n)}}return Promise.reject(t)})};d.useDefaults();d.setLevel(d.WARN);yt.add(_t,zt,qt,Ct,$t,Mt,jt,St,Qt,Et,Lt,It,At,Rt,Tt,Bt,Ot,Dt,Nt,Ut,Pt,Ht,Vt,Kt,Ft,Yt,Wt);Jt.watch();qi();const N=Zt(Se);N.use(Gt());N.use(gt);N.use(Xt,it);N.use(te,ee({config:{classes:{input:"form-control",label:"form-label",help:"form-text",outer:"mb-3"}}}));N.component("FontAwesomeIcon",oe);N.mount("#app");export{R as _};
