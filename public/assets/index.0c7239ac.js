import{a as ht,d as K,u as Ct,o as tt,L as m,r as q,b as l,c,e as t,f as s,w as _,g as n,R as O,h as D,i as S,j as k,t as v,p as Y,k as W,l as qt,S as Mt,F as $,m as xt,s as L,n as lt,q as I,v as mt,x as B,y as U,z as N,A as G,B as Z,C as jt,M as ct,D as wt,E as vt,G as pt,H as gt,I as kt,J as F,K as yt,N as et,P as ot,O as rt,_ as it,Q as nt,T as at,U as St,V as Et,W as Qt,X as Lt,Y as It,Z as At,$ as Tt,a0 as Bt,a1 as Ot,a2 as Rt,a3 as Dt,a4 as Pt,a5 as Nt,a6 as Ut,a7 as Kt,a8 as Vt,a9 as Ht,aa as Ft,ab as Yt,ac as Wt,ad as Jt,ae as Gt,af as Zt,ag as Xt,ah as te,ai as ee,aj as oe,ak as re,al as ie,am as ne,an as ae,ao as le,ap as se,aq as de,ar as me,as as ce,at as pe,au as ge}from"./vendor.5bb527e4.js";const be=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const p of a)if(p.type==="childList")for(const g of p.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function r(a){const p={};return a.integrity&&(p.integrity=a.integrity),a.referrerpolicy&&(p.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?p.credentials="include":a.crossorigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function i(a){if(a.ep)return;a.ep=!0;const p=r(a);fetch(a.href,p)}};be();const j=ht.create({baseURL:"/",headers:{Accept:"application/json","Content-Type":"application/json"}}),A=K("token",{state:()=>({token:Ct("token",""),sound:!0}),getters:{refresh_token(){return this.token?tt(this.token).refresh_token:""},eid(){return this.token?tt(this.token).eid:""},id(){return this.token?tt(this.token).user_id:""},is_admin(){return this.token?tt(this.token).is_admin:!1}},actions:{async getToken(){m.info("token:get"),await j.get("/auth/token",{withCredentials:!0}).then(e=>{this.token=e.data.token}).catch(e=>{e.response&&e.response.status===401?(this.token="",m.info("token:get login failed - redirecting to CAS"),window.location.href="/auth/login"):(m.error("token:get error"+e),this.token="")})},async tryToken(){m.info("token:try"),await j.get("/auth/token",{withCredentials:!0}).then(e=>{this.token=e.data.token}).catch(async e=>{e.response&&e.response.status===401?(m.info("token:try login failed - trying refresh token"),await this.refreshToken()):(m.error("token:try error"+e),this.token="")})},async refreshToken(){m.info("token:refresh"),await j.post("/auth/token",{refresh_token:this.refresh_token}).then(e=>{this.token=e.data.token}).catch(e=>{e.response&&e.response.status===401?(this.token="",m.info("token:refresh login failed - redirecting to CAS"),window.location.href="/auth/login"):(m.error("token:refresh error"+e),this.token="")})},async logout(){this.token="",window.location.href="/auth/logout"},async toggleSound(){this.sound=!this.sound}}});var P=(e,o)=>{const r=e.__vccOpts||e;for(const[i,a]of o)r[i]=a;return r};const ue=e=>(Y("data-v-5f1a5e7f"),e=e(),W(),e),fe={class:"navbar navbar-expand-md navbar-dark fixed-top bg-purple"},he={class:"container"},xe=k("Office Hours"),we=ue(()=>t("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarCollapse","aria-controls":"navbarCollapse","aria-expanded":"false","aria-label":"Toggle navigation"},[t("span",{class:"navbar-toggler-icon"})],-1)),ve={id:"navbarCollapse",class:"collapse navbar-collapse"},ke={class:"navbar-nav me-auto mb-2 mb-md-0"},ye={class:"nav-item"},_e=k("Queues"),ze={class:"nav-item"},$e=k("About"),Ce={key:0,class:"nav-item"},qe=k("Admin"),Me={key:1,class:"nav-item"},je=k("Data"),Se={class:""},Ee={key:0},Qe={class:"navbar-nav me-auto mb-2 mb-md-0"},Le={class:"nav-item"},Ie={class:"nav-item"},Ae={class:"nav-item"},Te=k(" Logout"),Be={key:1},Oe=k(" Login"),Re={__name:"NavBar",setup(e){const o=A();return(r,i)=>{const a=q("font-awesome-icon");return l(),c("nav",fe,[t("div",he,[s(n(O),{to:"/",class:"navbar-brand"},{default:_(()=>[xe]),_:1}),we,t("div",ve,[t("ul",ke,[t("li",ye,[s(n(O),{to:"/queues","active-class":"active",class:"nav-link"},{default:_(()=>[_e]),_:1})]),t("li",ze,[s(n(O),{to:"/about","active-class":"active",class:"nav-link"},{default:_(()=>[$e]),_:1})]),n(o).is_admin?(l(),c("li",Ce,[s(n(O),{to:"/admin","active-class":"active",class:"nav-link"},{default:_(()=>[qe]),_:1})])):D("",!0),n(o).is_admin?(l(),c("li",Me,[s(n(O),{to:"/data","active-class":"active",class:"nav-link"},{default:_(()=>[je]),_:1})])):D("",!0)]),t("div",Se,[n(o).token?(l(),c("div",Ee,[t("ul",Qe,[t("li",Le,[t("a",{class:"nav-link",onClick:i[0]||(i[0]=(...p)=>n(o).toggleSound&&n(o).toggleSound(...p))},[n(o).sound?(l(),S(a,{key:0,icon:"bell"})):(l(),S(a,{key:1,icon:"bell-slash"}))])]),t("li",Ie,[s(n(O),{to:"/profile","active-class":"active",class:"nav-link"},{default:_(()=>[s(a,{icon:"user"}),k(" "+v(n(o).eid),1)]),_:1})]),t("li",Ae,[t("a",{class:"btn btn-success float-end",onClick:i[1]||(i[1]=p=>n(o).logout())},[s(a,{icon:"arrow-right-from-bracket"}),Te])])])])):(l(),c("div",Be,[t("a",{class:"btn btn-success",onClick:i[2]||(i[2]=p=>n(o).getToken())},[s(a,{icon:"arrow-right-to-bracket"}),Oe])]))])])])])}}};var De=P(Re,[["__scopeId","data-v-5f1a5e7f"]]);const Pe={id:"main",class:"container px-4 py-5"},Ne={__name:"App",setup(e){return(o,r)=>(l(),c($,null,[t("header",null,[s(De)]),t("div",Pe,[(l(),S(Mt,null,{default:_(()=>[s(n(qt))]),_:1}))])],64))}};var Ue=P(Ne,[["__scopeId","data-v-68e3a569"]]);const Ke="modulepreload",ft={},Ve="/",He=function(o,r){return!r||r.length===0?o():Promise.all(r.map(i=>{if(i=`${Ve}${i}`,i in ft)return;ft[i]=!0;const a=i.endsWith(".css"),p=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${p}`))return;const g=document.createElement("link");if(g.rel=a?"stylesheet":Ke,a||(g.as="script",g.crossOrigin=""),g.href=i,document.head.appendChild(g),a)return new Promise((w,u)=>{g.addEventListener("load",w),g.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>o())};const Fe={},Ye=e=>(Y("data-v-193ed13f"),e=e(),W(),e),We={class:"pb-2 border-bottom"},Je=k(" Office Hours Queue "),Ge=Ye(()=>t("div",{class:"row p-4 pb-0 pt-lg-4 pb-lg-4 align-items-center rounded-3 border shadow-lg"},[t("div",{class:"col-lg-10 mx-auto"},[t("p",{class:"lead-custom text-center"},[k(" Welcome! This site manages virtual queues for office hours."),t("br"),k("Let's get started! ")])])],-1));function Ze(e,o){const r=q("font-awesome-icon");return l(),c($,null,[t("h2",We,[s(r,{icon:"chalkboard-teacher"}),Je]),Ge],64)}var Xe=P(Fe,[["render",Ze],["__scopeId","data-v-193ed13f"]]);const to=t("br",null,null,-1),eo={key:0},oo=k("Click Here to See Available Queues"),ro={key:1},io=k(" Login"),no={__name:"LoginMessage",setup(e){const o=A();return(r,i)=>{const a=q("RouterLink"),p=q("font-awesome-icon");return l(),c("main",null,[s(Xe),to,n(o).token?(l(),c("div",eo,[s(a,{to:"/queues",class:"btn btn-success"},{default:_(()=>[oo]),_:1})])):(l(),c("div",ro,[t("a",{class:"btn btn-success",onClick:i[0]||(i[0]=g=>n(o).getToken())},[s(p,{icon:"arrow-right-to-bracket"}),io])]))])}}},ao={__name:"HomeView",setup(e){return(o,r)=>(l(),S(no))}};const lo={},so=e=>(Y("data-v-5250f3b6"),e=e(),W(),e),mo={class:"pb-2 border-bottom"},co=k(" Office Hours Queue "),po=so(()=>t("div",{class:"row p-4 pb-0 pt-lg-4 pb-lg-4 align-items-center rounded-3 border shadow-lg"},[t("div",{class:"col-lg-10 mx-auto"},[t("p",{class:"lead-custom text-center"}," Select a queue to join: ")])],-1));function go(e,o){const r=q("font-awesome-icon");return l(),c($,null,[t("h2",mo,[s(r,{icon:"chalkboard-teacher"}),co]),po],64)}var bo=P(lo,[["render",go],["__scopeId","data-v-5250f3b6"]]);const T=K("queues",{state:()=>({queues:[],online:[],socket:void 0,connected:!1,error:!1}),getters:{getQueue:e=>o=>e.queues.find(r=>r.id==o),getOnline:e=>o=>e.online.find(r=>r.id==o)||{is_open:!1,helpers:0,requests:0},sortedQueues:e=>[...e.queues].sort((o,r)=>r.is_open-o.is_open)},actions:{async hydrate(){m.info("queues:hydrate"),await j.get("/api/v1/queues").then(e=>{this.queues=e.data})},async hydrateOnline(){m.info("queues:hydrateOnline"),this.socket&&(this.socket.disconnect(),this.online={});const e=A(),o="/status";this.socket=xt(o,{auth:{token:e.token}}),this.socket.on("connect",()=>{m.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",r=>{m.error("socket:connect_error - "+r),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{m.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("status:update",async r=>{m.info("status:update - "+r.id),m.debug("|- updated: "+r);var i=this.online.findIndex(a=>a.id===r.id);i<0?this.online.push(r):Object.assign(this.online[i],r)}),m.info("emit status:connect"),await this.socket.emit("status:connect",async(r,i)=>{r==200?(m.info("status:connect OK"),m.debug("|- online: "+i),this.online=i):m.error("status:connect error - "+r)})},async disconnectQueue(){this.socket&&(m.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async update(e){await j.post("/api/v1/queues/"+e.id,{queue:e}).then(async()=>{await this.hydrate()})},async deleteQueue(e){await j.delete("/api/v1/queues/"+e).then(async()=>{await this.hydrate()})},async addQueue(e){await j.put("/api/v1/queues/",{name:e}).then(async()=>{await this.hydrate()})}}});const uo={class:"col"},fo={class:"card-header"},ho={key:0,class:"float-end badge rounded-pill bg-success"},xo={key:1,class:"float-end badge rounded-pill bg-danger"},wo={class:"card-body"},vo={class:"card-text"},ko={__name:"QueueCard",props:{queue:{type:Object,default(){return{}}}},setup(e){const o=e,r=T(),{getOnline:i}=L(r),a=lt();function p(g){a.push("/queues/"+g)}return(g,w)=>{const u=q("font-awesome-icon");return l(),c("div",uo,[t("div",{class:"card w-100 hvr-grow",onClick:w[0]||(w[0]=f=>p(o.queue.id))},[t("h5",fo,[k(v(o.queue.name)+" ",1),n(i)(o.queue.id).is_open===1?(l(),c("span",ho,[k("Open | "+v(n(i)(o.queue.id).helpers||0)+" ",1),s(u,{icon:"user-graduate"}),k(" | "+v(n(i)(o.queue.id).requests||0)+" ",1),s(u,{icon:"circle-question"})])):(l(),c("span",xo,"Closed"))]),t("div",wo,[t("p",vo,v(o.queue.snippet),1)])])])}}};var yo=P(ko,[["__scopeId","data-v-3228e55c"]]);const _o={class:"row row-cols-1 row-cols-lg-3 g-4"},zo={__name:"QueueList",async setup(e){let o,r;const i=T();i.hydrate(),[o,r]=I(()=>i.hydrateOnline()),await o,r();const{sortedQueues:a}=L(i);return mt(async()=>{await i.disconnectQueue()}),(p,g)=>(l(),c("div",_o,[(l(!0),c($,null,B(n(a),(w,u)=>(l(),S(yo,{key:w.id,queue:w,index:u},null,8,["queue","index"]))),128))]))}},$o=t("br",null,null,-1),Co={__name:"QueueListView",setup(e){return(o,r)=>(l(),c("main",null,[s(bo),$o,s(zo)]))}},X=K("requests",{state:()=>({requests:[],online:[],helpers:[],socket:void 0,connected:!1,error:!1}),getters:{getRequest:e=>o=>e.requests.find(r=>r.user_id===o),userOnline:e=>o=>e.online.find(r=>r==o)!==void 0,sortedRequests:e=>[...e.requests].sort(function(o,r){return o.status_id==r.status_id?o.id-r.id:r.status_id-o.status_id})},actions:{async connectQueue(e){this.socket&&this.socket.disconnect(),this.$reset();const o=A(),r="/";this.socket=xt(r,{auth:{token:o.token,queue_id:e}}),this.socket.on("connect",()=>{m.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",i=>{m.error("socket:connect_error - "+i),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{m.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("queue:update",async i=>{m.info("queue:update - "+i.id),m.debug("|- updated: "+i);var a=this.requests.findIndex(p=>p.id===i.id);a<0?(this.requests.push(i),o.sound&&new Audio("/ding-36029.mp3").play()):this.requests[a]=i}),this.socket.on("queue:remove",async i=>{m.info("queue.remove - "+i);var a=this.requests.findIndex(p=>p.id===i);a>=0&&this.requests.splice(a,1)}),this.socket.on("user:online",async i=>{m.info("user:online - "+i),this.online.push(String(i))}),this.socket.on("user:offline",async i=>{m.info("user:offline - "+i),this.online.splice(this.online.indexOf(String(i)),1)}),this.socket.on("helper:online",async i=>{m.info("helper:online - "+i.id),m.debug("|- helper: "+i),this.helpers.push(i)}),this.socket.on("helper:offline",async i=>{m.info("helper:offline - "+i),this.helpers.splice(this.helpers.findIndex(a=>a.id==i),1)}),this.socket.on("queue:opening",async()=>{m.info("queue:opening"),await T().hydrate()}),this.socket.on("connected",async(i,a)=>{m.info("socket:connected"),m.debug("|-online: "+i),m.debug("|-helpers: "+a),this.online=i,this.helpers=a}),this.socket.on("queue:closing",async()=>{m.info("queue:closing"),this.requests=[],await T().hydrate()}),m.info("emit queue:connect"),await this.socket.emit("queue:connect",async(i,a)=>{i==200?(m.info("queue:connect OK"),m.debug("|- requests: "+a),this.requests=a):m.error("queue:connect error - "+i)})},async disconnectQueue(){this.socket&&(m.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async joinQueue(){m.info("emit queue:join"),await this.socket.emit("queue:join",async e=>{e==200?m.info("queue:join OK"):m.error("queue:join error - "+e)})},async openQueue(){m.info("emit queue:open"),await this.socket.emit("queue:open",async e=>{e==200?(m.info("queue:open OK"),T().hydrate()):m.error("queue:open error - "+e)})},async closeQueue(){m.info("emit queue:close"),await this.socket.emit("queue:close",async e=>{e==200?(m.info("queue:close OK"),this.requests=[],T().hydrate()):m.error("queue:close error - "+e)})},async takeRequest(e){m.info("emit request:take - "+e),await this.socket.emit("request:take",e,async o=>{o==200?m.info("request:take OK"):m.error("request:take error - "+o)})},async deleteRequest(e){m.info("emit request:delete - "+e),await this.socket.emit("request:delete",e,async o=>{o==200?m.info("request:delete OK"):m.error("request:delete error - "+o)})},async finishRequest(e){m.info("emit request:finish - "+e),await this.socket.emit("request:finish",e,async o=>{o==200?m.info("request:finish OK"):m.error("request:finish error - "+o)})},async requeueRequest(e){m.info("emit request:requeue - "+e),await this.socket.emit("request:requeue",e,async o=>{o==200?m.info("request:requeue OK"):m.error("request:requeue error - "+o)})}}});const qo=e=>(Y("data-v-4e001cb8"),e=e(),W(),e),Mo={key:2,class:"badge bg-primary rounded-pill"},jo=qo(()=>t("br",null,null,-1)),So={id:"tooltip",class:"text-muted"},Eo={__name:"RequestItem",props:{request:{type:Object,default(){return{}}},helper:{type:Boolean,default(){return!1}},userId:{type:Number,default(){return-1}}},setup(e){const o=e;var r=U({now:N.utc()});const i=X(),a=async function(){await i.deleteRequest(o.request.id)},p=async function(){await i.takeRequest(o.request.id)},g=async function(){await i.finishRequest(o.request.id)},w=async function(){await i.requeueRequest(o.request.id)},u=G(()=>o.request.updated_at?r.now.to(o.request.updated_at):r.now.to(o.request.created_at));return(f,h)=>{const b=q("font-awesome-icon");return l(),c("li",{class:Z(["list-group-item",[e.request.status_id==2?"list-group-item-primary":"",e.request.user_id==e.userId?"current-user":"",n(i).userOnline(e.request.user_id)?"":"list-group-item-light"]])},[n(i).userOnline(e.request.user_id)?(l(),S(b,{key:0,icon:"link"})):(l(),S(b,{key:1,icon:"link-slash"})),k(" "+v(e.request.user.name)+" ",1),e.helper?(l(),c($,{key:2},[t("button",{class:"float-end btn btn-danger btn-sm mx-1",onClick:a},[s(b,{icon:"times",size:"xl"})]),t("button",{class:"float-end btn btn-secondary btn-sm mx-1",onClick:w},[s(b,{icon:"redo",size:"lg"})]),e.request.status_id==1?(l(),c("button",{key:0,class:"float-end btn btn-primary btn-sm mx-1",onClick:p}," Take ")):(l(),c("button",{key:1,class:"float-end btn btn-success btn-sm mx-1",onClick:g}," Done ")),e.request.status_id==2?(l(),c("span",Mo,v(e.request.helper.name),1)):D("",!0),jo,t("small",So,v(n(u)),1)],64)):D("",!0)],2)}}};var Qo=P(Eo,[["__scopeId","data-v-4e001cb8"]]);const Lo=t("h3",{class:"text-center"},"Students Waiting",-1),Io=t("hr",null,null,-1),Ao={class:"list-group list-group-numbered"},_t={__name:"RequestList",props:{id:{type:Number,default:-1}},setup(e){const o=A(),r=X(),{sortedRequests:i}=L(r);return(a,p)=>(l(),c($,null,[Lo,Io,t("ul",Ao,[(l(!0),c($,null,B(n(i),(g,w)=>(l(),S(Qo,jt({key:g.id,request:g,index:w},a.$attrs,{"user-id":n(o).id}),null,16,["request","index","user-id"]))),128))])],64))}},To=t("h3",{class:"text-center"},"Helpers Online",-1),Bo=t("hr",null,null,-1),Oo={class:"list-group list-group-flush"},zt={__name:"HelperList",setup(e){const o=X(),{helpers:r}=L(o);return(i,a)=>{const p=q("font-awesome-icon");return l(),c($,null,[To,Bo,t("ul",Oo,[(l(!0),c($,null,B(n(r),(g,w)=>(l(),c("li",{key:w,class:"list-group-item"},[s(p,{icon:"link"}),k(" "+v(g.name),1)]))),128))])],64)}}};const J=e=>(Y("data-v-38a96dbb"),e=e(),W(),e),Ro={class:"queue-header mx-auto"},Do={key:0,class:"btn btn-outline-success float-end disabled"},Po=J(()=>t("span",{class:"visually-hidden"},"Connected!",-1)),No=J(()=>t("span",{class:"visually-hidden"},"Disconnected!",-1)),Uo=J(()=>t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),Ko=J(()=>t("span",{class:"visually-hidden"},"Connecting...",-1)),Vo=[Uo,Ko],Ho=J(()=>t("h2",{class:"text-center"},"Moderate Queue",-1)),Fo=J(()=>t("hr",null,null,-1)),Yo={class:"row"},Wo={class:"col-12 col-md-4 mb-4"},Jo={class:"col-12 col-md-8 mb-4"},Go={__name:"HelperPane",props:{id:{type:Number,default:-1}},async setup(e){let o,r;const i=e,a=T();[o,r]=I(()=>a.hydrate()),await o,r();const p=a.getQueue,g=X(),{connected:w,error:u}=L(g);[o,r]=I(()=>g.connectQueue(i.id)),await o,r();const f=async function(){confirm("Are you sure? All pending requests will be lost!")&&await g.closeQueue()},h=async function(){await g.openQueue()},b=async function(){await g.connectQueue(i.id)};return mt(async()=>{await g.disconnectQueue()}),(d,x)=>{const z=q("font-awesome-icon");return l(),c($,null,[t("div",Ro,[n(w)?(l(),c("button",Do,[s(z,{icon:"link"}),Po])):(l(),c($,{key:1},[n(u)?(l(),c("button",{key:0,class:"btn btn-outline-danger float-end",onClick:b},[s(z,{icon:"link-slash"}),No])):(l(),c("button",{key:1,class:"btn btn-outline-warning float-end",onClick:b},Vo))],64)),Ho,n(p)(e.id).is_open==1?(l(),c("a",{key:2,class:"w-100 btn btn-success",onClick:f},"Queue is Open - Click to Close")):(l(),c("a",{key:3,class:"w-100 btn btn-danger",onClick:h},"Queue is Closed - Click to Open"))]),Fo,t("div",Yo,[t("div",Wo,[s(zt)]),t("div",Jo,[s(_t,{id:e.id,helper:""},null,8,["id"])])])],64)}}};var Zo=P(Go,[["__scopeId","data-v-38a96dbb"]]);const R=e=>(Y("data-v-3eaf00d9"),e=e(),W(),e),Xo={id:"studentModal",class:"modal fade",tabindex:"-1","aria-labelledby":"studentModalLabel","aria-hidden":"true"},tr={class:"modal-dialog"},er={class:"modal-content"},or=R(()=>t("div",{class:"modal-header"},[t("h5",{id:"studentModalLabel",class:"modal-title"},"Your Turn!"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),rr={class:"modal-body"},ir=k(" You will be helped by "),nr=k(". Their contact info is below: "),ar=R(()=>t("hr",null,null,-1)),lr=["innerHTML"],sr=R(()=>t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," OK ")],-1)),dr={class:"queue-header mx-auto"},mr={key:0,class:"btn btn-outline-success float-end disabled"},cr=R(()=>t("span",{class:"visually-hidden"},"Connected!",-1)),pr=R(()=>t("span",{class:"visually-hidden"},"Disconnected!",-1)),gr=R(()=>t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),br=R(()=>t("span",{class:"visually-hidden"},"Connecting...",-1)),ur=[gr,br],fr=R(()=>t("h2",{class:"text-center"},"Waiting Queue",-1)),hr={key:0,class:"w-100 btn btn-success disabled",disabled:""},xr={key:3,class:"w-100 btn btn-danger disabled",disabled:""},wr=R(()=>t("hr",null,null,-1)),vr={key:0,class:"row"},kr={class:"col-12 col-md-4 mb-4"},yr={class:"col-12 col-md-8 mb-4"},_r={__name:"StudentPane",props:{id:{type:Number,default:-1}},async setup(e){let o,r;const i=e,a=A(),p=T();[o,r]=I(()=>p.hydrate()),await o,r();const g=p.getQueue,w=X(),u=w.getRequest,{connected:f,error:h}=L(w);[o,r]=I(()=>w.connectQueue(i.id)),await o,r();var b,d=!1;w.$subscribe(()=>{const y=u(a.id);y&&y.status_id==2&&!d&&(d=!0,b=new ct("#studentModal",{}),b.show(),a.sound&&new Audio("/ding-36029.mp3").play()),y||(d=!1)});const x=async function(){d=!1,await w.joinQueue()},z=async function(){await w.connectQueue(i.id)};return mt(async()=>{await w.disconnectQueue()}),(y,M)=>{const Q=q("font-awesome-icon");return l(),c($,null,[t("div",Xo,[t("div",tr,[t("div",er,[or,t("div",rr,[n(u)(n(a).id)&&n(u)(n(a).id).helper?(l(),c($,{key:0},[t("p",null,[ir,t("strong",null,v(n(u)(n(a).id).helper.name),1),nr]),ar,t("div",{innerHTML:n(wt).sanitize(n(vt).parse(n(u)(n(a).id).helper.contact_info||""))},null,8,lr)],64)):D("",!0)]),sr])])]),t("div",dr,[n(f)?(l(),c("button",mr,[s(Q,{icon:"link"}),cr])):(l(),c($,{key:1},[n(h)?(l(),c("button",{key:0,class:"btn btn-outline-danger float-end",onClick:z},[s(Q,{icon:"link-slash"}),pr])):(l(),c("button",{key:1,class:"btn btn-outline-warning float-end",onClick:z},ur))],64)),fr,n(g)(e.id).is_open==1?(l(),c($,{key:2},[n(u)(n(a).id)!=null?(l(),c("a",hr,"Queue Joined")):(l(),c("a",{key:1,class:"w-100 btn btn-success",onClick:M[0]||(M[0]=E=>x())},"Join Queue"))],64)):(l(),c("a",xr,"Queue is Closed"))]),wr,n(g)(e.id).is_open==1?(l(),c("div",vr,[t("div",kr,[s(zt)]),t("div",yr,[s(_t,{id:e.id},null,8,["id"])])])):D("",!0)],64)}}};var zr=P(_r,[["__scopeId","data-v-3eaf00d9"]]);const $r=k(" Back"),Cr=k(" Edit"),qr={class:"display-5 text-center"},Mr=t("hr",null,null,-1),jr=["innerHTML"],Sr=t("hr",null,null,-1),Er={__name:"QueueSingle",props:{id:{type:Number,default:-1}},async setup(e){let o,r;const i=A(),a=T();[o,r]=I(()=>a.hydrate()),await o,r();const p=a.getQueue;return(g,w)=>{const u=q("font-awesome-icon");return l(),c("main",null,[s(n(O),{to:{name:"queues"},class:"btn btn-secondary float-start"},{default:_(()=>[s(u,{icon:"arrow-left"}),$r]),_:1}),n(i).is_admin?(l(),S(n(O),{key:0,to:{name:"queue_edit",params:{id:e.id}},class:"btn btn-secondary float-end"},{default:_(()=>[s(u,{icon:"pen-to-square"}),Cr]),_:1},8,["to"])):D("",!0),t("h1",qr,v(n(p)(e.id).name),1),Mr,t("div",{innerHTML:n(wt).sanitize(n(vt).parse(n(p)(e.id).description||""))},null,8,jr),Sr,n(p)(e.id).helper==1?(l(),S(Zo,{key:1,id:e.id},null,8,["id"])):(l(),S(zr,{key:2,id:e.id},null,8,["id"]))])}}},Qr={__name:"QueueSingleView",setup(e){return(o,r)=>(l(),S(Er))}},bt=K("users",{state:()=>({users:[]}),getters:{getUser:e=>o=>e.users.find(r=>r.id===o)},actions:{async hydrate(){m.info("users:hydrate"),await j.get("/api/v1/users").then(e=>{this.users=e.data})},async update(e){await j.post("/api/v1/users/"+e.id,{user:e}).then(async()=>{await this.hydrate()})},async deleteUser(e){await j.delete("/api/v1/users/"+e).then(async()=>{await this.hydrate()})},async addUser(e){await j.put("/api/v1/users/",{eid:e}).then(async()=>{await this.hydrate()})}}});const Lr=t("h1",{class:"display-5 text-center"},"Edit Queue",-1),Ir=t("hr",null,null,-1),Ar={class:"mb-3"},Tr=t("label",{for:"multiselect-users",class:"form-label"},"Helpers",-1),Br=t("div",{class:"form-text"}," Helpers who can manage the queue (usually TAs) - admins already have access ",-1),Or={class:"row row-cols-1 row-cols-md-2"},Rr=t("div",{class:"col d-grid mb-2"},[t("button",{class:"btn btn-success"},"Save")],-1),Dr={class:"col d-grid mb-2"},Pr=k(" Cancel"),Nr=k(" Cancel"),Ur={__name:"EditQueue",props:{id:{type:Number,default:-1},admin:{type:Boolean,default:!1}},async setup(e){let o,r;const i=e,a=lt(),p=T();[o,r]=I(()=>p.hydrate()),await o,r();const g=p.getQueue(i.id),w=bt();w.hydrate();const{users:u}=L(w);var f;pt(()=>{f=new gt({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const h=async b=>{b=(({id:d,name:x,snippet:z})=>({id:d,name:x,snippet:z}))(b),b.description=f.value(),b.users=[];for(const d of g.users)b.users.push({id:d.id});try{await p.update(b),i.admin?a.push("/admin"):a.push("/queues/"+g.id)}catch(d){if(d.response&&d.response.status===422){let x={};if(d.response.data.data){for(const z in d.response.data.data){x[z]="";for(const y of d.response.data.data[z])x[z]=x[z]+y.message+" "}F("queueform",["The server rejected this submission. Please correct errors listed above"],x)}else F("queueform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(d)}};return(b,d)=>{const x=q("FormKit"),z=q("router-link");return l(),c("main",null,[Lr,Ir,s(x,{id:"queueform",type:"form",value:n(g),actions:!1,onSubmit:h},{default:_(()=>[s(x,{type:"text",name:"name",label:"Queue Name",help:"Name of the queue (usually the course)",validation:"required"}),s(x,{type:"text",name:"snippet",label:"Short Description",help:"Short description shown on the initial card"}),s(x,{type:"textarea",name:"description",label:"Long Description",help:"Long description shown on the queue page",rows:"10"}),t("div",Ar,[Tr,s(n(kt),{id:"multiselect-users",modelValue:n(g).users,"onUpdate:modelValue":d[0]||(d[0]=y=>n(g).users=y),class:"form-control",options:n(u),multiple:!0,"tag-placeholder":"Add this as new user",placeholder:"Type to search or add user",label:"eid","track-by":"id"},null,8,["modelValue","options"]),Br]),t("div",Or,[Rr,t("div",Dr,[e.admin?(l(),S(z,{key:0,to:{name:"admin"},class:"btn btn-secondary"},{default:_(()=>[Pr]),_:1})):(l(),S(z,{key:1,to:{name:"queue_single",params:{id:n(g).id}},class:"btn btn-secondary"},{default:_(()=>[Nr]),_:1},8,["to"]))])])]),_:1},8,["value"])])}}},Kr={__name:"QueueEditView",setup(e){return(o,r)=>(l(),S(Ur))}},Vr=K("profile",{state:()=>({user:{}}),actions:{async hydrate(){m.info("profile:hydrate"),await j.get("/api/v1/profile").then(e=>{this.user=e.data})},async update(e){await j.post("/api/v1/profile/",{user:e}).then(async()=>{await this.hydrate()})}}});const Hr=t("h1",{class:"display-5 text-center"},"Edit User",-1),Fr=t("hr",null,null,-1),Yr={class:"row row-cols-1 row-cols-md-2"},Wr=t("div",{class:"col d-grid mb-2"},[t("button",{class:"btn btn-success"},"Save")],-1),Jr={class:"col d-grid mb-2"},Gr=k(" Cancel"),Zr={__name:"EditProfile",async setup(e){let o,r;const i=lt(),a=Vr();[o,r]=I(()=>a.hydrate()),await o,r();const{user:p}=L(a);var g;pt(()=>{g=new gt({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const w=async u=>{const f={name:u.name,contact_info:g.value()};try{await a.update(f),i.push("/queues/")}catch(h){if(h.response&&h.response.status===422){let b={};if(h.response.data.data){for(const d in h.response.data.data){b[d]="";for(const x of h.response.data.data[d])b[d]=b[d]+x.message+" "}F("userform",["The server rejected this submission. Please correct errors listed above"],b)}else F("userform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(h)}};return(u,f)=>{const h=q("FormKit"),b=q("router-link");return l(),c("main",null,[Hr,Fr,s(h,{id:"userform",type:"form",value:n(p),actions:!1,onSubmit:w},{default:_(()=>[s(h,{type:"text",name:"eid",label:"eID",disabled:!0,help:"Your K-State eID (cannot be changed)",validation:"required"}),s(h,{type:"text",name:"name",label:"Name",help:"Your full name as you'd like it displayed on the site",validation:"required"}),s(h,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact you",rows:"10"}),t("div",Yr,[Wr,t("div",Jr,[s(b,{to:{name:"queues"},class:"btn btn-secondary"},{default:_(()=>[Gr]),_:1})])])]),_:1},8,["value"])])}}};const Xr={__name:"ProfileView",setup(e){return(o,r)=>(l(),S(Zr))}},ti={id:"userModal",class:"modal fade",tabindex:"-1","aria-labelledby":"userModalLabel","aria-hidden":"true"},ei={class:"modal-dialog"},oi={class:"modal-content"},ri=t("div",{class:"modal-header"},[t("h5",{id:"userModalLabel",class:"modal-title"},"Delete User"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ii={class:"modal-body"},ni=t("h5",null,"Are you sure you want to delete this user?",-1),ai=t("strong",null,"eID: ",-1),li=t("br",null,null,-1),si=t("strong",null,"Name: ",-1),di={class:"modal-footer"},mi=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),ci=k(" Delete User "),pi=k(" User "),gi=t("h1",{class:"text-center"},"Users",-1),bi={class:"table table-striped table-hover"},ui=t("thead",null,[t("tr",null,[t("th",null,"eID"),t("th",null,"Name"),t("th",null,"Roles"),t("th",null,"Actions")])],-1),fi=["onClick"],hi={__name:"UserAdmin",setup(e){const o=bt();o.hydrate();const{users:r}=L(o),i=A();var a=U({}),p;const g=function(f){a.id=f.id,a.eid=f.eid,a.name=f.name,p=new ct("#userModal",{}),p.show()},w=async function(f){await o.deleteUser(f),p.hide()},u=async function(){var f=prompt("Enter an eID to create a user");if(f)try{await o.addUser(f)}catch(h){h.response&&h.response.status===422?alert(JSON.stringify(h.response.data)):alert(h)}};return(f,h)=>{const b=q("font-awesome-icon");return l(),c($,null,[t("div",ti,[t("div",ei,[t("div",oi,[ri,t("div",ii,[ni,t("p",null,[ai,k(v(n(a).eid)+" ",1),li,si,k(v(n(a).name),1)])]),t("div",di,[mi,t("button",{type:"button",class:"btn btn-danger",onClick:h[0]||(h[0]=d=>w(n(a).id))},[s(b,{icon:"trash"}),ci])])])])]),t("button",{type:"button",class:"btn btn-success float-end",onClick:u},[s(b,{icon:"plus"}),pi]),gi,t("table",bi,[ui,t("tbody",null,[(l(!0),c($,null,B(n(r),d=>(l(),c("tr",{key:d.id},[t("td",null,v(d.eid),1),t("td",null,v(d.name),1),t("td",null,[(l(!0),c($,null,B(d.roles,x=>(l(),c("span",{key:x.id,class:"badge rounded-pill bg-success"},v(x.name),1))),128))]),t("td",null,[s(n(O),{to:{name:"admin_useredit",params:{id:d.id}},class:"btn btn-secondary btn-sm mx-1"},{default:_(()=>[s(b,{icon:"pen-to-square"})]),_:2},1032,["to"]),d.id!=n(i).id?(l(),c("button",{key:0,type:"button",class:"btn btn-danger btn-sm mx-1",onClick:yt(x=>g(d),["prevent"])},[s(b,{icon:"trash"})],8,fi)):D("",!0)])]))),128))])])],64)}}},xi={id:"queueModal",class:"modal fade",tabindex:"-1","aria-labelledby":"queueModalLabel","aria-hidden":"true"},wi={class:"modal-dialog"},vi={class:"modal-content"},ki=t("div",{class:"modal-header"},[t("h5",{id:"queueModalLabel",class:"modal-title"},"Delete Queue"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),yi={class:"modal-body"},_i=t("h5",null,"Are you sure you want to delete this queue?",-1),zi=t("strong",null,"Name: ",-1),$i={class:"modal-footer"},Ci=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),qi=k(" Delete Queue "),Mi=k(" Queue "),ji=t("h1",{class:"text-center"},"Queues",-1),Si={class:"table table-striped table-hover"},Ei=t("thead",null,[t("tr",null,[t("th",null,"Name"),t("th",null,"Actions")])],-1),Qi=["onClick"],Li={__name:"QueueAdmin",setup(e){const o=T();o.hydrate();const{queues:r}=L(o);var i=U({}),a;const p=function(u){i.id=u.id,i.name=u.name,a=new ct("#queueModal",{}),a.show()},g=async function(u){await o.deleteQueue(u),a.hide()},w=async function(){var u=prompt("Enter a name for the new queue");if(u)try{await o.addQueue(u)}catch(f){f.response&&f.response.status===422?alert(JSON.stringify(f.response.data)):alert(f)}};return(u,f)=>{const h=q("font-awesome-icon"),b=q("router-link");return l(),c($,null,[t("div",xi,[t("div",wi,[t("div",vi,[ki,t("div",yi,[_i,t("p",null,[zi,k(v(n(i).name),1)])]),t("div",$i,[Ci,t("button",{type:"button",class:"btn btn-danger",onClick:f[0]||(f[0]=d=>g(n(i).id))},[s(h,{icon:"trash"}),qi])])])])]),t("button",{type:"button",class:"btn btn-success float-end",onClick:w},[s(h,{icon:"plus"}),Mi]),ji,t("table",Si,[Ei,t("tbody",null,[(l(!0),c($,null,B(n(r),d=>(l(),c("tr",{key:d.id},[t("td",null,v(d.name),1),t("td",null,[s(b,{to:{name:"queue_edit",params:{id:d.id,admin:!0}},class:"btn btn-secondary btn-sm mx-1"},{default:_(()=>[s(h,{icon:"pen-to-square"})]),_:2},1032,["to"]),t("button",{type:"button",class:"btn btn-danger btn-sm mx-1",onClick:yt(x=>p(d),["prevent"])},[s(h,{icon:"trash"})],8,Qi)])]))),128))])])],64)}}},Ii={__name:"AdminView",setup(e){return(o,r)=>(l(),c($,null,[s(Li),s(hi)],64))}},Ai=K("roles",{state:()=>({roles:[]}),actions:{async hydrate(){m.info("roles:hydrate"),await j.get("/api/v1/roles").then(e=>{this.roles=e.data})}}});const Ti=t("h1",{class:"display-5 text-center"},"Edit User",-1),Bi=t("hr",null,null,-1),Oi={class:"mb-3"},Ri=t("label",{for:"multiselect-roles",class:"form-label"},"Roles",-1),Di=t("div",{class:"form-text"},"Roles assigned to this user",-1),Pi={class:"row row-cols-1 row-cols-md-2"},Ni=t("div",{class:"col d-grid mb-2"},[t("button",{class:"btn btn-success"},"Save")],-1),Ui={class:"col d-grid mb-2"},Ki=k(" Cancel"),Vi={__name:"UserEdit",props:{id:{type:Number,default:-1}},async setup(e){let o,r;const i=e,a=lt(),p=bt();[o,r]=I(()=>p.hydrate()),await o,r();const g=p.users.find(b=>b.id===parseInt(i.id)),w=Ai();w.hydrate();const{roles:u}=L(w);var f;pt(()=>{f=new gt({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const h=async b=>{b=(({id:d,name:x})=>({id:d,name:x}))(b),b.contact_info=f.value(),b.roles=[];for(const d of g.roles)b.roles.push({id:d.id});try{await p.update(b),a.push("/admin/")}catch(d){if(d.response&&d.response.status===422){let x={};if(d.response.data.data){for(const z in d.response.data.data){x[z]="";for(const y of d.response.data.data[z])x[z]=x[z]+y.message+" "}F("usersForm",["The server rejected this submission. Please correct errors listed above"],x)}else F("usersForm",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(d)}};return(b,d)=>{const x=q("FormKit"),z=q("router-link");return l(),c("main",null,[Ti,Bi,s(x,{id:"userform",type:"form",value:n(g),actions:!1,onSubmit:h},{default:_(()=>[s(x,{type:"text",name:"eid",label:"eID",disabled:!0,help:"The user's K-State eID (cannot be changed)",validation:"required"}),s(x,{type:"text",name:"name",label:"Name",help:"The user's full name as you'd like it displayed on the site",validation:"required"}),s(x,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact the user",rows:"10"}),t("div",Oi,[Ri,s(n(kt),{id:"multiselect-roles",modelValue:n(g).roles,"onUpdate:modelValue":d[0]||(d[0]=y=>n(g).roles=y),class:"form-control",options:n(u),multiple:!0,"tag-placeholder":"Add this as new role",placeholder:"Type to search or add role",label:"name","track-by":"id"},null,8,["modelValue","options"]),Di]),t("div",Pi,[Ni,t("div",Ui,[s(z,{to:{name:"admin"},class:"btn btn-secondary"},{default:_(()=>[Ki]),_:1})])])]),_:1},8,["value"])])}}},Hi={__name:"UserEditView",setup(e){return(o,r)=>(l(),S(Vi))}},ut=K("periods",{state:()=>({queues:[],periods:[],events:[],presences:[]}),getters:{getPeriod:e=>o=>e.periods.find(r=>r.id==o),getEventsTimline:e=>{var o=[{name:"Queued",data:[]},{name:"Taken",data:[]}];for(var r of e.events)r.status=="Queued"?o[0].data.push({x:r.eid,y:[N(r.created_at).valueOf(),r.updated_at===null?N().valueOf():N(r.updated_at).valueOf()]}):r.status=="Taken"&&o[1].data.push({x:r.eid,y:[N(r.created_at).valueOf(),r.updated_at===null?N().valueOf():N(r.updated_at).valueOf()],z:r.presence?r.presence.eid:""});return o}},actions:{async hydrate(){m.info("periods:hydrate"),await j.get("/api/v1/periods").then(e=>{this.queues=e.data})},async loadPeriods(e){m.info("periods:hydrate - "+e),await j.get("/api/v1/periods?name="+e).then(o=>{this.periods=o.data})},async loadEvents(e){m.info("periods:hydrate - "+e),await j.get("/api/v1/periods/"+e).then(o=>{this.events=o.data.events,this.presences=o.data.presences})}}});const Fi=t("h1",{class:"display-5 text-center"},"Event Log: Queues",-1),Yi=["data-page-count"],Wi={class:"col-md-6 mb-2 mb-md-0"},Ji={class:"col-md-6"},Gi={class:"row"},Zi={class:"col-md-12"},Xi={class:"table-responsive"},tn={class:"table table-striped d-md-table"},en=["onClick"],on=t("i",{class:"gg-select float-right"},null,-1),rn=t("th",null,"Actions",-1),nn=k("View"),an={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},ln={__name:"QueueList",async setup(e){let o,r;const i=ut();[o,r]=I(()=>i.hydrate()),await o,r();const{queues:a}=L(i),p=U([{name:"Queue",field:"queue_name",sort:""},{name:"Periods",field:"periods",sort:""},{name:"Recent",field:"recent",sort:""}]),g=function(u,f){let h;const b=p[f];u.shiftKey||this.cols.forEach(d=>{d.field!==b.field&&(d.sort="")}),b.sort||(h="asc"),b.sort==="desc"&&(h=u.shiftKey?"":"asc"),b.sort==="asc"&&(h="desc"),b.sort=h},w=G(()=>p.reduce((u,f)=>(f.sort&&(f.sort==="asc"?u.push(f.field):u.push("-"+f.field)),u),[]));return(u,f)=>{const h=q("router-link");return l(),c($,null,[Fi,s(n(at),{"ds-data":n(a),"ds-sortby":n(w)},{default:_(({ds:b})=>[t("div",{class:"row","data-page-count":b.dsPagecount},[t("div",Wi,[s(n(et),{"ds-show-entries":"25"})]),t("div",Ji,[s(n(ot),{"ds-search-placeholder":"Search..."})])],8,Yi),t("div",Gi,[t("div",Zi,[t("div",Xi,[t("table",tn,[t("thead",null,[t("tr",null,[(l(!0),c($,null,B(p,(d,x)=>(l(),c("th",{key:d.field,class:Z(["sort",d.sort]),onClick:z=>g(z,x)},[k(v(d.name)+" ",1),on],10,en))),128)),rn])]),s(n(rt),{tag:"tbody"},{default:_(({row:d})=>[t("tr",null,[t("td",null,v(d.queue_name),1),t("td",null,v(d.periods),1),t("td",null,v(d.recent),1),t("td",null,[s(h,{to:{name:"data_periods",params:{name:d.queue_name}},class:"btn btn-secondary btn-sm mx-1"},{default:_(()=>[nn]),_:2},1032,["to"])])])]),_:1})])])])]),t("div",an,[s(n(it),{class:"mb-2 mb-md-0"}),s(n(nt))])]),_:1},8,["ds-data","ds-sortby"])],64)}}},sn={__name:"DashboardView",setup(e){return(o,r)=>(l(),S(ln))}};const dn={class:"display-5 text-center"},mn=["data-page-count"],cn={class:"col-md-6 mb-2 mb-md-0"},pn={class:"col-md-6"},gn={class:"row"},bn={class:"col-md-12"},un={class:"table-responsive"},fn={class:"table table-striped d-md-table"},hn=["onClick"],xn=t("i",{class:"gg-select float-right"},null,-1),wn=t("th",null,"Actions",-1),vn=k("View"),kn={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},yn={__name:"PeriodList",props:{name:{type:String,default:""}},async setup(e){let o,r;const i=e,a=ut();[o,r]=I(()=>a.loadPeriods(i.name)),await o,r();const{periods:p}=L(a),g=U([{name:"ID",field:"id",sort:""},{name:"Opened",field:"created_at",sort:""},{name:"Closed",field:"updated_at",sort:""},{name:"Events",field:"events",sort:""}]),w=function(f,h){let b;const d=g[h];f.shiftKey||this.cols.forEach(x=>{x.field!==d.field&&(x.sort="")}),d.sort||(b="asc"),d.sort==="desc"&&(b=f.shiftKey?"":"asc"),d.sort==="asc"&&(b="desc"),d.sort=b},u=G(()=>g.reduce((f,h)=>(h.sort&&(h.sort==="asc"?f.push(h.field):f.push("-"+h.field)),f),[]));return(f,h)=>{const b=q("router-link");return l(),c($,null,[t("h1",dn,"Event Log: "+v(e.name),1),s(n(at),{"ds-data":n(p),"ds-sortby":n(u)},{default:_(({ds:d})=>[t("div",{class:"row","data-page-count":d.dsPagecount},[t("div",cn,[s(n(et),{"ds-show-entries":"25"})]),t("div",pn,[s(n(ot),{"ds-search-placeholder":"Search..."})])],8,mn),t("div",gn,[t("div",bn,[t("div",un,[t("table",fn,[t("thead",null,[t("tr",null,[(l(!0),c($,null,B(g,(x,z)=>(l(),c("th",{key:x.field,class:Z(["sort",x.sort]),onClick:y=>w(y,z)},[k(v(x.name)+" ",1),xn],10,hn))),128)),wn])]),s(n(rt),{tag:"tbody"},{default:_(({row:x})=>[t("tr",null,[t("td",null,v(x.id),1),t("td",null,v(x.created_at),1),t("td",null,v(x.updated_at),1),t("td",null,v(x.events),1),t("td",null,[s(b,{to:{name:"period",params:{id:x.id}},class:"btn btn-secondary btn-sm mx-1"},{default:_(()=>[vn]),_:2},1032,["to"])])])]),_:1})])])])]),t("div",kn,[s(n(it),{class:"mb-2 mb-md-0"}),s(n(nt))])]),_:1},8,["ds-data","ds-sortby"])],64)}}},_n={__name:"PeriodView",setup(e){return(o,r)=>(l(),S(yn))}},zn={class:"display-5 text-center"},$n=t("h2",{class:"text-center"},"Events",-1),Cn=["data-page-count"],qn={class:"col-md-6 mb-2 mb-md-0"},Mn={class:"col-md-6"},jn={class:"row"},Sn={class:"col-md-12"},En={class:"table-responsive"},Qn={class:"table table-striped d-md-table"},Ln=["onClick"],In=t("i",{class:"gg-select float-right"},null,-1),An={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},Tn=t("h2",{class:"text-center"},"Presences",-1),Bn=["data-page-count"],On={class:"col-md-6 mb-2 mb-md-0"},Rn={class:"col-md-6"},Dn={class:"row"},Pn={class:"col-md-12"},Nn={class:"table-responsive"},Un={class:"table table-striped d-md-table"},Kn=["onClick"],Vn=t("i",{class:"gg-select float-right"},null,-1),Hn={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},Fn={__name:"EventList",props:{id:{type:Number,default:-1}},async setup(e){let o,r;const i=e,a=ut();[o,r]=I(()=>a.loadEvents(i.id)),await o,r();const{events:p,presences:g,getEventsTimline:w}=L(a),u=U([{name:"ID",field:"id",sort:""},{name:"eID",field:"eid",sort:""},{name:"Status",field:"status",sort:""},{name:"Start",field:"created_at",sort:""},{name:"End",field:"updated_at",sort:""},{name:"Helper",field:"presence.eid",sort:""}]),f=U([{name:"ID",field:"id",sort:""},{name:"eID",field:"eid",sort:""},{name:"Start",field:"created_at",sort:""},{name:"End",field:"updated_at",sort:""}]),h=function(y,M){let Q;const E=u[M];y.shiftKey||this.eventCols.forEach(C=>{C.field!==E.field&&(C.sort="")}),E.sort||(Q="asc"),E.sort==="desc"&&(Q=y.shiftKey?"":"asc"),E.sort==="asc"&&(Q="desc"),E.sort=Q},b=function(y,M){let Q;const E=f[M];y.shiftKey||this.presenceCols.forEach(C=>{C.field!==E.field&&(C.sort="")}),E.sort||(Q="asc"),E.sort==="desc"&&(Q=y.shiftKey?"":"asc"),E.sort==="asc"&&(Q="desc"),E.sort=Q},d=G(()=>u.reduce((y,M)=>(M.sort&&(M.sort==="asc"?y.push(M.field):y.push("-"+M.field)),y),[])),x=G(()=>f.reduce((y,M)=>(M.sort&&(M.sort==="asc"?y.push(M.field):y.push("-"+M.field)),y),[])),z={chart:{type:"rangeBar"},plotOptions:{bar:{horizontal:!0,barHeight:"50%",rangeBarGroupRows:!0}},xaxis:{type:"datetime",labels:{datetimeUTC:!1}},dataLabels:{enabled:!0,formatter:function(y,M){return M.w.config.series[M.seriesIndex].data[M.dataPointIndex].z}}};return(y,M)=>{const Q=q("apexchart");return l(),c($,null,[t("h1",zn,"Event Log: Period "+v(e.id),1),$n,t("div",null,[s(Q,{type:"rangeBar",options:z,series:n(w)},null,8,["series"])]),s(n(at),{"ds-data":n(p),"ds-sortby":n(d)},{default:_(({ds:E})=>[t("div",{class:"row","data-page-count":E.dsPagecount},[t("div",qn,[s(n(et),{"ds-show-entries":"25"})]),t("div",Mn,[s(n(ot),{"ds-search-placeholder":"Search..."})])],8,Cn),t("div",jn,[t("div",Sn,[t("div",En,[t("table",Qn,[t("thead",null,[t("tr",null,[(l(!0),c($,null,B(u,(C,st)=>(l(),c("th",{key:C.field,class:Z(["sort",C.sort]),onClick:dt=>h(dt,st)},[k(v(C.name)+" ",1),In],10,Ln))),128))])]),s(n(rt),{tag:"tbody"},{default:_(({row:C})=>[t("tr",null,[t("td",null,v(C.id),1),t("td",null,v(C.eid),1),t("td",null,v(C.status),1),t("td",null,v(C.created_at),1),t("td",null,v(C.updated_at),1),t("td",null,v(C.presence?C.presence.eid:""),1)])]),_:1})])])])]),t("div",An,[s(n(it),{class:"mb-2 mb-md-0"}),s(n(nt))])]),_:1},8,["ds-data","ds-sortby"]),Tn,s(n(at),{"ds-data":n(g),"ds-sortby":n(x)},{default:_(({ds:E})=>[t("div",{class:"row","data-page-count":E.dsPagecount},[t("div",On,[s(n(et),{"ds-show-entries":"25"})]),t("div",Rn,[s(n(ot),{"ds-search-placeholder":"Search..."})])],8,Bn),t("div",Dn,[t("div",Pn,[t("div",Nn,[t("table",Un,[t("thead",null,[t("tr",null,[(l(!0),c($,null,B(f,(C,st)=>(l(),c("th",{key:C.field,class:Z(["sort",C.sort]),onClick:dt=>b(dt,st)},[k(v(C.name)+" ",1),Vn],10,Kn))),128))])]),s(n(rt),{tag:"tbody"},{default:_(({row:C})=>[t("tr",null,[t("td",null,v(C.id),1),t("td",null,v(C.eid),1),t("td",null,v(C.created_at),1),t("td",null,v(C.updated_at),1)])]),_:1})])])])]),t("div",Hn,[s(n(it),{class:"mb-2 mb-md-0"}),s(n(nt))])]),_:1},8,["ds-data","ds-sortby"])],64)}}},Yn={__name:"EventView",setup(e){return(o,r)=>(l(),S(Fn))}},H=()=>A().is_admin,$t=St({history:Et("/"),routes:[{path:"/",name:"home",component:ao},{path:"/about",name:"about",component:()=>He(()=>import("./AboutView.e60306be.js"),["assets/AboutView.e60306be.js","assets/vendor.5bb527e4.js"])},{path:"/queues",name:"queues",component:Co},{path:"/queues/:id",name:"queue_single",component:Qr,props:e=>({id:Number(e.params.id)})},{path:"/queues/:id/edit",name:"queue_edit",component:Kr,props:!0,beforeEnter:H},{path:"/profile",name:"profile",component:Xr},{path:"/admin",name:"admin",component:Ii,beforeEnter:H},{path:"/admin/user/:id/edit",name:"admin_useredit",component:Hi,props:!0,beforeEnter:H},{path:"/data",name:"data",component:sn,beforeEnter:H},{path:"/data/:name",name:"data_periods",component:_n,beforeEnter:H,props:e=>({name:e.params.name})},{path:"/period/:id",name:"period",component:Yn,beforeEnter:H,props:e=>({id:e.params.id})}]});$t.beforeEach(async function(e){if(e.name!=="home"&&e.name!=="about"){const o=A();if(o.token||await o.tryToken(),!o.token)return"/"}});const Wn=()=>{j.interceptors.request.use(e=>{if(e.url!=="/auth/token"){const o=A();o.token&&(e.headers.Authorization="Bearer "+o.token)}return e},e=>Promise.reject(e)),j.interceptors.response.use(e=>e,async e=>{const o=e.config;if(o.url!=="/auth/token"&&e.response&&e.response.status===401&&!o._retry){o._retry=!0;try{return await A().refreshToken(),j(o)}catch(r){return Promise.reject(r)}}return Promise.reject(e)})};m.useDefaults();m.setLevel(m.WARN);Qt.add(Lt,It,At,Tt,Bt,Ot,Rt,Dt,Pt,Nt,Ut,Kt,Vt,Ht,Ft,Yt,Wt,Jt,Gt,Zt,Xt,te,ee,oe,re,ie,ne);ae.watch();Wn();const V=le(Ue);V.use(se());V.use($t);V.use(de,ht);V.use(me,ce({config:{classes:{input:"form-control",label:"form-label",help:"form-text",outer:"mb-3"}}}));V.use(pe);V.component("FontAwesomeIcon",ge);V.mount("#app");export{P as _};
