import{a as rt,d as R,u as gt,o as H,L as c,r as C,b as l,c as s,e,f as m,w as q,g as a,R as N,h as O,i as v,t as _,p as U,j as P,k as $,S as bt,F as y,l as ut,m as V,n as E,s as Q,q as A,v as ft,x as K,y as et,z as ht,A as xt,B as wt,C as it,M as Y,D as nt,E as at,G as W,H as Z,I as lt,J as T,K as dt,N as vt,O as kt,P as yt,Q as _t,T as zt,U as Ct,V as qt,W as $t,X as Mt,Y as jt,Z as St,_ as Qt,$ as Et,a0 as Lt,a1 as Nt,a2 as Ot,a3 as It,a4 as At,a5 as Tt,a6 as Rt,a7 as Bt,a8 as Dt,a9 as Ut,aa as Pt,ab as Jt,ac as Ht,ad as Vt,ae as Ft,af as Kt,ag as Yt,ah as Wt,ai as Zt,aj as Gt}from"./vendor.82c61424.js";const Xt=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const d of r)if(d.type==="childList")for(const p of d.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function n(r){const d={};return r.integrity&&(d.integrity=r.integrity),r.referrerpolicy&&(d.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?d.credentials="include":r.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function i(r){if(r.ep)return;r.ep=!0;const d=n(r);fetch(r.href,d)}};Xt();const z=rt.create({baseURL:"/",headers:{Accept:"application/json","Content-Type":"application/json"}}),M=R("token",{state:()=>({token:gt("token","")}),getters:{refresh_token(){return this.token?H(this.token).refresh_token:""},eid(){return this.token?H(this.token).eid:""},id(){return this.token?H(this.token).user_id:""},is_admin(){return this.token?H(this.token).is_admin:!1}},actions:{async getToken(){c.info("token:get"),await z.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(c.info("token:get login failed - redirecting to CAS"),window.location.href="/auth/login"):(c.error("token:get error"+JSON.stringify(t)),this.token="")})},async tryToken(){c.info("token:try"),await z.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(async t=>{t.response&&t.response.status===401?(c.info("token:try login failed - trying refresh token"),await this.refreshToken()):(c.error("token:try error"+JSON.stringify(t)),this.token="")})},async refreshToken(){c.info("token:refresh"),await z.post("/auth/token",{refresh_token:this.refresh_token}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(c.info("token:refresh login failed - redirecting to CAS"),window.location.href="/auth/login"):(c.error("token:refresh error"+JSON.stringify(t)),this.token="")})},async logout(){this.token="",window.location.href="http://localhost:3000/auth/logout"}}});var I=(t,o)=>{const n=t.__vccOpts||t;for(const[i,r]of o)n[i]=r;return n};const te=t=>(U("data-v-0d8040b6"),t=t(),P(),t),ee={class:"navbar navbar-expand-md navbar-dark fixed-top bg-purple"},oe={class:"container"},re=v("Office Hours"),ie=te(()=>e("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarCollapse","aria-controls":"navbarCollapse","aria-expanded":"false","aria-label":"Toggle navigation"},[e("span",{class:"navbar-toggler-icon"})],-1)),ne={id:"navbarCollapse",class:"collapse navbar-collapse"},ae={class:"navbar-nav me-auto mb-2 mb-md-0"},le={class:"nav-item"},de=v("Queues"),se={class:"nav-item"},me=v("About"),ce={key:0,class:"nav-item"},pe=v("Admin"),ge={class:""},be={key:0},ue={class:"navbar-nav me-auto mb-2 mb-md-0"},fe={class:"nav-item"},he={class:"nav-item"},xe=v(" Logout"),we={key:1},ve=v(" Login"),ke={__name:"NavBar",setup(t){const o=M();return(n,i)=>{const r=C("font-awesome-icon");return l(),s("nav",ee,[e("div",oe,[m(a(N),{to:"/",class:"navbar-brand"},{default:q(()=>[re]),_:1}),ie,e("div",ne,[e("ul",ae,[e("li",le,[m(a(N),{to:"/queues","active-class":"active",class:"nav-link"},{default:q(()=>[de]),_:1})]),e("li",se,[m(a(N),{to:"/about","active-class":"active",class:"nav-link"},{default:q(()=>[me]),_:1})]),a(o).is_admin?(l(),s("li",ce,[m(a(N),{to:"/admin","active-class":"active",class:"nav-link"},{default:q(()=>[pe]),_:1})])):O("",!0)]),e("div",ge,[a(o).token?(l(),s("div",be,[e("ul",ue,[e("li",fe,[m(a(N),{to:"/profile","active-class":"active",class:"nav-link"},{default:q(()=>[m(r,{icon:"user"}),v(" "+_(a(o).eid),1)]),_:1})]),e("li",he,[e("a",{class:"btn btn-success float-end",onClick:i[0]||(i[0]=d=>a(o).logout())},[m(r,{icon:"arrow-right-from-bracket"}),xe])])])])):(l(),s("div",we,[e("a",{class:"btn btn-success",onClick:i[1]||(i[1]=d=>a(o).getToken())},[m(r,{icon:"arrow-right-to-bracket"}),ve])]))])])])])}}};var ye=I(ke,[["__scopeId","data-v-0d8040b6"]]);const _e={id:"main",class:"container px-4 py-5"},ze={__name:"App",setup(t){return(o,n)=>(l(),s(y,null,[e("header",null,[m(ye)]),e("div",_e,[(l(),$(bt,null,{default:q(()=>[m(a(ut))]),_:1}))])],64))}};var Ce=I(ze,[["__scopeId","data-v-68e3a569"]]);const qe="modulepreload",ot={},$e="/",Me=function(o,n){return!n||n.length===0?o():Promise.all(n.map(i=>{if(i=`${$e}${i}`,i in ot)return;ot[i]=!0;const r=i.endsWith(".css"),d=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${d}`))return;const p=document.createElement("link");if(p.rel=r?"stylesheet":qe,r||(p.as="script",p.crossOrigin=""),p.href=i,document.head.appendChild(p),r)return new Promise((h,u)=>{p.addEventListener("load",h),p.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>o())};const je={},Se=t=>(U("data-v-8c844e72"),t=t(),P(),t),Qe={class:"pb-2 border-bottom"},Ee=v(" Office Hours Queue "),Le=Se(()=>e("div",{class:"row p-4 pb-0 pt-lg-4 pb-lg-4 align-items-center rounded-3 border shadow-lg"},[e("div",{class:"col-lg-10 mx-auto"},[e("p",{class:"lead-custom text-center"}," Welcome! Here you can join the queue for office hours. Let's get started! ")])],-1));function Ne(t,o){const n=C("font-awesome-icon");return l(),s(y,null,[e("h2",Qe,[m(n,{icon:"chalkboard-teacher"}),Ee]),Le],64)}var st=I(je,[["render",Ne],["__scopeId","data-v-8c844e72"]]);const Oe=e("br",null,null,-1),Ie={key:0},Ae=v("Queues List"),Te={key:1},Re=v(" Login"),Be={__name:"LoginMessage",setup(t){const o=M();return(n,i)=>{const r=C("RouterLink"),d=C("font-awesome-icon");return l(),s("main",null,[m(st),Oe,a(o).token?(l(),s("div",Ie,[m(r,{to:"/queues",class:"btn btn-success"},{default:q(()=>[Ae]),_:1})])):(l(),s("div",Te,[e("a",{class:"btn btn-success",onClick:i[0]||(i[0]=p=>a(o).getToken())},[m(d,{icon:"arrow-right-to-bracket"}),Re])]))])}}},De={__name:"HomeView",setup(t){return(o,n)=>(l(),$(Be))}};const Ue={class:"col"},Pe={class:"card-header"},Je={key:0,class:"float-end badge rounded-pill bg-success"},He={key:1,class:"float-end badge rounded-pill bg-danger"},Ve={class:"card-body"},Fe={class:"card-text"},Ke={__name:"QueueCard",props:{queue:{type:Object,default(){return{}}},helpers:{type:Number,default(){return 0}},requests:{type:Number,default(){return 0}}},setup(t){const o=t,n=V();function i(r){n.push("/queues/"+r)}return(r,d)=>{const p=C("font-awesome-icon");return l(),s("div",Ue,[e("div",{class:"card w-100 hvr-grow",onClick:d[0]||(d[0]=h=>i(o.queue.id))},[e("h5",Pe,[v(_(o.queue.name)+" ",1),o.queue.is_open===1?(l(),s("span",Je,[v("Open | "+_(t.helpers)+" ",1),m(p,{icon:"user-graduate"}),v(" | "+_(t.requests)+" ",1),m(p,{icon:"circle-question"})])):(l(),s("span",He,"Closed"))]),e("div",Ve,[e("p",Fe,_(o.queue.snippet),1)])])])}}};var Ye=I(Ke,[["__scopeId","data-v-3451fb3b"]]);const S=R("queues",{state:()=>({queues:[],online:{}}),getters:{getQueue:t=>o=>t.queues.find(n=>n.id==o),sortedQueues:t=>[...t.queues].sort((o,n)=>n.is_open-o.is_open)},actions:{async hydrate(){c.info("queues:hydrate"),await z.get("/api/v1/queues").then(t=>{this.queues=t.data})},async hydrateOnline(){c.info("queues:hydrateOnline"),await z.get("/api/v1/queues/online").then(t=>{this.online=t.data})},async update(t){await z.post("/api/v1/queues/"+t.id,{queue:t}).then(async()=>{await this.hydrate()})},async deleteQueue(t){await z.delete("/api/v1/queues/"+t).then(async()=>{await this.hydrate()})},async addQueue(t){await z.put("/api/v1/queues/",{name:t}).then(async()=>{await this.hydrate()})}}}),We={class:"row row-cols-1 row-cols-lg-3 g-4"},Ze={__name:"QueueList",async setup(t){let o,n;const i=S();i.hydrate(),[o,n]=E(()=>i.hydrateOnline()),await o,n();const{sortedQueues:r,online:d}=Q(i);return(p,h)=>(l(),s("div",We,[(l(!0),s(y,null,A(a(r),(u,f)=>(l(),$(Ye,{key:u.id,queue:u,index:f,helpers:a(d).helpers[String(u.id)],requests:a(d).requests[String(u.id)]},null,8,["queue","index","helpers","requests"]))),128))]))}},Ge=e("br",null,null,-1),Xe={__name:"QueueListView",setup(t){return(o,n)=>(l(),s("main",null,[m(st),Ge,m(Ze)]))}},J=R("requests",{state:()=>({requests:[],online:[],helpers:[],socket:void 0,connected:!1,error:!1}),getters:{getRequest:t=>o=>t.requests.find(n=>n.user_id===o),userOnline:t=>o=>t.online.find(n=>n==o)!==void 0,sortedRequests:t=>[...t.requests].sort(function(o,n){return o.status_id==n.status_id?o.id-n.id:n.status_id-o.status_id})},actions:{async connectQueue(t){this.socket&&this.socket.disconnect(),this.$reset();const o=M(),n="/";this.socket=ft(n,{auth:{token:o.token,queue_id:t}}),this.socket.on("connect",()=>{c.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",i=>{c.error("socket:connect_error - "+i),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{c.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("queue:update",async i=>{c.info("queue:update - "+JSON.stringify(i.id)),c.debug("|- updated: "+JSON.stringify(i));var r=this.requests.findIndex(d=>d.id===i.id);r<0?this.requests.push(i):this.requests[r]=i}),this.socket.on("queue:remove",async i=>{c.info("queue.remove - "+JSON.stringify(i));var r=this.requests.findIndex(d=>d.id===i);r>=0&&this.requests.splice(r,1)}),this.socket.on("user:online",async i=>{c.info("user:online - "+JSON.stringify(i)),this.online.push(String(i))}),this.socket.on("user:offline",async i=>{c.info("user:offline - "+JSON.stringify(i)),this.online.splice(this.online.indexOf(String(i)),1)}),this.socket.on("helper:online",async i=>{c.info("helper:online - "+JSON.stringify(i.id)),c.debug("|- helper: "+JSON.stringify(i)),this.helpers.push(i)}),this.socket.on("helper:offline",async i=>{c.info("helper:offline - "+JSON.stringify(i)),this.helpers.splice(this.helpers.findIndex(r=>r.id==i),1)}),this.socket.on("queue:opening",async()=>{c.info("queue:opening"),await S().hydrate()}),this.socket.on("connected",async(i,r)=>{c.info("socket:connected"),c.debug("|-online: "+JSON.stringify(i)),c.debug("|-helpers: "+JSON.stringify(r)),this.online=i,this.helpers=r}),this.socket.on("queue:closing",async()=>{c.info("queue:closing"),this.requests=[],await S().hydrate()}),c.info("emit queue:connect"),await this.socket.emit("queue:connect",async(i,r)=>{i==200?(c.info("queue:connect OK"),c.debug("|- requests: "+JSON.stringify(r)),this.requests=r):c.error("queue:connect error - "+JSON.stringify(i))})},async disconnectQueue(){this.socket&&(c.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async joinQueue(){c.info("emit queue:join"),await this.socket.emit("queue:join",async t=>{t==200?c.info("queue:join OK"):c.error("queue:join error - "+JSON.stringify(t))})},async openQueue(){c.info("emit queue:open"),await this.socket.emit("queue:open",async t=>{t==200?(c.info("queue:open OK"),S().hydrate()):c.error("queue:open error - "+JSON.stringify(t))})},async closeQueue(){c.info("emit queue:close"),await this.socket.emit("queue:close",async t=>{t==200?(c.info("queue:close OK"),this.requests=[],S().hydrate()):c.error("queue:close error - "+JSON.stringify(t))})},async takeRequest(t){c.info("emit request:take - "+t),await this.socket.emit("request:take",t,async o=>{o==200?c.info("request:take OK"):c.error("request:take error - "+JSON.stringify(o))})},async deleteRequest(t){c.info("emit request:delete - "+t),await this.socket.emit("request:delete",t,async o=>{o==200?c.info("request:delete OK"):c.error("request:delete error - "+JSON.stringify(o))})},async finishRequest(t){c.info("emit request:finish - "+t),await this.socket.emit("request:finish",t,async o=>{o==200?c.info("request:finish OK"):c.error("request:finish error - "+JSON.stringify(o))})}}});const to=t=>(U("data-v-f961a11e"),t=t(),P(),t),eo={key:2,class:"badge bg-primary rounded-pill"},oo=to(()=>e("br",null,null,-1)),ro={id:"tooltip",class:"text-muted"},io={__name:"RequestItem",props:{request:{type:Object,default(){return{}}},helper:{type:Boolean,default(){return!1}},userId:{type:Number,default(){return-1}}},setup(t){const o=t;var n=K({now:et.utc()});const i=function(){n.now=et.utc(),setInterval(i,1e4)};setInterval(i,1e4);const r=J(),d=async function(){await r.deleteRequest(o.request.id)},p=async function(){await r.takeRequest(o.request.id)},h=async function(){await r.finishRequest(o.request.id)},u=ht(()=>o.request.updated_at?n.now.to(o.request.updated_at):n.now.to(o.request.created_at));return(f,x)=>{const b=C("font-awesome-icon");return l(),s("li",{class:xt(["list-group-item",[t.request.status_id==2?"list-group-item-primary":"",t.request.user_id==t.userId?"current-user":"",a(r).userOnline(t.request.user_id)?"":"list-group-item-light"]])},[a(r).userOnline(t.request.user_id)?(l(),$(b,{key:0,icon:"link"})):(l(),$(b,{key:1,icon:"link-slash"})),v(" "+_(t.request.user.name)+" ",1),t.request.status_id==2?(l(),s("span",eo,_(t.request.helper.name),1)):O("",!0),t.helper?(l(),s(y,{key:3},[e("button",{class:"float-end btn btn-danger btn-sm mx-1",onClick:d}," X "),t.request.status_id==1?(l(),s("button",{key:0,class:"float-end btn btn-primary btn-sm mx-1",onClick:p}," Take ")):(l(),s("button",{key:1,class:"float-end btn btn-success btn-sm mx-1",onClick:h}," Done ")),oo,e("small",ro,_(a(u)),1)],64)):O("",!0)],2)}}};var no=I(io,[["__scopeId","data-v-f961a11e"]]);const ao=e("h3",{class:"text-center"},"Students Waiting",-1),lo=e("hr",null,null,-1),so={class:"list-group list-group-numbered"},mt={__name:"RequestList",props:{id:{type:Number,default:-1}},setup(t){const o=M(),n=J(),{sortedRequests:i}=Q(n);return(r,d)=>(l(),s(y,null,[ao,lo,e("ul",so,[(l(!0),s(y,null,A(a(i),(p,h)=>(l(),$(no,wt({key:p.id,request:p,index:h},r.$attrs,{"user-id":a(o).id}),null,16,["request","index","user-id"]))),128))])],64))}},mo=e("h3",{class:"text-center"},"Helpers Online",-1),co=e("hr",null,null,-1),po={class:"list-group list-group-flush"},ct={__name:"HelperList",setup(t){const o=J(),{helpers:n}=Q(o);return(i,r)=>{const d=C("font-awesome-icon");return l(),s(y,null,[mo,co,e("ul",po,[(l(!0),s(y,null,A(a(n),(p,h)=>(l(),s("li",{key:h,class:"list-group-item"},[m(d,{icon:"link"}),v(" "+_(p.name),1)]))),128))])],64)}}};const B=t=>(U("data-v-38a96dbb"),t=t(),P(),t),go={class:"queue-header mx-auto"},bo={key:0,class:"btn btn-outline-success float-end disabled"},uo=B(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),fo=B(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),ho=B(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),xo=B(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),wo=[ho,xo],vo=B(()=>e("h2",{class:"text-center"},"Moderate Queue",-1)),ko=B(()=>e("hr",null,null,-1)),yo={class:"row"},_o={class:"col-12 col-md-4 mb-4"},zo={class:"col-12 col-md-8 mb-4"},Co={__name:"HelperPane",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const i=t,r=S();[o,n]=E(()=>r.hydrate()),await o,n();const d=r.getQueue,p=J(),{connected:h,error:u}=Q(p);[o,n]=E(()=>p.connectQueue(i.id)),await o,n();const f=async function(){confirm("Are you sure? All pending requests will be lost!")&&await p.closeQueue()},x=async function(){await p.openQueue()},b=async function(){await p.connectQueue(i.id)};return it(async()=>{await p.disconnectQueue()}),(g,w)=>{const k=C("font-awesome-icon");return l(),s(y,null,[e("div",go,[a(h)?(l(),s("button",bo,[m(k,{icon:"link"}),uo])):(l(),s(y,{key:1},[a(u)?(l(),s("button",{key:0,class:"btn btn-outline-danger float-end",onClick:b},[m(k,{icon:"link-slash"}),fo])):(l(),s("button",{key:1,class:"btn btn-outline-warning float-end",onClick:b},wo))],64)),vo,a(d)(t.id).is_open==1?(l(),s("a",{key:2,class:"w-100 btn btn-success",onClick:f},"Queue is Open - Click to Close")):(l(),s("a",{key:3,class:"w-100 btn btn-danger",onClick:x},"Queue is Closed - Click to Open"))]),ko,e("div",yo,[e("div",_o,[m(ct)]),e("div",zo,[m(mt,{id:t.id,helper:""},null,8,["id"])])])],64)}}};var qo=I(Co,[["__scopeId","data-v-38a96dbb"]]);const L=t=>(U("data-v-7eda1672"),t=t(),P(),t),$o={id:"studentModal",class:"modal fade",tabindex:"-1","aria-labelledby":"studentModalLabel","aria-hidden":"true"},Mo={class:"modal-dialog"},jo={class:"modal-content"},So=L(()=>e("div",{class:"modal-header"},[e("h5",{id:"studentModalLabel",class:"modal-title"},"Your Turn!"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Qo={class:"modal-body"},Eo=v(" You will be helped by "),Lo=v(". Their contact info is below: "),No=L(()=>e("hr",null,null,-1)),Oo=["innerHTML"],Io=L(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," OK ")],-1)),Ao={class:"queue-header mx-auto"},To={key:0,class:"btn btn-outline-success float-end disabled"},Ro=L(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),Bo=L(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),Do=L(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),Uo=L(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),Po=[Do,Uo],Jo=L(()=>e("h2",{class:"text-center"},"Waiting Queue",-1)),Ho={key:0,class:"w-100 btn btn-success disabled",disabled:""},Vo={key:3,class:"w-100 btn btn-danger disabled",disabled:""},Fo=L(()=>e("hr",null,null,-1)),Ko={key:0,class:"row"},Yo={class:"col-12 col-md-4 mb-4"},Wo={class:"col-12 col-md-8 mb-4"},Zo={__name:"StudentPane",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const i=t,r=M(),d=S();[o,n]=E(()=>d.hydrate()),await o,n();const p=d.getQueue,h=J(),u=h.getRequest,{connected:f,error:x}=Q(h);[o,n]=E(()=>h.connectQueue(i.id)),await o,n();var b,g=!1;h.$subscribe(()=>{const j=u(r.id);j&&j.status_id==2&&!g&&(g=!0,b=new Y("#studentModal",{}),b.show())});const w=async function(){g=!1,await h.joinQueue()},k=async function(){await h.connectQueue(i.id)};return it(async()=>{await h.disconnectQueue()}),(j,X)=>{const tt=C("font-awesome-icon");return l(),s(y,null,[e("div",$o,[e("div",Mo,[e("div",jo,[So,e("div",Qo,[a(u)(a(r).id)&&a(u)(a(r).id).helper?(l(),s(y,{key:0},[e("p",null,[Eo,e("strong",null,_(a(u)(a(r).id).helper.name),1),Lo]),No,e("div",{innerHTML:a(nt).sanitize(a(at).parse(a(u)(a(r).id).helper.contact_info))},null,8,Oo)],64)):O("",!0)]),Io])])]),e("div",Ao,[a(f)?(l(),s("button",To,[m(tt,{icon:"link"}),Ro])):(l(),s(y,{key:1},[a(x)?(l(),s("button",{key:0,class:"btn btn-outline-danger float-end",onClick:k},[m(tt,{icon:"link-slash"}),Bo])):(l(),s("button",{key:1,class:"btn btn-outline-warning float-end",onClick:k},Po))],64)),Jo,a(p)(t.id).is_open==1?(l(),s(y,{key:2},[a(u)(a(r).id)!=null?(l(),s("a",Ho,"Queue Joined")):(l(),s("a",{key:1,class:"w-100 btn btn-success",onClick:X[0]||(X[0]=ki=>w())},"Join Queue"))],64)):(l(),s("a",Vo,"Queue is Closed"))]),Fo,a(p)(t.id).is_open==1?(l(),s("div",Ko,[e("div",Yo,[m(ct)]),e("div",Wo,[m(mt,{id:t.id},null,8,["id"])])])):O("",!0)],64)}}};var Go=I(Zo,[["__scopeId","data-v-7eda1672"]]);const Xo=v(" Back"),tr=v(" Edit"),er={class:"display-5 text-center"},or=e("hr",null,null,-1),rr=["innerHTML"],ir=e("hr",null,null,-1),nr={__name:"QueueSingle",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const i=M(),r=S();[o,n]=E(()=>r.hydrate()),await o,n();const d=r.getQueue;return(p,h)=>{const u=C("font-awesome-icon");return l(),s("main",null,[m(a(N),{to:{name:"queues"},class:"btn btn-secondary float-start"},{default:q(()=>[m(u,{icon:"arrow-left"}),Xo]),_:1}),a(i).is_admin?(l(),$(a(N),{key:0,to:{name:"queue_edit",params:{id:t.id}},class:"btn btn-secondary float-end"},{default:q(()=>[m(u,{icon:"pen-to-square"}),tr]),_:1},8,["to"])):O("",!0),e("h1",er,_(a(d)(t.id).name),1),or,e("div",{innerHTML:a(nt).sanitize(a(at).parse(a(d)(t.id).description))},null,8,rr),ir,a(d)(t.id).helper==1?(l(),$(qo,{key:1,id:t.id},null,8,["id"])):(l(),$(Go,{key:2,id:t.id},null,8,["id"]))])}}},ar={__name:"QueueSingleView",setup(t){return(o,n)=>(l(),$(nr))}},G=R("users",{state:()=>({users:[]}),getters:{getUser:t=>o=>t.users.find(n=>n.id===o)},actions:{async hydrate(){c.info("users:hydrate"),await z.get("/api/v1/users").then(t=>{this.users=t.data})},async update(t){await z.post("/api/v1/users/"+t.id,{user:t}).then(async()=>{await this.hydrate()})},async deleteUser(t){await z.delete("/api/v1/users/"+t).then(async()=>{await this.hydrate()})},async addUser(t){await z.put("/api/v1/users/",{eid:t}).then(async()=>{await this.hydrate()})}}});const lr=e("h1",{class:"display-5 text-center"},"Edit Queue",-1),dr=e("hr",null,null,-1),sr={class:"mb-3"},mr=e("label",{for:"multiselect-users",class:"form-label"},"Helpers",-1),cr=e("div",{class:"form-text"}," Helpers who can manage the queue (usually TAs) - admins already have access ",-1),pr={class:"row row-cols-1 row-cols-md-2"},gr=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),br={class:"col d-grid mb-2"},ur=v(" Cancel"),fr={__name:"EditQueue",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const i=t,r=V(),d=S();[o,n]=E(()=>d.hydrate()),await o,n();const p=d.getQueue(i.id),h=G();h.hydrate();const{users:u}=Q(h);var f;W(()=>{f=new Z({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const x=async b=>{b=(({id:g,name:w,snippet:k})=>({id:g,name:w,snippet:k}))(b),b.description=f.value(),b.users=[];for(const g of p.users)b.users.push({id:g.id});try{await d.update(b),r.push("/queues/"+p.id)}catch(g){if(g.response&&g.response.status===422){let w={};if(g.response.data.data){for(const k in g.response.data.data){w[k]="";for(const j of g.response.data.data[k])w[k]=w[k]+j.message+" "}T("queueform",["The server rejected this submission. Please correct errors listed above"],w)}else T("queueform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(g)}};return(b,g)=>{const w=C("FormKit"),k=C("router-link");return l(),s("main",null,[lr,dr,m(w,{id:"queueform",type:"form",value:a(p),actions:!1,onSubmit:x},{default:q(()=>[m(w,{type:"text",name:"name",label:"Queue Name",help:"Name of the queue (usually the course)",validation:"required"}),m(w,{type:"text",name:"snippet",label:"Short Description",help:"Short description shown on the initial card"}),m(w,{type:"textarea",name:"description",label:"Long Description",help:"Long description shown on the queue page",rows:"10"}),e("div",sr,[mr,m(a(lt),{id:"multiselect-users",modelValue:a(p).users,"onUpdate:modelValue":g[0]||(g[0]=j=>a(p).users=j),class:"form-control",options:a(u),multiple:!0,"tag-placeholder":"Add this as new user",placeholder:"Type to search or add user",label:"eid","track-by":"id"},null,8,["modelValue","options"]),cr]),e("div",pr,[gr,e("div",br,[m(k,{to:{name:"queue_single",params:{id:a(p).id}},class:"btn btn-secondary"},{default:q(()=>[ur]),_:1},8,["to"])])])]),_:1},8,["value"])])}}},hr={__name:"QueueEditView",setup(t){return(o,n)=>(l(),$(fr))}},xr=R("profile",{state:()=>({user:{}}),actions:{async hydrate(){c.info("profile:hydrate"),await z.get("/api/v1/profile").then(t=>{this.user=t.data})},async update(t){await z.post("/api/v1/profile/",{user:t}).then(async()=>{await this.hydrate()})}}});const wr=e("h1",{class:"display-5 text-center"},"Edit User",-1),vr=e("hr",null,null,-1),kr={class:"row row-cols-1 row-cols-md-2"},yr=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),_r={class:"col d-grid mb-2"},zr=v(" Cancel"),Cr={__name:"EditProfile",async setup(t){let o,n;const i=V(),r=xr();[o,n]=E(()=>r.hydrate()),await o,n();const{user:d}=Q(r);var p;W(()=>{p=new Z({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const h=async u=>{const f={name:u.name,contact_info:p.value()};try{await r.update(f),i.push("/queues/")}catch(x){if(x.response&&x.response.status===422){let b={};if(x.response.data.data){for(const g in x.response.data.data){b[g]="";for(const w of x.response.data.data[g])b[g]=b[g]+w.message+" "}T("userform",["The server rejected this submission. Please correct errors listed above"],b)}else T("userform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(x)}};return(u,f)=>{const x=C("FormKit"),b=C("router-link");return l(),s("main",null,[wr,vr,m(x,{id:"userform",type:"form",value:a(d),actions:!1,onSubmit:h},{default:q(()=>[m(x,{type:"text",name:"eid",label:"eID",disabled:!0,help:"Your K-State eID (cannot be changed)",validation:"required"}),m(x,{type:"text",name:"name",label:"Name",help:"Your full name as you'd like it displayed on the site",validation:"required"}),m(x,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact you",rows:"10"}),e("div",kr,[yr,e("div",_r,[m(b,{to:{name:"queues"},class:"btn btn-secondary"},{default:q(()=>[zr]),_:1})])])]),_:1},8,["value"])])}}};const qr={__name:"ProfileView",setup(t){return(o,n)=>(l(),$(Cr))}},$r={id:"userModal",class:"modal fade",tabindex:"-1","aria-labelledby":"userModalLabel","aria-hidden":"true"},Mr={class:"modal-dialog"},jr={class:"modal-content"},Sr=e("div",{class:"modal-header"},[e("h5",{id:"userModalLabel",class:"modal-title"},"Delete User"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Qr={class:"modal-body"},Er=e("h5",null,"Are you sure you want to delete this user?",-1),Lr=e("strong",null,"eID: ",-1),Nr=e("br",null,null,-1),Or=e("strong",null,"Name: ",-1),Ir={class:"modal-footer"},Ar=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),Tr=v(" Delete User "),Rr=v(" User "),Br=e("h1",{class:"text-center"},"Users",-1),Dr={class:"table table-striped table-hover"},Ur=e("thead",null,[e("tr",null,[e("th",null,"eID"),e("th",null,"Name"),e("th",null,"Roles"),e("th",null,"Actions")])],-1),Pr=["onClick"],Jr={__name:"UserAdmin",setup(t){const o=G();o.hydrate();const{users:n}=Q(o),i=M();var r=K({}),d;const p=function(f){r.id=f.id,r.eid=f.eid,r.name=f.name,d=new Y("#userModal",{}),d.show()},h=async function(f){await o.deleteUser(f),d.hide()},u=async function(){var f=prompt("Enter an eID to create a user");if(f)try{await o.addUser(f)}catch(x){x.response&&x.response.status===422?alert(JSON.stringify(x.response.data)):alert(x)}};return(f,x)=>{const b=C("font-awesome-icon");return l(),s(y,null,[e("div",$r,[e("div",Mr,[e("div",jr,[Sr,e("div",Qr,[Er,e("p",null,[Lr,v(_(a(r).eid)+" ",1),Nr,Or,v(_(a(r).name),1)])]),e("div",Ir,[Ar,e("button",{type:"button",class:"btn btn-danger",onClick:x[0]||(x[0]=g=>h(a(r).id))},[m(b,{icon:"trash"}),Tr])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:u},[m(b,{icon:"plus"}),Rr]),Br,e("table",Dr,[Ur,e("tbody",null,[(l(!0),s(y,null,A(a(n),g=>(l(),s("tr",{key:g.id},[e("td",null,_(g.eid),1),e("td",null,_(g.name),1),e("td",null,[(l(!0),s(y,null,A(g.roles,w=>(l(),s("span",{key:w.id,class:"badge rounded-pill bg-success"},_(w.name),1))),128))]),e("td",null,[m(a(N),{to:{name:"admin_useredit",params:{id:g.id}},class:"btn btn-secondary btn-sm mx-1"},{default:q(()=>[m(b,{icon:"pen-to-square"})]),_:2},1032,["to"]),g.id!=a(i).id?(l(),s("button",{key:0,type:"button",class:"btn btn-danger btn-sm mx-1",onClick:dt(w=>p(g),["prevent"])},[m(b,{icon:"trash"})],8,Pr)):O("",!0)])]))),128))])])],64)}}},Hr={id:"queueModal",class:"modal fade",tabindex:"-1","aria-labelledby":"queueModalLabel","aria-hidden":"true"},Vr={class:"modal-dialog"},Fr={class:"modal-content"},Kr=e("div",{class:"modal-header"},[e("h5",{id:"queueModalLabel",class:"modal-title"},"Delete Queue"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Yr={class:"modal-body"},Wr=e("h5",null,"Are you sure you want to delete this queue?",-1),Zr=e("strong",null,"Name: ",-1),Gr={class:"modal-footer"},Xr=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),ti=v(" Delete Queue "),ei=v(" Queue "),oi=e("h1",{class:"text-center"},"Queues",-1),ri={class:"table table-striped table-hover"},ii=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Actions")])],-1),ni=["onClick"],ai={__name:"QueueAdmin",setup(t){const o=S();o.hydrate();const{queues:n}=Q(o);var i=K({}),r;const d=function(u){i.id=u.id,i.name=u.name,r=new Y("#queueModal",{}),r.show()},p=async function(u){await o.deleteQueue(u),r.hide()},h=async function(){var u=prompt("Enter a name for the new queue");if(u)try{await o.addQueue(u)}catch(f){f.response&&f.response.status===422?alert(JSON.stringify(f.response.data)):alert(f)}};return(u,f)=>{const x=C("font-awesome-icon");return l(),s(y,null,[e("div",Hr,[e("div",Vr,[e("div",Fr,[Kr,e("div",Yr,[Wr,e("p",null,[Zr,v(_(a(i).name),1)])]),e("div",Gr,[Xr,e("button",{type:"button",class:"btn btn-danger",onClick:f[0]||(f[0]=b=>p(a(i).id))},[m(x,{icon:"trash"}),ti])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:h},[m(x,{icon:"plus"}),ei]),oi,e("table",ri,[ii,e("tbody",null,[(l(!0),s(y,null,A(a(n),b=>(l(),s("tr",{key:b.id},[e("td",null,_(b.name),1),e("td",null,[e("button",{type:"button",class:"btn btn-danger btn-sm mx-1",onClick:dt(g=>d(b),["prevent"])},[m(x,{icon:"trash"})],8,ni)])]))),128))])])],64)}}},li={__name:"AdminView",setup(t){return(o,n)=>(l(),s(y,null,[m(ai),m(Jr)],64))}},di=R("roles",{state:()=>({roles:[]}),actions:{async hydrate(){c.info("roles:hydrate"),await z.get("/api/v1/roles").then(t=>{this.roles=t.data})}}});const si=e("h1",{class:"display-5 text-center"},"Edit User",-1),mi=e("hr",null,null,-1),ci={class:"mb-3"},pi=e("label",{for:"multiselect-roles",class:"form-label"},"Roles",-1),gi=e("div",{class:"form-text"},"Roles assigned to this user",-1),bi={class:"row row-cols-1 row-cols-md-2"},ui=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),fi={class:"col d-grid mb-2"},hi=v(" Cancel"),xi={__name:"UserEdit",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const i=t,r=V(),d=G();[o,n]=E(()=>d.hydrate()),await o,n();const p=d.users.find(b=>b.id===parseInt(i.id)),h=di();h.hydrate();const{roles:u}=Q(h);var f;W(()=>{f=new Z({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const x=async b=>{b=(({id:g,name:w})=>({id:g,name:w}))(b),b.contact_info=f.value(),b.roles=[];for(const g of p.roles)b.roles.push({id:g.id});try{await d.update(b),r.push("/admin/")}catch(g){if(g.response&&g.response.status===422){let w={};if(g.response.data.data){for(const k in g.response.data.data){w[k]="";for(const j of g.response.data.data[k])w[k]=w[k]+j.message+" "}T("usersForm",["The server rejected this submission. Please correct errors listed above"],w)}else T("usersForm",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(g)}};return(b,g)=>{const w=C("FormKit"),k=C("router-link");return l(),s("main",null,[si,mi,m(w,{id:"userform",type:"form",value:a(p),actions:!1,onSubmit:x},{default:q(()=>[m(w,{type:"text",name:"eid",label:"eID",disabled:!0,help:"The user's K-State eID (cannot be changed)",validation:"required"}),m(w,{type:"text",name:"name",label:"Name",help:"The user's full name as you'd like it displayed on the site",validation:"required"}),m(w,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact the user",rows:"10"}),e("div",ci,[pi,m(a(lt),{id:"multiselect-roles",modelValue:a(p).roles,"onUpdate:modelValue":g[0]||(g[0]=j=>a(p).roles=j),class:"form-control",options:a(u),multiple:!0,"tag-placeholder":"Add this as new role",placeholder:"Type to search or add role",label:"name","track-by":"id"},null,8,["modelValue","options"]),gi]),e("div",bi,[ui,e("div",fi,[m(k,{to:{name:"admin"},class:"btn btn-secondary"},{default:q(()=>[hi]),_:1})])])]),_:1},8,["value"])])}}},wi={__name:"UserEditView",setup(t){return(o,n)=>(l(),$(xi))}},F=()=>M().is_admin,pt=vt({history:kt("/"),routes:[{path:"/",name:"home",component:De,beforeEnter:async()=>{const t=M();if(await t.tryToken(),t.token)return"/queues"}},{path:"/about",name:"about",component:()=>Me(()=>import("./AboutView.f455dcc2.js"),["assets/AboutView.f455dcc2.js","assets/vendor.82c61424.js"])},{path:"/queues",name:"queues",component:Xe},{path:"/queues/:id",name:"queue_single",component:ar,props:t=>({id:Number(t.params.id)})},{path:"/queues/:id/edit",name:"queue_edit",component:hr,props:!0,beforeEnter:F},{path:"/profile",name:"profile",component:qr},{path:"/admin",name:"admin",component:li,beforeEnter:F},{path:"/admin/user/:id/edit",name:"admin_useredit",component:wi,props:!0,beforeEnter:F}]});pt.beforeEach(async function(t){if(t.name!=="home"&&t.name!=="about"){const o=M();if(o.token||await o.tryToken(),!o.token)return"/"}});const vi=()=>{z.interceptors.request.use(t=>{if(t.url!=="/auth/token"){const o=M();o.token&&(t.headers.Authorization="Bearer "+o.token)}return t},t=>Promise.reject(t)),z.interceptors.response.use(t=>t,async t=>{const o=t.config;if(o.url!=="/auth/token"&&t.response&&t.response.status===401&&!o._retry){o._retry=!0;try{return await M().refreshToken(),z(o)}catch(n){return Promise.reject(n)}}return Promise.reject(t)})};c.useDefaults();c.setLevel(c.WARN);yt.add(_t,zt,Ct,qt,$t,Mt,jt,St,Qt,Et,Lt,Nt,Ot,It,At,Tt,Rt,Bt,Dt,Ut,Pt,Jt,Ht);Vt.watch();vi();const D=Ft(Ce);D.use(Kt());D.use(pt);D.use(Yt,rt);D.use(Wt,Zt({config:{classes:{input:"form-control",label:"form-label",help:"form-text",outer:"mb-3"}}}));D.component("FontAwesomeIcon",Gt);D.mount("#app");export{I as _};
