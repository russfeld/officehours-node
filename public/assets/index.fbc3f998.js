import{a as bt,d as P,u as zt,o as G,L as m,r as M,b as l,c,e as t,f as s,w as $,g as i,R as D,h as T,i as j,j as y,t as v,p as F,k as W,l as $t,S as Ct,F as C,m as ut,s as S,n as at,q as L,v as lt,x as A,y as B,z as X,A as V,B as Y,C as qt,M as st,D as ft,E as ht,G as dt,H as mt,I as xt,J as K,K as wt,N as tt,P as et,O as ot,_ as rt,Q as it,T as nt,U as Mt,V as jt,W as St,X as Et,Y as Qt,Z as Lt,$ as It,a0 as At,a1 as Dt,a2 as Rt,a3 as Tt,a4 as Bt,a5 as Pt,a6 as Ot,a7 as Nt,a8 as Ut,a9 as Kt,aa as Ht,ab as Vt,ac as Yt,ad as Ft,ae as Wt,af as Jt,ag as Zt,ah as Gt,ai as Xt,aj as te,ak as ee,al as oe,am as re,an as ie,ao as ne,ap as ae,aq as le,ar as se,as as de,at as me,au as ce}from"./vendor.0627cd51.js";const pe=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const p of a)if(p.type==="childList")for(const b of p.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&n(b)}).observe(document,{childList:!0,subtree:!0});function r(a){const p={};return a.integrity&&(p.integrity=a.integrity),a.referrerpolicy&&(p.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?p.credentials="include":a.crossorigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function n(a){if(a.ep)return;a.ep=!0;const p=r(a);fetch(a.href,p)}};pe();const q=bt.create({baseURL:"/",headers:{Accept:"application/json","Content-Type":"application/json"}}),E=P("token",{state:()=>({token:zt("token",""),sound:!0}),getters:{refresh_token(){return this.token?G(this.token).refresh_token:""},eid(){return this.token?G(this.token).eid:""},id(){return this.token?G(this.token).user_id:""},is_admin(){return this.token?G(this.token).is_admin:!1}},actions:{async getToken(){m.info("token:get"),await q.get("/auth/token",{withCredentials:!0}).then(e=>{this.token=e.data.token}).catch(e=>{e.response&&e.response.status===401?(m.info("token:get login failed - redirecting to CAS"),window.location.href="/auth/login"):(m.error("token:get error"+e),this.token="")})},async tryToken(){m.info("token:try"),await q.get("/auth/token",{withCredentials:!0}).then(e=>{this.token=e.data.token}).catch(async e=>{e.response&&e.response.status===401?(m.info("token:try login failed - trying refresh token"),await this.refreshToken()):(m.error("token:try error"+e),this.token="")})},async refreshToken(){m.info("token:refresh"),await q.post("/auth/token",{refresh_token:this.refresh_token}).then(e=>{this.token=e.data.token}).catch(e=>{e.response&&e.response.status===401?(m.info("token:refresh login failed - redirecting to CAS"),window.location.href="/auth/login"):(m.error("token:refresh error"+e),this.token="")})},async logout(){this.token="",window.location.href=window.location.href="/auth/logout"},async toggleSound(){this.sound=!this.sound}}});var O=(e,o)=>{const r=e.__vccOpts||e;for(const[n,a]of o)r[n]=a;return r};const ge=e=>(F("data-v-5f1a5e7f"),e=e(),W(),e),be={class:"navbar navbar-expand-md navbar-dark fixed-top bg-purple"},ue={class:"container"},fe=y("Office Hours"),he=ge(()=>t("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarCollapse","aria-controls":"navbarCollapse","aria-expanded":"false","aria-label":"Toggle navigation"},[t("span",{class:"navbar-toggler-icon"})],-1)),xe={id:"navbarCollapse",class:"collapse navbar-collapse"},we={class:"navbar-nav me-auto mb-2 mb-md-0"},ve={class:"nav-item"},ke=y("Queues"),ye={class:"nav-item"},_e=y("About"),ze={key:0,class:"nav-item"},$e=y("Admin"),Ce={key:1,class:"nav-item"},qe=y("Data"),Me={class:""},je={key:0},Se={class:"navbar-nav me-auto mb-2 mb-md-0"},Ee={class:"nav-item"},Qe={class:"nav-item"},Le={class:"nav-item"},Ie=y(" Logout"),Ae={key:1},De=y(" Login"),Re={__name:"NavBar",setup(e){const o=E();return(r,n)=>{const a=M("font-awesome-icon");return l(),c("nav",be,[t("div",ue,[s(i(D),{to:"/",class:"navbar-brand"},{default:$(()=>[fe]),_:1}),he,t("div",xe,[t("ul",we,[t("li",ve,[s(i(D),{to:"/queues","active-class":"active",class:"nav-link"},{default:$(()=>[ke]),_:1})]),t("li",ye,[s(i(D),{to:"/about","active-class":"active",class:"nav-link"},{default:$(()=>[_e]),_:1})]),i(o).is_admin?(l(),c("li",ze,[s(i(D),{to:"/admin","active-class":"active",class:"nav-link"},{default:$(()=>[$e]),_:1})])):T("",!0),i(o).is_admin?(l(),c("li",Ce,[s(i(D),{to:"/data","active-class":"active",class:"nav-link"},{default:$(()=>[qe]),_:1})])):T("",!0)]),t("div",Me,[i(o).token?(l(),c("div",je,[t("ul",Se,[t("li",Ee,[t("a",{class:"nav-link",onClick:n[0]||(n[0]=(...p)=>i(o).toggleSound&&i(o).toggleSound(...p))},[i(o).sound?(l(),j(a,{key:0,icon:"bell"})):(l(),j(a,{key:1,icon:"bell-slash"}))])]),t("li",Qe,[s(i(D),{to:"/profile","active-class":"active",class:"nav-link"},{default:$(()=>[s(a,{icon:"user"}),y(" "+v(i(o).eid),1)]),_:1})]),t("li",Le,[t("a",{class:"btn btn-success float-end",onClick:n[1]||(n[1]=p=>i(o).logout())},[s(a,{icon:"arrow-right-from-bracket"}),Ie])])])])):(l(),c("div",Ae,[t("a",{class:"btn btn-success",onClick:n[2]||(n[2]=p=>i(o).getToken())},[s(a,{icon:"arrow-right-to-bracket"}),De])]))])])])])}}};var Te=O(Re,[["__scopeId","data-v-5f1a5e7f"]]);const Be={id:"main",class:"container px-4 py-5"},Pe={__name:"App",setup(e){return(o,r)=>(l(),c(C,null,[t("header",null,[s(Te)]),t("div",Be,[(l(),j(Ct,null,{default:$(()=>[s(i($t))]),_:1}))])],64))}};var Oe=O(Pe,[["__scopeId","data-v-68e3a569"]]);const Ne="modulepreload",gt={},Ue="/",Ke=function(o,r){return!r||r.length===0?o():Promise.all(r.map(n=>{if(n=`${Ue}${n}`,n in gt)return;gt[n]=!0;const a=n.endsWith(".css"),p=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${p}`))return;const b=document.createElement("link");if(b.rel=a?"stylesheet":Ne,a||(b.as="script",b.crossOrigin=""),b.href=n,document.head.appendChild(b),a)return new Promise((w,f)=>{b.addEventListener("load",w),b.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>o())};const He={},Ve=e=>(F("data-v-8c844e72"),e=e(),W(),e),Ye={class:"pb-2 border-bottom"},Fe=y(" Office Hours Queue "),We=Ve(()=>t("div",{class:"row p-4 pb-0 pt-lg-4 pb-lg-4 align-items-center rounded-3 border shadow-lg"},[t("div",{class:"col-lg-10 mx-auto"},[t("p",{class:"lead-custom text-center"}," Welcome! Here you can join the queue for office hours. Let's get started! ")])],-1));function Je(e,o){const r=M("font-awesome-icon");return l(),c(C,null,[t("h2",Ye,[s(r,{icon:"chalkboard-teacher"}),Fe]),We],64)}var vt=O(He,[["render",Je],["__scopeId","data-v-8c844e72"]]);const Ze=t("br",null,null,-1),Ge={key:0},Xe=y("Queues List"),to={key:1},eo=y(" Login"),oo={__name:"LoginMessage",setup(e){const o=E();return(r,n)=>{const a=M("RouterLink"),p=M("font-awesome-icon");return l(),c("main",null,[s(vt),Ze,i(o).token?(l(),c("div",Ge,[s(a,{to:"/queues",class:"btn btn-success"},{default:$(()=>[Xe]),_:1})])):(l(),c("div",to,[t("a",{class:"btn btn-success",onClick:n[0]||(n[0]=b=>i(o).getToken())},[s(p,{icon:"arrow-right-to-bracket"}),eo])]))])}}},ro={__name:"HomeView",setup(e){return(o,r)=>(l(),j(oo))}},I=P("queues",{state:()=>({queues:[],online:[],socket:void 0,connected:!1,error:!1}),getters:{getQueue:e=>o=>e.queues.find(r=>r.id==o),getOnline:e=>o=>e.online.find(r=>r.id==o)||{is_open:!1,helpers:0,requests:0},sortedQueues:e=>[...e.queues].sort((o,r)=>r.is_open-o.is_open)},actions:{async hydrate(){m.info("queues:hydrate"),await q.get("/api/v1/queues").then(e=>{this.queues=e.data})},async hydrateOnline(){m.info("queues:hydrateOnline"),this.socket&&(this.socket.disconnect(),this.online={});const e=E(),o="/status";this.socket=ut(o,{auth:{token:e.token}}),this.socket.on("connect",()=>{m.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",r=>{m.error("socket:connect_error - "+r),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{m.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("status:update",async r=>{m.info("status:update - "+r.id),m.debug("|- updated: "+r);var n=this.online.findIndex(a=>a.id===r.id);n<0?this.online.push(r):Object.assign(this.online[n],r)}),m.info("emit status:connect"),await this.socket.emit("status:connect",async(r,n)=>{r==200?(m.info("status:connect OK"),m.debug("|- online: "+n),this.online=n):m.error("status:connect error - "+r)})},async disconnectQueue(){this.socket&&(m.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async update(e){await q.post("/api/v1/queues/"+e.id,{queue:e}).then(async()=>{await this.hydrate()})},async deleteQueue(e){await q.delete("/api/v1/queues/"+e).then(async()=>{await this.hydrate()})},async addQueue(e){await q.put("/api/v1/queues/",{name:e}).then(async()=>{await this.hydrate()})}}});const io={class:"col"},no={class:"card-header"},ao={key:0,class:"float-end badge rounded-pill bg-success"},lo={key:1,class:"float-end badge rounded-pill bg-danger"},so={class:"card-body"},mo={class:"card-text"},co={__name:"QueueCard",props:{queue:{type:Object,default(){return{}}}},setup(e){const o=e,r=I(),{getOnline:n}=S(r),a=at();function p(b){a.push("/queues/"+b)}return(b,w)=>{const f=M("font-awesome-icon");return l(),c("div",io,[t("div",{class:"card w-100 hvr-grow",onClick:w[0]||(w[0]=h=>p(o.queue.id))},[t("h5",no,[y(v(o.queue.name)+" ",1),i(n)(o.queue.id).is_open===1?(l(),c("span",ao,[y("Open | "+v(i(n)(o.queue.id).helpers||0)+" ",1),s(f,{icon:"user-graduate"}),y(" | "+v(i(n)(o.queue.id).requests||0)+" ",1),s(f,{icon:"circle-question"})])):(l(),c("span",lo,"Closed"))]),t("div",so,[t("p",mo,v(o.queue.snippet),1)])])])}}};var po=O(co,[["__scopeId","data-v-3228e55c"]]);const go={class:"row row-cols-1 row-cols-lg-3 g-4"},bo={__name:"QueueList",async setup(e){let o,r;const n=I();n.hydrate(),[o,r]=L(()=>n.hydrateOnline()),await o,r();const{sortedQueues:a}=S(n);return lt(async()=>{await n.disconnectQueue()}),(p,b)=>(l(),c("div",go,[(l(!0),c(C,null,A(i(a),(w,f)=>(l(),j(po,{key:w.id,queue:w,index:f},null,8,["queue","index"]))),128))]))}},uo=t("br",null,null,-1),fo={__name:"QueueListView",setup(e){return(o,r)=>(l(),c("main",null,[s(vt),uo,s(bo)]))}},J=P("requests",{state:()=>({requests:[],online:[],helpers:[],socket:void 0,connected:!1,error:!1}),getters:{getRequest:e=>o=>e.requests.find(r=>r.user_id===o),userOnline:e=>o=>e.online.find(r=>r==o)!==void 0,sortedRequests:e=>[...e.requests].sort(function(o,r){return o.status_id==r.status_id?o.id-r.id:r.status_id-o.status_id})},actions:{async connectQueue(e){this.socket&&this.socket.disconnect(),this.$reset();const o=E(),r="/";this.socket=ut(r,{auth:{token:o.token,queue_id:e}}),this.socket.on("connect",()=>{m.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",n=>{m.error("socket:connect_error - "+n),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{m.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("queue:update",async n=>{m.info("queue:update - "+n.id),m.debug("|- updated: "+n);var a=this.requests.findIndex(p=>p.id===n.id);a<0?(this.requests.push(n),o.sound&&new Audio("/ding-36029.mp3").play()):this.requests[a]=n}),this.socket.on("queue:remove",async n=>{m.info("queue.remove - "+n);var a=this.requests.findIndex(p=>p.id===n);a>=0&&this.requests.splice(a,1)}),this.socket.on("user:online",async n=>{m.info("user:online - "+n),this.online.push(String(n))}),this.socket.on("user:offline",async n=>{m.info("user:offline - "+n),this.online.splice(this.online.indexOf(String(n)),1)}),this.socket.on("helper:online",async n=>{m.info("helper:online - "+n.id),m.debug("|- helper: "+n),this.helpers.push(n)}),this.socket.on("helper:offline",async n=>{m.info("helper:offline - "+n),this.helpers.splice(this.helpers.findIndex(a=>a.id==n),1)}),this.socket.on("queue:opening",async()=>{m.info("queue:opening"),await I().hydrate()}),this.socket.on("connected",async(n,a)=>{m.info("socket:connected"),m.debug("|-online: "+n),m.debug("|-helpers: "+a),this.online=n,this.helpers=a}),this.socket.on("queue:closing",async()=>{m.info("queue:closing"),this.requests=[],await I().hydrate()}),m.info("emit queue:connect"),await this.socket.emit("queue:connect",async(n,a)=>{n==200?(m.info("queue:connect OK"),m.debug("|- requests: "+a),this.requests=a):m.error("queue:connect error - "+n)})},async disconnectQueue(){this.socket&&(m.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async joinQueue(){m.info("emit queue:join"),await this.socket.emit("queue:join",async e=>{e==200?m.info("queue:join OK"):m.error("queue:join error - "+e)})},async openQueue(){m.info("emit queue:open"),await this.socket.emit("queue:open",async e=>{e==200?(m.info("queue:open OK"),I().hydrate()):m.error("queue:open error - "+e)})},async closeQueue(){m.info("emit queue:close"),await this.socket.emit("queue:close",async e=>{e==200?(m.info("queue:close OK"),this.requests=[],I().hydrate()):m.error("queue:close error - "+e)})},async takeRequest(e){m.info("emit request:take - "+e),await this.socket.emit("request:take",e,async o=>{o==200?m.info("request:take OK"):m.error("request:take error - "+o)})},async deleteRequest(e){m.info("emit request:delete - "+e),await this.socket.emit("request:delete",e,async o=>{o==200?m.info("request:delete OK"):m.error("request:delete error - "+o)})},async finishRequest(e){m.info("emit request:finish - "+e),await this.socket.emit("request:finish",e,async o=>{o==200?m.info("request:finish OK"):m.error("request:finish error - "+o)})},async requeueRequest(e){m.info("emit request:requeue - "+e),await this.socket.emit("request:requeue",e,async o=>{o==200?m.info("request:requeue OK"):m.error("request:requeue error - "+o)})}}});const ho=e=>(F("data-v-651444a6"),e=e(),W(),e),xo={key:2,class:"badge bg-primary rounded-pill"},wo=ho(()=>t("br",null,null,-1)),vo={id:"tooltip",class:"text-muted"},ko={__name:"RequestItem",props:{request:{type:Object,default(){return{}}},helper:{type:Boolean,default(){return!1}},userId:{type:Number,default(){return-1}}},setup(e){const o=e;var r=B({now:X.utc()});const n=function(){r.now=X.utc(),setInterval(n,1e4)};setInterval(n,1e4);const a=J(),p=async function(){await a.deleteRequest(o.request.id)},b=async function(){await a.takeRequest(o.request.id)},w=async function(){await a.finishRequest(o.request.id)},f=async function(){await a.requeueRequest(o.request.id)},h=V(()=>o.request.updated_at?r.now.to(o.request.updated_at):r.now.to(o.request.created_at));return(x,u)=>{const d=M("font-awesome-icon");return l(),c("li",{class:Y(["list-group-item",[e.request.status_id==2?"list-group-item-primary":"",e.request.user_id==e.userId?"current-user":"",i(a).userOnline(e.request.user_id)?"":"list-group-item-light"]])},[i(a).userOnline(e.request.user_id)?(l(),j(d,{key:0,icon:"link"})):(l(),j(d,{key:1,icon:"link-slash"})),y(" "+v(e.request.user.name)+" ",1),e.helper?(l(),c(C,{key:2},[t("button",{class:"float-end btn btn-danger btn-sm mx-1",onClick:p},[s(d,{icon:"times",size:"xl"})]),t("button",{class:"float-end btn btn-secondary btn-sm mx-1",onClick:f},[s(d,{icon:"redo",size:"lg"})]),e.request.status_id==1?(l(),c("button",{key:0,class:"float-end btn btn-primary btn-sm mx-1",onClick:b}," Take ")):(l(),c("button",{key:1,class:"float-end btn btn-success btn-sm mx-1",onClick:w}," Done ")),e.request.status_id==2?(l(),c("span",xo,v(e.request.helper.name),1)):T("",!0),wo,t("small",vo,v(i(h)),1)],64)):T("",!0)],2)}}};var yo=O(ko,[["__scopeId","data-v-651444a6"]]);const _o=t("h3",{class:"text-center"},"Students Waiting",-1),zo=t("hr",null,null,-1),$o={class:"list-group list-group-numbered"},kt={__name:"RequestList",props:{id:{type:Number,default:-1}},setup(e){const o=E(),r=J(),{sortedRequests:n}=S(r);return(a,p)=>(l(),c(C,null,[_o,zo,t("ul",$o,[(l(!0),c(C,null,A(i(n),(b,w)=>(l(),j(yo,qt({key:b.id,request:b,index:w},a.$attrs,{"user-id":i(o).id}),null,16,["request","index","user-id"]))),128))])],64))}},Co=t("h3",{class:"text-center"},"Helpers Online",-1),qo=t("hr",null,null,-1),Mo={class:"list-group list-group-flush"},yt={__name:"HelperList",setup(e){const o=J(),{helpers:r}=S(o);return(n,a)=>{const p=M("font-awesome-icon");return l(),c(C,null,[Co,qo,t("ul",Mo,[(l(!0),c(C,null,A(i(r),(b,w)=>(l(),c("li",{key:w,class:"list-group-item"},[s(p,{icon:"link"}),y(" "+v(b.name),1)]))),128))])],64)}}};const H=e=>(F("data-v-38a96dbb"),e=e(),W(),e),jo={class:"queue-header mx-auto"},So={key:0,class:"btn btn-outline-success float-end disabled"},Eo=H(()=>t("span",{class:"visually-hidden"},"Connected!",-1)),Qo=H(()=>t("span",{class:"visually-hidden"},"Disconnected!",-1)),Lo=H(()=>t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),Io=H(()=>t("span",{class:"visually-hidden"},"Connecting...",-1)),Ao=[Lo,Io],Do=H(()=>t("h2",{class:"text-center"},"Moderate Queue",-1)),Ro=H(()=>t("hr",null,null,-1)),To={class:"row"},Bo={class:"col-12 col-md-4 mb-4"},Po={class:"col-12 col-md-8 mb-4"},Oo={__name:"HelperPane",props:{id:{type:Number,default:-1}},async setup(e){let o,r;const n=e,a=I();[o,r]=L(()=>a.hydrate()),await o,r();const p=a.getQueue,b=J(),{connected:w,error:f}=S(b);[o,r]=L(()=>b.connectQueue(n.id)),await o,r();const h=async function(){confirm("Are you sure? All pending requests will be lost!")&&await b.closeQueue()},x=async function(){await b.openQueue()},u=async function(){await b.connectQueue(n.id)};return lt(async()=>{await b.disconnectQueue()}),(d,g)=>{const k=M("font-awesome-icon");return l(),c(C,null,[t("div",jo,[i(w)?(l(),c("button",So,[s(k,{icon:"link"}),Eo])):(l(),c(C,{key:1},[i(f)?(l(),c("button",{key:0,class:"btn btn-outline-danger float-end",onClick:u},[s(k,{icon:"link-slash"}),Qo])):(l(),c("button",{key:1,class:"btn btn-outline-warning float-end",onClick:u},Ao))],64)),Do,i(p)(e.id).is_open==1?(l(),c("a",{key:2,class:"w-100 btn btn-success",onClick:h},"Queue is Open - Click to Close")):(l(),c("a",{key:3,class:"w-100 btn btn-danger",onClick:x},"Queue is Closed - Click to Open"))]),Ro,t("div",To,[t("div",Bo,[s(yt)]),t("div",Po,[s(kt,{id:e.id,helper:""},null,8,["id"])])])],64)}}};var No=O(Oo,[["__scopeId","data-v-38a96dbb"]]);const R=e=>(F("data-v-3eaf00d9"),e=e(),W(),e),Uo={id:"studentModal",class:"modal fade",tabindex:"-1","aria-labelledby":"studentModalLabel","aria-hidden":"true"},Ko={class:"modal-dialog"},Ho={class:"modal-content"},Vo=R(()=>t("div",{class:"modal-header"},[t("h5",{id:"studentModalLabel",class:"modal-title"},"Your Turn!"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Yo={class:"modal-body"},Fo=y(" You will be helped by "),Wo=y(". Their contact info is below: "),Jo=R(()=>t("hr",null,null,-1)),Zo=["innerHTML"],Go=R(()=>t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," OK ")],-1)),Xo={class:"queue-header mx-auto"},tr={key:0,class:"btn btn-outline-success float-end disabled"},er=R(()=>t("span",{class:"visually-hidden"},"Connected!",-1)),or=R(()=>t("span",{class:"visually-hidden"},"Disconnected!",-1)),rr=R(()=>t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),ir=R(()=>t("span",{class:"visually-hidden"},"Connecting...",-1)),nr=[rr,ir],ar=R(()=>t("h2",{class:"text-center"},"Waiting Queue",-1)),lr={key:0,class:"w-100 btn btn-success disabled",disabled:""},sr={key:3,class:"w-100 btn btn-danger disabled",disabled:""},dr=R(()=>t("hr",null,null,-1)),mr={key:0,class:"row"},cr={class:"col-12 col-md-4 mb-4"},pr={class:"col-12 col-md-8 mb-4"},gr={__name:"StudentPane",props:{id:{type:Number,default:-1}},async setup(e){let o,r;const n=e,a=E(),p=I();[o,r]=L(()=>p.hydrate()),await o,r();const b=p.getQueue,w=J(),f=w.getRequest,{connected:h,error:x}=S(w);[o,r]=L(()=>w.connectQueue(n.id)),await o,r();var u,d=!1;w.$subscribe(()=>{const z=f(a.id);z&&z.status_id==2&&!d&&(d=!0,u=new st("#studentModal",{}),u.show(),a.sound&&new Audio("/ding-36029.mp3").play()),z||(d=!1)});const g=async function(){d=!1,await w.joinQueue()},k=async function(){await w.connectQueue(n.id)};return lt(async()=>{await w.disconnectQueue()}),(z,_)=>{const Q=M("font-awesome-icon");return l(),c(C,null,[t("div",Uo,[t("div",Ko,[t("div",Ho,[Vo,t("div",Yo,[i(f)(i(a).id)&&i(f)(i(a).id).helper?(l(),c(C,{key:0},[t("p",null,[Fo,t("strong",null,v(i(f)(i(a).id).helper.name),1),Wo]),Jo,t("div",{innerHTML:i(ft).sanitize(i(ht).parse(i(f)(i(a).id).helper.contact_info||""))},null,8,Zo)],64)):T("",!0)]),Go])])]),t("div",Xo,[i(h)?(l(),c("button",tr,[s(Q,{icon:"link"}),er])):(l(),c(C,{key:1},[i(x)?(l(),c("button",{key:0,class:"btn btn-outline-danger float-end",onClick:k},[s(Q,{icon:"link-slash"}),or])):(l(),c("button",{key:1,class:"btn btn-outline-warning float-end",onClick:k},nr))],64)),ar,i(b)(e.id).is_open==1?(l(),c(C,{key:2},[i(f)(i(a).id)!=null?(l(),c("a",lr,"Queue Joined")):(l(),c("a",{key:1,class:"w-100 btn btn-success",onClick:_[0]||(_[0]=Z=>g())},"Join Queue"))],64)):(l(),c("a",sr,"Queue is Closed"))]),dr,i(b)(e.id).is_open==1?(l(),c("div",mr,[t("div",cr,[s(yt)]),t("div",pr,[s(kt,{id:e.id},null,8,["id"])])])):T("",!0)],64)}}};var br=O(gr,[["__scopeId","data-v-3eaf00d9"]]);const ur=y(" Back"),fr=y(" Edit"),hr={class:"display-5 text-center"},xr=t("hr",null,null,-1),wr=["innerHTML"],vr=t("hr",null,null,-1),kr={__name:"QueueSingle",props:{id:{type:Number,default:-1}},async setup(e){let o,r;const n=E(),a=I();[o,r]=L(()=>a.hydrate()),await o,r();const p=a.getQueue;return(b,w)=>{const f=M("font-awesome-icon");return l(),c("main",null,[s(i(D),{to:{name:"queues"},class:"btn btn-secondary float-start"},{default:$(()=>[s(f,{icon:"arrow-left"}),ur]),_:1}),i(n).is_admin?(l(),j(i(D),{key:0,to:{name:"queue_edit",params:{id:e.id}},class:"btn btn-secondary float-end"},{default:$(()=>[s(f,{icon:"pen-to-square"}),fr]),_:1},8,["to"])):T("",!0),t("h1",hr,v(i(p)(e.id).name),1),xr,t("div",{innerHTML:i(ft).sanitize(i(ht).parse(i(p)(e.id).description))},null,8,wr),vr,i(p)(e.id).helper==1?(l(),j(No,{key:1,id:e.id},null,8,["id"])):(l(),j(br,{key:2,id:e.id},null,8,["id"]))])}}},yr={__name:"QueueSingleView",setup(e){return(o,r)=>(l(),j(kr))}},ct=P("users",{state:()=>({users:[]}),getters:{getUser:e=>o=>e.users.find(r=>r.id===o)},actions:{async hydrate(){m.info("users:hydrate"),await q.get("/api/v1/users").then(e=>{this.users=e.data})},async update(e){await q.post("/api/v1/users/"+e.id,{user:e}).then(async()=>{await this.hydrate()})},async deleteUser(e){await q.delete("/api/v1/users/"+e).then(async()=>{await this.hydrate()})},async addUser(e){await q.put("/api/v1/users/",{eid:e}).then(async()=>{await this.hydrate()})}}});const _r=t("h1",{class:"display-5 text-center"},"Edit Queue",-1),zr=t("hr",null,null,-1),$r={class:"mb-3"},Cr=t("label",{for:"multiselect-users",class:"form-label"},"Helpers",-1),qr=t("div",{class:"form-text"}," Helpers who can manage the queue (usually TAs) - admins already have access ",-1),Mr={class:"row row-cols-1 row-cols-md-2"},jr=t("div",{class:"col d-grid mb-2"},[t("button",{class:"btn btn-success"},"Save")],-1),Sr={class:"col d-grid mb-2"},Er=y(" Cancel"),Qr={__name:"EditQueue",props:{id:{type:Number,default:-1}},async setup(e){let o,r;const n=e,a=at(),p=I();[o,r]=L(()=>p.hydrate()),await o,r();const b=p.getQueue(n.id),w=ct();w.hydrate();const{users:f}=S(w);var h;dt(()=>{h=new mt({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const x=async u=>{u=(({id:d,name:g,snippet:k})=>({id:d,name:g,snippet:k}))(u),u.description=h.value(),u.users=[];for(const d of b.users)u.users.push({id:d.id});try{await p.update(u),a.push("/queues/"+b.id)}catch(d){if(d.response&&d.response.status===422){let g={};if(d.response.data.data){for(const k in d.response.data.data){g[k]="";for(const z of d.response.data.data[k])g[k]=g[k]+z.message+" "}K("queueform",["The server rejected this submission. Please correct errors listed above"],g)}else K("queueform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(d)}};return(u,d)=>{const g=M("FormKit"),k=M("router-link");return l(),c("main",null,[_r,zr,s(g,{id:"queueform",type:"form",value:i(b),actions:!1,onSubmit:x},{default:$(()=>[s(g,{type:"text",name:"name",label:"Queue Name",help:"Name of the queue (usually the course)",validation:"required"}),s(g,{type:"text",name:"snippet",label:"Short Description",help:"Short description shown on the initial card"}),s(g,{type:"textarea",name:"description",label:"Long Description",help:"Long description shown on the queue page",rows:"10"}),t("div",$r,[Cr,s(i(xt),{id:"multiselect-users",modelValue:i(b).users,"onUpdate:modelValue":d[0]||(d[0]=z=>i(b).users=z),class:"form-control",options:i(f),multiple:!0,"tag-placeholder":"Add this as new user",placeholder:"Type to search or add user",label:"eid","track-by":"id"},null,8,["modelValue","options"]),qr]),t("div",Mr,[jr,t("div",Sr,[s(k,{to:{name:"queue_single",params:{id:i(b).id}},class:"btn btn-secondary"},{default:$(()=>[Er]),_:1},8,["to"])])])]),_:1},8,["value"])])}}},Lr={__name:"QueueEditView",setup(e){return(o,r)=>(l(),j(Qr))}},Ir=P("profile",{state:()=>({user:{}}),actions:{async hydrate(){m.info("profile:hydrate"),await q.get("/api/v1/profile").then(e=>{this.user=e.data})},async update(e){await q.post("/api/v1/profile/",{user:e}).then(async()=>{await this.hydrate()})}}});const Ar=t("h1",{class:"display-5 text-center"},"Edit User",-1),Dr=t("hr",null,null,-1),Rr={class:"row row-cols-1 row-cols-md-2"},Tr=t("div",{class:"col d-grid mb-2"},[t("button",{class:"btn btn-success"},"Save")],-1),Br={class:"col d-grid mb-2"},Pr=y(" Cancel"),Or={__name:"EditProfile",async setup(e){let o,r;const n=at(),a=Ir();[o,r]=L(()=>a.hydrate()),await o,r();const{user:p}=S(a);var b;dt(()=>{b=new mt({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const w=async f=>{const h={name:f.name,contact_info:b.value()};try{await a.update(h),n.push("/queues/")}catch(x){if(x.response&&x.response.status===422){let u={};if(x.response.data.data){for(const d in x.response.data.data){u[d]="";for(const g of x.response.data.data[d])u[d]=u[d]+g.message+" "}K("userform",["The server rejected this submission. Please correct errors listed above"],u)}else K("userform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(x)}};return(f,h)=>{const x=M("FormKit"),u=M("router-link");return l(),c("main",null,[Ar,Dr,s(x,{id:"userform",type:"form",value:i(p),actions:!1,onSubmit:w},{default:$(()=>[s(x,{type:"text",name:"eid",label:"eID",disabled:!0,help:"Your K-State eID (cannot be changed)",validation:"required"}),s(x,{type:"text",name:"name",label:"Name",help:"Your full name as you'd like it displayed on the site",validation:"required"}),s(x,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact you",rows:"10"}),t("div",Rr,[Tr,t("div",Br,[s(u,{to:{name:"queues"},class:"btn btn-secondary"},{default:$(()=>[Pr]),_:1})])])]),_:1},8,["value"])])}}};const Nr={__name:"ProfileView",setup(e){return(o,r)=>(l(),j(Or))}},Ur={id:"userModal",class:"modal fade",tabindex:"-1","aria-labelledby":"userModalLabel","aria-hidden":"true"},Kr={class:"modal-dialog"},Hr={class:"modal-content"},Vr=t("div",{class:"modal-header"},[t("h5",{id:"userModalLabel",class:"modal-title"},"Delete User"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Yr={class:"modal-body"},Fr=t("h5",null,"Are you sure you want to delete this user?",-1),Wr=t("strong",null,"eID: ",-1),Jr=t("br",null,null,-1),Zr=t("strong",null,"Name: ",-1),Gr={class:"modal-footer"},Xr=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),ti=y(" Delete User "),ei=y(" User "),oi=t("h1",{class:"text-center"},"Users",-1),ri={class:"table table-striped table-hover"},ii=t("thead",null,[t("tr",null,[t("th",null,"eID"),t("th",null,"Name"),t("th",null,"Roles"),t("th",null,"Actions")])],-1),ni=["onClick"],ai={__name:"UserAdmin",setup(e){const o=ct();o.hydrate();const{users:r}=S(o),n=E();var a=B({}),p;const b=function(h){a.id=h.id,a.eid=h.eid,a.name=h.name,p=new st("#userModal",{}),p.show()},w=async function(h){await o.deleteUser(h),p.hide()},f=async function(){var h=prompt("Enter an eID to create a user");if(h)try{await o.addUser(h)}catch(x){x.response&&x.response.status===422?alert(JSON.stringify(x.response.data)):alert(x)}};return(h,x)=>{const u=M("font-awesome-icon");return l(),c(C,null,[t("div",Ur,[t("div",Kr,[t("div",Hr,[Vr,t("div",Yr,[Fr,t("p",null,[Wr,y(v(i(a).eid)+" ",1),Jr,Zr,y(v(i(a).name),1)])]),t("div",Gr,[Xr,t("button",{type:"button",class:"btn btn-danger",onClick:x[0]||(x[0]=d=>w(i(a).id))},[s(u,{icon:"trash"}),ti])])])])]),t("button",{type:"button",class:"btn btn-success float-end",onClick:f},[s(u,{icon:"plus"}),ei]),oi,t("table",ri,[ii,t("tbody",null,[(l(!0),c(C,null,A(i(r),d=>(l(),c("tr",{key:d.id},[t("td",null,v(d.eid),1),t("td",null,v(d.name),1),t("td",null,[(l(!0),c(C,null,A(d.roles,g=>(l(),c("span",{key:g.id,class:"badge rounded-pill bg-success"},v(g.name),1))),128))]),t("td",null,[s(i(D),{to:{name:"admin_useredit",params:{id:d.id}},class:"btn btn-secondary btn-sm mx-1"},{default:$(()=>[s(u,{icon:"pen-to-square"})]),_:2},1032,["to"]),d.id!=i(n).id?(l(),c("button",{key:0,type:"button",class:"btn btn-danger btn-sm mx-1",onClick:wt(g=>b(d),["prevent"])},[s(u,{icon:"trash"})],8,ni)):T("",!0)])]))),128))])])],64)}}},li={id:"queueModal",class:"modal fade",tabindex:"-1","aria-labelledby":"queueModalLabel","aria-hidden":"true"},si={class:"modal-dialog"},di={class:"modal-content"},mi=t("div",{class:"modal-header"},[t("h5",{id:"queueModalLabel",class:"modal-title"},"Delete Queue"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ci={class:"modal-body"},pi=t("h5",null,"Are you sure you want to delete this queue?",-1),gi=t("strong",null,"Name: ",-1),bi={class:"modal-footer"},ui=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),fi=y(" Delete Queue "),hi=y(" Queue "),xi=t("h1",{class:"text-center"},"Queues",-1),wi={class:"table table-striped table-hover"},vi=t("thead",null,[t("tr",null,[t("th",null,"Name"),t("th",null,"Actions")])],-1),ki=["onClick"],yi={__name:"QueueAdmin",setup(e){const o=I();o.hydrate();const{queues:r}=S(o);var n=B({}),a;const p=function(f){n.id=f.id,n.name=f.name,a=new st("#queueModal",{}),a.show()},b=async function(f){await o.deleteQueue(f),a.hide()},w=async function(){var f=prompt("Enter a name for the new queue");if(f)try{await o.addQueue(f)}catch(h){h.response&&h.response.status===422?alert(JSON.stringify(h.response.data)):alert(h)}};return(f,h)=>{const x=M("font-awesome-icon");return l(),c(C,null,[t("div",li,[t("div",si,[t("div",di,[mi,t("div",ci,[pi,t("p",null,[gi,y(v(i(n).name),1)])]),t("div",bi,[ui,t("button",{type:"button",class:"btn btn-danger",onClick:h[0]||(h[0]=u=>b(i(n).id))},[s(x,{icon:"trash"}),fi])])])])]),t("button",{type:"button",class:"btn btn-success float-end",onClick:w},[s(x,{icon:"plus"}),hi]),xi,t("table",wi,[vi,t("tbody",null,[(l(!0),c(C,null,A(i(r),u=>(l(),c("tr",{key:u.id},[t("td",null,v(u.name),1),t("td",null,[t("button",{type:"button",class:"btn btn-danger btn-sm mx-1",onClick:wt(d=>p(u),["prevent"])},[s(x,{icon:"trash"})],8,ki)])]))),128))])])],64)}}},_i={__name:"AdminView",setup(e){return(o,r)=>(l(),c(C,null,[s(yi),s(ai)],64))}},zi=P("roles",{state:()=>({roles:[]}),actions:{async hydrate(){m.info("roles:hydrate"),await q.get("/api/v1/roles").then(e=>{this.roles=e.data})}}});const $i=t("h1",{class:"display-5 text-center"},"Edit User",-1),Ci=t("hr",null,null,-1),qi={class:"mb-3"},Mi=t("label",{for:"multiselect-roles",class:"form-label"},"Roles",-1),ji=t("div",{class:"form-text"},"Roles assigned to this user",-1),Si={class:"row row-cols-1 row-cols-md-2"},Ei=t("div",{class:"col d-grid mb-2"},[t("button",{class:"btn btn-success"},"Save")],-1),Qi={class:"col d-grid mb-2"},Li=y(" Cancel"),Ii={__name:"UserEdit",props:{id:{type:Number,default:-1}},async setup(e){let o,r;const n=e,a=at(),p=ct();[o,r]=L(()=>p.hydrate()),await o,r();const b=p.users.find(u=>u.id===parseInt(n.id)),w=zi();w.hydrate();const{roles:f}=S(w);var h;dt(()=>{h=new mt({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const x=async u=>{u=(({id:d,name:g})=>({id:d,name:g}))(u),u.contact_info=h.value(),u.roles=[];for(const d of b.roles)u.roles.push({id:d.id});try{await p.update(u),a.push("/admin/")}catch(d){if(d.response&&d.response.status===422){let g={};if(d.response.data.data){for(const k in d.response.data.data){g[k]="";for(const z of d.response.data.data[k])g[k]=g[k]+z.message+" "}K("usersForm",["The server rejected this submission. Please correct errors listed above"],g)}else K("usersForm",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(d)}};return(u,d)=>{const g=M("FormKit"),k=M("router-link");return l(),c("main",null,[$i,Ci,s(g,{id:"userform",type:"form",value:i(b),actions:!1,onSubmit:x},{default:$(()=>[s(g,{type:"text",name:"eid",label:"eID",disabled:!0,help:"The user's K-State eID (cannot be changed)",validation:"required"}),s(g,{type:"text",name:"name",label:"Name",help:"The user's full name as you'd like it displayed on the site",validation:"required"}),s(g,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact the user",rows:"10"}),t("div",qi,[Mi,s(i(xt),{id:"multiselect-roles",modelValue:i(b).roles,"onUpdate:modelValue":d[0]||(d[0]=z=>i(b).roles=z),class:"form-control",options:i(f),multiple:!0,"tag-placeholder":"Add this as new role",placeholder:"Type to search or add role",label:"name","track-by":"id"},null,8,["modelValue","options"]),ji]),t("div",Si,[Ei,t("div",Qi,[s(k,{to:{name:"admin"},class:"btn btn-secondary"},{default:$(()=>[Li]),_:1})])])]),_:1},8,["value"])])}}},Ai={__name:"UserEditView",setup(e){return(o,r)=>(l(),j(Ii))}},pt=P("periods",{state:()=>({queues:[],periods:[],events:[],presences:[]}),getters:{getPeriod:e=>o=>e.periods.find(r=>r.id==o)},actions:{async hydrate(){m.info("periods:hydrate"),await q.get("/api/v1/periods").then(e=>{this.queues=e.data})},async loadPeriods(e){m.info("periods:hydrate - "+e),await q.get("/api/v1/periods?name="+e).then(o=>{this.periods=o.data})},async loadEvents(e){m.info("periods:hydrate - "+e),await q.get("/api/v1/periods/"+e).then(o=>{this.events=o.data.events;for(var r of this.events)r.ganttBarConfig={id:r.id},r.created_at=X(r.created_at).format("YYYY-MM-DD HH:mm"),r.updated_at=X(r.updated_at).format("YYYY-MM-DD HH:mm");this.presences=o.data.presences})}}});const Di=t("h1",{class:"display-5 text-center"},"Event Log: Queues",-1),Ri=["data-page-count"],Ti={class:"col-md-6 mb-2 mb-md-0"},Bi={class:"col-md-6"},Pi={class:"row"},Oi={class:"col-md-12"},Ni={class:"table-responsive"},Ui={class:"table table-striped d-md-table"},Ki=["onClick"],Hi=t("i",{class:"gg-select float-right"},null,-1),Vi=t("th",null,"Actions",-1),Yi=y("View"),Fi={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},Wi={__name:"QueueList",async setup(e){let o,r;const n=pt();[o,r]=L(()=>n.hydrate()),await o,r();const{queues:a}=S(n),p=B([{name:"Queue",field:"queue_name",sort:""},{name:"Periods",field:"periods",sort:""},{name:"Recent",field:"recent",sort:""}]),b=function(f,h){let x;const u=p[h];f.shiftKey||this.cols.forEach(d=>{d.field!==u.field&&(d.sort="")}),u.sort||(x="asc"),u.sort==="desc"&&(x=f.shiftKey?"":"asc"),u.sort==="asc"&&(x="desc"),u.sort=x},w=V(()=>p.reduce((f,h)=>(h.sort&&(h.sort==="asc"?f.push(h.field):f.push("-"+h.field)),f),[]));return(f,h)=>{const x=M("router-link");return l(),c(C,null,[Di,s(i(nt),{"ds-data":i(a),"ds-sortby":i(w)},{default:$(({ds:u})=>[t("div",{class:"row","data-page-count":u.dsPagecount},[t("div",Ti,[s(i(tt),{"ds-show-entries":"25"})]),t("div",Bi,[s(i(et),{"ds-search-placeholder":"Search..."})])],8,Ri),t("div",Pi,[t("div",Oi,[t("div",Ni,[t("table",Ui,[t("thead",null,[t("tr",null,[(l(!0),c(C,null,A(p,(d,g)=>(l(),c("th",{key:d.field,class:Y(["sort",d.sort]),onClick:k=>b(k,g)},[y(v(d.name)+" ",1),Hi],10,Ki))),128)),Vi])]),s(i(ot),{tag:"tbody"},{default:$(({row:d})=>[t("tr",null,[t("td",null,v(d.queue_name),1),t("td",null,v(d.periods),1),t("td",null,v(d.recent),1),t("td",null,[s(x,{to:{name:"data_periods",params:{name:d.queue_name}},class:"btn btn-secondary btn-sm mx-1"},{default:$(()=>[Yi]),_:2},1032,["to"])])])]),_:1})])])])]),t("div",Fi,[s(i(rt),{class:"mb-2 mb-md-0"}),s(i(it))])]),_:1},8,["ds-data","ds-sortby"])],64)}}},Ji={__name:"DashboardView",setup(e){return(o,r)=>(l(),j(Wi))}};const Zi={class:"display-5 text-center"},Gi=["data-page-count"],Xi={class:"col-md-6 mb-2 mb-md-0"},tn={class:"col-md-6"},en={class:"row"},on={class:"col-md-12"},rn={class:"table-responsive"},nn={class:"table table-striped d-md-table"},an=["onClick"],ln=t("i",{class:"gg-select float-right"},null,-1),sn=t("th",null,"Actions",-1),dn=y("View"),mn={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},cn={__name:"PeriodList",props:{name:{type:String,default:""}},async setup(e){let o,r;const n=e,a=pt();[o,r]=L(()=>a.loadPeriods(n.name)),await o,r();const{periods:p}=S(a),b=B([{name:"ID",field:"id",sort:""},{name:"Opened",field:"created_at",sort:""},{name:"Closed",field:"updated_at",sort:""},{name:"Events",field:"events",sort:""}]),w=function(h,x){let u;const d=b[x];h.shiftKey||this.cols.forEach(g=>{g.field!==d.field&&(g.sort="")}),d.sort||(u="asc"),d.sort==="desc"&&(u=h.shiftKey?"":"asc"),d.sort==="asc"&&(u="desc"),d.sort=u},f=V(()=>b.reduce((h,x)=>(x.sort&&(x.sort==="asc"?h.push(x.field):h.push("-"+x.field)),h),[]));return(h,x)=>{const u=M("router-link");return l(),c(C,null,[t("h1",Zi,"Event Log: "+v(e.name),1),s(i(nt),{"ds-data":i(p),"ds-sortby":i(f)},{default:$(({ds:d})=>[t("div",{class:"row","data-page-count":d.dsPagecount},[t("div",Xi,[s(i(tt),{"ds-show-entries":"25"})]),t("div",tn,[s(i(et),{"ds-search-placeholder":"Search..."})])],8,Gi),t("div",en,[t("div",on,[t("div",rn,[t("table",nn,[t("thead",null,[t("tr",null,[(l(!0),c(C,null,A(b,(g,k)=>(l(),c("th",{key:g.field,class:Y(["sort",g.sort]),onClick:z=>w(z,k)},[y(v(g.name)+" ",1),ln],10,an))),128)),sn])]),s(i(ot),{tag:"tbody"},{default:$(({row:g})=>[t("tr",null,[t("td",null,v(g.id),1),t("td",null,v(g.created_at),1),t("td",null,v(g.updated_at),1),t("td",null,v(g.events),1),t("td",null,[s(u,{to:{name:"period",params:{id:g.id}},class:"btn btn-secondary btn-sm mx-1"},{default:$(()=>[dn]),_:2},1032,["to"])])])]),_:1})])])])]),t("div",mn,[s(i(rt),{class:"mb-2 mb-md-0"}),s(i(it))])]),_:1},8,["ds-data","ds-sortby"])],64)}}},pn={__name:"PeriodView",setup(e){return(o,r)=>(l(),j(cn))}},gn={class:"display-5 text-center"},bn=t("h2",{class:"text-center"},"Events",-1),un=["data-page-count"],fn={class:"col-md-6 mb-2 mb-md-0"},hn={class:"col-md-6"},xn={class:"row"},wn={class:"col-md-12"},vn={class:"table-responsive"},kn={class:"table table-striped d-md-table"},yn=["onClick"],_n=t("i",{class:"gg-select float-right"},null,-1),zn={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},$n=t("h2",{class:"text-center"},"Presences",-1),Cn=["data-page-count"],qn={class:"col-md-6 mb-2 mb-md-0"},Mn={class:"col-md-6"},jn={class:"row"},Sn={class:"col-md-12"},En={class:"table-responsive"},Qn={class:"table table-striped d-md-table"},Ln=["onClick"],In=t("i",{class:"gg-select float-right"},null,-1),An={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},Dn={__name:"EventList",props:{id:{type:Number,default:-1}},async setup(e){let o,r;const n=e,a=pt();[o,r]=L(()=>a.loadEvents(n.id)),await o,r();const{events:p,presences:b}=S(a),w=B([{name:"ID",field:"id",sort:""},{name:"eID",field:"eid",sort:""},{name:"Status",field:"status",sort:""},{name:"Start",field:"created_at",sort:""},{name:"End",field:"updated_at",sort:""},{name:"Helper",field:"presence.eid",sort:""}]),f=B([{name:"ID",field:"id",sort:""},{name:"eID",field:"eid",sort:""},{name:"Start",field:"created_at",sort:""},{name:"End",field:"updated_at",sort:""}]),h=function(g,k){let z;const _=w[k];g.shiftKey||this.eventCols.forEach(Q=>{Q.field!==_.field&&(Q.sort="")}),_.sort||(z="asc"),_.sort==="desc"&&(z=g.shiftKey?"":"asc"),_.sort==="asc"&&(z="desc"),_.sort=z},x=function(g,k){let z;const _=f[k];g.shiftKey||this.presenceCols.forEach(Q=>{Q.field!==_.field&&(Q.sort="")}),_.sort||(z="asc"),_.sort==="desc"&&(z=g.shiftKey?"":"asc"),_.sort==="asc"&&(z="desc"),_.sort=z},u=V(()=>w.reduce((g,k)=>(k.sort&&(k.sort==="asc"?g.push(k.field):g.push("-"+k.field)),g),[])),d=V(()=>f.reduce((g,k)=>(k.sort&&(k.sort==="asc"?g.push(k.field):g.push("-"+k.field)),g),[]));return(g,k)=>(l(),c(C,null,[t("h1",gn,"Event Log: Period "+v(e.id),1),bn,s(i(nt),{"ds-data":i(p),"ds-sortby":i(u)},{default:$(({ds:z})=>[t("div",{class:"row","data-page-count":z.dsPagecount},[t("div",fn,[s(i(tt),{"ds-show-entries":"25"})]),t("div",hn,[s(i(et),{"ds-search-placeholder":"Search..."})])],8,un),t("div",xn,[t("div",wn,[t("div",vn,[t("table",kn,[t("thead",null,[t("tr",null,[(l(!0),c(C,null,A(w,(_,Q)=>(l(),c("th",{key:_.field,class:Y(["sort",_.sort]),onClick:Z=>h(Z,Q)},[y(v(_.name)+" ",1),_n],10,yn))),128))])]),s(i(ot),{tag:"tbody"},{default:$(({row:_})=>[t("tr",null,[t("td",null,v(_.id),1),t("td",null,v(_.eid),1),t("td",null,v(_.status),1),t("td",null,v(_.created_at),1),t("td",null,v(_.updated_at),1),t("td",null,v(_.presence?_.presence.eid:""),1)])]),_:1})])])])]),t("div",zn,[s(i(rt),{class:"mb-2 mb-md-0"}),s(i(it))])]),_:1},8,["ds-data","ds-sortby"]),$n,s(i(nt),{"ds-data":i(b),"ds-sortby":i(d)},{default:$(({ds:z})=>[t("div",{class:"row","data-page-count":z.dsPagecount},[t("div",qn,[s(i(tt),{"ds-show-entries":"25"})]),t("div",Mn,[s(i(et),{"ds-search-placeholder":"Search..."})])],8,Cn),t("div",jn,[t("div",Sn,[t("div",En,[t("table",Qn,[t("thead",null,[t("tr",null,[(l(!0),c(C,null,A(f,(_,Q)=>(l(),c("th",{key:_.field,class:Y(["sort",_.sort]),onClick:Z=>x(Z,Q)},[y(v(_.name)+" ",1),In],10,Ln))),128))])]),s(i(ot),{tag:"tbody"},{default:$(({row:_})=>[t("tr",null,[t("td",null,v(_.id),1),t("td",null,v(_.eid),1),t("td",null,v(_.created_at),1),t("td",null,v(_.updated_at),1)])]),_:1})])])])]),t("div",An,[s(i(rt),{class:"mb-2 mb-md-0"}),s(i(it))])]),_:1},8,["ds-data","ds-sortby"])],64))}},Rn={__name:"EventView",setup(e){return(o,r)=>(l(),j(Dn))}},U=()=>E().is_admin,_t=Mt({history:jt("/"),routes:[{path:"/",name:"home",component:ro,beforeEnter:async()=>{const e=E();if(await e.tryToken(),e.token)return"/queues"}},{path:"/about",name:"about",component:()=>Ke(()=>import("./AboutView.ac98bd61.js"),["assets/AboutView.ac98bd61.js","assets/vendor.0627cd51.js"])},{path:"/queues",name:"queues",component:fo},{path:"/queues/:id",name:"queue_single",component:yr,props:e=>({id:Number(e.params.id)})},{path:"/queues/:id/edit",name:"queue_edit",component:Lr,props:!0,beforeEnter:U},{path:"/profile",name:"profile",component:Nr},{path:"/admin",name:"admin",component:_i,beforeEnter:U},{path:"/admin/user/:id/edit",name:"admin_useredit",component:Ai,props:!0,beforeEnter:U},{path:"/data",name:"data",component:Ji,beforeEnter:U},{path:"/data/:name",name:"data_periods",component:pn,beforeEnter:U,props:e=>({name:e.params.name})},{path:"/period/:id",name:"period",component:Rn,beforeEnter:U,props:e=>({id:e.params.id})}]});_t.beforeEach(async function(e){if(e.name!=="home"&&e.name!=="about"){const o=E();if(o.token||await o.tryToken(),!o.token)return"/"}});const Tn=()=>{q.interceptors.request.use(e=>{if(e.url!=="/auth/token"){const o=E();o.token&&(e.headers.Authorization="Bearer "+o.token)}return e},e=>Promise.reject(e)),q.interceptors.response.use(e=>e,async e=>{const o=e.config;if(o.url!=="/auth/token"&&e.response&&e.response.status===401&&!o._retry){o._retry=!0;try{return await E().refreshToken(),q(o)}catch(r){return Promise.reject(r)}}return Promise.reject(e)})};m.useDefaults();m.setLevel(m.WARN);St.add(Et,Qt,Lt,It,At,Dt,Rt,Tt,Bt,Pt,Ot,Nt,Ut,Kt,Ht,Vt,Yt,Ft,Wt,Jt,Zt,Gt,Xt,te,ee,oe,re);ie.watch();Tn();const N=ne(Oe);N.use(ae());N.use(_t);N.use(le,bt);N.use(se,de({config:{classes:{input:"form-control",label:"form-label",help:"form-text",outer:"mb-3"}}}));N.use(me);N.component("FontAwesomeIcon",ce);N.mount("#app");export{O as _};
