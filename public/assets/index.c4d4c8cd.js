import{a as et,d as R,u as pt,o as P,L as c,r as z,b as a,c as s,e,f as m,w as q,g as l,R as N,h as O,i as v,t as C,p as J,j as H,k as $,S as gt,F as y,l as bt,m as V,n as E,s as Q,q as T,v as ut,x as ft,y as ht,z as ot,M as K,A as rt,B as it,C as Y,D as W,E as nt,G as A,H as at,I as lt,J as xt,K as wt,N as vt,O as kt,P as yt,Q as _t,T as zt,U as Ct,V as qt,W as $t,X as Mt,Y as jt,Z as St,_ as Qt,$ as Et,a0 as Lt,a1 as Nt,a2 as Ot,a3 as It,a4 as Tt,a5 as At,a6 as Rt,a7 as Bt,a8 as Dt,a9 as Ut,aa as Pt,ab as Jt,ac as Ht,ad as Vt,ae as Ft,af as Kt,ag as Yt,ah as Wt}from"./vendor.dc7b8f01.js";const Zt=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const p of d.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&r(p)}).observe(document,{childList:!0,subtree:!0});function n(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerpolicy&&(d.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?d.credentials="include":i.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(i){if(i.ep)return;i.ep=!0;const d=n(i);fetch(i.href,d)}};Zt();const _=et.create({baseURL:"/",headers:{Accept:"application/json","Content-Type":"application/json"}}),M=R("token",{state:()=>({token:pt("token","")}),getters:{refresh_token(){return this.token?P(this.token).refresh_token:""},eid(){return this.token?P(this.token).eid:""},id(){return this.token?P(this.token).user_id:""},is_admin(){return this.token?P(this.token).is_admin:!1}},actions:{async getToken(){c.info("token:get"),await _.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(c.info("token:get login failed - redirecting to CAS"),window.location.href="/auth/login"):(c.error("token:get error"+JSON.stringify(t)),this.token="")})},async tryToken(){c.info("token:try"),await _.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(async t=>{t.response&&t.response.status===401?(c.info("token:try login failed - trying refresh token"),await this.refreshToken()):(c.error("token:try error"+JSON.stringify(t)),this.token="")})},async refreshToken(){c.info("token:refresh"),await _.post("/auth/token",{refresh_token:this.refresh_token}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(c.info("token:refresh login failed - redirecting to CAS"),window.location.href="/auth/login"):(c.error("token:refresh error"+JSON.stringify(t)),this.token="")})},async logout(){this.token="",window.location.href="http://localhost:3000/auth/logout"}}});var I=(t,o)=>{const n=t.__vccOpts||t;for(const[r,i]of o)n[r]=i;return n};const Gt=t=>(J("data-v-0d8040b6"),t=t(),H(),t),Xt={class:"navbar navbar-expand-md navbar-dark fixed-top bg-purple"},te={class:"container"},ee=v("Office Hours"),oe=Gt(()=>e("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarCollapse","aria-controls":"navbarCollapse","aria-expanded":"false","aria-label":"Toggle navigation"},[e("span",{class:"navbar-toggler-icon"})],-1)),re={id:"navbarCollapse",class:"collapse navbar-collapse"},ie={class:"navbar-nav me-auto mb-2 mb-md-0"},ne={class:"nav-item"},ae=v("Queues"),le={class:"nav-item"},de=v("About"),se={key:0,class:"nav-item"},me=v("Admin"),ce={class:""},pe={key:0},ge={class:"navbar-nav me-auto mb-2 mb-md-0"},be={class:"nav-item"},ue={class:"nav-item"},fe=v(" Logout"),he={key:1},xe=v(" Login"),we={__name:"NavBar",setup(t){const o=M();return(n,r)=>{const i=z("font-awesome-icon");return a(),s("nav",Xt,[e("div",te,[m(l(N),{to:"/",class:"navbar-brand"},{default:q(()=>[ee]),_:1}),oe,e("div",re,[e("ul",ie,[e("li",ne,[m(l(N),{to:"/queues","active-class":"active",class:"nav-link"},{default:q(()=>[ae]),_:1})]),e("li",le,[m(l(N),{to:"/about","active-class":"active",class:"nav-link"},{default:q(()=>[de]),_:1})]),l(o).is_admin?(a(),s("li",se,[m(l(N),{to:"/admin","active-class":"active",class:"nav-link"},{default:q(()=>[me]),_:1})])):O("",!0)]),e("div",ce,[l(o).token?(a(),s("div",pe,[e("ul",ge,[e("li",be,[m(l(N),{to:"/profile","active-class":"active",class:"nav-link"},{default:q(()=>[m(i,{icon:"user"}),v(" "+C(l(o).eid),1)]),_:1})]),e("li",ue,[e("a",{class:"btn btn-success float-end",onClick:r[0]||(r[0]=d=>l(o).logout())},[m(i,{icon:"arrow-right-from-bracket"}),fe])])])])):(a(),s("div",he,[e("a",{class:"btn btn-success",onClick:r[1]||(r[1]=d=>l(o).getToken())},[m(i,{icon:"arrow-right-to-bracket"}),xe])]))])])])])}}};var ve=I(we,[["__scopeId","data-v-0d8040b6"]]);const ke={id:"main",class:"container px-4 py-5"},ye={__name:"App",setup(t){return(o,n)=>(a(),s(y,null,[e("header",null,[m(ve)]),e("div",ke,[(a(),$(gt,null,{default:q(()=>[m(l(bt))]),_:1}))])],64))}};var _e=I(ye,[["__scopeId","data-v-68e3a569"]]);const ze="modulepreload",tt={},Ce="/",qe=function(o,n){return!n||n.length===0?o():Promise.all(n.map(r=>{if(r=`${Ce}${r}`,r in tt)return;tt[r]=!0;const i=r.endsWith(".css"),d=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${d}`))return;const p=document.createElement("link");if(p.rel=i?"stylesheet":ze,i||(p.as="script",p.crossOrigin=""),p.href=r,document.head.appendChild(p),i)return new Promise((x,u)=>{p.addEventListener("load",x),p.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>o())};const $e={},Me=t=>(J("data-v-8c844e72"),t=t(),H(),t),je={class:"pb-2 border-bottom"},Se=v(" Office Hours Queue "),Qe=Me(()=>e("div",{class:"row p-4 pb-0 pt-lg-4 pb-lg-4 align-items-center rounded-3 border shadow-lg"},[e("div",{class:"col-lg-10 mx-auto"},[e("p",{class:"lead-custom text-center"}," Welcome! Here you can join the queue for office hours. Let's get started! ")])],-1));function Ee(t,o){const n=z("font-awesome-icon");return a(),s(y,null,[e("h2",je,[m(n,{icon:"chalkboard-teacher"}),Se]),Qe],64)}var dt=I($e,[["render",Ee],["__scopeId","data-v-8c844e72"]]);const Le=e("br",null,null,-1),Ne={key:0},Oe=v("Queues List"),Ie={key:1},Te=v(" Login"),Ae={__name:"LoginMessage",setup(t){const o=M();return(n,r)=>{const i=z("RouterLink"),d=z("font-awesome-icon");return a(),s("main",null,[m(dt),Le,l(o).token?(a(),s("div",Ne,[m(i,{to:"/queues",class:"btn btn-success"},{default:q(()=>[Oe]),_:1})])):(a(),s("div",Ie,[e("a",{class:"btn btn-success",onClick:r[0]||(r[0]=p=>l(o).getToken())},[m(d,{icon:"arrow-right-to-bracket"}),Te])]))])}}},Re={__name:"HomeView",setup(t){return(o,n)=>(a(),$(Ae))}};const Be={class:"col"},De={class:"card-header"},Ue={key:0,class:"float-end badge rounded-pill bg-success"},Pe={key:1,class:"float-end badge rounded-pill bg-danger"},Je={class:"card-body"},He={class:"card-text"},Ve={__name:"QueueCard",props:{queue:{type:Object,default(){return{}}},helpers:{type:Number,default(){return 0}},requests:{type:Number,default(){return 0}}},setup(t){const o=t,n=V();function r(i){n.push("/queues/"+i)}return(i,d)=>{const p=z("font-awesome-icon");return a(),s("div",Be,[e("div",{class:"card w-100 hvr-grow",onClick:d[0]||(d[0]=x=>r(o.queue.id))},[e("h5",De,[v(C(o.queue.name)+" ",1),o.queue.is_open===1?(a(),s("span",Ue,[v("Open | "+C(t.helpers)+" ",1),m(p,{icon:"user-graduate"}),v(" | "+C(t.requests)+" ",1),m(p,{icon:"circle-question"})])):(a(),s("span",Pe,"Closed"))]),e("div",Je,[e("p",He,C(o.queue.snippet),1)])])])}}};var Fe=I(Ve,[["__scopeId","data-v-3451fb3b"]]);const S=R("queues",{state:()=>({queues:[],online:{}}),getters:{getQueue:t=>o=>t.queues.find(n=>n.id==o),sortedQueues:t=>[...t.queues].sort((o,n)=>n.is_open-o.is_open)},actions:{async hydrate(){c.info("queues:hydrate"),await _.get("/api/v1/queues").then(t=>{this.queues=t.data})},async hydrateOnline(){c.info("queues:hydrateOnline"),await _.get("/api/v1/queues/online").then(t=>{this.online=t.data})},async update(t){await _.post("/api/v1/queues/"+t.id,{queue:t}).then(async()=>{await this.hydrate()})},async deleteQueue(t){await _.delete("/api/v1/queues/"+t).then(async()=>{await this.hydrate()})},async addQueue(t){await _.put("/api/v1/queues/",{name:t}).then(async()=>{await this.hydrate()})}}}),Ke={class:"row row-cols-1 row-cols-lg-3 g-4"},Ye={__name:"QueueList",async setup(t){let o,n;const r=S();r.hydrate(),[o,n]=E(()=>r.hydrateOnline()),await o,n();const{sortedQueues:i,online:d}=Q(r);return(p,x)=>(a(),s("div",Ke,[(a(!0),s(y,null,T(l(i),(u,f)=>(a(),$(Fe,{key:u.id,queue:u,index:f,helpers:l(d).helpers[String(u.id)],requests:l(d).requests[String(u.id)]},null,8,["queue","index","helpers","requests"]))),128))]))}},We=e("br",null,null,-1),Ze={__name:"QueueListView",setup(t){return(o,n)=>(a(),s("main",null,[m(dt),We,m(Ye)]))}},U=R("requests",{state:()=>({requests:[],online:[],helpers:[],socket:void 0,connected:!1,error:!1}),getters:{getRequest:t=>o=>t.requests.find(n=>n.user_id===o),userOnline:t=>o=>t.online.find(n=>n==o)!==void 0,sortedRequests:t=>[...t.requests].sort(function(o,n){return o.status_id==n.status_id?o.id-n.id:n.status_id-o.status_id})},actions:{async connectQueue(t){this.socket&&this.socket.disconnect(),this.$reset();const o=M(),n="/";this.socket=ut(n,{auth:{token:o.token,queue_id:t}}),this.socket.on("connect",()=>{c.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",r=>{c.error("socket:connect_error - "+r),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{c.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("queue:update",async r=>{c.info("queue:update - "+JSON.stringify(r.id)),c.debug("|- updated: "+JSON.stringify(r));var i=this.requests.findIndex(d=>d.id===r.id);i<0?this.requests.push(r):this.requests[i]=r}),this.socket.on("queue:remove",async r=>{c.info("queue.remove - "+JSON.stringify(r));var i=this.requests.findIndex(d=>d.id===r);i>=0&&this.requests.splice(i,1)}),this.socket.on("user:online",async r=>{c.info("user:online - "+JSON.stringify(r)),this.online.push(String(r))}),this.socket.on("user:offline",async r=>{c.info("user:offline - "+JSON.stringify(r)),this.online.splice(this.online.indexOf(String(r)),1)}),this.socket.on("helper:online",async r=>{c.info("helper:online - "+JSON.stringify(r.id)),c.debug("|- helper: "+JSON.stringify(r)),this.helpers.push(r)}),this.socket.on("helper:offline",async r=>{c.info("helper:offline - "+JSON.stringify(r)),this.helpers.splice(this.helpers.findIndex(i=>i.id==r),1)}),this.socket.on("queue:opening",async()=>{c.info("queue:opening"),await S().hydrate()}),this.socket.on("connected",async(r,i)=>{c.info("socket:connected"),c.debug("|-online: "+JSON.stringify(r)),c.debug("|-helpers: "+JSON.stringify(i)),this.online=r,this.helpers=i}),this.socket.on("queue:closing",async()=>{c.info("queue:closing"),this.requests=[],await S().hydrate()}),c.info("emit queue:connect"),await this.socket.emit("queue:connect",async(r,i)=>{r==200?(c.info("queue:connect OK"),c.debug("|- requests: "+JSON.stringify(i)),this.requests=i):c.error("queue:connect error - "+JSON.stringify(r))})},async disconnectQueue(){this.socket&&(c.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async joinQueue(){c.info("emit queue:join"),await this.socket.emit("queue:join",async t=>{t==200?c.info("queue:join OK"):c.error("queue:join error - "+JSON.stringify(t))})},async openQueue(){c.info("emit queue:open"),await this.socket.emit("queue:open",async t=>{t==200?(c.info("queue:open OK"),S().hydrate()):c.error("queue:open error - "+JSON.stringify(t))})},async closeQueue(){c.info("emit queue:close"),await this.socket.emit("queue:close",async t=>{t==200?(c.info("queue:close OK"),this.requests=[],S().hydrate()):c.error("queue:close error - "+JSON.stringify(t))})},async takeRequest(t){c.info("emit request:take - "+t),await this.socket.emit("request:take",t,async o=>{o==200?c.info("request:take OK"):c.error("request:take error - "+JSON.stringify(o))})},async deleteRequest(t){c.info("emit request:delete - "+t),await this.socket.emit("request:delete",t,async o=>{o==200?c.info("request:delete OK"):c.error("request:delete error - "+JSON.stringify(o))})},async finishRequest(t){c.info("emit request:finish - "+t),await this.socket.emit("request:finish",t,async o=>{o==200?c.info("request:finish OK"):c.error("request:finish error - "+JSON.stringify(o))})}}});const Ge={key:2,class:"badge bg-primary rounded-pill"},Xe={__name:"RequestItem",props:{request:{type:Object,default(){return{}}},helper:{type:Boolean,default(){return!1}},userId:{type:Number,default(){return-1}}},setup(t){const o=t,n=U(),r=async function(){await n.deleteRequest(o.request.id)},i=async function(){await n.takeRequest(o.request.id)},d=async function(){await n.finishRequest(o.request.id)};return(p,x)=>{const u=z("font-awesome-icon");return a(),s("li",{class:ft(["list-group-item",[t.request.status_id==2?"list-group-item-primary":"",t.request.user_id==t.userId?"current-user":"",l(n).userOnline(t.request.user_id)?"":"list-group-item-light"]])},[l(n).userOnline(t.request.user_id)?(a(),$(u,{key:0,icon:"link"})):(a(),$(u,{key:1,icon:"link-slash"})),v(" "+C(t.request.user.name)+" ",1),t.request.status_id==2?(a(),s("span",Ge,C(t.request.helper.name),1)):O("",!0),t.helper?(a(),s(y,{key:3},[e("button",{class:"float-end btn btn-danger btn-sm mx-1",onClick:r}," X "),t.request.status_id==1?(a(),s("button",{key:0,class:"float-end btn btn-primary btn-sm mx-1",onClick:i}," Take ")):(a(),s("button",{key:1,class:"float-end btn btn-success btn-sm mx-1",onClick:d}," Done "))],64)):O("",!0)],2)}}};var to=I(Xe,[["__scopeId","data-v-eaea46b6"]]);const eo=e("h3",{class:"text-center"},"Students Waiting",-1),oo=e("hr",null,null,-1),ro={class:"list-group list-group-numbered"},st={__name:"RequestList",props:{id:{type:Number,default:-1}},setup(t){const o=M(),n=U(),{sortedRequests:r}=Q(n);return(i,d)=>(a(),s(y,null,[eo,oo,e("ul",ro,[(a(!0),s(y,null,T(l(r),(p,x)=>(a(),$(to,ht({key:p.id,request:p,index:x},i.$attrs,{"user-id":l(o).id}),null,16,["request","index","user-id"]))),128))])],64))}},io=e("h3",{class:"text-center"},"Helpers Online",-1),no=e("hr",null,null,-1),ao={class:"list-group list-group-flush"},mt={__name:"HelperList",setup(t){const o=U(),{helpers:n}=Q(o);return(r,i)=>{const d=z("font-awesome-icon");return a(),s(y,null,[io,no,e("ul",ao,[(a(!0),s(y,null,T(l(n),(p,x)=>(a(),s("li",{key:x,class:"list-group-item"},[m(d,{icon:"link"}),v(" "+C(p.name),1)]))),128))])],64)}}};const B=t=>(J("data-v-38a96dbb"),t=t(),H(),t),lo={class:"queue-header mx-auto"},so={key:0,class:"btn btn-outline-success float-end disabled"},mo=B(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),co=B(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),po=B(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),go=B(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),bo=[po,go],uo=B(()=>e("h2",{class:"text-center"},"Moderate Queue",-1)),fo=B(()=>e("hr",null,null,-1)),ho={class:"row"},xo={class:"col-12 col-md-4 mb-4"},wo={class:"col-12 col-md-8 mb-4"},vo={__name:"HelperPane",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const r=t,i=S();[o,n]=E(()=>i.hydrate()),await o,n();const d=i.getQueue,p=U(),{connected:x,error:u}=Q(p);[o,n]=E(()=>p.connectQueue(r.id)),await o,n();const f=async function(){confirm("Are you sure? All pending requests will be lost!")&&await p.closeQueue()},w=async function(){await p.openQueue()},b=async function(){await p.connectQueue(r.id)};return ot(async()=>{await p.disconnectQueue()}),(g,h)=>{const k=z("font-awesome-icon");return a(),s(y,null,[e("div",lo,[l(x)?(a(),s("button",so,[m(k,{icon:"link"}),mo])):(a(),s(y,{key:1},[l(u)?(a(),s("button",{key:0,class:"btn btn-outline-danger float-end",onClick:b},[m(k,{icon:"link-slash"}),co])):(a(),s("button",{key:1,class:"btn btn-outline-warning float-end",onClick:b},bo))],64)),uo,l(d)(t.id).is_open==1?(a(),s("a",{key:2,class:"w-100 btn btn-success",onClick:f},"Queue is Open - Click to Close")):(a(),s("a",{key:3,class:"w-100 btn btn-danger",onClick:w},"Queue is Closed - Click to Open"))]),fo,e("div",ho,[e("div",xo,[m(mt)]),e("div",wo,[m(st,{id:t.id,helper:""},null,8,["id"])])])],64)}}};var ko=I(vo,[["__scopeId","data-v-38a96dbb"]]);const L=t=>(J("data-v-7eda1672"),t=t(),H(),t),yo={id:"studentModal",class:"modal fade",tabindex:"-1","aria-labelledby":"studentModalLabel","aria-hidden":"true"},_o={class:"modal-dialog"},zo={class:"modal-content"},Co=L(()=>e("div",{class:"modal-header"},[e("h5",{id:"studentModalLabel",class:"modal-title"},"Your Turn!"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),qo={class:"modal-body"},$o=v(" You will be helped by "),Mo=v(". Their contact info is below: "),jo=L(()=>e("hr",null,null,-1)),So=["innerHTML"],Qo=L(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," OK ")],-1)),Eo={class:"queue-header mx-auto"},Lo={key:0,class:"btn btn-outline-success float-end disabled"},No=L(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),Oo=L(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),Io=L(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),To=L(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),Ao=[Io,To],Ro=L(()=>e("h2",{class:"text-center"},"Waiting Queue",-1)),Bo={key:0,class:"w-100 btn btn-success disabled",disabled:""},Do={key:3,class:"w-100 btn btn-danger disabled",disabled:""},Uo=L(()=>e("hr",null,null,-1)),Po={key:0,class:"row"},Jo={class:"col-12 col-md-4 mb-4"},Ho={class:"col-12 col-md-8 mb-4"},Vo={__name:"StudentPane",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const r=t,i=M(),d=S();[o,n]=E(()=>d.hydrate()),await o,n();const p=d.getQueue,x=U(),u=x.getRequest,{connected:f,error:w}=Q(x);[o,n]=E(()=>x.connectQueue(r.id)),await o,n();var b,g=!1;x.$subscribe(()=>{const j=u(i.id);j&&j.status_id==2&&!g&&(g=!0,b=new K("#studentModal",{}),b.show())});const h=async function(){g=!1,await x.joinQueue()},k=async function(){await x.connectQueue(r.id)};return ot(async()=>{await x.disconnectQueue()}),(j,G)=>{const X=z("font-awesome-icon");return a(),s(y,null,[e("div",yo,[e("div",_o,[e("div",zo,[Co,e("div",qo,[l(u)(l(i).id)&&l(u)(l(i).id).helper?(a(),s(y,{key:0},[e("p",null,[$o,e("strong",null,C(l(u)(l(i).id).helper.name),1),Mo]),jo,e("div",{innerHTML:l(rt).sanitize(l(it).parse(l(u)(l(i).id).helper.contact_info))},null,8,So)],64)):O("",!0)]),Qo])])]),e("div",Eo,[l(f)?(a(),s("button",Lo,[m(X,{icon:"link"}),No])):(a(),s(y,{key:1},[l(w)?(a(),s("button",{key:0,class:"btn btn-outline-danger float-end",onClick:k},[m(X,{icon:"link-slash"}),Oo])):(a(),s("button",{key:1,class:"btn btn-outline-warning float-end",onClick:k},Ao))],64)),Ro,l(p)(t.id).is_open==1?(a(),s(y,{key:2},[l(u)(l(i).id)!=null?(a(),s("a",Bo,"Queue Joined")):(a(),s("a",{key:1,class:"w-100 btn btn-success",onClick:G[0]||(G[0]=fi=>h())},"Join Queue"))],64)):(a(),s("a",Do,"Queue is Closed"))]),Uo,l(p)(t.id).is_open==1?(a(),s("div",Po,[e("div",Jo,[m(mt)]),e("div",Ho,[m(st,{id:t.id},null,8,["id"])])])):O("",!0)],64)}}};var Fo=I(Vo,[["__scopeId","data-v-7eda1672"]]);const Ko=v(" Back"),Yo=v(" Edit"),Wo={class:"display-5 text-center"},Zo=e("hr",null,null,-1),Go=["innerHTML"],Xo=e("hr",null,null,-1),tr={__name:"QueueSingle",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const r=M(),i=S();[o,n]=E(()=>i.hydrate()),await o,n();const d=i.getQueue;return(p,x)=>{const u=z("font-awesome-icon");return a(),s("main",null,[m(l(N),{to:{name:"queues"},class:"btn btn-secondary float-start"},{default:q(()=>[m(u,{icon:"arrow-left"}),Ko]),_:1}),l(r).is_admin?(a(),$(l(N),{key:0,to:{name:"queue_edit",params:{id:t.id}},class:"btn btn-secondary float-end"},{default:q(()=>[m(u,{icon:"pen-to-square"}),Yo]),_:1},8,["to"])):O("",!0),e("h1",Wo,C(l(d)(t.id).name),1),Zo,e("div",{innerHTML:l(rt).sanitize(l(it).parse(l(d)(t.id).description))},null,8,Go),Xo,l(d)(t.id).helper==1?(a(),$(ko,{key:1,id:t.id},null,8,["id"])):(a(),$(Fo,{key:2,id:t.id},null,8,["id"]))])}}},er={__name:"QueueSingleView",setup(t){return(o,n)=>(a(),$(tr))}},Z=R("users",{state:()=>({users:[]}),getters:{getUser:t=>o=>t.users.find(n=>n.id===o)},actions:{async hydrate(){c.info("users:hydrate"),await _.get("/api/v1/users").then(t=>{this.users=t.data})},async update(t){await _.post("/api/v1/users/"+t.id,{user:t}).then(async()=>{await this.hydrate()})},async deleteUser(t){await _.delete("/api/v1/users/"+t).then(async()=>{await this.hydrate()})},async addUser(t){await _.put("/api/v1/users/",{eid:t}).then(async()=>{await this.hydrate()})}}});const or=e("h1",{class:"display-5 text-center"},"Edit Queue",-1),rr=e("hr",null,null,-1),ir={class:"mb-3"},nr=e("label",{for:"multiselect-users",class:"form-label"},"Helpers",-1),ar=e("div",{class:"form-text"}," Helpers who can manage the queue (usually TAs) - admins already have access ",-1),lr={class:"row row-cols-1 row-cols-md-2"},dr=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),sr={class:"col d-grid mb-2"},mr=v(" Cancel"),cr={__name:"EditQueue",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const r=t,i=V(),d=S();[o,n]=E(()=>d.hydrate()),await o,n();const p=d.getQueue(r.id),x=Z();x.hydrate();const{users:u}=Q(x);var f;Y(()=>{f=new W({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const w=async b=>{b=(({id:g,name:h,snippet:k})=>({id:g,name:h,snippet:k}))(b),b.description=f.value(),b.users=[];for(const g of p.users)b.users.push({id:g.id});try{await d.update(b),i.push("/queues/"+p.id)}catch(g){if(g.response&&g.response.status===422){let h={};if(g.response.data.data){for(const k in g.response.data.data){h[k]="";for(const j of g.response.data.data[k])h[k]=h[k]+j.message+" "}A("queueform",["The server rejected this submission. Please correct errors listed above"],h)}else A("queueform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(g)}};return(b,g)=>{const h=z("FormKit"),k=z("router-link");return a(),s("main",null,[or,rr,m(h,{id:"queueform",type:"form",value:l(p),actions:!1,onSubmit:w},{default:q(()=>[m(h,{type:"text",name:"name",label:"Queue Name",help:"Name of the queue (usually the course)",validation:"required"}),m(h,{type:"text",name:"snippet",label:"Short Description",help:"Short description shown on the initial card"}),m(h,{type:"textarea",name:"description",label:"Long Description",help:"Long description shown on the queue page",rows:"10"}),e("div",ir,[nr,m(l(nt),{id:"multiselect-users",modelValue:l(p).users,"onUpdate:modelValue":g[0]||(g[0]=j=>l(p).users=j),class:"form-control",options:l(u),multiple:!0,"tag-placeholder":"Add this as new user",placeholder:"Type to search or add user",label:"eid","track-by":"id"},null,8,["modelValue","options"]),ar]),e("div",lr,[dr,e("div",sr,[m(k,{to:{name:"queue_single",params:{id:l(p).id}},class:"btn btn-secondary"},{default:q(()=>[mr]),_:1},8,["to"])])])]),_:1},8,["value"])])}}},pr={__name:"QueueEditView",setup(t){return(o,n)=>(a(),$(cr))}},gr=R("profile",{state:()=>({user:{}}),actions:{async hydrate(){c.info("profile:hydrate"),await _.get("/api/v1/profile").then(t=>{this.user=t.data})},async update(t){await _.post("/api/v1/profile/",{user:t}).then(async()=>{await this.hydrate()})}}});const br=e("h1",{class:"display-5 text-center"},"Edit User",-1),ur=e("hr",null,null,-1),fr={class:"row row-cols-1 row-cols-md-2"},hr=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),xr={class:"col d-grid mb-2"},wr=v(" Cancel"),vr={__name:"EditProfile",async setup(t){let o,n;const r=V(),i=gr();[o,n]=E(()=>i.hydrate()),await o,n();const{user:d}=Q(i);var p;Y(()=>{p=new W({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const x=async u=>{const f={name:u.name,contact_info:p.value()};try{await i.update(f),r.push("/queues/")}catch(w){if(w.response&&w.response.status===422){let b={};if(w.response.data.data){for(const g in w.response.data.data){b[g]="";for(const h of w.response.data.data[g])b[g]=b[g]+h.message+" "}A("userform",["The server rejected this submission. Please correct errors listed above"],b)}else A("userform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(w)}};return(u,f)=>{const w=z("FormKit"),b=z("router-link");return a(),s("main",null,[br,ur,m(w,{id:"userform",type:"form",value:l(d),actions:!1,onSubmit:x},{default:q(()=>[m(w,{type:"text",name:"eid",label:"eID",disabled:!0,help:"Your K-State eID (cannot be changed)",validation:"required"}),m(w,{type:"text",name:"name",label:"Name",help:"Your full name as you'd like it displayed on the site",validation:"required"}),m(w,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact you",rows:"10"}),e("div",fr,[hr,e("div",xr,[m(b,{to:{name:"queues"},class:"btn btn-secondary"},{default:q(()=>[wr]),_:1})])])]),_:1},8,["value"])])}}};const kr={__name:"ProfileView",setup(t){return(o,n)=>(a(),$(vr))}},yr={id:"userModal",class:"modal fade",tabindex:"-1","aria-labelledby":"userModalLabel","aria-hidden":"true"},_r={class:"modal-dialog"},zr={class:"modal-content"},Cr=e("div",{class:"modal-header"},[e("h5",{id:"userModalLabel",class:"modal-title"},"Delete User"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),qr={class:"modal-body"},$r=e("h5",null,"Are you sure you want to delete this user?",-1),Mr=e("strong",null,"eID: ",-1),jr=e("br",null,null,-1),Sr=e("strong",null,"Name: ",-1),Qr={class:"modal-footer"},Er=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),Lr=v(" Delete User "),Nr=v(" User "),Or=e("h1",{class:"text-center"},"Users",-1),Ir={class:"table table-striped table-hover"},Tr=e("thead",null,[e("tr",null,[e("th",null,"eID"),e("th",null,"Name"),e("th",null,"Roles"),e("th",null,"Actions")])],-1),Ar=["onClick"],Rr={__name:"UserAdmin",setup(t){const o=Z();o.hydrate();const{users:n}=Q(o),r=M();var i=at({}),d;const p=function(f){i.id=f.id,i.eid=f.eid,i.name=f.name,d=new K("#userModal",{}),d.show()},x=async function(f){await o.deleteUser(f),d.hide()},u=async function(){var f=prompt("Enter an eID to create a user");if(f)try{await o.addUser(f)}catch(w){w.response&&w.response.status===422?alert(JSON.stringify(w.response.data)):alert(w)}};return(f,w)=>{const b=z("font-awesome-icon");return a(),s(y,null,[e("div",yr,[e("div",_r,[e("div",zr,[Cr,e("div",qr,[$r,e("p",null,[Mr,v(C(l(i).eid)+" ",1),jr,Sr,v(C(l(i).name),1)])]),e("div",Qr,[Er,e("button",{type:"button",class:"btn btn-danger",onClick:w[0]||(w[0]=g=>x(l(i).id))},[m(b,{icon:"trash"}),Lr])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:u},[m(b,{icon:"plus"}),Nr]),Or,e("table",Ir,[Tr,e("tbody",null,[(a(!0),s(y,null,T(l(n),g=>(a(),s("tr",{key:g.id},[e("td",null,C(g.eid),1),e("td",null,C(g.name),1),e("td",null,[(a(!0),s(y,null,T(g.roles,h=>(a(),s("span",{key:h.id,class:"badge rounded-pill bg-success"},C(h.name),1))),128))]),e("td",null,[m(l(N),{to:{name:"admin_useredit",params:{id:g.id}},class:"btn btn-secondary btn-sm mx-1"},{default:q(()=>[m(b,{icon:"pen-to-square"})]),_:2},1032,["to"]),g.id!=l(r).id?(a(),s("button",{key:0,type:"button",class:"btn btn-danger btn-sm mx-1",onClick:lt(h=>p(g),["prevent"])},[m(b,{icon:"trash"})],8,Ar)):O("",!0)])]))),128))])])],64)}}},Br={id:"queueModal",class:"modal fade",tabindex:"-1","aria-labelledby":"queueModalLabel","aria-hidden":"true"},Dr={class:"modal-dialog"},Ur={class:"modal-content"},Pr=e("div",{class:"modal-header"},[e("h5",{id:"queueModalLabel",class:"modal-title"},"Delete Queue"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Jr={class:"modal-body"},Hr=e("h5",null,"Are you sure you want to delete this queue?",-1),Vr=e("strong",null,"Name: ",-1),Fr={class:"modal-footer"},Kr=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),Yr=v(" Delete Queue "),Wr=v(" Queue "),Zr=e("h1",{class:"text-center"},"Queues",-1),Gr={class:"table table-striped table-hover"},Xr=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Actions")])],-1),ti=["onClick"],ei={__name:"QueueAdmin",setup(t){const o=S();o.hydrate();const{queues:n}=Q(o);var r=at({}),i;const d=function(u){r.id=u.id,r.name=u.name,i=new K("#queueModal",{}),i.show()},p=async function(u){await o.deleteQueue(u),i.hide()},x=async function(){var u=prompt("Enter a name for the new queue");if(u)try{await o.addQueue(u)}catch(f){f.response&&f.response.status===422?alert(JSON.stringify(f.response.data)):alert(f)}};return(u,f)=>{const w=z("font-awesome-icon");return a(),s(y,null,[e("div",Br,[e("div",Dr,[e("div",Ur,[Pr,e("div",Jr,[Hr,e("p",null,[Vr,v(C(l(r).name),1)])]),e("div",Fr,[Kr,e("button",{type:"button",class:"btn btn-danger",onClick:f[0]||(f[0]=b=>p(l(r).id))},[m(w,{icon:"trash"}),Yr])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:x},[m(w,{icon:"plus"}),Wr]),Zr,e("table",Gr,[Xr,e("tbody",null,[(a(!0),s(y,null,T(l(n),b=>(a(),s("tr",{key:b.id},[e("td",null,C(b.name),1),e("td",null,[e("button",{type:"button",class:"btn btn-danger btn-sm mx-1",onClick:lt(g=>d(b),["prevent"])},[m(w,{icon:"trash"})],8,ti)])]))),128))])])],64)}}},oi={__name:"AdminView",setup(t){return(o,n)=>(a(),s(y,null,[m(ei),m(Rr)],64))}},ri=R("roles",{state:()=>({roles:[]}),actions:{async hydrate(){c.info("roles:hydrate"),await _.get("/api/v1/roles").then(t=>{this.roles=t.data})}}});const ii=e("h1",{class:"display-5 text-center"},"Edit User",-1),ni=e("hr",null,null,-1),ai={class:"mb-3"},li=e("label",{for:"multiselect-roles",class:"form-label"},"Roles",-1),di=e("div",{class:"form-text"},"Roles assigned to this user",-1),si={class:"row row-cols-1 row-cols-md-2"},mi=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),ci={class:"col d-grid mb-2"},pi=v(" Cancel"),gi={__name:"UserEdit",props:{id:{type:Number,default:-1}},async setup(t){let o,n;const r=t,i=V(),d=Z();[o,n]=E(()=>d.hydrate()),await o,n();const p=d.users.find(b=>b.id===parseInt(r.id)),x=ri();x.hydrate();const{roles:u}=Q(x);var f;Y(()=>{f=new W({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const w=async b=>{b=(({id:g,name:h})=>({id:g,name:h}))(b),b.contact_info=f.value(),b.roles=[];for(const g of p.roles)b.roles.push({id:g.id});try{await d.update(b),i.push("/admin/")}catch(g){if(g.response&&g.response.status===422){let h={};if(g.response.data.data){for(const k in g.response.data.data){h[k]="";for(const j of g.response.data.data[k])h[k]=h[k]+j.message+" "}A("usersForm",["The server rejected this submission. Please correct errors listed above"],h)}else A("usersForm",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(g)}};return(b,g)=>{const h=z("FormKit"),k=z("router-link");return a(),s("main",null,[ii,ni,m(h,{id:"userform",type:"form",value:l(p),actions:!1,onSubmit:w},{default:q(()=>[m(h,{type:"text",name:"eid",label:"eID",disabled:!0,help:"The user's K-State eID (cannot be changed)",validation:"required"}),m(h,{type:"text",name:"name",label:"Name",help:"The user's full name as you'd like it displayed on the site",validation:"required"}),m(h,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact the user",rows:"10"}),e("div",ai,[li,m(l(nt),{id:"multiselect-roles",modelValue:l(p).roles,"onUpdate:modelValue":g[0]||(g[0]=j=>l(p).roles=j),class:"form-control",options:l(u),multiple:!0,"tag-placeholder":"Add this as new role",placeholder:"Type to search or add role",label:"name","track-by":"id"},null,8,["modelValue","options"]),di]),e("div",si,[mi,e("div",ci,[m(k,{to:{name:"admin"},class:"btn btn-secondary"},{default:q(()=>[pi]),_:1})])])]),_:1},8,["value"])])}}},bi={__name:"UserEditView",setup(t){return(o,n)=>(a(),$(gi))}},F=()=>M().is_admin,ct=xt({history:wt("/"),routes:[{path:"/",name:"home",component:Re,beforeEnter:async()=>{const t=M();if(await t.tryToken(),t.token)return"/queues"}},{path:"/about",name:"about",component:()=>qe(()=>import("./AboutView.33989865.js"),["assets/AboutView.33989865.js","assets/vendor.dc7b8f01.js"])},{path:"/queues",name:"queues",component:Ze},{path:"/queues/:id",name:"queue_single",component:er,props:t=>({id:Number(t.params.id)})},{path:"/queues/:id/edit",name:"queue_edit",component:pr,props:!0,beforeEnter:F},{path:"/profile",name:"profile",component:kr},{path:"/admin",name:"admin",component:oi,beforeEnter:F},{path:"/admin/user/:id/edit",name:"admin_useredit",component:bi,props:!0,beforeEnter:F}]});ct.beforeEach(async function(t){if(t.name!=="home"&&t.name!=="about"){const o=M();if(o.token||await o.tryToken(),!o.token)return"/"}});const ui=()=>{_.interceptors.request.use(t=>{if(t.url!=="/auth/token"){const o=M();o.token&&(t.headers.Authorization="Bearer "+o.token)}return t},t=>Promise.reject(t)),_.interceptors.response.use(t=>t,async t=>{const o=t.config;if(o.url!=="/auth/token"&&t.response&&t.response.status===401&&!o._retry){o._retry=!0;try{return await M().refreshToken(),_(o)}catch(n){return Promise.reject(n)}}return Promise.reject(t)})};c.useDefaults();c.setLevel(c.WARN);vt.add(kt,yt,_t,zt,Ct,qt,$t,Mt,jt,St,Qt,Et,Lt,Nt,Ot,It,Tt,At,Rt,Bt,Dt,Ut,Pt);Jt.watch();ui();const D=Ht(_e);D.use(Vt());D.use(ct);D.use(Ft,et);D.use(Kt,Yt({config:{classes:{input:"form-control",label:"form-label",help:"form-text",outer:"mb-3"}}}));D.component("FontAwesomeIcon",Wt);D.mount("#app");export{I as _};
