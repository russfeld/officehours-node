const __vite__fileDeps=["assets/AboutView-DM7FW7ym.js","assets/vendor-BadIPgUR.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{a as be,d as V,u as Se,j as ee,L as d,r as C,o as i,c as _,b as e,e as c,w as $,f as g,g as o,R as j,h as N,i as L,t as v,p as W,k as J,S as Ce,F as x,l as Qe,m as ye,s as R,n as ie,q as A,v as de,x as D,y as M,z as K,A as G,B as X,C as Ee,M as ue,D as ke,E as ve,G as _e,H as he,I as ge,J as z,K as we,N as te,O as se,_ as ne,P as oe,Q as ae,T as re,U as Le,V as Oe,W as Ie,X as Re,Y as Te,Z as Ae,$ as Pe,a0 as De,a1 as je,a2 as Ue,a3 as Ne,a4 as Be,a5 as Ke,a6 as Me,a7 as Ve,a8 as He,a9 as Fe,aa as ze,ab as We,ac as Je,ad as Ye,ae as Ge,af as Xe,ag as Ze,ah as et,ai as tt,aj as st,ak as nt,al as ot,am as at,an as rt,ao as it,ap as ct,aq as lt,ar as dt,as as ut,at as _t,au as ht}from"./vendor-BadIPgUR.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function n(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerPolicy&&(u.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?u.credentials="include":r.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function a(r){if(r.ep)return;r.ep=!0;const u=n(r);fetch(r.href,u)}})();const E=be.create({baseURL:"/",headers:{Accept:"application/json","Content-Type":"application/json"}}),T=V("token",{state:()=>({token:Se("token",""),sound:!0}),getters:{refresh_token(){return this.token?ee(this.token).refresh_token:""},eid(){return this.token?ee(this.token).eid:""},id(){return this.token?ee(this.token).user_id:""},is_admin(){return this.token?ee(this.token).is_admin:!1}},actions:{async getToken(){d.info("token:get"),await E.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(this.token="",d.info("token:get login failed - redirecting to CAS"),window.location.href="/auth/login"):(d.error("token:get error"+t),this.token="")})},async tryToken(){d.info("token:try"),await E.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(async t=>{t.response&&t.response.status===401?(d.info("token:try login failed - trying refresh token"),await this.tryRefreshToken()):(d.error("token:try error"+t),this.token="")})},async refreshToken(){d.info("token:refresh"),await E.post("/auth/token",{refresh_token:this.refresh_token}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(this.token="",d.info("token:refresh login failed - redirecting to CAS"),window.location.href="/auth/login"):(d.error("token:refresh error"+t),this.token="")})},async tryRefreshToken(){d.info("token:tryrefresh"),await E.post("/auth/token",{refresh_token:this.refresh_token}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(this.token="",d.info("token:tryrefresh login failed")):(this.token="",d.error("token:tryrefresh error"+t))})},async logout(){this.token="",window.location.href="/auth/logout"},async toggleSound(){this.sound=!this.sound}}}),B=(t,s)=>{const n=t.__vccOpts||t;for(const[a,r]of s)n[a]=r;return n},ft=t=>(W("data-v-2892401b"),t=t(),J(),t),mt={class:"navbar navbar-expand-md navbar-dark fixed-top bg-purple"},pt={class:"container"},bt=ft(()=>e("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarCollapse","aria-controls":"navbarCollapse","aria-expanded":"false","aria-label":"Toggle navigation"},[e("span",{class:"navbar-toggler-icon"})],-1)),yt={id:"navbarCollapse",class:"collapse navbar-collapse"},kt={class:"navbar-nav me-auto mb-2 mb-md-0"},vt={class:"nav-item"},gt={class:"nav-item"},wt={key:0,class:"nav-item"},$t={key:1,class:"nav-item"},qt={class:""},xt={key:0},St={class:"navbar-nav me-auto mb-2 mb-md-0"},Ct={class:"nav-item"},Qt={class:"nav-item"},Et={class:"nav-item"},Lt={key:1},Ot={__name:"NavBar",setup(t){const s=T();return(n,a)=>{const r=C("font-awesome-icon");return i(),_("nav",mt,[e("div",pt,[c(o(j),{to:"/",class:"navbar-brand"},{default:$(()=>[g("Office Hours")]),_:1}),bt,e("div",yt,[e("ul",kt,[e("li",vt,[c(o(j),{to:"/queues","active-class":"active",class:"nav-link"},{default:$(()=>[g("Queues")]),_:1})]),e("li",gt,[c(o(j),{to:"/about","active-class":"active",class:"nav-link"},{default:$(()=>[g("About")]),_:1})]),o(s).is_admin?(i(),_("li",wt,[c(o(j),{to:"/admin","active-class":"active",class:"nav-link"},{default:$(()=>[g("Admin")]),_:1})])):N("",!0),o(s).is_admin?(i(),_("li",$t,[c(o(j),{to:"/data","active-class":"active",class:"nav-link"},{default:$(()=>[g("Data")]),_:1})])):N("",!0)]),e("div",qt,[o(s).token?(i(),_("div",xt,[e("ul",St,[e("li",Ct,[e("a",{class:"nav-link",onClick:a[0]||(a[0]=(...u)=>o(s).toggleSound&&o(s).toggleSound(...u))},[o(s).sound?(i(),L(r,{key:0,icon:"bell"})):(i(),L(r,{key:1,icon:"bell-slash"}))])]),e("li",Qt,[c(o(j),{to:"/profile","active-class":"active",class:"nav-link"},{default:$(()=>[c(r,{icon:"user"}),g(" "+v(o(s).eid),1)]),_:1})]),e("li",Et,[e("a",{class:"btn btn-success float-end",onClick:a[1]||(a[1]=u=>o(s).logout())},[c(r,{icon:"arrow-right-from-bracket"}),g(" Logout")])])])])):(i(),_("div",Lt,[e("a",{class:"btn btn-success",onClick:a[2]||(a[2]=u=>o(s).getToken())},[c(r,{icon:"arrow-right-to-bracket"}),g(" Login")])]))])])])])}}},It=B(Ot,[["__scopeId","data-v-2892401b"]]),Rt={id:"main",class:"container px-4 py-5"},Tt={__name:"App",setup(t){return T().tryToken(),(n,a)=>(i(),_(x,null,[e("header",null,[c(It)]),e("div",Rt,[(i(),L(Ce,null,{default:$(()=>[c(o(Qe))]),_:1}))])],64))}},At=B(Tt,[["__scopeId","data-v-afa63203"]]),Pt="modulepreload",Dt=function(t){return"/"+t},pe={},jt=function(s,n,a){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),m=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));r=Promise.all(n.map(y=>{if(y=Dt(y),y in pe)return;pe[y]=!0;const p=y.endsWith(".css"),b=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${b}`))return;const f=document.createElement("link");if(f.rel=p?"stylesheet":Pt,p||(f.as="script",f.crossOrigin=""),f.href=y,m&&f.setAttribute("nonce",m),document.head.appendChild(f),p)return new Promise((h,l)=>{f.addEventListener("load",h),f.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${y}`)))})}))}return r.then(()=>s()).catch(u=>{const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=u,window.dispatchEvent(m),!m.defaultPrevented)throw u})},Ut={},Nt=t=>(W("data-v-e8e73fd2"),t=t(),J(),t),Bt={class:"pb-2 border-bottom"},Kt=Nt(()=>e("div",{class:"row p-4 pb-0 pt-lg-4 pb-lg-4 align-items-center rounded-3 border shadow-lg"},[e("div",{class:"col-lg-10 mx-auto"},[e("p",{class:"lead-custom text-center"},[g(" Welcome! This site manages virtual queues for office hours."),e("br"),g("Let's get started! ")])])],-1));function Mt(t,s){const n=C("font-awesome-icon");return i(),_(x,null,[e("h2",Bt,[c(n,{icon:"chalkboard-teacher"}),g(" Office Hours Queue ")]),Kt],64)}const Vt=B(Ut,[["render",Mt],["__scopeId","data-v-e8e73fd2"]]),Ht=e("br",null,null,-1),Ft={key:0},zt={key:1},Wt={__name:"LoginMessage",setup(t){const s=T();return(n,a)=>{const r=C("RouterLink"),u=C("font-awesome-icon");return i(),_("main",null,[c(Vt),Ht,o(s).token?(i(),_("div",Ft,[c(r,{to:"/queues",class:"btn btn-success"},{default:$(()=>[g("Click Here to See Available Queues")]),_:1})])):(i(),_("div",zt,[e("a",{class:"btn btn-success",onClick:a[0]||(a[0]=m=>o(s).getToken())},[c(u,{icon:"arrow-right-to-bracket"}),g(" Login")])]))])}}},Jt={__name:"HomeView",setup(t){return(s,n)=>(i(),L(Wt))}},Yt={},Gt=t=>(W("data-v-6e27551f"),t=t(),J(),t),Xt={class:"pb-2 border-bottom"},Zt=Gt(()=>e("div",{class:"row p-4 pb-0 pt-lg-4 pb-lg-4 align-items-center rounded-3 border shadow-lg"},[e("div",{class:"col-lg-10 mx-auto"},[e("p",{class:"lead-custom text-center"}," Select a queue to join: ")])],-1));function es(t,s){const n=C("font-awesome-icon");return i(),_(x,null,[e("h2",Xt,[c(n,{icon:"chalkboard-teacher"}),g(" Office Hours Queue ")]),Zt],64)}const ts=B(Yt,[["render",es],["__scopeId","data-v-6e27551f"]]),P=V("queues",{state:()=>({queues:[],online:[],socket:void 0,connected:!1,error:!1}),getters:{getQueue:t=>s=>t.queues.find(n=>n.id==s),getOnline:t=>s=>t.online.find(n=>n.id==s)||{is_open:!1,helpers:0,requests:0},sortedQueues:t=>[...t.queues].sort((s,n)=>n.is_open-s.is_open)},actions:{async hydrate(){d.info("queues:hydrate"),await E.get("/api/v1/queues").then(t=>{this.queues=t.data})},async hydrateOnline(){d.info("queues:hydrateOnline"),this.socket&&(this.socket.disconnect(),this.online={});const t=T(),s="/status";this.socket=ye(s,{auth:{token:t.token}}),this.socket.on("connect",()=>{d.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",n=>{d.error("socket:connect_error - "+n),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{d.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("status:update",async n=>{d.info("status:update - "+n.id),d.debug("|- updated: "+n);var a=this.online.findIndex(r=>r.id===n.id);a<0?this.online.push(n):Object.assign(this.online[a],n)}),d.info("emit status:connect"),await this.socket.emit("status:connect",async(n,a)=>{n==200?(d.info("status:connect OK"),d.debug("|- online: "+a),this.online=a):d.error("status:connect error - "+n)})},async disconnectQueue(){this.socket&&(d.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async update(t){await E.post("/api/v1/queues/"+t.id,{queue:t}).then(async()=>{await this.hydrate()})},async deleteQueue(t){await E.delete("/api/v1/queues/"+t).then(async()=>{await this.hydrate()})},async addQueue(t){await E.put("/api/v1/queues/",{name:t}).then(async()=>{await this.hydrate()})}}}),ss={class:"col"},ns={class:"card-header"},os={key:0,class:"float-end badge rounded-pill bg-success"},as={key:1,class:"float-end badge rounded-pill bg-danger"},rs={class:"card-body"},is={class:"card-text"},cs={__name:"QueueCard",props:{queue:{type:Object,default(){return{}}}},setup(t){const s=t,n=P(),{getOnline:a}=R(n),r=ie();function u(m){r.push("/queues/"+m)}return(m,y)=>{const p=C("font-awesome-icon");return i(),_("div",ss,[e("div",{class:"card w-100 hvr-grow",onClick:y[0]||(y[0]=b=>u(s.queue.id))},[e("h5",ns,[g(v(s.queue.name)+" ",1),o(a)(s.queue.id).is_open===1?(i(),_("span",os,[g("Open | "+v(o(a)(s.queue.id).helpers||0)+" ",1),c(p,{icon:"user-graduate"}),g(" | "+v(o(a)(s.queue.id).requests||0)+" ",1),c(p,{icon:"circle-question"})])):(i(),_("span",as,"Closed"))]),e("div",rs,[e("p",is,v(s.queue.snippet),1)])])])}}},ls=B(cs,[["__scopeId","data-v-1d44794c"]]),ds={class:"row row-cols-1 row-cols-lg-3 g-4"},us={__name:"QueueList",async setup(t){let s,n;const a=P();a.hydrate(),[s,n]=A(()=>a.hydrateOnline()),await s,n();const{sortedQueues:r}=R(a);return de(async()=>{await a.disconnectQueue()}),(u,m)=>(i(),_("div",ds,[(i(!0),_(x,null,D(o(r),(y,p)=>(i(),L(ls,{key:y.id,queue:y,index:p},null,8,["queue","index"]))),128))]))}},_s=e("br",null,null,-1),hs={__name:"QueueListView",setup(t){return(s,n)=>(i(),_("main",null,[c(ts),_s,c(us)]))}},Z=V("requests",{state:()=>({requests:[],online:[],helpers:[],socket:void 0,connected:!1,error:!1}),getters:{getRequest:t=>s=>t.requests.find(n=>n.user_id===s),userOnline:t=>s=>t.online.find(n=>n==s)!==void 0,sortedRequests:t=>[...t.requests].sort(function(s,n){return s.status_id==n.status_id?s.id-n.id:n.status_id-s.status_id})},actions:{async connectQueue(t){this.socket&&this.socket.disconnect(),this.$reset();const s=T(),n="/";this.socket=ye(n,{auth:{token:s.token,queue_id:t}}),this.socket.on("connect",()=>{d.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",a=>{d.error("socket:connect_error - "+a),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{d.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("queue:update",async a=>{d.info("queue:update - "+a.id),d.debug("|- updated: "+a);var r=this.requests.findIndex(u=>u.id===a.id);r<0?(this.requests.push(a),s.sound&&new Audio("/ding-36029.mp3").play()):this.requests[r]=a}),this.socket.on("queue:remove",async a=>{d.info("queue.remove - "+a);var r=this.requests.findIndex(u=>u.id===a);r>=0&&this.requests.splice(r,1)}),this.socket.on("user:online",async a=>{d.info("user:online - "+a),this.online.push(String(a))}),this.socket.on("user:offline",async a=>{d.info("user:offline - "+a),this.online.splice(this.online.indexOf(String(a)),1)}),this.socket.on("helper:online",async a=>{d.info("helper:online - "+a.id),d.debug("|- helper: "+a),this.helpers.push(a)}),this.socket.on("helper:offline",async a=>{d.info("helper:offline - "+a),this.helpers.splice(this.helpers.findIndex(r=>r.id==a),1)}),this.socket.on("queue:opening",async()=>{d.info("queue:opening"),await P().hydrate()}),this.socket.on("connected",async(a,r)=>{d.info("socket:connected"),d.debug("|-online: "+a),d.debug("|-helpers: "+r),this.online=a,this.helpers=r}),this.socket.on("queue:closing",async()=>{d.info("queue:closing"),this.requests=[],await P().hydrate()}),d.info("emit queue:connect"),await this.socket.emit("queue:connect",async(a,r)=>{a==200?(d.info("queue:connect OK"),d.debug("|- requests: "+r),this.requests=r):d.error("queue:connect error - "+a)})},async disconnectQueue(){this.socket&&(d.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async joinQueue(){d.info("emit queue:join"),await this.socket.emit("queue:join",async t=>{t==200?d.info("queue:join OK"):d.error("queue:join error - "+t)})},async openQueue(){d.info("emit queue:open"),await this.socket.emit("queue:open",async t=>{t==200?(d.info("queue:open OK"),P().hydrate()):d.error("queue:open error - "+t)})},async closeQueue(){d.info("emit queue:close"),await this.socket.emit("queue:close",async t=>{t==200?(d.info("queue:close OK"),this.requests=[],P().hydrate()):d.error("queue:close error - "+t)})},async takeRequest(t){d.info("emit request:take - "+t),await this.socket.emit("request:take",t,async s=>{s==200?d.info("request:take OK"):d.error("request:take error - "+s)})},async deleteRequest(t){d.info("emit request:delete - "+t),await this.socket.emit("request:delete",t,async s=>{s==200?d.info("request:delete OK"):d.error("request:delete error - "+s)})},async finishRequest(t){d.info("emit request:finish - "+t),await this.socket.emit("request:finish",t,async s=>{s==200?d.info("request:finish OK"):d.error("request:finish error - "+s)})},async requeueRequest(t){d.info("emit request:requeue - "+t),await this.socket.emit("request:requeue",t,async s=>{s==200?d.info("request:requeue OK"):d.error("request:requeue error - "+s)})}}}),fs=t=>(W("data-v-11287421"),t=t(),J(),t),ms={key:2,class:"badge bg-primary rounded-pill"},ps=fs(()=>e("br",null,null,-1)),bs={id:"tooltip",class:"text-muted"},ys={__name:"RequestItem",props:{request:{type:Object,default(){return{}}},helper:{type:Boolean,default(){return!1}},userId:{type:Number,default(){return-1}}},setup(t){const s=t;var n=M({now:K.utc()});const a=Z(),r=async function(){await a.deleteRequest(s.request.id)},u=async function(){await a.takeRequest(s.request.id)},m=async function(){await a.finishRequest(s.request.id)},y=async function(){await a.requeueRequest(s.request.id)},p=G(()=>s.request.updated_at?n.now.to(s.request.updated_at):n.now.to(s.request.created_at));return(b,f)=>{const h=C("font-awesome-icon");return i(),_("li",{class:X(["list-group-item",[t.request.status_id==2?"list-group-item-primary":"",t.request.user_id==t.userId?"current-user":"",o(a).userOnline(t.request.user_id)?"":"list-group-item-light"]])},[o(a).userOnline(t.request.user_id)?(i(),L(h,{key:0,icon:"link"})):(i(),L(h,{key:1,icon:"link-slash"})),g(" "+v(t.request.user.name)+" ",1),t.helper?(i(),_(x,{key:2},[e("button",{class:"float-end btn btn-danger btn-sm mx-1",onClick:r},[c(h,{icon:"times",size:"xl"})]),e("button",{class:"float-end btn btn-secondary btn-sm mx-1",onClick:y},[c(h,{icon:"redo",size:"lg"})]),t.request.status_id==1?(i(),_("button",{key:0,class:"float-end btn btn-primary btn-sm mx-1",onClick:u}," Take ")):(i(),_("button",{key:1,class:"float-end btn btn-success btn-sm mx-1",onClick:m}," Done ")),t.request.status_id==2?(i(),_("span",ms,v(t.request.helper.name),1)):N("",!0),ps,e("small",bs,v(p.value),1)],64)):N("",!0)],2)}}},ks=B(ys,[["__scopeId","data-v-11287421"]]),vs=e("h3",{class:"text-center"},"Students Waiting",-1),gs=e("hr",null,null,-1),ws={class:"list-group list-group-numbered"},$e={__name:"RequestList",props:{id:{type:Number,default:-1},helper:{type:Boolean,default(){return!1}}},setup(t){const s=t,n=T(),a=Z(),{sortedRequests:r}=R(a);return(u,m)=>(i(),_(x,null,[vs,gs,e("ul",ws,[(i(!0),_(x,null,D(o(r),(y,p)=>(i(),L(ks,Ee({key:y.id,request:y,index:p,ref_for:!0},u.$attrs,{"user-id":o(n).id,helper:s.helper}),null,16,["request","index","user-id","helper"]))),128))])],64))}},$s=e("h3",{class:"text-center"},"Helpers Online",-1),qs=e("hr",null,null,-1),xs={class:"list-group list-group-flush"},qe={__name:"HelperList",setup(t){const s=Z(),{helpers:n}=R(s);return(a,r)=>{const u=C("font-awesome-icon");return i(),_(x,null,[$s,qs,e("ul",xs,[(i(!0),_(x,null,D(o(n),(m,y)=>(i(),_("li",{key:y,class:"list-group-item"},[c(u,{icon:"link"}),g(" "+v(m.name),1)]))),128))])],64)}}},Y=t=>(W("data-v-0509c2d5"),t=t(),J(),t),Ss={class:"queue-header mx-auto"},Cs={key:0,class:"btn btn-outline-success float-end disabled"},Qs=Y(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),Es=Y(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),Ls=Y(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),Os=Y(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),Is=[Ls,Os],Rs=Y(()=>e("h2",{class:"text-center"},"Moderate Queue",-1)),Ts=Y(()=>e("hr",null,null,-1)),As={class:"row"},Ps={class:"col-12 col-md-4 mb-4"},Ds={class:"col-12 col-md-8 mb-4"},js={__name:"HelperPane",props:{id:{type:Number,default:-1}},async setup(t){let s,n;const a=t,r=P();[s,n]=A(()=>r.hydrate()),await s,n();const u=r.getQueue,m=Z(),{connected:y,error:p}=R(m);[s,n]=A(()=>m.connectQueue(a.id)),await s,n();const b=async function(){confirm("Are you sure? All pending requests will be lost!")&&await m.closeQueue()},f=async function(){await m.openQueue()},h=async function(){await m.connectQueue(a.id)};return de(async()=>{await m.disconnectQueue()}),(l,k)=>{const q=C("font-awesome-icon");return i(),_(x,null,[e("div",Ss,[o(y)?(i(),_("button",Cs,[c(q,{icon:"link"}),Qs])):(i(),_(x,{key:1},[o(p)?(i(),_("button",{key:0,class:"btn btn-outline-danger float-end",onClick:h},[c(q,{icon:"link-slash"}),Es])):(i(),_("button",{key:1,class:"btn btn-outline-warning float-end",onClick:h},Is))],64)),Rs,o(u)(t.id).is_open==1?(i(),_("a",{key:2,class:"w-100 btn btn-success",onClick:b},"Queue is Open - Click to Close")):(i(),_("a",{key:3,class:"w-100 btn btn-danger",onClick:f},"Queue is Closed - Click to Open"))]),Ts,e("div",As,[e("div",Ps,[c(qe)]),e("div",Ds,[c($e,{id:t.id,helper:""},null,8,["id"])])])],64)}}},Us=B(js,[["__scopeId","data-v-0509c2d5"]]),U=t=>(W("data-v-fb79369c"),t=t(),J(),t),Ns={id:"studentModal",class:"modal fade",tabindex:"-1","aria-labelledby":"studentModalLabel","aria-hidden":"true"},Bs={class:"modal-dialog"},Ks={class:"modal-content"},Ms=U(()=>e("div",{class:"modal-header"},[e("h5",{id:"studentModalLabel",class:"modal-title"}," Your Turn! "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Vs={class:"modal-body"},Hs=U(()=>e("hr",null,null,-1)),Fs=["innerHTML"],zs=U(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," OK ")],-1)),Ws={class:"queue-header mx-auto"},Js={key:0,class:"btn btn-outline-success float-end disabled"},Ys=U(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),Gs=U(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),Xs=U(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),Zs=U(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),en=[Xs,Zs],tn=U(()=>e("h2",{class:"text-center"},"Waiting Queue",-1)),sn={key:0,class:"w-100 btn btn-success disabled",disabled:""},nn={key:3,class:"w-100 btn btn-danger disabled",disabled:""},on=U(()=>e("hr",null,null,-1)),an={key:0,class:"row"},rn={class:"col-12 col-md-4 mb-4"},cn={class:"col-12 col-md-8 mb-4"},ln={__name:"StudentPane",props:{id:{type:Number,default:-1}},async setup(t){let s,n;const a=t,r=T(),u=P();[s,n]=A(()=>u.hydrate()),await s,n();const m=u.getQueue,y=Z(),p=y.getRequest,{connected:b,error:f}=R(y);[s,n]=A(()=>y.connectQueue(a.id)),await s,n();var h,l=!1;y.$subscribe(()=>{const w=p(r.id);w&&w.status_id==2&&!l&&(l=!0,h=new ue("#studentModal",{}),h.show(),r.sound&&new Audio("/ding-36029.mp3").play()),w||(l=!1)});const k=async function(){l=!1,await y.joinQueue()},q=async function(){await y.connectQueue(a.id)};return de(async()=>{await y.disconnectQueue()}),(w,Q)=>{const I=C("font-awesome-icon");return i(),_(x,null,[e("div",Ns,[e("div",Bs,[e("div",Ks,[Ms,e("div",Vs,[o(p)(o(r).id)&&o(p)(o(r).id).helper?(i(),_(x,{key:0},[e("p",null,[g(" You will be helped by "),e("strong",null,v(o(p)(o(r).id).helper.name),1),g(". Their contact info is below: ")]),Hs,e("div",{innerHTML:o(ke).sanitize(o(ve).parse(o(p)(o(r).id).helper.contact_info||""))},null,8,Fs)],64)):N("",!0)]),zs])])]),e("div",Ws,[o(b)?(i(),_("button",Js,[c(I,{icon:"link"}),Ys])):(i(),_(x,{key:1},[o(f)?(i(),_("button",{key:0,class:"btn btn-outline-danger float-end",onClick:q},[c(I,{icon:"link-slash"}),Gs])):(i(),_("button",{key:1,class:"btn btn-outline-warning float-end",onClick:q},en))],64)),tn,o(m)(t.id).is_open==1?(i(),_(x,{key:2},[o(p)(o(r).id)!=null?(i(),_("a",sn,"Queue Joined")):(i(),_("a",{key:1,class:"w-100 btn btn-success",onClick:Q[0]||(Q[0]=O=>k())},"Join Queue"))],64)):(i(),_("a",nn,"Queue is Closed"))]),on,o(m)(t.id).is_open==1?(i(),_("div",an,[e("div",rn,[c(qe)]),e("div",cn,[c($e,{id:t.id},null,8,["id"])])])):N("",!0)],64)}}},dn=B(ln,[["__scopeId","data-v-fb79369c"]]),un={class:"display-5 text-center"},_n=e("hr",null,null,-1),hn=["innerHTML"],fn=e("hr",null,null,-1),mn={__name:"QueueSingle",props:{id:{type:Number,default:-1}},async setup(t){let s,n;const a=T(),r=P();[s,n]=A(()=>r.hydrate()),await s,n();const u=r.getQueue;return(m,y)=>{const p=C("font-awesome-icon");return i(),_("main",null,[c(o(j),{to:{name:"queues"},class:"btn btn-secondary float-start"},{default:$(()=>[c(p,{icon:"arrow-left"}),g(" Back")]),_:1}),o(a).is_admin?(i(),L(o(j),{key:0,to:{name:"queue_edit",params:{id:t.id}},class:"btn btn-secondary float-end"},{default:$(()=>[c(p,{icon:"pen-to-square"}),g(" Edit")]),_:1},8,["to"])):N("",!0),e("h1",un,v(o(u)(t.id).name),1),_n,e("div",{innerHTML:o(ke).sanitize(o(ve).parse(o(u)(t.id).description||""))},null,8,hn),fn,o(u)(t.id).helper==1?(i(),L(Us,{key:1,id:t.id},null,8,["id"])):(i(),L(dn,{key:2,id:t.id},null,8,["id"]))])}}},pn={__name:"QueueSingleView",setup(t){return(s,n)=>(i(),L(mn))}},fe=V("users",{state:()=>({users:[]}),getters:{getUser:t=>s=>t.users.find(n=>n.id===s)},actions:{async hydrate(){d.info("users:hydrate"),await E.get("/api/v1/users").then(t=>{this.users=t.data})},async update(t){await E.post("/api/v1/users/"+t.id,{user:t}).then(async()=>{await this.hydrate()})},async deleteUser(t){await E.delete("/api/v1/users/"+t).then(async()=>{await this.hydrate()})},async addUser(t){await E.put("/api/v1/users/",{eid:t}).then(async()=>{await this.hydrate()})}}}),bn=e("h1",{class:"display-5 text-center"},"Edit Queue",-1),yn=e("hr",null,null,-1),kn={class:"mb-3"},vn=e("label",{for:"multiselect-users",class:"form-label"},"Helpers",-1),gn=e("div",{class:"form-text"}," Helpers who can manage the queue (usually TAs) - admins already have access ",-1),wn={class:"row row-cols-1 row-cols-md-2"},$n=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),qn={class:"col d-grid mb-2"},xn={__name:"EditQueue",props:{id:{type:Number,default:-1},admin:{type:Boolean,default:!1}},async setup(t){let s,n;const a=ie(),r=t,u=P();[s,n]=A(()=>u.hydrate()),await s,n();const m=u.getQueue(r.id),y=fe();y.hydrate();const{users:p}=R(y);var b;_e(()=>{b=new he({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const f=async h=>{h=(({id:l,name:k,snippet:q})=>({id:l,name:k,snippet:q}))(h),h.description=b.value(),h.users=[];for(const l of m.users)h.users.push({id:l.id});try{await u.update(h),r.admin?a.push("/admin"):a.push("/queues/"+m.id)}catch(l){if(l.response&&l.response.status===422){let k={};if(l.response.data.data){for(const q in l.response.data.data){k[q]="";for(const w of l.response.data.data[q])k[q]=k[q]+w.message+" "}z("queueform",["The server rejected this submission. Please correct errors listed above"],k)}else z("queueform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(l)}};return(h,l)=>{const k=C("FormKit"),q=C("router-link");return i(),_("main",null,[bn,yn,c(k,{id:"queueform",type:"form",value:o(m),actions:!1,onSubmit:f},{default:$(()=>[c(k,{type:"text",name:"name",label:"Queue Name",help:"Name of the queue (usually the course)",validation:"required"}),c(k,{type:"text",name:"snippet",label:"Short Description",help:"Short description shown on the initial card"}),c(k,{type:"textarea",name:"description",label:"Long Description",help:"Long description shown on the queue page",rows:"10"}),e("div",kn,[vn,c(o(ge),{id:"multiselect-users",modelValue:o(m).users,"onUpdate:modelValue":l[0]||(l[0]=w=>o(m).users=w),class:"form-control",options:o(p),multiple:!0,"tag-placeholder":"Add this as new user",placeholder:"Type to search or add user",label:"eid","track-by":"id"},null,8,["modelValue","options"]),gn]),e("div",wn,[$n,e("div",qn,[t.admin?(i(),L(q,{key:0,to:{name:"admin"},class:"btn btn-secondary"},{default:$(()=>[g(" Cancel")]),_:1})):(i(),L(q,{key:1,to:{name:"queue_single",params:{id:o(m).id}},class:"btn btn-secondary"},{default:$(()=>[g(" Cancel")]),_:1},8,["to"]))])])]),_:1},8,["value"])])}}},Sn={__name:"QueueEditView",setup(t){return(s,n)=>(i(),L(xn))}},Cn=V("profile",{state:()=>({user:{}}),actions:{async hydrate(){d.info("profile:hydrate"),await E.get("/api/v1/profile").then(t=>{this.user=t.data})},async update(t){await E.post("/api/v1/profile/",{user:t}).then(async()=>{await this.hydrate()})}}}),Qn=e("h1",{class:"display-5 text-center"},"Edit User",-1),En=e("hr",null,null,-1),Ln={class:"row row-cols-1 row-cols-md-2"},On=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),In={class:"col d-grid mb-2"},Rn={__name:"EditProfile",async setup(t){let s,n;const a=ie(),r=Cn();[s,n]=A(()=>r.hydrate()),await s,n();const{user:u}=R(r);var m;_e(()=>{m=new he({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const y=async p=>{const b={name:p.name,contact_info:m.value()};try{await r.update(b),a.push("/queues/")}catch(f){if(f.response&&f.response.status===422){let h={};if(f.response.data.data){for(const l in f.response.data.data){h[l]="";for(const k of f.response.data.data[l])h[l]=h[l]+k.message+" "}z("userform",["The server rejected this submission. Please correct errors listed above"],h)}else z("userform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(f)}};return(p,b)=>{const f=C("FormKit"),h=C("router-link");return i(),_("main",null,[Qn,En,c(f,{id:"userform",type:"form",value:o(u),actions:!1,onSubmit:y},{default:$(()=>[c(f,{type:"text",name:"eid",label:"eID",disabled:!0,help:"Your K-State eID (cannot be changed)",validation:"required"}),c(f,{type:"text",name:"name",label:"Name",help:"Your full name as you'd like it displayed on the site",validation:"required"}),c(f,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact you",rows:"10"}),e("div",Ln,[On,e("div",In,[c(h,{to:{name:"queues"},class:"btn btn-secondary"},{default:$(()=>[g(" Cancel")]),_:1})])])]),_:1},8,["value"])])}}},Tn={__name:"ProfileView",setup(t){return(s,n)=>(i(),L(Rn))}},An={id:"userModal",class:"modal fade",tabindex:"-1","aria-labelledby":"userModalLabel","aria-hidden":"true"},Pn={class:"modal-dialog"},Dn={class:"modal-content"},jn=e("div",{class:"modal-header"},[e("h5",{id:"userModalLabel",class:"modal-title"}," Delete User "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Un={class:"modal-body"},Nn=e("h5",null,"Are you sure you want to delete this user?",-1),Bn=e("strong",null,"eID: ",-1),Kn=e("br",null,null,-1),Mn=e("strong",null,"Name: ",-1),Vn={class:"modal-footer"},Hn=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),Fn=e("h1",{class:"text-center"},"Users",-1),zn={class:"table table-striped table-hover"},Wn=e("thead",null,[e("tr",null,[e("th",null,"eID"),e("th",null,"Name"),e("th",null,"Roles"),e("th",null,"Actions")])],-1),Jn=["onClick"],Yn={__name:"UserAdmin",setup(t){const s=fe();s.hydrate();const{users:n}=R(s),a=T();var r=M({}),u;const m=function(b){r.id=b.id,r.eid=b.eid,r.name=b.name,u=new ue("#userModal",{}),u.show()},y=async function(b){await s.deleteUser(b),u.hide()},p=async function(){var b=prompt("Enter an eID to create a user");if(b)try{await s.addUser(b)}catch(f){f.response&&f.response.status===422?alert(JSON.stringify(f.response.data)):alert(f)}};return(b,f)=>{const h=C("font-awesome-icon");return i(),_(x,null,[e("div",An,[e("div",Pn,[e("div",Dn,[jn,e("div",Un,[Nn,e("p",null,[Bn,g(v(o(r).eid)+" ",1),Kn,Mn,g(v(o(r).name),1)])]),e("div",Vn,[Hn,e("button",{type:"button",class:"btn btn-danger",onClick:f[0]||(f[0]=l=>y(o(r).id))},[c(h,{icon:"trash"}),g(" Delete User ")])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:p},[c(h,{icon:"plus"}),g(" User ")]),Fn,e("table",zn,[Wn,e("tbody",null,[(i(!0),_(x,null,D(o(n),l=>(i(),_("tr",{key:l.id},[e("td",null,v(l.eid),1),e("td",null,v(l.name),1),e("td",null,[(i(!0),_(x,null,D(l.roles,k=>(i(),_("span",{key:k.id,class:"badge rounded-pill bg-success"},v(k.name),1))),128))]),e("td",null,[c(o(j),{to:{name:"admin_useredit",params:{id:l.id}},class:"btn btn-secondary btn-sm mx-1"},{default:$(()=>[c(h,{icon:"pen-to-square"})]),_:2},1032,["to"]),l.id!=o(a).id?(i(),_("button",{key:0,type:"button",class:"btn btn-danger btn-sm mx-1",onClick:we(k=>m(l),["prevent"])},[c(h,{icon:"trash"})],8,Jn)):N("",!0)])]))),128))])])],64)}}},Gn={id:"queueModal",class:"modal fade",tabindex:"-1","aria-labelledby":"queueModalLabel","aria-hidden":"true"},Xn={class:"modal-dialog"},Zn={class:"modal-content"},eo=e("div",{class:"modal-header"},[e("h5",{id:"queueModalLabel",class:"modal-title"}," Delete Queue "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),to={class:"modal-body"},so=e("h5",null,"Are you sure you want to delete this queue?",-1),no=e("strong",null,"Name: ",-1),oo={class:"modal-footer"},ao=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),ro=e("h1",{class:"text-center"},"Queues",-1),io={class:"table table-striped table-hover"},co=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Actions")])],-1),lo=["onClick"],uo={__name:"QueueAdmin",setup(t){const s=P();s.hydrate();const{queues:n}=R(s);var a=M({}),r;const u=function(p){a.id=p.id,a.name=p.name,r=new ue("#queueModal",{}),r.show()},m=async function(p){await s.deleteQueue(p),r.hide()},y=async function(){var p=prompt("Enter a name for the new queue");if(p)try{await s.addQueue(p)}catch(b){b.response&&b.response.status===422?alert(JSON.stringify(b.response.data)):alert(b)}};return(p,b)=>{const f=C("font-awesome-icon"),h=C("router-link");return i(),_(x,null,[e("div",Gn,[e("div",Xn,[e("div",Zn,[eo,e("div",to,[so,e("p",null,[no,g(v(o(a).name),1)])]),e("div",oo,[ao,e("button",{type:"button",class:"btn btn-danger",onClick:b[0]||(b[0]=l=>m(o(a).id))},[c(f,{icon:"trash"}),g(" Delete Queue ")])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:y},[c(f,{icon:"plus"}),g(" Queue ")]),ro,e("table",io,[co,e("tbody",null,[(i(!0),_(x,null,D(o(n),l=>(i(),_("tr",{key:l.id},[e("td",null,v(l.name),1),e("td",null,[c(h,{to:{name:"queue_edit",params:{id:l.id,admin:!0}},class:"btn btn-secondary btn-sm mx-1"},{default:$(()=>[c(f,{icon:"pen-to-square"})]),_:2},1032,["to"]),e("button",{type:"button",class:"btn btn-danger btn-sm mx-1",onClick:we(k=>u(l),["prevent"])},[c(f,{icon:"trash"})],8,lo)])]))),128))])])],64)}}},_o={__name:"AdminView",setup(t){return(s,n)=>(i(),_(x,null,[c(uo),c(Yn)],64))}},ho=V("roles",{state:()=>({roles:[]}),actions:{async hydrate(){d.info("roles:hydrate"),await E.get("/api/v1/roles").then(t=>{this.roles=t.data})}}}),fo=e("h1",{class:"display-5 text-center"},"Edit User",-1),mo=e("hr",null,null,-1),po={class:"mb-3"},bo=e("label",{for:"multiselect-roles",class:"form-label"},"Roles",-1),yo=e("div",{class:"form-text"},"Roles assigned to this user",-1),ko={class:"row row-cols-1 row-cols-md-2"},vo=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),go={class:"col d-grid mb-2"},wo={__name:"UserEdit",props:{id:{type:Number,default:-1}},async setup(t){let s,n;const a=ie(),r=t,u=fe();[s,n]=A(()=>u.hydrate()),await s,n();const m=u.users.find(h=>h.id===parseInt(r.id)),y=ho();y.hydrate();const{roles:p}=R(y);var b;_e(()=>{b=new he({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const f=async h=>{h=(({id:l,name:k})=>({id:l,name:k}))(h),h.contact_info=b.value(),h.roles=[];for(const l of m.roles)h.roles.push({id:l.id});try{await u.update(h),a.push("/admin/")}catch(l){if(l.response&&l.response.status===422){let k={};if(l.response.data.data){for(const q in l.response.data.data){k[q]="";for(const w of l.response.data.data[q])k[q]=k[q]+w.message+" "}z("usersForm",["The server rejected this submission. Please correct errors listed above"],k)}else z("usersForm",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(l)}};return(h,l)=>{const k=C("FormKit"),q=C("router-link");return i(),_("main",null,[fo,mo,c(k,{id:"userform",type:"form",value:o(m),actions:!1,onSubmit:f},{default:$(()=>[c(k,{type:"text",name:"eid",label:"eID",disabled:!0,help:"The user's K-State eID (cannot be changed)",validation:"required"}),c(k,{type:"text",name:"name",label:"Name",help:"The user's full name as you'd like it displayed on the site",validation:"required"}),c(k,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact the user",rows:"10"}),e("div",po,[bo,c(o(ge),{id:"multiselect-roles",modelValue:o(m).roles,"onUpdate:modelValue":l[0]||(l[0]=w=>o(m).roles=w),class:"form-control",options:o(p),multiple:!0,"tag-placeholder":"Add this as new role",placeholder:"Type to search or add role",label:"name","track-by":"id"},null,8,["modelValue","options"]),yo]),e("div",ko,[vo,e("div",go,[c(q,{to:{name:"admin"},class:"btn btn-secondary"},{default:$(()=>[g(" Cancel")]),_:1})])])]),_:1},8,["value"])])}}},$o={__name:"UserEditView",setup(t){return(s,n)=>(i(),L(wo))}},me=V("periods",{state:()=>({queues:[],periods:[],events:[],presences:[]}),getters:{getPeriod:t=>s=>t.periods.find(n=>n.id==s),getEventsTimline:t=>{var s=[{name:"Queued",data:[]},{name:"Taken",data:[]}];for(var n of t.events)n.status=="Queued"?s[0].data.push({x:n.eid,y:[K(n.created_at).valueOf(),n.updated_at===null?K().valueOf():K(n.updated_at).valueOf()]}):n.status=="Taken"&&s[1].data.push({x:n.eid,y:[K(n.created_at).valueOf(),n.updated_at===null?K().valueOf():K(n.updated_at).valueOf()],z:n.presence?n.presence.eid:""});return s}},actions:{async hydrate(){d.info("periods:hydrate"),await E.get("/api/v1/periods").then(t=>{this.queues=t.data})},async loadPeriods(t){d.info("periods:hydrate - "+t),await E.get("/api/v1/periods?name="+t).then(s=>{this.periods=s.data})},async loadEvents(t){d.info("periods:hydrate - "+t),await E.get("/api/v1/periods/"+t).then(s=>{this.events=s.data.events,this.presences=s.data.presences})}}}),qo=e("h1",{class:"display-5 text-center"},"Event Log: Queues",-1),xo=["data-page-count"],So={class:"col-md-6 mb-2 mb-md-0"},Co={class:"col-md-6"},Qo={class:"row"},Eo={class:"col-md-12"},Lo={class:"table-responsive"},Oo={class:"table table-striped d-md-table"},Io=["onClick"],Ro=e("i",{class:"gg-select float-right"},null,-1),To=e("th",null,"Actions",-1),Ao={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},Po={__name:"QueueList",async setup(t){let s,n;const a=me();[s,n]=A(()=>a.hydrate()),await s,n();const{queues:r}=R(a),u=M([{name:"Queue",field:"queue_name",sort:""},{name:"Periods",field:"periods",sort:""},{name:"Recent",field:"recent",sort:""}]),m=function(p,b){let f;const h=u[b];p.shiftKey||this.cols.forEach(l=>{l.field!==h.field&&(l.sort="")}),h.sort||(f="asc"),h.sort==="desc"&&(f=p.shiftKey?"":"asc"),h.sort==="asc"&&(f="desc"),h.sort=f},y=G(()=>u.reduce((p,b)=>(b.sort&&(b.sort==="asc"?p.push(b.field):p.push("-"+b.field)),p),[]));return(p,b)=>{const f=C("router-link");return i(),_(x,null,[qo,c(o(re),{"ds-data":o(r),"ds-sortby":y.value},{default:$(({ds:h})=>[e("div",{class:"row","data-page-count":h.dsPagecount},[e("div",So,[c(o(te),{"ds-show-entries":"25"})]),e("div",Co,[c(o(se),{"ds-search-placeholder":"Search..."})])],8,xo),e("div",Qo,[e("div",Eo,[e("div",Lo,[e("table",Oo,[e("thead",null,[e("tr",null,[(i(!0),_(x,null,D(u,(l,k)=>(i(),_("th",{key:l.field,class:X(["sort",l.sort]),onClick:q=>m(q,k)},[g(v(l.name)+" ",1),Ro],10,Io))),128)),To])]),c(o(ne),{tag:"tbody"},{default:$(({row:l})=>[e("tr",null,[e("td",null,v(l.queue_name),1),e("td",null,v(l.periods),1),e("td",null,v(l.recent),1),e("td",null,[c(f,{to:{name:"data_periods",params:{name:l.queue_name}},class:"btn btn-secondary btn-sm mx-1"},{default:$(()=>[g("View")]),_:2},1032,["to"])])])]),_:1})])])])]),e("div",Ao,[c(o(oe),{class:"mb-2 mb-md-0"}),c(o(ae))])]),_:1},8,["ds-data","ds-sortby"])],64)}}},Do={__name:"DashboardView",setup(t){return(s,n)=>(i(),L(Po))}},jo={class:"display-5 text-center"},Uo=["data-page-count"],No={class:"col-md-6 mb-2 mb-md-0"},Bo={class:"col-md-6"},Ko={class:"row"},Mo={class:"col-md-12"},Vo={class:"table-responsive"},Ho={class:"table table-striped d-md-table"},Fo=["onClick"],zo=e("i",{class:"gg-select float-right"},null,-1),Wo=e("th",null,"Actions",-1),Jo={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},Yo={__name:"PeriodList",props:{name:{type:String,default:""}},async setup(t){let s,n;const a=t,r=me();[s,n]=A(()=>r.loadPeriods(a.name)),await s,n();const{periods:u}=R(r),m=M([{name:"ID",field:"id",sort:""},{name:"Opened",field:"created_at",sort:""},{name:"Closed",field:"updated_at",sort:""},{name:"Events",field:"events",sort:""}]),y=function(b,f){let h;const l=m[f];b.shiftKey||this.cols.forEach(k=>{k.field!==l.field&&(k.sort="")}),l.sort||(h="asc"),l.sort==="desc"&&(h=b.shiftKey?"":"asc"),l.sort==="asc"&&(h="desc"),l.sort=h},p=G(()=>m.reduce((b,f)=>(f.sort&&(f.sort==="asc"?b.push(f.field):b.push("-"+f.field)),b),[]));return(b,f)=>{const h=C("router-link");return i(),_(x,null,[e("h1",jo,"Event Log: "+v(t.name),1),c(o(re),{"ds-data":o(u),"ds-sortby":p.value},{default:$(({ds:l})=>[e("div",{class:"row","data-page-count":l.dsPagecount},[e("div",No,[c(o(te),{"ds-show-entries":"25"})]),e("div",Bo,[c(o(se),{"ds-search-placeholder":"Search..."})])],8,Uo),e("div",Ko,[e("div",Mo,[e("div",Vo,[e("table",Ho,[e("thead",null,[e("tr",null,[(i(!0),_(x,null,D(m,(k,q)=>(i(),_("th",{key:k.field,class:X(["sort",k.sort]),onClick:w=>y(w,q)},[g(v(k.name)+" ",1),zo],10,Fo))),128)),Wo])]),c(o(ne),{tag:"tbody"},{default:$(({row:k})=>[e("tr",null,[e("td",null,v(k.id),1),e("td",null,v(k.created_at),1),e("td",null,v(k.updated_at),1),e("td",null,v(k.events),1),e("td",null,[c(h,{to:{name:"period",params:{id:k.id}},class:"btn btn-secondary btn-sm mx-1"},{default:$(()=>[g("View")]),_:2},1032,["to"])])])]),_:1})])])])]),e("div",Jo,[c(o(oe),{class:"mb-2 mb-md-0"}),c(o(ae))])]),_:1},8,["ds-data","ds-sortby"])],64)}}},Go={__name:"PeriodView",setup(t){return(s,n)=>(i(),L(Yo))}},Xo={class:"display-5 text-center"},Zo=e("h2",{class:"text-center"},"Events",-1),ea=["data-page-count"],ta={class:"col-md-6 mb-2 mb-md-0"},sa={class:"col-md-6"},na={class:"row"},oa={class:"col-md-12"},aa={class:"table-responsive"},ra={class:"table table-striped d-md-table"},ia=["onClick"],ca=e("i",{class:"gg-select float-right"},null,-1),la={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},da=e("h2",{class:"text-center"},"Presences",-1),ua=["data-page-count"],_a={class:"col-md-6 mb-2 mb-md-0"},ha={class:"col-md-6"},fa={class:"row"},ma={class:"col-md-12"},pa={class:"table-responsive"},ba={class:"table table-striped d-md-table"},ya=["onClick"],ka=e("i",{class:"gg-select float-right"},null,-1),va={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},ga={__name:"EventList",props:{id:{type:Number,default:-1}},async setup(t){let s,n;const a=t,r=me();[s,n]=A(()=>r.loadEvents(a.id)),await s,n();const{events:u,presences:m,getEventsTimline:y}=R(r),p=M([{name:"ID",field:"id",sort:""},{name:"eID",field:"eid",sort:""},{name:"Status",field:"status",sort:""},{name:"Start",field:"created_at",sort:""},{name:"End",field:"updated_at",sort:""},{name:"Helper",field:"presence.eid",sort:""}]),b=M([{name:"ID",field:"id",sort:""},{name:"eID",field:"eid",sort:""},{name:"Start",field:"created_at",sort:""},{name:"End",field:"updated_at",sort:""}]),f=function(w,Q){let I;const O=p[Q];w.shiftKey||this.eventCols.forEach(S=>{S.field!==O.field&&(S.sort="")}),O.sort||(I="asc"),O.sort==="desc"&&(I=w.shiftKey?"":"asc"),O.sort==="asc"&&(I="desc"),O.sort=I},h=function(w,Q){let I;const O=b[Q];w.shiftKey||this.presenceCols.forEach(S=>{S.field!==O.field&&(S.sort="")}),O.sort||(I="asc"),O.sort==="desc"&&(I=w.shiftKey?"":"asc"),O.sort==="asc"&&(I="desc"),O.sort=I},l=G(()=>p.reduce((w,Q)=>(Q.sort&&(Q.sort==="asc"?w.push(Q.field):w.push("-"+Q.field)),w),[])),k=G(()=>b.reduce((w,Q)=>(Q.sort&&(Q.sort==="asc"?w.push(Q.field):w.push("-"+Q.field)),w),[])),q={chart:{type:"rangeBar"},plotOptions:{bar:{horizontal:!0,barHeight:"50%",rangeBarGroupRows:!0}},xaxis:{type:"datetime",labels:{datetimeUTC:!1}},dataLabels:{enabled:!0,formatter:function(w,Q){return Q.w.config.series[Q.seriesIndex].data[Q.dataPointIndex].z}}};return(w,Q)=>{const I=C("apexchart");return i(),_(x,null,[e("h1",Xo,"Event Log: Period "+v(t.id),1),Zo,e("div",null,[c(I,{type:"rangeBar",options:q,series:o(y)},null,8,["series"])]),c(o(re),{"ds-data":o(u),"ds-sortby":l.value},{default:$(({ds:O})=>[e("div",{class:"row","data-page-count":O.dsPagecount},[e("div",ta,[c(o(te),{"ds-show-entries":"25"})]),e("div",sa,[c(o(se),{"ds-search-placeholder":"Search..."})])],8,ea),e("div",na,[e("div",oa,[e("div",aa,[e("table",ra,[e("thead",null,[e("tr",null,[(i(!0),_(x,null,D(p,(S,ce)=>(i(),_("th",{key:S.field,class:X(["sort",S.sort]),onClick:le=>f(le,ce)},[g(v(S.name)+" ",1),ca],10,ia))),128))])]),c(o(ne),{tag:"tbody"},{default:$(({row:S})=>[e("tr",null,[e("td",null,v(S.id),1),e("td",null,v(S.eid),1),e("td",null,v(S.status),1),e("td",null,v(S.created_at),1),e("td",null,v(S.updated_at),1),e("td",null,v(S.presence?S.presence.eid:""),1)])]),_:1})])])])]),e("div",la,[c(o(oe),{class:"mb-2 mb-md-0"}),c(o(ae))])]),_:1},8,["ds-data","ds-sortby"]),da,c(o(re),{"ds-data":o(m),"ds-sortby":k.value},{default:$(({ds:O})=>[e("div",{class:"row","data-page-count":O.dsPagecount},[e("div",_a,[c(o(te),{"ds-show-entries":"25"})]),e("div",ha,[c(o(se),{"ds-search-placeholder":"Search..."})])],8,ua),e("div",fa,[e("div",ma,[e("div",pa,[e("table",ba,[e("thead",null,[e("tr",null,[(i(!0),_(x,null,D(b,(S,ce)=>(i(),_("th",{key:S.field,class:X(["sort",S.sort]),onClick:le=>h(le,ce)},[g(v(S.name)+" ",1),ka],10,ya))),128))])]),c(o(ne),{tag:"tbody"},{default:$(({row:S})=>[e("tr",null,[e("td",null,v(S.id),1),e("td",null,v(S.eid),1),e("td",null,v(S.created_at),1),e("td",null,v(S.updated_at),1)])]),_:1})])])])]),e("div",va,[c(o(oe),{class:"mb-2 mb-md-0"}),c(o(ae))])]),_:1},8,["ds-data","ds-sortby"])],64)}}},wa={__name:"EventView",setup(t){return(s,n)=>(i(),L(ga))}},F=()=>T().is_admin,xe=Le({history:Oe("/"),routes:[{path:"/",name:"home",component:Jt},{path:"/about",name:"about",component:()=>jt(()=>import("./AboutView-DM7FW7ym.js"),__vite__mapDeps([0,1]))},{path:"/queues",name:"queues",component:hs},{path:"/queues/:id",name:"queue_single",component:pn,props:t=>({id:Number(t.params.id)})},{path:"/queues/:id/edit",name:"queue_edit",component:Sn,props:!0,beforeEnter:F},{path:"/profile",name:"profile",component:Tn},{path:"/admin",name:"admin",component:_o,beforeEnter:F},{path:"/admin/user/:id/edit",name:"admin_useredit",component:$o,props:!0,beforeEnter:F},{path:"/data",name:"data",component:Do,beforeEnter:F},{path:"/data/:name",name:"data_periods",component:Go,beforeEnter:F,props:t=>({name:t.params.name})},{path:"/period/:id",name:"period",component:wa,beforeEnter:F,props:t=>({id:t.params.id})}]});xe.beforeEach(async function(t){if(t.name!=="home"&&t.name!=="about"){const s=T();if(s.token||await s.getToken(),!s.token)return"/"}});const $a=()=>{E.interceptors.request.use(t=>{if(t.url!=="/auth/token"){const s=T();s.token&&(t.headers.Authorization="Bearer "+s.token)}return t},t=>Promise.reject(t)),E.interceptors.response.use(t=>t,async t=>{const s=t.config;if(s.url!=="/auth/token"&&t.response&&t.response.status===401&&!s._retry){s._retry=!0;try{return await T().refreshToken(),E(s)}catch(n){return Promise.reject(n)}}return Promise.reject(t)})};d.useDefaults();d.setLevel(d.WARN);Ie.add(Re,Te,Ae,Pe,De,je,Ue,Ne,Be,Ke,Me,Ve,He,Fe,ze,We,Je,Ye,Ge,Xe,Ze,et,tt,st,nt,ot,at);rt.watch();$a();const H=it(At);H.use(ct());H.use(xe);H.use(lt,be);H.use(dt,ut({config:{classes:{input:"form-control",label:"form-label",help:"form-text",outer:"mb-3"}}}));H.use(_t);H.component("FontAwesomeIcon",ht);H.mount("#app");export{B as _};
