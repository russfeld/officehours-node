import{a as ot,d as B,u as gt,o as P,L as m,r as z,b as n,c as d,e,f as s,w as q,g as a,R as O,h as T,i as v,t as C,p as V,j as H,k as $,S as bt,F as y,l as ut,m as K,n as L,s as E,q as R,v as ft,x as ht,y as xt,z as rt,M as Y,A as it,B as nt,C as W,D as Z,E as at,G as A,H as lt,I as dt,J as wt,K as vt,N as j,O as kt,P as yt,Q as _t,T as zt,U as Ct,V as qt,W as $t,X as Mt,Y as jt,Z as St,_ as Qt,$ as Et,a0 as Lt,a1 as Nt,a2 as Ot,a3 as Tt,a4 as It,a5 as Rt}from"./vendor.b318a427.js";const At=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&l(p)}).observe(document,{childList:!0,subtree:!0});function r(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerpolicy&&(c.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?c.credentials="include":i.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function l(i){if(i.ep)return;i.ep=!0;const c=r(i);fetch(i.href,c)}};At();const _=ot.create({baseURL:"/",headers:{Accept:"application/json","Content-Type":"application/json"}}),M=B("token",{state:()=>({token:gt("token","")}),getters:{refresh_token(){return this.token?P(this.token).refresh_token:""},eid(){return this.token?P(this.token).eid:""},id(){return this.token?P(this.token).user_id:""},is_admin(){return this.token?P(this.token).is_admin:!1}},actions:{async getToken(){m.info("token:get"),await _.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(m.info("token:get login failed - redirecting to CAS"),window.location.href="/auth/login"):(m.error("token:get error"+JSON.stringify(t)),this.token="")})},async tryToken(){m.info("token:try"),await _.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(async t=>{t.response&&t.response.status===401?(m.info("token:try login failed - trying refresh token"),await this.refreshToken()):(m.error("token:try error"+JSON.stringify(t)),this.token="")})},async refreshToken(){m.info("token:refresh"),await _.post("/auth/token",{refresh_token:this.refresh_token}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(m.info("token:refresh login failed - redirecting to CAS"),window.location.href="/auth/login"):(m.error("token:refresh error"+JSON.stringify(t)),this.token="")})},async logout(){this.token="",window.location.href="http://localhost:3000/auth/logout"}}});var I=(t,o)=>{const r=t.__vccOpts||t;for(const[l,i]of o)r[l]=i;return r};const Bt=t=>(V("data-v-41093076"),t=t(),H(),t),Dt={class:"navbar navbar-expand-md navbar-dark fixed-top bg-purple"},Ut={class:"container"},Jt=v("Office Hours"),Pt=Bt(()=>e("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarCollapse","aria-controls":"navbarCollapse","aria-expanded":"false","aria-label":"Toggle navigation"},[e("span",{class:"navbar-toggler-icon"})],-1)),Vt={id:"navbarCollapse",class:"collapse navbar-collapse"},Ht={class:"navbar-nav me-auto mb-2 mb-md-0"},Kt={class:"nav-item"},Ft=v("Queues"),Yt={class:"nav-item"},Wt=v("About"),Zt={key:0,class:"nav-item"},Gt=v("Admin"),Xt={class:""},te={key:0},ee={class:"navbar-nav me-auto mb-2 mb-md-0"},oe={class:"nav-item"},re={class:"nav-item"},ie=v(" Logout"),ne={key:1},ae=v(" Login"),le={__name:"Navbar",setup(t){const o=M();return(r,l)=>{const i=z("font-awesome-icon");return n(),d("nav",Dt,[e("div",Ut,[s(a(O),{to:"/",class:"navbar-brand"},{default:q(()=>[Jt]),_:1}),Pt,e("div",Vt,[e("ul",Ht,[e("li",Kt,[s(a(O),{to:"/queues","active-class":"active",class:"nav-link"},{default:q(()=>[Ft]),_:1})]),e("li",Yt,[s(a(O),{to:"/about","active-class":"active",class:"nav-link"},{default:q(()=>[Wt]),_:1})]),a(o).is_admin?(n(),d("li",Zt,[s(a(O),{to:"/admin","active-class":"active",class:"nav-link"},{default:q(()=>[Gt]),_:1})])):T("",!0)]),e("div",Xt,[a(o).token?(n(),d("div",te,[e("ul",ee,[e("li",oe,[s(a(O),{to:"/profile","active-class":"active",class:"nav-link"},{default:q(()=>[s(i,{icon:"user"}),v(" "+C(a(o).eid),1)]),_:1})]),e("li",re,[e("a",{class:"btn btn-success float-end",onClick:l[0]||(l[0]=c=>a(o).logout())},[s(i,{icon:"arrow-right-from-bracket"}),ie])])])])):(n(),d("div",ne,[e("a",{class:"btn btn-success",onClick:l[1]||(l[1]=c=>a(o).getToken())},[s(i,{icon:"arrow-right-to-bracket"}),ae])]))])])])])}}};var de=I(le,[["__scopeId","data-v-41093076"]]);const se={id:"main",class:"container px-4 py-5"},me={__name:"App",setup(t){return(o,r)=>(n(),d(y,null,[e("header",null,[s(de)]),e("div",se,[(n(),$(bt,null,{default:q(()=>[s(a(ut))]),_:1}))])],64))}};var ce=I(me,[["__scopeId","data-v-7a5a2909"]]);const pe="modulepreload",et={},ge="/",be=function(o,r){return!r||r.length===0?o():Promise.all(r.map(l=>{if(l=`${ge}${l}`,l in et)return;et[l]=!0;const i=l.endsWith(".css"),c=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${c}`))return;const p=document.createElement("link");if(p.rel=i?"stylesheet":pe,i||(p.as="script",p.crossOrigin=""),p.href=l,document.head.appendChild(p),i)return new Promise((x,u)=>{p.addEventListener("load",x),p.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>o())};const ue={},fe=t=>(V("data-v-8c844e72"),t=t(),H(),t),he={class:"pb-2 border-bottom"},xe=v(" Office Hours Queue "),we=fe(()=>e("div",{class:"row p-4 pb-0 pt-lg-4 pb-lg-4 align-items-center rounded-3 border shadow-lg"},[e("div",{class:"col-lg-10 mx-auto"},[e("p",{class:"lead-custom text-center"}," Welcome! Here you can join the queue for office hours. Let's get started! ")])],-1));function ve(t,o){const r=z("font-awesome-icon");return n(),d(y,null,[e("h2",he,[s(r,{icon:"chalkboard-teacher"}),xe]),we],64)}var st=I(ue,[["render",ve],["__scopeId","data-v-8c844e72"]]);const ke=e("br",null,null,-1),ye={key:0},_e=v("Queues List"),ze={key:1},Ce=v(" Login"),qe={__name:"LoginMessage",setup(t){const o=M();return(r,l)=>{const i=z("RouterLink"),c=z("font-awesome-icon");return n(),d("main",null,[s(st),ke,a(o).token?(n(),d("div",ye,[s(i,{to:"/queues",class:"btn btn-success"},{default:q(()=>[_e]),_:1})])):(n(),d("div",ze,[e("a",{class:"btn btn-success",onClick:l[0]||(l[0]=p=>a(o).getToken())},[s(c,{icon:"arrow-right-to-bracket"}),Ce])]))])}}},$e={__name:"HomeView",setup(t){return(o,r)=>(n(),$(qe))}};const Me={class:"col"},je={class:"card-header"},Se={key:0,class:"float-end badge rounded-pill bg-success"},Qe={key:1,class:"float-end badge rounded-pill bg-danger"},Ee={class:"card-body"},Le={class:"card-text"},Ne={__name:"QueueCard",props:{queue:{type:Object,default(){return{}}},helpers:{type:Number,default(){return 0}},requests:{type:Number,default(){return 0}}},setup(t){const o=t,r=K();function l(i){r.push("/queues/"+i)}return(i,c)=>{const p=z("font-awesome-icon");return n(),d("div",Me,[e("div",{class:"card w-100 hvr-grow",onClick:c[0]||(c[0]=x=>l(o.queue.id))},[e("h5",je,[v(C(o.queue.name)+" ",1),o.queue.is_open===1?(n(),d("span",Se,[v("Open | "+C(t.helpers)+" ",1),s(p,{icon:"user-graduate"}),v(" | "+C(t.requests)+" ",1),s(p,{icon:"circle-question"})])):(n(),d("span",Qe,"Closed"))]),e("div",Ee,[e("p",Le,C(o.queue.snippet),1)])])])}}};var Oe=I(Ne,[["__scopeId","data-v-3451fb3b"]]);const Q=B("queues",{state:()=>({queues:[],online:{}}),getters:{getQueue:t=>o=>t.queues.find(r=>r.id==o),sortedQueues:t=>[...t.queues].sort((o,r)=>r.is_open-o.is_open)},actions:{async hydrate(){m.info("queues:hydrate"),await _.get("/api/v1/queues").then(t=>{this.queues=t.data})},async hydrateOnline(){m.info("queues:hydrateOnline"),await _.get("/api/v1/queues/online").then(t=>{this.online=t.data})},async update(t){await _.post("/api/v1/queues/"+t.id,{queue:t}).then(async()=>{await this.hydrate()})},async deleteQueue(t){await _.delete("/api/v1/queues/"+t).then(async()=>{await this.hydrate()})},async addQueue(t){await _.put("/api/v1/queues/",{name:t}).then(async()=>{await this.hydrate()})}}}),Te={class:"row row-cols-1 row-cols-lg-3 g-4"},Ie={__name:"QueueList",async setup(t){let o,r;const l=Q();l.hydrate(),[o,r]=L(()=>l.hydrateOnline()),await o,r();const{sortedQueues:i,online:c}=E(l);return(p,x)=>(n(),d("div",Te,[(n(!0),d(y,null,R(a(i),(u,f)=>(n(),$(Oe,{key:u.id,queue:u,index:f,helpers:a(c).helpers[String(u.id)],requests:a(c).requests[String(u.id)]},null,8,["queue","index","helpers","requests"]))),128))]))}},Re=e("br",null,null,-1),Ae={__name:"QueueListView",setup(t){return(o,r)=>(n(),d("main",null,[s(st),Re,s(Ie)]))}},J=B("requests",{state:()=>({requests:[],online:[],helpers:[],socket:void 0,connected:!1,error:!1}),getters:{getRequest:t=>o=>t.requests.find(r=>r.user_id===o),userOnline:t=>o=>t.online.find(r=>r==o)!==void 0,sortedRequests:t=>[...t.requests].sort(function(o,r){return o.status_id==r.status_id?o.id-r.id:r.status_id-o.status_id})},actions:{async connectQueue(t){this.socket&&this.socket.disconnect(),this.$reset();const o=M();this.socket=ft("http://localhost:3000",{auth:{token:o.token,queue_id:t}}),this.socket.on("connect",()=>{m.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",r=>{m.error("socket:connect_error - "+r),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{m.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("queue:update",async r=>{m.info("queue:update - "+JSON.stringify(r.id)),m.debug("|- updated: "+JSON.stringify(r));var l=this.requests.findIndex(i=>i.id===r.id);l<0?this.requests.push(r):this.requests[l]=r}),this.socket.on("queue:remove",async r=>{m.info("queue.remove - "+JSON.stringify(r));var l=this.requests.findIndex(i=>i.id===r);l>=0&&this.requests.splice(l,1)}),this.socket.on("user:online",async r=>{m.info("user:online - "+JSON.stringify(r)),this.online.push(String(r))}),this.socket.on("user:offline",async r=>{m.info("user:offline - "+JSON.stringify(r)),this.online.splice(this.online.indexOf(String(r)),1)}),this.socket.on("helper:online",async r=>{m.info("helper:online - "+JSON.stringify(r.id)),m.debug("|- helper: "+JSON.stringify(r)),this.helpers.push(r)}),this.socket.on("helper:offline",async r=>{m.info("helper:offline - "+JSON.stringify(r)),this.helpers.splice(this.helpers.findIndex(l=>l.id==r),1)}),this.socket.on("queue:opening",async()=>{m.info("queue:opening"),await Q().hydrate()}),this.socket.on("connected",async(r,l)=>{m.info("socket:connected"),m.debug("|-online: "+JSON.stringify(r)),m.debug("|-helpers: "+JSON.stringify(l)),this.online=r,this.helpers=l}),this.socket.on("queue:closing",async()=>{m.info("queue:closing"),this.requests=[],await Q().hydrate()}),m.info("emit queue:connect"),await this.socket.emit("queue:connect",async(r,l)=>{r==200?(m.info("queue:connect OK"),m.debug("|- requests: "+JSON.stringify(l)),this.requests=l):m.error("queue:connect error - "+JSON.stringify(r))})},async disconnectQueue(){this.socket&&(m.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async joinQueue(){m.info("emit queue:join"),await this.socket.emit("queue:join",async t=>{t==200?m.info("queue:join OK"):m.error("queue:join error - "+JSON.stringify(t))})},async openQueue(){m.info("emit queue:open"),await this.socket.emit("queue:open",async t=>{t==200?(m.info("queue:open OK"),Q().hydrate()):m.error("queue:open error - "+JSON.stringify(t))})},async closeQueue(){m.info("emit queue:close"),await this.socket.emit("queue:close",async t=>{t==200?(m.info("queue:close OK"),this.requests=[],Q().hydrate()):m.error("queue:close error - "+JSON.stringify(t))})},async takeRequest(t){m.info("emit request:take - "+t),await this.socket.emit("request:take",t,async o=>{o==200?m.info("request:take OK"):m.error("request:take error - "+JSON.stringify(o))})},async deleteRequest(t){m.info("emit request:delete - "+t),await this.socket.emit("request:delete",t,async o=>{o==200?m.info("request:delete OK"):m.error("request:delete error - "+JSON.stringify(o))})},async finishRequest(t){m.info("emit request:finish - "+t),await this.socket.emit("request:finish",t,async o=>{o==200?m.info("request:finish OK"):m.error("request:finish error - "+JSON.stringify(o))})}}});const Be={key:2,class:"badge bg-primary rounded-pill"},De={__name:"RequestItem",props:{request:{type:Object,default(){return{}}},helper:{type:Boolean,default(){return!1}},userId:{type:Number,default(){return-1}}},setup(t){const o=t,r=J(),l=async function(){await r.deleteRequest(o.request.id)},i=async function(){await r.takeRequest(o.request.id)},c=async function(){await r.finishRequest(o.request.id)};return(p,x)=>{const u=z("font-awesome-icon");return n(),d("li",{class:ht(["list-group-item",[t.request.status_id==2?"list-group-item-primary":"",t.request.user_id==t.userId?"current-user":"",a(r).userOnline(t.request.user_id)?"":"list-group-item-light"]])},[a(r).userOnline(t.request.user_id)?(n(),$(u,{key:0,icon:"link"})):(n(),$(u,{key:1,icon:"link-slash"})),v(" "+C(t.request.user.name)+" ",1),t.request.status_id==2?(n(),d("span",Be,C(t.request.helper.name),1)):T("",!0),t.helper?(n(),d(y,{key:3},[e("button",{class:"float-end btn btn-danger btn-sm mx-1",onClick:l}," X "),t.request.status_id==1?(n(),d("button",{key:0,class:"float-end btn btn-primary btn-sm mx-1",onClick:i}," Take ")):(n(),d("button",{key:1,class:"float-end btn btn-success btn-sm mx-1",onClick:c}," Done "))],64)):T("",!0)],2)}}};var Ue=I(De,[["__scopeId","data-v-eaea46b6"]]);const Je=e("h3",{class:"text-center"},"Students Waiting",-1),Pe=e("hr",null,null,-1),Ve={class:"list-group list-group-numbered"},mt={__name:"RequestList",props:{id:{type:Number,default:-1}},setup(t){const o=M(),r=J(),{sortedRequests:l}=E(r);return(i,c)=>(n(),d(y,null,[Je,Pe,e("ul",Ve,[(n(!0),d(y,null,R(a(l),(p,x)=>(n(),$(Ue,xt({key:p.id,request:p,index:x},i.$attrs,{"user-id":a(o).id}),null,16,["request","index","user-id"]))),128))])],64))}},He=e("h3",{class:"text-center"},"Helpers Online",-1),Ke=e("hr",null,null,-1),Fe={class:"list-group list-group-flush"},ct={__name:"HelperList",setup(t){const o=J(),{helpers:r}=E(o);return(l,i)=>{const c=z("font-awesome-icon");return n(),d(y,null,[He,Ke,e("ul",Fe,[(n(!0),d(y,null,R(a(r),(p,x)=>(n(),d("li",{key:x,class:"list-group-item"},[s(c,{icon:"link"}),v(" "+C(p.name),1)]))),128))])],64)}}};const D=t=>(V("data-v-8ccb829a"),t=t(),H(),t),Ye={class:"queue-header mx-auto"},We={key:0,class:"btn btn-outline-success float-end disabled"},Ze=D(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),Ge=D(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),Xe=D(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),to=D(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),eo=[Xe,to],oo=D(()=>e("h2",{class:"text-center"},"Moderate Queue",-1)),ro=D(()=>e("hr",null,null,-1)),io={class:"row"},no={class:"col-12 col-md-4 mb-4"},ao={class:"col-12 col-md-8 mb-4"},lo={__name:"Helper",props:{id:{type:Number,default:-1}},async setup(t){let o,r;const l=t,i=Q();[o,r]=L(()=>i.hydrate()),await o,r();const c=i.getQueue,p=J(),{connected:x,error:u}=E(p);[o,r]=L(()=>p.connectQueue(l.id)),await o,r();const f=async function(){confirm("Are you sure? All pending requests will be lost!")&&await p.closeQueue()},w=async function(){await p.openQueue()},b=async function(){await p.connectQueue(l.id)};return rt(async()=>{await p.disconnectQueue()}),(g,h)=>{const k=z("font-awesome-icon");return n(),d(y,null,[e("div",Ye,[a(x)?(n(),d("button",We,[s(k,{icon:"link"}),Ze])):(n(),d(y,{key:1},[a(u)?(n(),d("button",{key:0,class:"btn btn-outline-danger float-end",onClick:b},[s(k,{icon:"link-slash"}),Ge])):(n(),d("button",{key:1,class:"btn btn-outline-warning float-end",onClick:b},eo))],64)),oo,a(c)(t.id).is_open==1?(n(),d("a",{key:2,class:"w-100 btn btn-success",onClick:f},"Queue is Open - Click to Close")):(n(),d("a",{key:3,class:"w-100 btn btn-danger",onClick:w},"Queue is Closed - Click to Open"))]),ro,e("div",io,[e("div",no,[s(ct)]),e("div",ao,[s(mt,{id:t.id,helper:""},null,8,["id"])])])],64)}}};var so=I(lo,[["__scopeId","data-v-8ccb829a"]]);const N=t=>(V("data-v-c2cf3a2c"),t=t(),H(),t),mo={id:"studentModal",class:"modal fade",tabindex:"-1","aria-labelledby":"studentModalLabel","aria-hidden":"true"},co={class:"modal-dialog"},po={class:"modal-content"},go=N(()=>e("div",{class:"modal-header"},[e("h5",{id:"studentModalLabel",class:"modal-title"},"Your Turn!"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),bo={class:"modal-body"},uo=v(" You will be helped by "),fo=v(". Their contact info is below: "),ho=N(()=>e("hr",null,null,-1)),xo=["innerHTML"],wo=N(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," OK ")],-1)),vo={class:"queue-header mx-auto"},ko={key:0,class:"btn btn-outline-success float-end disabled"},yo=N(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),_o=N(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),zo=N(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),Co=N(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),qo=[zo,Co],$o=N(()=>e("h2",{class:"text-center"},"Waiting Queue",-1)),Mo={key:0,class:"w-100 btn btn-success disabled",disabled:""},jo={key:3,class:"w-100 btn btn-danger disabled",disabled:""},So=N(()=>e("hr",null,null,-1)),Qo={key:0,class:"row"},Eo={class:"col-12 col-md-4 mb-4"},Lo={class:"col-12 col-md-8 mb-4"},No={__name:"Student",props:{id:{type:Number,default:-1}},async setup(t){let o,r;const l=t,i=M(),c=Q();[o,r]=L(()=>c.hydrate()),await o,r();const p=c.getQueue,x=J(),u=x.getRequest,{connected:f,error:w}=E(x);[o,r]=L(()=>x.connectQueue(l.id)),await o,r();var b,g=!1;x.$subscribe(()=>{const S=u(i.id);S&&S.status_id==2&&!g&&(g=!0,b=new Y("#studentModal",{}),b.show())});const h=async function(){g=!1,await x.joinQueue()},k=async function(){await x.connectQueue(l.id)};return rt(async()=>{await x.disconnectQueue()}),(S,X)=>{const tt=z("font-awesome-icon");return n(),d(y,null,[e("div",mo,[e("div",co,[e("div",po,[go,e("div",bo,[a(u)(a(i).id)&&a(u)(a(i).id).helper?(n(),d(y,{key:0},[e("p",null,[uo,e("strong",null,C(a(u)(a(i).id).helper.name),1),fo]),ho,e("div",{innerHTML:a(it).sanitize(a(nt).parse(a(u)(a(i).id).helper.contact_info))},null,8,xo)],64)):T("",!0)]),wo])])]),e("div",vo,[a(f)?(n(),d("button",ko,[s(tt,{icon:"link"}),yo])):(n(),d(y,{key:1},[a(w)?(n(),d("button",{key:0,class:"btn btn-outline-danger float-end",onClick:k},[s(tt,{icon:"link-slash"}),_o])):(n(),d("button",{key:1,class:"btn btn-outline-warning float-end",onClick:k},qo))],64)),$o,a(p)(t.id).is_open==1?(n(),d(y,{key:2},[a(u)(a(i).id)!=null?(n(),d("a",Mo,"Queue Joined")):(n(),d("a",{key:1,class:"w-100 btn btn-success",onClick:X[0]||(X[0]=ii=>h())},"Join Queue"))],64)):(n(),d("a",jo,"Queue is Closed"))]),So,a(p)(t.id).is_open==1?(n(),d("div",Qo,[e("div",Eo,[s(ct)]),e("div",Lo,[s(mt,{id:t.id},null,8,["id"])])])):T("",!0)],64)}}};var Oo=I(No,[["__scopeId","data-v-c2cf3a2c"]]);const To=v(" Back"),Io=v(" Edit"),Ro={class:"display-5 text-center"},Ao=e("hr",null,null,-1),Bo=["innerHTML"],Do=e("hr",null,null,-1),Uo={__name:"Queue",props:{id:{type:Number,default:-1}},async setup(t){let o,r;const l=M(),i=Q();[o,r]=L(()=>i.hydrate()),await o,r();const c=i.getQueue;return(p,x)=>{const u=z("font-awesome-icon");return n(),d("main",null,[s(a(O),{to:{name:"queues"},class:"btn btn-secondary float-start"},{default:q(()=>[s(u,{icon:"arrow-left"}),To]),_:1}),a(l).is_admin?(n(),$(a(O),{key:0,to:{name:"queue_edit",params:{id:t.id}},class:"btn btn-secondary float-end"},{default:q(()=>[s(u,{icon:"pen-to-square"}),Io]),_:1},8,["to"])):T("",!0),e("h1",Ro,C(a(c)(t.id).name),1),Ao,e("div",{innerHTML:a(it).sanitize(a(nt).parse(a(c)(t.id).description))},null,8,Bo),Do,a(c)(t.id).helper==1?(n(),$(so,{key:1,id:t.id},null,8,["id"])):(n(),$(Oo,{key:2,id:t.id},null,8,["id"]))])}}},Jo={__name:"QueueSingleView",setup(t){return(o,r)=>(n(),$(Uo))}},G=B("users",{state:()=>({users:[]}),getters:{getUser:t=>o=>t.users.find(r=>r.id===o)},actions:{async hydrate(){m.info("users:hydrate"),await _.get("/api/v1/users").then(t=>{this.users=t.data})},async update(t){await _.post("/api/v1/users/"+t.id,{user:t}).then(async()=>{await this.hydrate()})},async deleteUser(t){await _.delete("/api/v1/users/"+t).then(async()=>{await this.hydrate()})},async addUser(t){await _.put("/api/v1/users/",{eid:t}).then(async()=>{await this.hydrate()})}}});const Po=e("h1",{class:"display-5 text-center"},"Edit Queue",-1),Vo=e("hr",null,null,-1),Ho={class:"mb-3"},Ko=e("label",{for:"multiselect-users",class:"form-label"},"Helpers",-1),Fo=e("div",{class:"form-text"}," Helpers who can manage the queue (usually TAs) - admins already have access ",-1),Yo={class:"row row-cols-1 row-cols-md-2"},Wo=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),Zo={class:"col d-grid mb-2"},Go=v(" Cancel"),Xo={__name:"EditQueue",props:{id:{type:Number,default:-1}},async setup(t){let o,r;const l=t,i=K(),c=Q();[o,r]=L(()=>c.hydrate()),await o,r();const p=c.getQueue(l.id),x=G();x.hydrate();const{users:u}=E(x);var f;W(()=>{f=new Z({blockStyles:{italic:"_"},status:!1})});const w=async b=>{b=(({id:g,name:h,snippet:k})=>({id:g,name:h,snippet:k}))(b),b.description=f.value(),b.users=[];for(const g of p.users)b.users.push({id:g.id});try{await c.update(b),i.push("/queues/"+p.id)}catch(g){if(g.response&&g.response.status===422){let h={};if(g.response.data.data){for(const k in g.response.data.data){h[k]="";for(const S of g.response.data.data[k])h[k]=h[k]+S.message+" "}A("queueform",["The server rejected this submission. Please correct errors listed above"],h)}else A("queueform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(g)}};return(b,g)=>{const h=z("FormKit"),k=z("router-link");return n(),d("main",null,[Po,Vo,s(h,{id:"queueform",type:"form",value:a(p),actions:!1,onSubmit:w},{default:q(()=>[s(h,{type:"text",name:"name",label:"Queue Name",help:"Name of the queue (usually the course)",validation:"required"}),s(h,{type:"text",name:"snippet",label:"Short Description",help:"Short description shown on the initial card"}),s(h,{type:"textarea",name:"description",label:"Long Description",help:"Long description shown on the queue page",rows:"10"}),e("div",Ho,[Ko,s(a(at),{id:"multiselect-users",modelValue:a(p).users,"onUpdate:modelValue":g[0]||(g[0]=S=>a(p).users=S),class:"form-control",options:a(u),multiple:!0,"tag-placeholder":"Add this as new user",placeholder:"Type to search or add user",label:"eid","track-by":"id"},null,8,["modelValue","options"]),Fo]),e("div",Yo,[Wo,e("div",Zo,[s(k,{to:{name:"queue_single",params:{id:a(p).id}},class:"btn btn-secondary"},{default:q(()=>[Go]),_:1},8,["to"])])])]),_:1},8,["value"])])}}},tr={__name:"QueueEditView",setup(t){return(o,r)=>(n(),$(Xo))}},er=B("profile",{state:()=>({user:{}}),actions:{async hydrate(){m.info("profile:hydrate"),await _.get("/api/v1/profile").then(t=>{this.user=t.data})},async update(t){await _.post("/api/v1/profile/",{user:t}).then(async()=>{await this.hydrate()})}}});const or=e("h1",{class:"display-5 text-center"},"Edit User",-1),rr=e("hr",null,null,-1),ir={class:"row row-cols-1 row-cols-md-2"},nr=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),ar={class:"col d-grid mb-2"},lr=v(" Cancel"),dr={__name:"EditProfile",async setup(t){let o,r;const l=K(),i=er();[o,r]=L(()=>i.hydrate()),await o,r();const{user:c}=E(i);var p;W(()=>{p=new Z({blockStyles:{italic:"_"},status:!1})});const x=async u=>{const f={name:u.name,contact_info:p.value()};try{await i.update(f),l.push("/queues/")}catch(w){if(w.response&&w.response.status===422){let b={};if(w.response.data.data){for(const g in w.response.data.data){b[g]="";for(const h of w.response.data.data[g])b[g]=b[g]+h.message+" "}A("userform",["The server rejected this submission. Please correct errors listed above"],b)}else A("userform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(w)}};return(u,f)=>{const w=z("FormKit"),b=z("router-link");return n(),d("main",null,[or,rr,s(w,{id:"userform",type:"form",value:a(c),actions:!1,onSubmit:x},{default:q(()=>[s(w,{type:"text",name:"eid",label:"eID",disabled:!0,help:"Your K-State eID (cannot be changed)",validation:"required"}),s(w,{type:"text",name:"name",label:"Name",help:"Your full name as you'd like it displayed on the site",validation:"required"}),s(w,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact you",rows:"10"}),e("div",ir,[nr,e("div",ar,[s(b,{to:{name:"queues"},class:"btn btn-secondary"},{default:q(()=>[lr]),_:1})])])]),_:1},8,["value"])])}}};const sr={__name:"ProfileView",setup(t){return(o,r)=>(n(),$(dr))}},mr={id:"userModal",class:"modal fade",tabindex:"-1","aria-labelledby":"userModalLabel","aria-hidden":"true"},cr={class:"modal-dialog"},pr={class:"modal-content"},gr=e("div",{class:"modal-header"},[e("h5",{id:"userModalLabel",class:"modal-title"},"Delete User"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),br={class:"modal-body"},ur=e("h5",null,"Are you sure you want to delete this user?",-1),fr=e("strong",null,"eID: ",-1),hr=e("br",null,null,-1),xr=e("strong",null,"Name: ",-1),wr={class:"modal-footer"},vr=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),kr=v(" Delete User "),yr=v(" User "),_r=e("h1",{class:"text-center"},"Users",-1),zr={class:"table table-striped table-hover"},Cr=e("thead",null,[e("tr",null,[e("th",null,"eID"),e("th",null,"Name"),e("th",null,"Roles"),e("th",null,"Actions")])],-1),qr=["onClick"],$r={__name:"UserAdmin",setup(t){const o=G();o.hydrate();const{users:r}=E(o),l=M();var i=lt({}),c;const p=function(f){i.id=f.id,i.eid=f.eid,i.name=f.name,c=new Y("#userModal",{}),c.show()},x=async function(f){await o.deleteUser(f),c.hide()},u=async function(){var f=prompt("Enter an eID to create a user");if(f)try{await o.addUser(f)}catch(w){w.response&&w.response.status===422?alert(JSON.stringify(w.response.data)):alert(w)}};return(f,w)=>{const b=z("font-awesome-icon");return n(),d(y,null,[e("div",mr,[e("div",cr,[e("div",pr,[gr,e("div",br,[ur,e("p",null,[fr,v(C(a(i).eid)+" ",1),hr,xr,v(C(a(i).name),1)])]),e("div",wr,[vr,e("button",{type:"button",class:"btn btn-danger",onClick:w[0]||(w[0]=g=>x(a(i).id))},[s(b,{icon:"trash"}),kr])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:u},[s(b,{icon:"plus"}),yr]),_r,e("table",zr,[Cr,e("tbody",null,[(n(!0),d(y,null,R(a(r),g=>(n(),d("tr",{key:g.id},[e("td",null,C(g.eid),1),e("td",null,C(g.name),1),e("td",null,[(n(!0),d(y,null,R(g.roles,h=>(n(),d("span",{key:h.id,class:"badge rounded-pill bg-success"},C(h.name),1))),128))]),e("td",null,[s(a(O),{to:{name:"admin_useredit",params:{id:g.id}},class:"btn btn-secondary btn-sm mx-1"},{default:q(()=>[s(b,{icon:"pen-to-square"})]),_:2},1032,["to"]),g.id!=a(l).id?(n(),d("button",{key:0,type:"button",class:"btn btn-danger btn-sm mx-1",onClick:dt(h=>p(g),["prevent"])},[s(b,{icon:"trash"})],8,qr)):T("",!0)])]))),128))])])],64)}}},Mr={id:"queueModal",class:"modal fade",tabindex:"-1","aria-labelledby":"queueModalLabel","aria-hidden":"true"},jr={class:"modal-dialog"},Sr={class:"modal-content"},Qr=e("div",{class:"modal-header"},[e("h5",{id:"queueModalLabel",class:"modal-title"},"Delete Queue"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Er={class:"modal-body"},Lr=e("h5",null,"Are you sure you want to delete this queue?",-1),Nr=e("strong",null,"Name: ",-1),Or={class:"modal-footer"},Tr=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),Ir=v(" Delete Queue "),Rr=v(" Queue "),Ar=e("h1",{class:"text-center"},"Queues",-1),Br={class:"table table-striped table-hover"},Dr=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Actions")])],-1),Ur=["onClick"],Jr={__name:"QueueAdmin",setup(t){const o=Q();o.hydrate();const{queues:r}=E(o);var l=lt({}),i;const c=function(u){l.id=u.id,l.name=u.name,i=new Y("#queueModal",{}),i.show()},p=async function(u){await o.deleteQueue(u),i.hide()},x=async function(){var u=prompt("Enter a name for the new queue");if(u)try{await o.addQueue(u)}catch(f){f.response&&f.response.status===422?alert(JSON.stringify(f.response.data)):alert(f)}};return(u,f)=>{const w=z("font-awesome-icon");return n(),d(y,null,[e("div",Mr,[e("div",jr,[e("div",Sr,[Qr,e("div",Er,[Lr,e("p",null,[Nr,v(C(a(l).name),1)])]),e("div",Or,[Tr,e("button",{type:"button",class:"btn btn-danger",onClick:f[0]||(f[0]=b=>p(a(l).id))},[s(w,{icon:"trash"}),Ir])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:x},[s(w,{icon:"plus"}),Rr]),Ar,e("table",Br,[Dr,e("tbody",null,[(n(!0),d(y,null,R(a(r),b=>(n(),d("tr",{key:b.id},[e("td",null,C(b.name),1),e("td",null,[e("button",{type:"button",class:"btn btn-danger btn-sm mx-1",onClick:dt(g=>c(b),["prevent"])},[s(w,{icon:"trash"})],8,Ur)])]))),128))])])],64)}}},Pr={__name:"AdminView",setup(t){return(o,r)=>(n(),d(y,null,[s(Jr),s($r)],64))}},Vr=B("roles",{state:()=>({roles:[]}),actions:{async hydrate(){m.info("roles:hydrate"),await _.get("/api/v1/roles").then(t=>{this.roles=t.data})}}});const Hr=e("h1",{class:"display-5 text-center"},"Edit User",-1),Kr=e("hr",null,null,-1),Fr={class:"mb-3"},Yr=e("label",{for:"multiselect-roles",class:"form-label"},"Roles",-1),Wr=e("div",{class:"form-text"},"Roles assigned to this user",-1),Zr={class:"row row-cols-1 row-cols-md-2"},Gr=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),Xr={class:"col d-grid mb-2"},ti=v(" Cancel"),ei={__name:"UserEdit",props:{id:{type:Number,default:-1}},async setup(t){let o,r;const l=t,i=K(),c=G();[o,r]=L(()=>c.hydrate()),await o,r();const p=c.users.find(b=>b.id===parseInt(l.id)),x=Vr();x.hydrate();const{roles:u}=E(x);var f;W(()=>{f=new Z({blockStyles:{italic:"_"},status:!1})});const w=async b=>{b=(({id:g,name:h})=>({id:g,name:h}))(b),b.contact_info=f.value(),b.roles=[];for(const g of p.roles)b.roles.push({id:g.id});try{await c.update(b),i.push("/admin/")}catch(g){if(g.response&&g.response.status===422){let h={};if(g.response.data.data){for(const k in g.response.data.data){h[k]="";for(const S of g.response.data.data[k])h[k]=h[k]+S.message+" "}A("usersForm",["The server rejected this submission. Please correct errors listed above"],h)}else A("usersForm",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(g)}};return(b,g)=>{const h=z("FormKit"),k=z("router-link");return n(),d("main",null,[Hr,Kr,s(h,{id:"userform",type:"form",value:a(p),actions:!1,onSubmit:w},{default:q(()=>[s(h,{type:"text",name:"eid",label:"eID",disabled:!0,help:"The user's K-State eID (cannot be changed)",validation:"required"}),s(h,{type:"text",name:"name",label:"Name",help:"The user's full name as you'd like it displayed on the site",validation:"required"}),s(h,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact the user",rows:"10"}),e("div",Fr,[Yr,s(a(at),{id:"multiselect-roles",modelValue:a(p).roles,"onUpdate:modelValue":g[0]||(g[0]=S=>a(p).roles=S),class:"form-control",options:a(u),multiple:!0,"tag-placeholder":"Add this as new role",placeholder:"Type to search or add role",label:"name","track-by":"id"},null,8,["modelValue","options"]),Wr]),e("div",Zr,[Gr,e("div",Xr,[s(k,{to:{name:"admin"},class:"btn btn-secondary"},{default:q(()=>[ti]),_:1})])])]),_:1},8,["value"])])}}},oi={__name:"UserEditView",setup(t){return(o,r)=>(n(),$(ei))}},F=()=>M().is_admin,pt=wt({history:vt("/"),routes:[{path:"/",name:"home",component:$e,beforeEnter:async()=>{const t=M();if(await t.tryToken(),t.token)return"/queues"}},{path:"/about",name:"about",component:()=>be(()=>import("./AboutView.8b6d167a.js"),["assets/AboutView.8b6d167a.js","assets/vendor.b318a427.js"])},{path:"/queues",name:"queues",component:Ae},{path:"/queues/:id",name:"queue_single",component:Jo,props:t=>({id:Number(t.params.id)})},{path:"/queues/:id/edit",name:"queue_edit",component:tr,props:!0,beforeEnter:F},{path:"/profile",name:"profile",component:sr},{path:"/admin",name:"admin",component:Pr,beforeEnter:F},{path:"/admin/user/:id/edit",name:"admin_useredit",component:oi,props:!0,beforeEnter:F}]});pt.beforeEach(async function(t){if(t.name!=="home"&&t.name!=="about"){const o=M();if(o.token||await o.tryToken(),!o.token)return"/"}});const ri=()=>{_.interceptors.request.use(t=>{if(t.url!=="/auth/token"){const o=M();o.token&&(t.headers.Authorization="Bearer "+o.token)}return t},t=>Promise.reject(t)),_.interceptors.response.use(t=>t,async t=>{const o=t.config;if(o.url!=="/auth/token"&&t.response&&t.response.status===401&&!o._retry){o._retry=!0;try{return await M().refreshToken(),_(o)}catch(r){return Promise.reject(r)}}return Promise.reject(t)})};m.useDefaults();m.setLevel(m.WARN);j.add(kt);j.add(yt);j.add(_t);j.add(zt);j.add(Ct);j.add(qt);j.add($t);j.add(Mt);j.add(jt);j.add(St);j.add(Qt);j.add(Et);ri();const U=Lt(ce);U.use(Nt());U.use(pt);U.use(Ot,ot);U.use(Tt,It({config:{classes:{input:"form-control",label:"form-label",help:"form-text",outer:"mb-3"}}}));U.component("FontAwesomeIcon",Rt);U.mount("#app");export{I as _};
