import{a as be,d as V,u as Se,o as ee,L as u,r as C,b as i,c as d,e,f as c,w as $,g,h as a,R as N,i as M,j as L,t as k,p as W,k as J,l as Ce,S as Qe,F as x,m as ye,s as A,n as ie,q as R,v as ue,x as D,y as K,z as U,A as G,B as X,C as Ee,M as de,D as ve,E as ke,G as _e,H as he,I as ge,J as z,K as we,N as te,O as se,_ as ne,P as oe,Q as ae,T as re,U as Le,V as Ie,W as Oe,X as Ae,Y as Re,Z as Te,$ as Pe,a0 as De,a1 as Ne,a2 as je,a3 as Me,a4 as Be,a5 as Ue,a6 as Ke,a7 as Ve,a8 as He,a9 as Fe,aa as ze,ab as We,ac as Je,ad as Ye,ae as Ge,af as Xe,ag as Ze,ah as et,ai as tt,aj as st,ak as nt,al as ot,am as at,an as rt,ao as it,ap as ct,aq as lt,ar as ut,as as dt,at as _t,au as ht}from"./vendor.b327130c.js";const ft=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const _ of r)if(_.type==="childList")for(const h of _.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function n(r){const _={};return r.integrity&&(_.integrity=r.integrity),r.referrerpolicy&&(_.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?_.credentials="include":r.crossorigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function o(r){if(r.ep)return;r.ep=!0;const _=n(r);fetch(r.href,_)}};ft();const E=be.create({baseURL:"/",headers:{Accept:"application/json","Content-Type":"application/json"}}),T=V("token",{state:()=>({token:Se("token",""),sound:!0}),getters:{refresh_token(){return this.token?ee(this.token).refresh_token:""},eid(){return this.token?ee(this.token).eid:""},id(){return this.token?ee(this.token).user_id:""},is_admin(){return this.token?ee(this.token).is_admin:!1}},actions:{async getToken(){u.info("token:get"),await E.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(this.token="",u.info("token:get login failed - redirecting to CAS"),window.location.href="/auth/login"):(u.error("token:get error"+t),this.token="")})},async tryToken(){u.info("token:try"),await E.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(async t=>{t.response&&t.response.status===401?(u.info("token:try login failed - trying refresh token"),await this.refreshToken()):(u.error("token:try error"+t),this.token="")})},async refreshToken(){u.info("token:refresh"),await E.post("/auth/token",{refresh_token:this.refresh_token}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(this.token="",u.info("token:refresh login failed - redirecting to CAS"),window.location.href="/auth/login"):(u.error("token:refresh error"+t),this.token="")})},async logout(){this.token="",window.location.href="/auth/logout"},async toggleSound(){this.sound=!this.sound}}});var B=(t,s)=>{const n=t.__vccOpts||t;for(const[o,r]of s)n[o]=r;return n};const pt=t=>(W("data-v-5f1a5e7f"),t=t(),J(),t),mt={class:"navbar navbar-expand-md navbar-dark fixed-top bg-purple"},bt={class:"container"},yt=pt(()=>e("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarCollapse","aria-controls":"navbarCollapse","aria-expanded":"false","aria-label":"Toggle navigation"},[e("span",{class:"navbar-toggler-icon"})],-1)),vt={id:"navbarCollapse",class:"collapse navbar-collapse"},kt={class:"navbar-nav me-auto mb-2 mb-md-0"},gt={class:"nav-item"},wt={class:"nav-item"},$t={key:0,class:"nav-item"},qt={key:1,class:"nav-item"},xt={class:""},St={key:0},Ct={class:"navbar-nav me-auto mb-2 mb-md-0"},Qt={class:"nav-item"},Et={class:"nav-item"},Lt={class:"nav-item"},It={key:1},Ot={__name:"NavBar",setup(t){const s=T();return(n,o)=>{const r=C("font-awesome-icon");return i(),d("nav",mt,[e("div",bt,[c(a(N),{to:"/",class:"navbar-brand"},{default:$(()=>[g("Office Hours")]),_:1}),yt,e("div",vt,[e("ul",kt,[e("li",gt,[c(a(N),{to:"/queues","active-class":"active",class:"nav-link"},{default:$(()=>[g("Queues")]),_:1})]),e("li",wt,[c(a(N),{to:"/about","active-class":"active",class:"nav-link"},{default:$(()=>[g("About")]),_:1})]),a(s).is_admin?(i(),d("li",$t,[c(a(N),{to:"/admin","active-class":"active",class:"nav-link"},{default:$(()=>[g("Admin")]),_:1})])):M("",!0),a(s).is_admin?(i(),d("li",qt,[c(a(N),{to:"/data","active-class":"active",class:"nav-link"},{default:$(()=>[g("Data")]),_:1})])):M("",!0)]),e("div",xt,[a(s).token?(i(),d("div",St,[e("ul",Ct,[e("li",Qt,[e("a",{class:"nav-link",onClick:o[0]||(o[0]=(..._)=>a(s).toggleSound&&a(s).toggleSound(..._))},[a(s).sound?(i(),L(r,{key:0,icon:"bell"})):(i(),L(r,{key:1,icon:"bell-slash"}))])]),e("li",Et,[c(a(N),{to:"/profile","active-class":"active",class:"nav-link"},{default:$(()=>[c(r,{icon:"user"}),g(" "+k(a(s).eid),1)]),_:1})]),e("li",Lt,[e("a",{class:"btn btn-success float-end",onClick:o[1]||(o[1]=_=>a(s).logout())},[c(r,{icon:"arrow-right-from-bracket"}),g(" Logout")])])])])):(i(),d("div",It,[e("a",{class:"btn btn-success",onClick:o[2]||(o[2]=_=>a(s).getToken())},[c(r,{icon:"arrow-right-to-bracket"}),g(" Login")])]))])])])])}}};var At=B(Ot,[["__scopeId","data-v-5f1a5e7f"]]);const Rt={id:"main",class:"container px-4 py-5"},Tt={__name:"App",setup(t){return(s,n)=>(i(),d(x,null,[e("header",null,[c(At)]),e("div",Rt,[(i(),L(Qe,null,{default:$(()=>[c(a(Ce))]),_:1}))])],64))}};var Pt=B(Tt,[["__scopeId","data-v-68e3a569"]]);const Dt="modulepreload",me={},Nt="/",jt=function(s,n){return!n||n.length===0?s():Promise.all(n.map(o=>{if(o=`${Nt}${o}`,o in me)return;me[o]=!0;const r=o.endsWith(".css"),_=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${_}`))return;const h=document.createElement("link");if(h.rel=r?"stylesheet":Dt,r||(h.as="script",h.crossOrigin=""),h.href=o,document.head.appendChild(h),r)return new Promise((v,p)=>{h.addEventListener("load",v),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>s())};const Mt={},Bt=t=>(W("data-v-193ed13f"),t=t(),J(),t),Ut={class:"pb-2 border-bottom"},Kt=Bt(()=>e("div",{class:"row p-4 pb-0 pt-lg-4 pb-lg-4 align-items-center rounded-3 border shadow-lg"},[e("div",{class:"col-lg-10 mx-auto"},[e("p",{class:"lead-custom text-center"},[g(" Welcome! This site manages virtual queues for office hours."),e("br"),g("Let's get started! ")])])],-1));function Vt(t,s){const n=C("font-awesome-icon");return i(),d(x,null,[e("h2",Ut,[c(n,{icon:"chalkboard-teacher"}),g(" Office Hours Queue ")]),Kt],64)}var Ht=B(Mt,[["render",Vt],["__scopeId","data-v-193ed13f"]]);const Ft=e("br",null,null,-1),zt={key:0},Wt={key:1},Jt={__name:"LoginMessage",setup(t){const s=T();return(n,o)=>{const r=C("RouterLink"),_=C("font-awesome-icon");return i(),d("main",null,[c(Ht),Ft,a(s).token?(i(),d("div",zt,[c(r,{to:"/queues",class:"btn btn-success"},{default:$(()=>[g("Click Here to See Available Queues")]),_:1})])):(i(),d("div",Wt,[e("a",{class:"btn btn-success",onClick:o[0]||(o[0]=h=>a(s).getToken())},[c(_,{icon:"arrow-right-to-bracket"}),g(" Login")])]))])}}},Yt={__name:"HomeView",setup(t){return(s,n)=>(i(),L(Jt))}};const Gt={},Xt=t=>(W("data-v-5250f3b6"),t=t(),J(),t),Zt={class:"pb-2 border-bottom"},es=Xt(()=>e("div",{class:"row p-4 pb-0 pt-lg-4 pb-lg-4 align-items-center rounded-3 border shadow-lg"},[e("div",{class:"col-lg-10 mx-auto"},[e("p",{class:"lead-custom text-center"}," Select a queue to join: ")])],-1));function ts(t,s){const n=C("font-awesome-icon");return i(),d(x,null,[e("h2",Zt,[c(n,{icon:"chalkboard-teacher"}),g(" Office Hours Queue ")]),es],64)}var ss=B(Gt,[["render",ts],["__scopeId","data-v-5250f3b6"]]);const P=V("queues",{state:()=>({queues:[],online:[],socket:void 0,connected:!1,error:!1}),getters:{getQueue:t=>s=>t.queues.find(n=>n.id==s),getOnline:t=>s=>t.online.find(n=>n.id==s)||{is_open:!1,helpers:0,requests:0},sortedQueues:t=>[...t.queues].sort((s,n)=>n.is_open-s.is_open)},actions:{async hydrate(){u.info("queues:hydrate"),await E.get("/api/v1/queues").then(t=>{this.queues=t.data})},async hydrateOnline(){u.info("queues:hydrateOnline"),this.socket&&(this.socket.disconnect(),this.online={});const t=T(),s="/status";this.socket=ye(s,{auth:{token:t.token}}),this.socket.on("connect",()=>{u.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",n=>{u.error("socket:connect_error - "+n),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{u.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("status:update",async n=>{u.info("status:update - "+n.id),u.debug("|- updated: "+n);var o=this.online.findIndex(r=>r.id===n.id);o<0?this.online.push(n):Object.assign(this.online[o],n)}),u.info("emit status:connect"),await this.socket.emit("status:connect",async(n,o)=>{n==200?(u.info("status:connect OK"),u.debug("|- online: "+o),this.online=o):u.error("status:connect error - "+n)})},async disconnectQueue(){this.socket&&(u.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async update(t){await E.post("/api/v1/queues/"+t.id,{queue:t}).then(async()=>{await this.hydrate()})},async deleteQueue(t){await E.delete("/api/v1/queues/"+t).then(async()=>{await this.hydrate()})},async addQueue(t){await E.put("/api/v1/queues/",{name:t}).then(async()=>{await this.hydrate()})}}});const ns={class:"col"},os={class:"card-header"},as={key:0,class:"float-end badge rounded-pill bg-success"},rs={key:1,class:"float-end badge rounded-pill bg-danger"},is={class:"card-body"},cs={class:"card-text"},ls={__name:"QueueCard",props:{queue:{type:Object,default(){return{}}}},setup(t){const s=t,n=P(),{getOnline:o}=A(n),r=ie();function _(h){r.push("/queues/"+h)}return(h,v)=>{const p=C("font-awesome-icon");return i(),d("div",ns,[e("div",{class:"card w-100 hvr-grow",onClick:v[0]||(v[0]=m=>_(s.queue.id))},[e("h5",os,[g(k(s.queue.name)+" ",1),a(o)(s.queue.id).is_open===1?(i(),d("span",as,[g("Open | "+k(a(o)(s.queue.id).helpers||0)+" ",1),c(p,{icon:"user-graduate"}),g(" | "+k(a(o)(s.queue.id).requests||0)+" ",1),c(p,{icon:"circle-question"})])):(i(),d("span",rs,"Closed"))]),e("div",is,[e("p",cs,k(s.queue.snippet),1)])])])}}};var us=B(ls,[["__scopeId","data-v-3228e55c"]]);const ds={class:"row row-cols-1 row-cols-lg-3 g-4"},_s={__name:"QueueList",async setup(t){let s,n;const o=P();o.hydrate(),[s,n]=R(()=>o.hydrateOnline()),await s,n();const{sortedQueues:r}=A(o);return ue(async()=>{await o.disconnectQueue()}),(_,h)=>(i(),d("div",ds,[(i(!0),d(x,null,D(a(r),(v,p)=>(i(),L(us,{key:v.id,queue:v,index:p},null,8,["queue","index"]))),128))]))}},hs=e("br",null,null,-1),fs={__name:"QueueListView",setup(t){return(s,n)=>(i(),d("main",null,[c(ss),hs,c(_s)]))}},Z=V("requests",{state:()=>({requests:[],online:[],helpers:[],socket:void 0,connected:!1,error:!1}),getters:{getRequest:t=>s=>t.requests.find(n=>n.user_id===s),userOnline:t=>s=>t.online.find(n=>n==s)!==void 0,sortedRequests:t=>[...t.requests].sort(function(s,n){return s.status_id==n.status_id?s.id-n.id:n.status_id-s.status_id})},actions:{async connectQueue(t){this.socket&&this.socket.disconnect(),this.$reset();const s=T(),n="/";this.socket=ye(n,{auth:{token:s.token,queue_id:t}}),this.socket.on("connect",()=>{u.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",o=>{u.error("socket:connect_error - "+o),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{u.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("queue:update",async o=>{u.info("queue:update - "+o.id),u.debug("|- updated: "+o);var r=this.requests.findIndex(_=>_.id===o.id);r<0?(this.requests.push(o),s.sound&&new Audio("/ding-36029.mp3").play()):this.requests[r]=o}),this.socket.on("queue:remove",async o=>{u.info("queue.remove - "+o);var r=this.requests.findIndex(_=>_.id===o);r>=0&&this.requests.splice(r,1)}),this.socket.on("user:online",async o=>{u.info("user:online - "+o),this.online.push(String(o))}),this.socket.on("user:offline",async o=>{u.info("user:offline - "+o),this.online.splice(this.online.indexOf(String(o)),1)}),this.socket.on("helper:online",async o=>{u.info("helper:online - "+o.id),u.debug("|- helper: "+o),this.helpers.push(o)}),this.socket.on("helper:offline",async o=>{u.info("helper:offline - "+o),this.helpers.splice(this.helpers.findIndex(r=>r.id==o),1)}),this.socket.on("queue:opening",async()=>{u.info("queue:opening"),await P().hydrate()}),this.socket.on("connected",async(o,r)=>{u.info("socket:connected"),u.debug("|-online: "+o),u.debug("|-helpers: "+r),this.online=o,this.helpers=r}),this.socket.on("queue:closing",async()=>{u.info("queue:closing"),this.requests=[],await P().hydrate()}),u.info("emit queue:connect"),await this.socket.emit("queue:connect",async(o,r)=>{o==200?(u.info("queue:connect OK"),u.debug("|- requests: "+r),this.requests=r):u.error("queue:connect error - "+o)})},async disconnectQueue(){this.socket&&(u.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async joinQueue(){u.info("emit queue:join"),await this.socket.emit("queue:join",async t=>{t==200?u.info("queue:join OK"):u.error("queue:join error - "+t)})},async openQueue(){u.info("emit queue:open"),await this.socket.emit("queue:open",async t=>{t==200?(u.info("queue:open OK"),P().hydrate()):u.error("queue:open error - "+t)})},async closeQueue(){u.info("emit queue:close"),await this.socket.emit("queue:close",async t=>{t==200?(u.info("queue:close OK"),this.requests=[],P().hydrate()):u.error("queue:close error - "+t)})},async takeRequest(t){u.info("emit request:take - "+t),await this.socket.emit("request:take",t,async s=>{s==200?u.info("request:take OK"):u.error("request:take error - "+s)})},async deleteRequest(t){u.info("emit request:delete - "+t),await this.socket.emit("request:delete",t,async s=>{s==200?u.info("request:delete OK"):u.error("request:delete error - "+s)})},async finishRequest(t){u.info("emit request:finish - "+t),await this.socket.emit("request:finish",t,async s=>{s==200?u.info("request:finish OK"):u.error("request:finish error - "+s)})},async requeueRequest(t){u.info("emit request:requeue - "+t),await this.socket.emit("request:requeue",t,async s=>{s==200?u.info("request:requeue OK"):u.error("request:requeue error - "+s)})}}});const ps=t=>(W("data-v-4e001cb8"),t=t(),J(),t),ms={key:2,class:"badge bg-primary rounded-pill"},bs=ps(()=>e("br",null,null,-1)),ys={id:"tooltip",class:"text-muted"},vs={__name:"RequestItem",props:{request:{type:Object,default(){return{}}},helper:{type:Boolean,default(){return!1}},userId:{type:Number,default(){return-1}}},setup(t){const s=t;var n=K({now:U.utc()});const o=Z(),r=async function(){await o.deleteRequest(s.request.id)},_=async function(){await o.takeRequest(s.request.id)},h=async function(){await o.finishRequest(s.request.id)},v=async function(){await o.requeueRequest(s.request.id)},p=G(()=>s.request.updated_at?n.now.to(s.request.updated_at):n.now.to(s.request.created_at));return(m,b)=>{const f=C("font-awesome-icon");return i(),d("li",{class:X(["list-group-item",[t.request.status_id==2?"list-group-item-primary":"",t.request.user_id==t.userId?"current-user":"",a(o).userOnline(t.request.user_id)?"":"list-group-item-light"]])},[a(o).userOnline(t.request.user_id)?(i(),L(f,{key:0,icon:"link"})):(i(),L(f,{key:1,icon:"link-slash"})),g(" "+k(t.request.user.name)+" ",1),t.helper?(i(),d(x,{key:2},[e("button",{class:"float-end btn btn-danger btn-sm mx-1",onClick:r},[c(f,{icon:"times",size:"xl"})]),e("button",{class:"float-end btn btn-secondary btn-sm mx-1",onClick:v},[c(f,{icon:"redo",size:"lg"})]),t.request.status_id==1?(i(),d("button",{key:0,class:"float-end btn btn-primary btn-sm mx-1",onClick:_}," Take ")):(i(),d("button",{key:1,class:"float-end btn btn-success btn-sm mx-1",onClick:h}," Done ")),t.request.status_id==2?(i(),d("span",ms,k(t.request.helper.name),1)):M("",!0),bs,e("small",ys,k(a(p)),1)],64)):M("",!0)],2)}}};var ks=B(vs,[["__scopeId","data-v-4e001cb8"]]);const gs=e("h3",{class:"text-center"},"Students Waiting",-1),ws=e("hr",null,null,-1),$s={class:"list-group list-group-numbered"},$e={__name:"RequestList",props:{id:{type:Number,default:-1}},setup(t){const s=T(),n=Z(),{sortedRequests:o}=A(n);return(r,_)=>(i(),d(x,null,[gs,ws,e("ul",$s,[(i(!0),d(x,null,D(a(o),(h,v)=>(i(),L(ks,Ee({key:h.id,request:h,index:v},r.$attrs,{"user-id":a(s).id}),null,16,["request","index","user-id"]))),128))])],64))}},qs=e("h3",{class:"text-center"},"Helpers Online",-1),xs=e("hr",null,null,-1),Ss={class:"list-group list-group-flush"},qe={__name:"HelperList",setup(t){const s=Z(),{helpers:n}=A(s);return(o,r)=>{const _=C("font-awesome-icon");return i(),d(x,null,[qs,xs,e("ul",Ss,[(i(!0),d(x,null,D(a(n),(h,v)=>(i(),d("li",{key:v,class:"list-group-item"},[c(_,{icon:"link"}),g(" "+k(h.name),1)]))),128))])],64)}}};const Y=t=>(W("data-v-38a96dbb"),t=t(),J(),t),Cs={class:"queue-header mx-auto"},Qs={key:0,class:"btn btn-outline-success float-end disabled"},Es=Y(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),Ls=Y(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),Is=Y(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),Os=Y(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),As=[Is,Os],Rs=Y(()=>e("h2",{class:"text-center"},"Moderate Queue",-1)),Ts=Y(()=>e("hr",null,null,-1)),Ps={class:"row"},Ds={class:"col-12 col-md-4 mb-4"},Ns={class:"col-12 col-md-8 mb-4"},js={__name:"HelperPane",props:{id:{type:Number,default:-1}},async setup(t){let s,n;const o=t,r=P();[s,n]=R(()=>r.hydrate()),await s,n();const _=r.getQueue,h=Z(),{connected:v,error:p}=A(h);[s,n]=R(()=>h.connectQueue(o.id)),await s,n();const m=async function(){confirm("Are you sure? All pending requests will be lost!")&&await h.closeQueue()},b=async function(){await h.openQueue()},f=async function(){await h.connectQueue(o.id)};return ue(async()=>{await h.disconnectQueue()}),(l,y)=>{const q=C("font-awesome-icon");return i(),d(x,null,[e("div",Cs,[a(v)?(i(),d("button",Qs,[c(q,{icon:"link"}),Es])):(i(),d(x,{key:1},[a(p)?(i(),d("button",{key:0,class:"btn btn-outline-danger float-end",onClick:f},[c(q,{icon:"link-slash"}),Ls])):(i(),d("button",{key:1,class:"btn btn-outline-warning float-end",onClick:f},As))],64)),Rs,a(_)(t.id).is_open==1?(i(),d("a",{key:2,class:"w-100 btn btn-success",onClick:m},"Queue is Open - Click to Close")):(i(),d("a",{key:3,class:"w-100 btn btn-danger",onClick:b},"Queue is Closed - Click to Open"))]),Ts,e("div",Ps,[e("div",Ds,[c(qe)]),e("div",Ns,[c($e,{id:t.id,helper:""},null,8,["id"])])])],64)}}};var Ms=B(js,[["__scopeId","data-v-38a96dbb"]]);const j=t=>(W("data-v-3eaf00d9"),t=t(),J(),t),Bs={id:"studentModal",class:"modal fade",tabindex:"-1","aria-labelledby":"studentModalLabel","aria-hidden":"true"},Us={class:"modal-dialog"},Ks={class:"modal-content"},Vs=j(()=>e("div",{class:"modal-header"},[e("h5",{id:"studentModalLabel",class:"modal-title"},"Your Turn!"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Hs={class:"modal-body"},Fs=j(()=>e("hr",null,null,-1)),zs=["innerHTML"],Ws=j(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," OK ")],-1)),Js={class:"queue-header mx-auto"},Ys={key:0,class:"btn btn-outline-success float-end disabled"},Gs=j(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),Xs=j(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),Zs=j(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),en=j(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),tn=[Zs,en],sn=j(()=>e("h2",{class:"text-center"},"Waiting Queue",-1)),nn={key:0,class:"w-100 btn btn-success disabled",disabled:""},on={key:3,class:"w-100 btn btn-danger disabled",disabled:""},an=j(()=>e("hr",null,null,-1)),rn={key:0,class:"row"},cn={class:"col-12 col-md-4 mb-4"},ln={class:"col-12 col-md-8 mb-4"},un={__name:"StudentPane",props:{id:{type:Number,default:-1}},async setup(t){let s,n;const o=t,r=T(),_=P();[s,n]=R(()=>_.hydrate()),await s,n();const h=_.getQueue,v=Z(),p=v.getRequest,{connected:m,error:b}=A(v);[s,n]=R(()=>v.connectQueue(o.id)),await s,n();var f,l=!1;v.$subscribe(()=>{const w=p(r.id);w&&w.status_id==2&&!l&&(l=!0,f=new de("#studentModal",{}),f.show(),r.sound&&new Audio("/ding-36029.mp3").play()),w||(l=!1)});const y=async function(){l=!1,await v.joinQueue()},q=async function(){await v.connectQueue(o.id)};return ue(async()=>{await v.disconnectQueue()}),(w,Q)=>{const O=C("font-awesome-icon");return i(),d(x,null,[e("div",Bs,[e("div",Us,[e("div",Ks,[Vs,e("div",Hs,[a(p)(a(r).id)&&a(p)(a(r).id).helper?(i(),d(x,{key:0},[e("p",null,[g(" You will be helped by "),e("strong",null,k(a(p)(a(r).id).helper.name),1),g(". Their contact info is below: ")]),Fs,e("div",{innerHTML:a(ve).sanitize(a(ke).parse(a(p)(a(r).id).helper.contact_info||""))},null,8,zs)],64)):M("",!0)]),Ws])])]),e("div",Js,[a(m)?(i(),d("button",Ys,[c(O,{icon:"link"}),Gs])):(i(),d(x,{key:1},[a(b)?(i(),d("button",{key:0,class:"btn btn-outline-danger float-end",onClick:q},[c(O,{icon:"link-slash"}),Xs])):(i(),d("button",{key:1,class:"btn btn-outline-warning float-end",onClick:q},tn))],64)),sn,a(h)(t.id).is_open==1?(i(),d(x,{key:2},[a(p)(a(r).id)!=null?(i(),d("a",nn,"Queue Joined")):(i(),d("a",{key:1,class:"w-100 btn btn-success",onClick:Q[0]||(Q[0]=I=>y())},"Join Queue"))],64)):(i(),d("a",on,"Queue is Closed"))]),an,a(h)(t.id).is_open==1?(i(),d("div",rn,[e("div",cn,[c(qe)]),e("div",ln,[c($e,{id:t.id},null,8,["id"])])])):M("",!0)],64)}}};var dn=B(un,[["__scopeId","data-v-3eaf00d9"]]);const _n={class:"display-5 text-center"},hn=e("hr",null,null,-1),fn=["innerHTML"],pn=e("hr",null,null,-1),mn={__name:"QueueSingle",props:{id:{type:Number,default:-1}},async setup(t){let s,n;const o=T(),r=P();[s,n]=R(()=>r.hydrate()),await s,n();const _=r.getQueue;return(h,v)=>{const p=C("font-awesome-icon");return i(),d("main",null,[c(a(N),{to:{name:"queues"},class:"btn btn-secondary float-start"},{default:$(()=>[c(p,{icon:"arrow-left"}),g(" Back")]),_:1}),a(o).is_admin?(i(),L(a(N),{key:0,to:{name:"queue_edit",params:{id:t.id}},class:"btn btn-secondary float-end"},{default:$(()=>[c(p,{icon:"pen-to-square"}),g(" Edit")]),_:1},8,["to"])):M("",!0),e("h1",_n,k(a(_)(t.id).name),1),hn,e("div",{innerHTML:a(ve).sanitize(a(ke).parse(a(_)(t.id).description||""))},null,8,fn),pn,a(_)(t.id).helper==1?(i(),L(Ms,{key:1,id:t.id},null,8,["id"])):(i(),L(dn,{key:2,id:t.id},null,8,["id"]))])}}},bn={__name:"QueueSingleView",setup(t){return(s,n)=>(i(),L(mn))}},fe=V("users",{state:()=>({users:[]}),getters:{getUser:t=>s=>t.users.find(n=>n.id===s)},actions:{async hydrate(){u.info("users:hydrate"),await E.get("/api/v1/users").then(t=>{this.users=t.data})},async update(t){await E.post("/api/v1/users/"+t.id,{user:t}).then(async()=>{await this.hydrate()})},async deleteUser(t){await E.delete("/api/v1/users/"+t).then(async()=>{await this.hydrate()})},async addUser(t){await E.put("/api/v1/users/",{eid:t}).then(async()=>{await this.hydrate()})}}});const yn=e("h1",{class:"display-5 text-center"},"Edit Queue",-1),vn=e("hr",null,null,-1),kn={class:"mb-3"},gn=e("label",{for:"multiselect-users",class:"form-label"},"Helpers",-1),wn=e("div",{class:"form-text"}," Helpers who can manage the queue (usually TAs) - admins already have access ",-1),$n={class:"row row-cols-1 row-cols-md-2"},qn=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),xn={class:"col d-grid mb-2"},Sn={__name:"EditQueue",props:{id:{type:Number,default:-1},admin:{type:Boolean,default:!1}},async setup(t){let s,n;const o=t,r=ie(),_=P();[s,n]=R(()=>_.hydrate()),await s,n();const h=_.getQueue(o.id),v=fe();v.hydrate();const{users:p}=A(v);var m;_e(()=>{m=new he({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const b=async f=>{f=(({id:l,name:y,snippet:q})=>({id:l,name:y,snippet:q}))(f),f.description=m.value(),f.users=[];for(const l of h.users)f.users.push({id:l.id});try{await _.update(f),o.admin?r.push("/admin"):r.push("/queues/"+h.id)}catch(l){if(l.response&&l.response.status===422){let y={};if(l.response.data.data){for(const q in l.response.data.data){y[q]="";for(const w of l.response.data.data[q])y[q]=y[q]+w.message+" "}z("queueform",["The server rejected this submission. Please correct errors listed above"],y)}else z("queueform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(l)}};return(f,l)=>{const y=C("FormKit"),q=C("router-link");return i(),d("main",null,[yn,vn,c(y,{id:"queueform",type:"form",value:a(h),actions:!1,onSubmit:b},{default:$(()=>[c(y,{type:"text",name:"name",label:"Queue Name",help:"Name of the queue (usually the course)",validation:"required"}),c(y,{type:"text",name:"snippet",label:"Short Description",help:"Short description shown on the initial card"}),c(y,{type:"textarea",name:"description",label:"Long Description",help:"Long description shown on the queue page",rows:"10"}),e("div",kn,[gn,c(a(ge),{id:"multiselect-users",modelValue:a(h).users,"onUpdate:modelValue":l[0]||(l[0]=w=>a(h).users=w),class:"form-control",options:a(p),multiple:!0,"tag-placeholder":"Add this as new user",placeholder:"Type to search or add user",label:"eid","track-by":"id"},null,8,["modelValue","options"]),wn]),e("div",$n,[qn,e("div",xn,[t.admin?(i(),L(q,{key:0,to:{name:"admin"},class:"btn btn-secondary"},{default:$(()=>[g(" Cancel")]),_:1})):(i(),L(q,{key:1,to:{name:"queue_single",params:{id:a(h).id}},class:"btn btn-secondary"},{default:$(()=>[g(" Cancel")]),_:1},8,["to"]))])])]),_:1},8,["value"])])}}},Cn={__name:"QueueEditView",setup(t){return(s,n)=>(i(),L(Sn))}},Qn=V("profile",{state:()=>({user:{}}),actions:{async hydrate(){u.info("profile:hydrate"),await E.get("/api/v1/profile").then(t=>{this.user=t.data})},async update(t){await E.post("/api/v1/profile/",{user:t}).then(async()=>{await this.hydrate()})}}});const En=e("h1",{class:"display-5 text-center"},"Edit User",-1),Ln=e("hr",null,null,-1),In={class:"row row-cols-1 row-cols-md-2"},On=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),An={class:"col d-grid mb-2"},Rn={__name:"EditProfile",async setup(t){let s,n;const o=ie(),r=Qn();[s,n]=R(()=>r.hydrate()),await s,n();const{user:_}=A(r);var h;_e(()=>{h=new he({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const v=async p=>{const m={name:p.name,contact_info:h.value()};try{await r.update(m),o.push("/queues/")}catch(b){if(b.response&&b.response.status===422){let f={};if(b.response.data.data){for(const l in b.response.data.data){f[l]="";for(const y of b.response.data.data[l])f[l]=f[l]+y.message+" "}z("userform",["The server rejected this submission. Please correct errors listed above"],f)}else z("userform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(b)}};return(p,m)=>{const b=C("FormKit"),f=C("router-link");return i(),d("main",null,[En,Ln,c(b,{id:"userform",type:"form",value:a(_),actions:!1,onSubmit:v},{default:$(()=>[c(b,{type:"text",name:"eid",label:"eID",disabled:!0,help:"Your K-State eID (cannot be changed)",validation:"required"}),c(b,{type:"text",name:"name",label:"Name",help:"Your full name as you'd like it displayed on the site",validation:"required"}),c(b,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact you",rows:"10"}),e("div",In,[On,e("div",An,[c(f,{to:{name:"queues"},class:"btn btn-secondary"},{default:$(()=>[g(" Cancel")]),_:1})])])]),_:1},8,["value"])])}}};const Tn={__name:"ProfileView",setup(t){return(s,n)=>(i(),L(Rn))}},Pn={id:"userModal",class:"modal fade",tabindex:"-1","aria-labelledby":"userModalLabel","aria-hidden":"true"},Dn={class:"modal-dialog"},Nn={class:"modal-content"},jn=e("div",{class:"modal-header"},[e("h5",{id:"userModalLabel",class:"modal-title"},"Delete User"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Mn={class:"modal-body"},Bn=e("h5",null,"Are you sure you want to delete this user?",-1),Un=e("strong",null,"eID: ",-1),Kn=e("br",null,null,-1),Vn=e("strong",null,"Name: ",-1),Hn={class:"modal-footer"},Fn=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),zn=e("h1",{class:"text-center"},"Users",-1),Wn={class:"table table-striped table-hover"},Jn=e("thead",null,[e("tr",null,[e("th",null,"eID"),e("th",null,"Name"),e("th",null,"Roles"),e("th",null,"Actions")])],-1),Yn=["onClick"],Gn={__name:"UserAdmin",setup(t){const s=fe();s.hydrate();const{users:n}=A(s),o=T();var r=K({}),_;const h=function(m){r.id=m.id,r.eid=m.eid,r.name=m.name,_=new de("#userModal",{}),_.show()},v=async function(m){await s.deleteUser(m),_.hide()},p=async function(){var m=prompt("Enter an eID to create a user");if(m)try{await s.addUser(m)}catch(b){b.response&&b.response.status===422?alert(JSON.stringify(b.response.data)):alert(b)}};return(m,b)=>{const f=C("font-awesome-icon");return i(),d(x,null,[e("div",Pn,[e("div",Dn,[e("div",Nn,[jn,e("div",Mn,[Bn,e("p",null,[Un,g(k(a(r).eid)+" ",1),Kn,Vn,g(k(a(r).name),1)])]),e("div",Hn,[Fn,e("button",{type:"button",class:"btn btn-danger",onClick:b[0]||(b[0]=l=>v(a(r).id))},[c(f,{icon:"trash"}),g(" Delete User ")])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:p},[c(f,{icon:"plus"}),g(" User ")]),zn,e("table",Wn,[Jn,e("tbody",null,[(i(!0),d(x,null,D(a(n),l=>(i(),d("tr",{key:l.id},[e("td",null,k(l.eid),1),e("td",null,k(l.name),1),e("td",null,[(i(!0),d(x,null,D(l.roles,y=>(i(),d("span",{key:y.id,class:"badge rounded-pill bg-success"},k(y.name),1))),128))]),e("td",null,[c(a(N),{to:{name:"admin_useredit",params:{id:l.id}},class:"btn btn-secondary btn-sm mx-1"},{default:$(()=>[c(f,{icon:"pen-to-square"})]),_:2},1032,["to"]),l.id!=a(o).id?(i(),d("button",{key:0,type:"button",class:"btn btn-danger btn-sm mx-1",onClick:we(y=>h(l),["prevent"])},[c(f,{icon:"trash"})],8,Yn)):M("",!0)])]))),128))])])],64)}}},Xn={id:"queueModal",class:"modal fade",tabindex:"-1","aria-labelledby":"queueModalLabel","aria-hidden":"true"},Zn={class:"modal-dialog"},eo={class:"modal-content"},to=e("div",{class:"modal-header"},[e("h5",{id:"queueModalLabel",class:"modal-title"},"Delete Queue"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),so={class:"modal-body"},no=e("h5",null,"Are you sure you want to delete this queue?",-1),oo=e("strong",null,"Name: ",-1),ao={class:"modal-footer"},ro=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),io=e("h1",{class:"text-center"},"Queues",-1),co={class:"table table-striped table-hover"},lo=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Actions")])],-1),uo=["onClick"],_o={__name:"QueueAdmin",setup(t){const s=P();s.hydrate();const{queues:n}=A(s);var o=K({}),r;const _=function(p){o.id=p.id,o.name=p.name,r=new de("#queueModal",{}),r.show()},h=async function(p){await s.deleteQueue(p),r.hide()},v=async function(){var p=prompt("Enter a name for the new queue");if(p)try{await s.addQueue(p)}catch(m){m.response&&m.response.status===422?alert(JSON.stringify(m.response.data)):alert(m)}};return(p,m)=>{const b=C("font-awesome-icon"),f=C("router-link");return i(),d(x,null,[e("div",Xn,[e("div",Zn,[e("div",eo,[to,e("div",so,[no,e("p",null,[oo,g(k(a(o).name),1)])]),e("div",ao,[ro,e("button",{type:"button",class:"btn btn-danger",onClick:m[0]||(m[0]=l=>h(a(o).id))},[c(b,{icon:"trash"}),g(" Delete Queue ")])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:v},[c(b,{icon:"plus"}),g(" Queue ")]),io,e("table",co,[lo,e("tbody",null,[(i(!0),d(x,null,D(a(n),l=>(i(),d("tr",{key:l.id},[e("td",null,k(l.name),1),e("td",null,[c(f,{to:{name:"queue_edit",params:{id:l.id,admin:!0}},class:"btn btn-secondary btn-sm mx-1"},{default:$(()=>[c(b,{icon:"pen-to-square"})]),_:2},1032,["to"]),e("button",{type:"button",class:"btn btn-danger btn-sm mx-1",onClick:we(y=>_(l),["prevent"])},[c(b,{icon:"trash"})],8,uo)])]))),128))])])],64)}}},ho={__name:"AdminView",setup(t){return(s,n)=>(i(),d(x,null,[c(_o),c(Gn)],64))}},fo=V("roles",{state:()=>({roles:[]}),actions:{async hydrate(){u.info("roles:hydrate"),await E.get("/api/v1/roles").then(t=>{this.roles=t.data})}}});const po=e("h1",{class:"display-5 text-center"},"Edit User",-1),mo=e("hr",null,null,-1),bo={class:"mb-3"},yo=e("label",{for:"multiselect-roles",class:"form-label"},"Roles",-1),vo=e("div",{class:"form-text"},"Roles assigned to this user",-1),ko={class:"row row-cols-1 row-cols-md-2"},go=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),wo={class:"col d-grid mb-2"},$o={__name:"UserEdit",props:{id:{type:Number,default:-1}},async setup(t){let s,n;const o=t,r=ie(),_=fe();[s,n]=R(()=>_.hydrate()),await s,n();const h=_.users.find(f=>f.id===parseInt(o.id)),v=fo();v.hydrate();const{roles:p}=A(v);var m;_e(()=>{m=new he({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const b=async f=>{f=(({id:l,name:y})=>({id:l,name:y}))(f),f.contact_info=m.value(),f.roles=[];for(const l of h.roles)f.roles.push({id:l.id});try{await _.update(f),r.push("/admin/")}catch(l){if(l.response&&l.response.status===422){let y={};if(l.response.data.data){for(const q in l.response.data.data){y[q]="";for(const w of l.response.data.data[q])y[q]=y[q]+w.message+" "}z("usersForm",["The server rejected this submission. Please correct errors listed above"],y)}else z("usersForm",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(l)}};return(f,l)=>{const y=C("FormKit"),q=C("router-link");return i(),d("main",null,[po,mo,c(y,{id:"userform",type:"form",value:a(h),actions:!1,onSubmit:b},{default:$(()=>[c(y,{type:"text",name:"eid",label:"eID",disabled:!0,help:"The user's K-State eID (cannot be changed)",validation:"required"}),c(y,{type:"text",name:"name",label:"Name",help:"The user's full name as you'd like it displayed on the site",validation:"required"}),c(y,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact the user",rows:"10"}),e("div",bo,[yo,c(a(ge),{id:"multiselect-roles",modelValue:a(h).roles,"onUpdate:modelValue":l[0]||(l[0]=w=>a(h).roles=w),class:"form-control",options:a(p),multiple:!0,"tag-placeholder":"Add this as new role",placeholder:"Type to search or add role",label:"name","track-by":"id"},null,8,["modelValue","options"]),vo]),e("div",ko,[go,e("div",wo,[c(q,{to:{name:"admin"},class:"btn btn-secondary"},{default:$(()=>[g(" Cancel")]),_:1})])])]),_:1},8,["value"])])}}},qo={__name:"UserEditView",setup(t){return(s,n)=>(i(),L($o))}},pe=V("periods",{state:()=>({queues:[],periods:[],events:[],presences:[]}),getters:{getPeriod:t=>s=>t.periods.find(n=>n.id==s),getEventsTimline:t=>{var s=[{name:"Queued",data:[]},{name:"Taken",data:[]}];for(var n of t.events)n.status=="Queued"?s[0].data.push({x:n.eid,y:[U(n.created_at).valueOf(),n.updated_at===null?U().valueOf():U(n.updated_at).valueOf()]}):n.status=="Taken"&&s[1].data.push({x:n.eid,y:[U(n.created_at).valueOf(),n.updated_at===null?U().valueOf():U(n.updated_at).valueOf()],z:n.presence?n.presence.eid:""});return s}},actions:{async hydrate(){u.info("periods:hydrate"),await E.get("/api/v1/periods").then(t=>{this.queues=t.data})},async loadPeriods(t){u.info("periods:hydrate - "+t),await E.get("/api/v1/periods?name="+t).then(s=>{this.periods=s.data})},async loadEvents(t){u.info("periods:hydrate - "+t),await E.get("/api/v1/periods/"+t).then(s=>{this.events=s.data.events,this.presences=s.data.presences})}}});const xo=e("h1",{class:"display-5 text-center"},"Event Log: Queues",-1),So=["data-page-count"],Co={class:"col-md-6 mb-2 mb-md-0"},Qo={class:"col-md-6"},Eo={class:"row"},Lo={class:"col-md-12"},Io={class:"table-responsive"},Oo={class:"table table-striped d-md-table"},Ao=["onClick"],Ro=e("i",{class:"gg-select float-right"},null,-1),To=e("th",null,"Actions",-1),Po={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},Do={__name:"QueueList",async setup(t){let s,n;const o=pe();[s,n]=R(()=>o.hydrate()),await s,n();const{queues:r}=A(o),_=K([{name:"Queue",field:"queue_name",sort:""},{name:"Periods",field:"periods",sort:""},{name:"Recent",field:"recent",sort:""}]),h=function(p,m){let b;const f=_[m];p.shiftKey||this.cols.forEach(l=>{l.field!==f.field&&(l.sort="")}),f.sort||(b="asc"),f.sort==="desc"&&(b=p.shiftKey?"":"asc"),f.sort==="asc"&&(b="desc"),f.sort=b},v=G(()=>_.reduce((p,m)=>(m.sort&&(m.sort==="asc"?p.push(m.field):p.push("-"+m.field)),p),[]));return(p,m)=>{const b=C("router-link");return i(),d(x,null,[xo,c(a(re),{"ds-data":a(r),"ds-sortby":a(v)},{default:$(({ds:f})=>[e("div",{class:"row","data-page-count":f.dsPagecount},[e("div",Co,[c(a(te),{"ds-show-entries":"25"})]),e("div",Qo,[c(a(se),{"ds-search-placeholder":"Search..."})])],8,So),e("div",Eo,[e("div",Lo,[e("div",Io,[e("table",Oo,[e("thead",null,[e("tr",null,[(i(!0),d(x,null,D(_,(l,y)=>(i(),d("th",{key:l.field,class:X(["sort",l.sort]),onClick:q=>h(q,y)},[g(k(l.name)+" ",1),Ro],10,Ao))),128)),To])]),c(a(ne),{tag:"tbody"},{default:$(({row:l})=>[e("tr",null,[e("td",null,k(l.queue_name),1),e("td",null,k(l.periods),1),e("td",null,k(l.recent),1),e("td",null,[c(b,{to:{name:"data_periods",params:{name:l.queue_name}},class:"btn btn-secondary btn-sm mx-1"},{default:$(()=>[g("View")]),_:2},1032,["to"])])])]),_:1})])])])]),e("div",Po,[c(a(oe),{class:"mb-2 mb-md-0"}),c(a(ae))])]),_:1},8,["ds-data","ds-sortby"])],64)}}},No={__name:"DashboardView",setup(t){return(s,n)=>(i(),L(Do))}};const jo={class:"display-5 text-center"},Mo=["data-page-count"],Bo={class:"col-md-6 mb-2 mb-md-0"},Uo={class:"col-md-6"},Ko={class:"row"},Vo={class:"col-md-12"},Ho={class:"table-responsive"},Fo={class:"table table-striped d-md-table"},zo=["onClick"],Wo=e("i",{class:"gg-select float-right"},null,-1),Jo=e("th",null,"Actions",-1),Yo={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},Go={__name:"PeriodList",props:{name:{type:String,default:""}},async setup(t){let s,n;const o=t,r=pe();[s,n]=R(()=>r.loadPeriods(o.name)),await s,n();const{periods:_}=A(r),h=K([{name:"ID",field:"id",sort:""},{name:"Opened",field:"created_at",sort:""},{name:"Closed",field:"updated_at",sort:""},{name:"Events",field:"events",sort:""}]),v=function(m,b){let f;const l=h[b];m.shiftKey||this.cols.forEach(y=>{y.field!==l.field&&(y.sort="")}),l.sort||(f="asc"),l.sort==="desc"&&(f=m.shiftKey?"":"asc"),l.sort==="asc"&&(f="desc"),l.sort=f},p=G(()=>h.reduce((m,b)=>(b.sort&&(b.sort==="asc"?m.push(b.field):m.push("-"+b.field)),m),[]));return(m,b)=>{const f=C("router-link");return i(),d(x,null,[e("h1",jo,"Event Log: "+k(t.name),1),c(a(re),{"ds-data":a(_),"ds-sortby":a(p)},{default:$(({ds:l})=>[e("div",{class:"row","data-page-count":l.dsPagecount},[e("div",Bo,[c(a(te),{"ds-show-entries":"25"})]),e("div",Uo,[c(a(se),{"ds-search-placeholder":"Search..."})])],8,Mo),e("div",Ko,[e("div",Vo,[e("div",Ho,[e("table",Fo,[e("thead",null,[e("tr",null,[(i(!0),d(x,null,D(h,(y,q)=>(i(),d("th",{key:y.field,class:X(["sort",y.sort]),onClick:w=>v(w,q)},[g(k(y.name)+" ",1),Wo],10,zo))),128)),Jo])]),c(a(ne),{tag:"tbody"},{default:$(({row:y})=>[e("tr",null,[e("td",null,k(y.id),1),e("td",null,k(y.created_at),1),e("td",null,k(y.updated_at),1),e("td",null,k(y.events),1),e("td",null,[c(f,{to:{name:"period",params:{id:y.id}},class:"btn btn-secondary btn-sm mx-1"},{default:$(()=>[g("View")]),_:2},1032,["to"])])])]),_:1})])])])]),e("div",Yo,[c(a(oe),{class:"mb-2 mb-md-0"}),c(a(ae))])]),_:1},8,["ds-data","ds-sortby"])],64)}}},Xo={__name:"PeriodView",setup(t){return(s,n)=>(i(),L(Go))}},Zo={class:"display-5 text-center"},ea=e("h2",{class:"text-center"},"Events",-1),ta=["data-page-count"],sa={class:"col-md-6 mb-2 mb-md-0"},na={class:"col-md-6"},oa={class:"row"},aa={class:"col-md-12"},ra={class:"table-responsive"},ia={class:"table table-striped d-md-table"},ca=["onClick"],la=e("i",{class:"gg-select float-right"},null,-1),ua={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},da=e("h2",{class:"text-center"},"Presences",-1),_a=["data-page-count"],ha={class:"col-md-6 mb-2 mb-md-0"},fa={class:"col-md-6"},pa={class:"row"},ma={class:"col-md-12"},ba={class:"table-responsive"},ya={class:"table table-striped d-md-table"},va=["onClick"],ka=e("i",{class:"gg-select float-right"},null,-1),ga={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},wa={__name:"EventList",props:{id:{type:Number,default:-1}},async setup(t){let s,n;const o=t,r=pe();[s,n]=R(()=>r.loadEvents(o.id)),await s,n();const{events:_,presences:h,getEventsTimline:v}=A(r),p=K([{name:"ID",field:"id",sort:""},{name:"eID",field:"eid",sort:""},{name:"Status",field:"status",sort:""},{name:"Start",field:"created_at",sort:""},{name:"End",field:"updated_at",sort:""},{name:"Helper",field:"presence.eid",sort:""}]),m=K([{name:"ID",field:"id",sort:""},{name:"eID",field:"eid",sort:""},{name:"Start",field:"created_at",sort:""},{name:"End",field:"updated_at",sort:""}]),b=function(w,Q){let O;const I=p[Q];w.shiftKey||this.eventCols.forEach(S=>{S.field!==I.field&&(S.sort="")}),I.sort||(O="asc"),I.sort==="desc"&&(O=w.shiftKey?"":"asc"),I.sort==="asc"&&(O="desc"),I.sort=O},f=function(w,Q){let O;const I=m[Q];w.shiftKey||this.presenceCols.forEach(S=>{S.field!==I.field&&(S.sort="")}),I.sort||(O="asc"),I.sort==="desc"&&(O=w.shiftKey?"":"asc"),I.sort==="asc"&&(O="desc"),I.sort=O},l=G(()=>p.reduce((w,Q)=>(Q.sort&&(Q.sort==="asc"?w.push(Q.field):w.push("-"+Q.field)),w),[])),y=G(()=>m.reduce((w,Q)=>(Q.sort&&(Q.sort==="asc"?w.push(Q.field):w.push("-"+Q.field)),w),[])),q={chart:{type:"rangeBar"},plotOptions:{bar:{horizontal:!0,barHeight:"50%",rangeBarGroupRows:!0}},xaxis:{type:"datetime",labels:{datetimeUTC:!1}},dataLabels:{enabled:!0,formatter:function(w,Q){return Q.w.config.series[Q.seriesIndex].data[Q.dataPointIndex].z}}};return(w,Q)=>{const O=C("apexchart");return i(),d(x,null,[e("h1",Zo,"Event Log: Period "+k(t.id),1),ea,e("div",null,[c(O,{type:"rangeBar",options:q,series:a(v)},null,8,["series"])]),c(a(re),{"ds-data":a(_),"ds-sortby":a(l)},{default:$(({ds:I})=>[e("div",{class:"row","data-page-count":I.dsPagecount},[e("div",sa,[c(a(te),{"ds-show-entries":"25"})]),e("div",na,[c(a(se),{"ds-search-placeholder":"Search..."})])],8,ta),e("div",oa,[e("div",aa,[e("div",ra,[e("table",ia,[e("thead",null,[e("tr",null,[(i(!0),d(x,null,D(p,(S,ce)=>(i(),d("th",{key:S.field,class:X(["sort",S.sort]),onClick:le=>b(le,ce)},[g(k(S.name)+" ",1),la],10,ca))),128))])]),c(a(ne),{tag:"tbody"},{default:$(({row:S})=>[e("tr",null,[e("td",null,k(S.id),1),e("td",null,k(S.eid),1),e("td",null,k(S.status),1),e("td",null,k(S.created_at),1),e("td",null,k(S.updated_at),1),e("td",null,k(S.presence?S.presence.eid:""),1)])]),_:1})])])])]),e("div",ua,[c(a(oe),{class:"mb-2 mb-md-0"}),c(a(ae))])]),_:1},8,["ds-data","ds-sortby"]),da,c(a(re),{"ds-data":a(h),"ds-sortby":a(y)},{default:$(({ds:I})=>[e("div",{class:"row","data-page-count":I.dsPagecount},[e("div",ha,[c(a(te),{"ds-show-entries":"25"})]),e("div",fa,[c(a(se),{"ds-search-placeholder":"Search..."})])],8,_a),e("div",pa,[e("div",ma,[e("div",ba,[e("table",ya,[e("thead",null,[e("tr",null,[(i(!0),d(x,null,D(m,(S,ce)=>(i(),d("th",{key:S.field,class:X(["sort",S.sort]),onClick:le=>f(le,ce)},[g(k(S.name)+" ",1),ka],10,va))),128))])]),c(a(ne),{tag:"tbody"},{default:$(({row:S})=>[e("tr",null,[e("td",null,k(S.id),1),e("td",null,k(S.eid),1),e("td",null,k(S.created_at),1),e("td",null,k(S.updated_at),1)])]),_:1})])])])]),e("div",ga,[c(a(oe),{class:"mb-2 mb-md-0"}),c(a(ae))])]),_:1},8,["ds-data","ds-sortby"])],64)}}},$a={__name:"EventView",setup(t){return(s,n)=>(i(),L(wa))}},F=()=>T().is_admin,xe=Le({history:Ie("/"),routes:[{path:"/",name:"home",component:Yt},{path:"/about",name:"about",component:()=>jt(()=>import("./AboutView.deb0890a.js"),["assets/AboutView.deb0890a.js","assets/vendor.b327130c.js"])},{path:"/queues",name:"queues",component:fs},{path:"/queues/:id",name:"queue_single",component:bn,props:t=>({id:Number(t.params.id)})},{path:"/queues/:id/edit",name:"queue_edit",component:Cn,props:!0,beforeEnter:F},{path:"/profile",name:"profile",component:Tn},{path:"/admin",name:"admin",component:ho,beforeEnter:F},{path:"/admin/user/:id/edit",name:"admin_useredit",component:qo,props:!0,beforeEnter:F},{path:"/data",name:"data",component:No,beforeEnter:F},{path:"/data/:name",name:"data_periods",component:Xo,beforeEnter:F,props:t=>({name:t.params.name})},{path:"/period/:id",name:"period",component:$a,beforeEnter:F,props:t=>({id:t.params.id})}]});xe.beforeEach(async function(t){if(t.name!=="home"&&t.name!=="about"){const s=T();if(s.token||await s.tryToken(),!s.token)return"/"}});const qa=()=>{E.interceptors.request.use(t=>{if(t.url!=="/auth/token"){const s=T();s.token&&(t.headers.Authorization="Bearer "+s.token)}return t},t=>Promise.reject(t)),E.interceptors.response.use(t=>t,async t=>{const s=t.config;if(s.url!=="/auth/token"&&t.response&&t.response.status===401&&!s._retry){s._retry=!0;try{return await T().refreshToken(),E(s)}catch(n){return Promise.reject(n)}}return Promise.reject(t)})};u.useDefaults();u.setLevel(u.WARN);Oe.add(Ae,Re,Te,Pe,De,Ne,je,Me,Be,Ue,Ke,Ve,He,Fe,ze,We,Je,Ye,Ge,Xe,Ze,et,tt,st,nt,ot,at);rt.watch();qa();const H=it(Pt);H.use(ct());H.use(xe);H.use(lt,be);H.use(ut,dt({config:{classes:{input:"form-control",label:"form-label",help:"form-text",outer:"mb-3"}}}));H.use(_t);H.component("FontAwesomeIcon",ht);H.mount("#app");export{B as _};
