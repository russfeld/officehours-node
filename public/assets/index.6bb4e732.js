import{a as it,d as A,u as ht,o as V,L as l,r as q,b as d,c as m,e,f as s,w as C,g as n,R as Q,h as I,i as T,j as w,t as z,p as U,k as F,S as xt,F as k,l as vt,m as nt,s as M,n as Y,q as L,v as J,x as R,y as Z,z as W,A as wt,B as yt,C as kt,M as G,D as dt,E as lt,G as X,H as tt,I as st,J as D,K as ct,N as K,O as mt,P as _t,Q as Tt,T as zt,U as qt,V as Ct,W as $t,X as Mt,Y as jt,Z as St,_ as Lt,$ as Qt,a0 as Bt,a1 as Et,a2 as It,a3 as At,a4 as Rt,a5 as Dt,a6 as Nt,a7 as Ot,a8 as Pt,a9 as Ut,aa as Ft,ab as Ht,ac as Vt,ad as Kt,ae as Yt,af as Wt,ag as Jt,ah as Zt,ai as Gt,aj as Xt,ak as te,al as ee,am as oe,an as ae,ao as re,ap as ie}from"./vendor.770c8b46.js";const ne=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&a(p)}).observe(document,{childList:!0,subtree:!0});function r(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerpolicy&&(c.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?c.credentials="include":i.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(i){if(i.ep)return;i.ep=!0;const c=r(i);fetch(i.href,c)}};ne();const _=it.create({baseURL:"/",headers:{Accept:"application/json","Content-Type":"application/json"}}),$=A("token",{state:()=>({token:ht("token",""),sound:!0}),getters:{refresh_token(){return this.token?V(this.token).refresh_token:""},eid(){return this.token?V(this.token).eid:""},id(){return this.token?V(this.token).user_id:""},is_admin(){return this.token?V(this.token).is_admin:!1}},actions:{async getToken(){l.info("token:get"),await _.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(l.info("token:get login failed - redirecting to CAS"),window.location.href="/auth/login"):(l.error("token:get error"+t),this.token="")})},async tryToken(){l.info("token:try"),await _.get("/auth/token",{withCredentials:!0}).then(t=>{this.token=t.data.token}).catch(async t=>{t.response&&t.response.status===401?(l.info("token:try login failed - trying refresh token"),await this.refreshToken()):(l.error("token:try error"+t),this.token="")})},async refreshToken(){l.info("token:refresh"),await _.post("/auth/token",{refresh_token:this.refresh_token}).then(t=>{this.token=t.data.token}).catch(t=>{t.response&&t.response.status===401?(l.info("token:refresh login failed - redirecting to CAS"),window.location.href="/auth/login"):(l.error("token:refresh error"+t),this.token="")})},async logout(){this.token="",window.location.href=window.location.href="/auth/logout"},async toggleSound(){this.sound=!this.sound}}});var B=(t,o)=>{const r=t.__vccOpts||t;for(const[a,i]of o)r[a]=i;return r};const de=t=>(U("data-v-5f1a5e7f"),t=t(),F(),t),le={class:"navbar navbar-expand-md navbar-dark fixed-top bg-purple"},se={class:"container"},ce=w("Office Hours"),me=de(()=>e("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarCollapse","aria-controls":"navbarCollapse","aria-expanded":"false","aria-label":"Toggle navigation"},[e("span",{class:"navbar-toggler-icon"})],-1)),pe={id:"navbarCollapse",class:"collapse navbar-collapse"},be={class:"navbar-nav me-auto mb-2 mb-md-0"},ge={class:"nav-item"},fe=w("Queues"),ue={class:"nav-item"},he=w("About"),xe={key:0,class:"nav-item"},ve=w("Admin"),we={key:1,class:"nav-item"},ye=w("Data"),ke={class:""},_e={key:0},Te={class:"navbar-nav me-auto mb-2 mb-md-0"},ze={class:"nav-item"},qe={class:"nav-item"},Ce={class:"nav-item"},$e=w(" Logout"),Me={key:1},je=w(" Login"),Se={__name:"NavBar",setup(t){const o=$();return(r,a)=>{const i=q("font-awesome-icon");return d(),m("nav",le,[e("div",se,[s(n(Q),{to:"/",class:"navbar-brand"},{default:C(()=>[ce]),_:1}),me,e("div",pe,[e("ul",be,[e("li",ge,[s(n(Q),{to:"/queues","active-class":"active",class:"nav-link"},{default:C(()=>[fe]),_:1})]),e("li",ue,[s(n(Q),{to:"/about","active-class":"active",class:"nav-link"},{default:C(()=>[he]),_:1})]),n(o).is_admin?(d(),m("li",xe,[s(n(Q),{to:"/admin","active-class":"active",class:"nav-link"},{default:C(()=>[ve]),_:1})])):I("",!0),n(o).is_admin?(d(),m("li",we,[s(n(Q),{to:"/data","active-class":"active",class:"nav-link"},{default:C(()=>[ye]),_:1})])):I("",!0)]),e("div",ke,[n(o).token?(d(),m("div",_e,[e("ul",Te,[e("li",ze,[e("a",{class:"nav-link",onClick:a[0]||(a[0]=(...c)=>n(o).toggleSound&&n(o).toggleSound(...c))},[n(o).sound?(d(),T(i,{key:0,icon:"bell"})):(d(),T(i,{key:1,icon:"bell-slash"}))])]),e("li",qe,[s(n(Q),{to:"/profile","active-class":"active",class:"nav-link"},{default:C(()=>[s(i,{icon:"user"}),w(" "+z(n(o).eid),1)]),_:1})]),e("li",Ce,[e("a",{class:"btn btn-success float-end",onClick:a[1]||(a[1]=c=>n(o).logout())},[s(i,{icon:"arrow-right-from-bracket"}),$e])])])])):(d(),m("div",Me,[e("a",{class:"btn btn-success",onClick:a[2]||(a[2]=c=>n(o).getToken())},[s(i,{icon:"arrow-right-to-bracket"}),je])]))])])])])}}};var Le=B(Se,[["__scopeId","data-v-5f1a5e7f"]]);const Qe={id:"main",class:"container px-4 py-5"},Be={__name:"App",setup(t){return(o,r)=>(d(),m(k,null,[e("header",null,[s(Le)]),e("div",Qe,[(d(),T(xt,null,{default:C(()=>[s(n(vt))]),_:1}))])],64))}};var Ee=B(Be,[["__scopeId","data-v-68e3a569"]]);const Ie="modulepreload",rt={},Ae="/",Re=function(o,r){return!r||r.length===0?o():Promise.all(r.map(a=>{if(a=`${Ae}${a}`,a in rt)return;rt[a]=!0;const i=a.endsWith(".css"),c=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${c}`))return;const p=document.createElement("link");if(p.rel=i?"stylesheet":Ie,i||(p.as="script",p.crossOrigin=""),p.href=a,document.head.appendChild(p),i)return new Promise((u,f)=>{p.addEventListener("load",u),p.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>o())};const De={},Ne=t=>(U("data-v-8c844e72"),t=t(),F(),t),Oe={class:"pb-2 border-bottom"},Pe=w(" Office Hours Queue "),Ue=Ne(()=>e("div",{class:"row p-4 pb-0 pt-lg-4 pb-lg-4 align-items-center rounded-3 border shadow-lg"},[e("div",{class:"col-lg-10 mx-auto"},[e("p",{class:"lead-custom text-center"}," Welcome! Here you can join the queue for office hours. Let's get started! ")])],-1));function Fe(t,o){const r=q("font-awesome-icon");return d(),m(k,null,[e("h2",Oe,[s(r,{icon:"chalkboard-teacher"}),Pe]),Ue],64)}var pt=B(De,[["render",Fe],["__scopeId","data-v-8c844e72"]]);const He=e("br",null,null,-1),Ve={key:0},Ke=w("Queues List"),Ye={key:1},We=w(" Login"),Je={__name:"LoginMessage",setup(t){const o=$();return(r,a)=>{const i=q("RouterLink"),c=q("font-awesome-icon");return d(),m("main",null,[s(pt),He,n(o).token?(d(),m("div",Ve,[s(i,{to:"/queues",class:"btn btn-success"},{default:C(()=>[Ke]),_:1})])):(d(),m("div",Ye,[e("a",{class:"btn btn-success",onClick:a[0]||(a[0]=p=>n(o).getToken())},[s(c,{icon:"arrow-right-to-bracket"}),We])]))])}}},Ze={__name:"HomeView",setup(t){return(o,r)=>(d(),T(Je))}},S=A("queues",{state:()=>({queues:[],online:[],socket:void 0,connected:!1,error:!1}),getters:{getQueue:t=>o=>t.queues.find(r=>r.id==o),getOnline:t=>o=>t.online.find(r=>r.id==o)||{is_open:!1,helpers:0,requests:0},sortedQueues:t=>[...t.queues].sort((o,r)=>r.is_open-o.is_open)},actions:{async hydrate(){l.info("queues:hydrate"),await _.get("/api/v1/queues").then(t=>{this.queues=t.data})},async hydrateOnline(){l.info("queues:hydrateOnline"),this.socket&&(this.socket.disconnect(),this.online={});const t=$(),o="/status";this.socket=nt(o,{auth:{token:t.token}}),this.socket.on("connect",()=>{l.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",r=>{l.error("socket:connect_error - "+r),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{l.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("status:update",async r=>{l.info("status:update - "+r.id),l.debug("|- updated: "+r);var a=this.online.findIndex(i=>i.id===r.id);a<0?this.online.push(r):Object.assign(this.online[a],r)}),l.info("emit status:connect"),await this.socket.emit("status:connect",async(r,a)=>{r==200?(l.info("status:connect OK"),l.debug("|- online: "+a),this.online=a):l.error("status:connect error - "+r)})},async disconnectQueue(){this.socket&&(l.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async update(t){await _.post("/api/v1/queues/"+t.id,{queue:t}).then(async()=>{await this.hydrate()})},async deleteQueue(t){await _.delete("/api/v1/queues/"+t).then(async()=>{await this.hydrate()})},async addQueue(t){await _.put("/api/v1/queues/",{name:t}).then(async()=>{await this.hydrate()})}}});const Ge={class:"col"},Xe={class:"card-header"},to={key:0,class:"float-end badge rounded-pill bg-success"},eo={key:1,class:"float-end badge rounded-pill bg-danger"},oo={class:"card-body"},ao={class:"card-text"},ro={__name:"QueueCard",props:{queue:{type:Object,default(){return{}}}},setup(t){const o=t,r=S(),{getOnline:a}=M(r),i=Y();function c(p){i.push("/queues/"+p)}return(p,u)=>{const f=q("font-awesome-icon");return d(),m("div",Ge,[e("div",{class:"card w-100 hvr-grow",onClick:u[0]||(u[0]=h=>c(o.queue.id))},[e("h5",Xe,[w(z(o.queue.name)+" ",1),n(a)(o.queue.id).is_open===1?(d(),m("span",to,[w("Open | "+z(n(a)(o.queue.id).helpers||0)+" ",1),s(f,{icon:"user-graduate"}),w(" | "+z(n(a)(o.queue.id).requests||0)+" ",1),s(f,{icon:"circle-question"})])):(d(),m("span",eo,"Closed"))]),e("div",oo,[e("p",ao,z(o.queue.snippet),1)])])])}}};var io=B(ro,[["__scopeId","data-v-3228e55c"]]);const no={class:"row row-cols-1 row-cols-lg-3 g-4"},lo={__name:"QueueList",async setup(t){let o,r;const a=S();a.hydrate(),[o,r]=L(()=>a.hydrateOnline()),await o,r();const{sortedQueues:i}=M(a);return J(async()=>{await a.disconnectQueue()}),(c,p)=>(d(),m("div",no,[(d(!0),m(k,null,R(n(i),(u,f)=>(d(),T(io,{key:u.id,queue:u,index:f},null,8,["queue","index"]))),128))]))}},so=e("br",null,null,-1),co={__name:"QueueListView",setup(t){return(o,r)=>(d(),m("main",null,[s(pt),so,s(lo)]))}},H=A("requests",{state:()=>({requests:[],online:[],helpers:[],socket:void 0,connected:!1,error:!1}),getters:{getRequest:t=>o=>t.requests.find(r=>r.user_id===o),userOnline:t=>o=>t.online.find(r=>r==o)!==void 0,sortedRequests:t=>[...t.requests].sort(function(o,r){return o.status_id==r.status_id?o.id-r.id:r.status_id-o.status_id})},actions:{async connectQueue(t){this.socket&&this.socket.disconnect(),this.$reset();const o=$(),r="/";this.socket=nt(r,{auth:{token:o.token,queue_id:t}}),this.socket.on("connect",()=>{l.info("socket:connect"),this.connected=!0,this.error=!1}),this.socket.on("connect_error",a=>{l.error("socket:connect_error - "+a),this.$reset,this.error=!0}),this.socket.on("disconnect",()=>{l.info("socket:disconnect"),this.connected=!1,this.error=!1}),this.socket.on("queue:update",async a=>{l.info("queue:update - "+a.id),l.debug("|- updated: "+a);var i=this.requests.findIndex(c=>c.id===a.id);i<0?(this.requests.push(a),o.sound&&new Audio("/ding-36029.mp3").play()):this.requests[i]=a}),this.socket.on("queue:remove",async a=>{l.info("queue.remove - "+a);var i=this.requests.findIndex(c=>c.id===a);i>=0&&this.requests.splice(i,1)}),this.socket.on("user:online",async a=>{l.info("user:online - "+a),this.online.push(String(a))}),this.socket.on("user:offline",async a=>{l.info("user:offline - "+a),this.online.splice(this.online.indexOf(String(a)),1)}),this.socket.on("helper:online",async a=>{l.info("helper:online - "+a.id),l.debug("|- helper: "+a),this.helpers.push(a)}),this.socket.on("helper:offline",async a=>{l.info("helper:offline - "+a),this.helpers.splice(this.helpers.findIndex(i=>i.id==a),1)}),this.socket.on("queue:opening",async()=>{l.info("queue:opening"),await S().hydrate()}),this.socket.on("connected",async(a,i)=>{l.info("socket:connected"),l.debug("|-online: "+a),l.debug("|-helpers: "+i),this.online=a,this.helpers=i}),this.socket.on("queue:closing",async()=>{l.info("queue:closing"),this.requests=[],await S().hydrate()}),l.info("emit queue:connect"),await this.socket.emit("queue:connect",async(a,i)=>{a==200?(l.info("queue:connect OK"),l.debug("|- requests: "+i),this.requests=i):l.error("queue:connect error - "+a)})},async disconnectQueue(){this.socket&&(l.info("emit socket:disconnect"),this.socket.disconnect()),this.$reset()},async joinQueue(){l.info("emit queue:join"),await this.socket.emit("queue:join",async t=>{t==200?l.info("queue:join OK"):l.error("queue:join error - "+t)})},async openQueue(){l.info("emit queue:open"),await this.socket.emit("queue:open",async t=>{t==200?(l.info("queue:open OK"),S().hydrate()):l.error("queue:open error - "+t)})},async closeQueue(){l.info("emit queue:close"),await this.socket.emit("queue:close",async t=>{t==200?(l.info("queue:close OK"),this.requests=[],S().hydrate()):l.error("queue:close error - "+t)})},async takeRequest(t){l.info("emit request:take - "+t),await this.socket.emit("request:take",t,async o=>{o==200?l.info("request:take OK"):l.error("request:take error - "+o)})},async deleteRequest(t){l.info("emit request:delete - "+t),await this.socket.emit("request:delete",t,async o=>{o==200?l.info("request:delete OK"):l.error("request:delete error - "+o)})},async finishRequest(t){l.info("emit request:finish - "+t),await this.socket.emit("request:finish",t,async o=>{o==200?l.info("request:finish OK"):l.error("request:finish error - "+o)})},async requeueRequest(t){l.info("emit request:requeue - "+t),await this.socket.emit("request:requeue",t,async o=>{o==200?l.info("request:requeue OK"):l.error("request:requeue error - "+o)})}}});const mo=t=>(U("data-v-651444a6"),t=t(),F(),t),po={key:2,class:"badge bg-primary rounded-pill"},bo=mo(()=>e("br",null,null,-1)),go={id:"tooltip",class:"text-muted"},fo={__name:"RequestItem",props:{request:{type:Object,default(){return{}}},helper:{type:Boolean,default(){return!1}},userId:{type:Number,default(){return-1}}},setup(t){const o=t;var r=Z({now:W.utc()});const a=function(){r.now=W.utc(),setInterval(a,1e4)};setInterval(a,1e4);const i=H(),c=async function(){await i.deleteRequest(o.request.id)},p=async function(){await i.takeRequest(o.request.id)},u=async function(){await i.finishRequest(o.request.id)},f=async function(){await i.requeueRequest(o.request.id)},h=wt(()=>o.request.updated_at?r.now.to(o.request.updated_at):r.now.to(o.request.created_at));return(x,g)=>{const b=q("font-awesome-icon");return d(),m("li",{class:yt(["list-group-item",[t.request.status_id==2?"list-group-item-primary":"",t.request.user_id==t.userId?"current-user":"",n(i).userOnline(t.request.user_id)?"":"list-group-item-light"]])},[n(i).userOnline(t.request.user_id)?(d(),T(b,{key:0,icon:"link"})):(d(),T(b,{key:1,icon:"link-slash"})),w(" "+z(t.request.user.name)+" ",1),t.helper?(d(),m(k,{key:2},[e("button",{class:"float-end btn btn-danger btn-sm mx-1",onClick:c},[s(b,{icon:"times",size:"xl"})]),e("button",{class:"float-end btn btn-secondary btn-sm mx-1",onClick:f},[s(b,{icon:"redo",size:"lg"})]),t.request.status_id==1?(d(),m("button",{key:0,class:"float-end btn btn-primary btn-sm mx-1",onClick:p}," Take ")):(d(),m("button",{key:1,class:"float-end btn btn-success btn-sm mx-1",onClick:u}," Done ")),t.request.status_id==2?(d(),m("span",po,z(t.request.helper.name),1)):I("",!0),bo,e("small",go,z(n(h)),1)],64)):I("",!0)],2)}}};var uo=B(fo,[["__scopeId","data-v-651444a6"]]);const ho=e("h3",{class:"text-center"},"Students Waiting",-1),xo=e("hr",null,null,-1),vo={class:"list-group list-group-numbered"},bt={__name:"RequestList",props:{id:{type:Number,default:-1}},setup(t){const o=$(),r=H(),{sortedRequests:a}=M(r);return(i,c)=>(d(),m(k,null,[ho,xo,e("ul",vo,[(d(!0),m(k,null,R(n(a),(p,u)=>(d(),T(uo,kt({key:p.id,request:p,index:u},i.$attrs,{"user-id":n(o).id}),null,16,["request","index","user-id"]))),128))])],64))}},wo=e("h3",{class:"text-center"},"Helpers Online",-1),yo=e("hr",null,null,-1),ko={class:"list-group list-group-flush"},gt={__name:"HelperList",setup(t){const o=H(),{helpers:r}=M(o);return(a,i)=>{const c=q("font-awesome-icon");return d(),m(k,null,[wo,yo,e("ul",ko,[(d(!0),m(k,null,R(n(r),(p,u)=>(d(),m("li",{key:u,class:"list-group-item"},[s(c,{icon:"link"}),w(" "+z(p.name),1)]))),128))])],64)}}};const N=t=>(U("data-v-38a96dbb"),t=t(),F(),t),_o={class:"queue-header mx-auto"},To={key:0,class:"btn btn-outline-success float-end disabled"},zo=N(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),qo=N(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),Co=N(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),$o=N(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),Mo=[Co,$o],jo=N(()=>e("h2",{class:"text-center"},"Moderate Queue",-1)),So=N(()=>e("hr",null,null,-1)),Lo={class:"row"},Qo={class:"col-12 col-md-4 mb-4"},Bo={class:"col-12 col-md-8 mb-4"},Eo={__name:"HelperPane",props:{id:{type:Number,default:-1}},async setup(t){let o,r;const a=t,i=S();[o,r]=L(()=>i.hydrate()),await o,r();const c=i.getQueue,p=H(),{connected:u,error:f}=M(p);[o,r]=L(()=>p.connectQueue(a.id)),await o,r();const h=async function(){confirm("Are you sure? All pending requests will be lost!")&&await p.closeQueue()},x=async function(){await p.openQueue()},g=async function(){await p.connectQueue(a.id)};return J(async()=>{await p.disconnectQueue()}),(b,v)=>{const y=q("font-awesome-icon");return d(),m(k,null,[e("div",_o,[n(u)?(d(),m("button",To,[s(y,{icon:"link"}),zo])):(d(),m(k,{key:1},[n(f)?(d(),m("button",{key:0,class:"btn btn-outline-danger float-end",onClick:g},[s(y,{icon:"link-slash"}),qo])):(d(),m("button",{key:1,class:"btn btn-outline-warning float-end",onClick:g},Mo))],64)),jo,n(c)(t.id).is_open==1?(d(),m("a",{key:2,class:"w-100 btn btn-success",onClick:h},"Queue is Open - Click to Close")):(d(),m("a",{key:3,class:"w-100 btn btn-danger",onClick:x},"Queue is Closed - Click to Open"))]),So,e("div",Lo,[e("div",Qo,[s(gt)]),e("div",Bo,[s(bt,{id:t.id,helper:""},null,8,["id"])])])],64)}}};var Io=B(Eo,[["__scopeId","data-v-38a96dbb"]]);const E=t=>(U("data-v-3eaf00d9"),t=t(),F(),t),Ao={id:"studentModal",class:"modal fade",tabindex:"-1","aria-labelledby":"studentModalLabel","aria-hidden":"true"},Ro={class:"modal-dialog"},Do={class:"modal-content"},No=E(()=>e("div",{class:"modal-header"},[e("h5",{id:"studentModalLabel",class:"modal-title"},"Your Turn!"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Oo={class:"modal-body"},Po=w(" You will be helped by "),Uo=w(". Their contact info is below: "),Fo=E(()=>e("hr",null,null,-1)),Ho=["innerHTML"],Vo=E(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," OK ")],-1)),Ko={class:"queue-header mx-auto"},Yo={key:0,class:"btn btn-outline-success float-end disabled"},Wo=E(()=>e("span",{class:"visually-hidden"},"Connected!",-1)),Jo=E(()=>e("span",{class:"visually-hidden"},"Disconnected!",-1)),Zo=E(()=>e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),Go=E(()=>e("span",{class:"visually-hidden"},"Connecting...",-1)),Xo=[Zo,Go],ta=E(()=>e("h2",{class:"text-center"},"Waiting Queue",-1)),ea={key:0,class:"w-100 btn btn-success disabled",disabled:""},oa={key:3,class:"w-100 btn btn-danger disabled",disabled:""},aa=E(()=>e("hr",null,null,-1)),ra={key:0,class:"row"},ia={class:"col-12 col-md-4 mb-4"},na={class:"col-12 col-md-8 mb-4"},da={__name:"StudentPane",props:{id:{type:Number,default:-1}},async setup(t){let o,r;const a=t,i=$(),c=S();[o,r]=L(()=>c.hydrate()),await o,r();const p=c.getQueue,u=H(),f=u.getRequest,{connected:h,error:x}=M(u);[o,r]=L(()=>u.connectQueue(a.id)),await o,r();var g,b=!1;u.$subscribe(()=>{const j=f(i.id);j&&j.status_id==2&&!b&&(b=!0,g=new G("#studentModal",{}),g.show(),i.sound&&new Audio("/ding-36029.mp3").play()),j||(b=!1)});const v=async function(){b=!1,await u.joinQueue()},y=async function(){await u.connectQueue(a.id)};return J(async()=>{await u.disconnectQueue()}),(j,ot)=>{const at=q("font-awesome-icon");return d(),m(k,null,[e("div",Ao,[e("div",Ro,[e("div",Do,[No,e("div",Oo,[n(f)(n(i).id)&&n(f)(n(i).id).helper?(d(),m(k,{key:0},[e("p",null,[Po,e("strong",null,z(n(f)(n(i).id).helper.name),1),Uo]),Fo,e("div",{innerHTML:n(dt).sanitize(n(lt).parse(n(f)(n(i).id).helper.contact_info||""))},null,8,Ho)],64)):I("",!0)]),Vo])])]),e("div",Ko,[n(h)?(d(),m("button",Yo,[s(at,{icon:"link"}),Wo])):(d(),m(k,{key:1},[n(x)?(d(),m("button",{key:0,class:"btn btn-outline-danger float-end",onClick:y},[s(at,{icon:"link-slash"}),Jo])):(d(),m("button",{key:1,class:"btn btn-outline-warning float-end",onClick:y},Xo))],64)),ta,n(p)(t.id).is_open==1?(d(),m(k,{key:2},[n(f)(n(i).id)!=null?(d(),m("a",ea,"Queue Joined")):(d(),m("a",{key:1,class:"w-100 btn btn-success",onClick:ot[0]||(ot[0]=Ar=>v())},"Join Queue"))],64)):(d(),m("a",oa,"Queue is Closed"))]),aa,n(p)(t.id).is_open==1?(d(),m("div",ra,[e("div",ia,[s(gt)]),e("div",na,[s(bt,{id:t.id},null,8,["id"])])])):I("",!0)],64)}}};var la=B(da,[["__scopeId","data-v-3eaf00d9"]]);const sa=w(" Back"),ca=w(" Edit"),ma={class:"display-5 text-center"},pa=e("hr",null,null,-1),ba=["innerHTML"],ga=e("hr",null,null,-1),fa={__name:"QueueSingle",props:{id:{type:Number,default:-1}},async setup(t){let o,r;const a=$(),i=S();[o,r]=L(()=>i.hydrate()),await o,r();const c=i.getQueue;return(p,u)=>{const f=q("font-awesome-icon");return d(),m("main",null,[s(n(Q),{to:{name:"queues"},class:"btn btn-secondary float-start"},{default:C(()=>[s(f,{icon:"arrow-left"}),sa]),_:1}),n(a).is_admin?(d(),T(n(Q),{key:0,to:{name:"queue_edit",params:{id:t.id}},class:"btn btn-secondary float-end"},{default:C(()=>[s(f,{icon:"pen-to-square"}),ca]),_:1},8,["to"])):I("",!0),e("h1",ma,z(n(c)(t.id).name),1),pa,e("div",{innerHTML:n(dt).sanitize(n(lt).parse(n(c)(t.id).description))},null,8,ba),ga,n(c)(t.id).helper==1?(d(),T(Io,{key:1,id:t.id},null,8,["id"])):(d(),T(la,{key:2,id:t.id},null,8,["id"]))])}}},ua={__name:"QueueSingleView",setup(t){return(o,r)=>(d(),T(fa))}},et=A("users",{state:()=>({users:[]}),getters:{getUser:t=>o=>t.users.find(r=>r.id===o)},actions:{async hydrate(){l.info("users:hydrate"),await _.get("/api/v1/users").then(t=>{this.users=t.data})},async update(t){await _.post("/api/v1/users/"+t.id,{user:t}).then(async()=>{await this.hydrate()})},async deleteUser(t){await _.delete("/api/v1/users/"+t).then(async()=>{await this.hydrate()})},async addUser(t){await _.put("/api/v1/users/",{eid:t}).then(async()=>{await this.hydrate()})}}});const ha=e("h1",{class:"display-5 text-center"},"Edit Queue",-1),xa=e("hr",null,null,-1),va={class:"mb-3"},wa=e("label",{for:"multiselect-users",class:"form-label"},"Helpers",-1),ya=e("div",{class:"form-text"}," Helpers who can manage the queue (usually TAs) - admins already have access ",-1),ka={class:"row row-cols-1 row-cols-md-2"},_a=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),Ta={class:"col d-grid mb-2"},za=w(" Cancel"),qa={__name:"EditQueue",props:{id:{type:Number,default:-1}},async setup(t){let o,r;const a=t,i=Y(),c=S();[o,r]=L(()=>c.hydrate()),await o,r();const p=c.getQueue(a.id),u=et();u.hydrate();const{users:f}=M(u);var h;X(()=>{h=new tt({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const x=async g=>{g=(({id:b,name:v,snippet:y})=>({id:b,name:v,snippet:y}))(g),g.description=h.value(),g.users=[];for(const b of p.users)g.users.push({id:b.id});try{await c.update(g),i.push("/queues/"+p.id)}catch(b){if(b.response&&b.response.status===422){let v={};if(b.response.data.data){for(const y in b.response.data.data){v[y]="";for(const j of b.response.data.data[y])v[y]=v[y]+j.message+" "}D("queueform",["The server rejected this submission. Please correct errors listed above"],v)}else D("queueform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(b)}};return(g,b)=>{const v=q("FormKit"),y=q("router-link");return d(),m("main",null,[ha,xa,s(v,{id:"queueform",type:"form",value:n(p),actions:!1,onSubmit:x},{default:C(()=>[s(v,{type:"text",name:"name",label:"Queue Name",help:"Name of the queue (usually the course)",validation:"required"}),s(v,{type:"text",name:"snippet",label:"Short Description",help:"Short description shown on the initial card"}),s(v,{type:"textarea",name:"description",label:"Long Description",help:"Long description shown on the queue page",rows:"10"}),e("div",va,[wa,s(n(st),{id:"multiselect-users",modelValue:n(p).users,"onUpdate:modelValue":b[0]||(b[0]=j=>n(p).users=j),class:"form-control",options:n(f),multiple:!0,"tag-placeholder":"Add this as new user",placeholder:"Type to search or add user",label:"eid","track-by":"id"},null,8,["modelValue","options"]),ya]),e("div",ka,[_a,e("div",Ta,[s(y,{to:{name:"queue_single",params:{id:n(p).id}},class:"btn btn-secondary"},{default:C(()=>[za]),_:1},8,["to"])])])]),_:1},8,["value"])])}}},Ca={__name:"QueueEditView",setup(t){return(o,r)=>(d(),T(qa))}},$a=A("profile",{state:()=>({user:{}}),actions:{async hydrate(){l.info("profile:hydrate"),await _.get("/api/v1/profile").then(t=>{this.user=t.data})},async update(t){await _.post("/api/v1/profile/",{user:t}).then(async()=>{await this.hydrate()})}}});const Ma=e("h1",{class:"display-5 text-center"},"Edit User",-1),ja=e("hr",null,null,-1),Sa={class:"row row-cols-1 row-cols-md-2"},La=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),Qa={class:"col d-grid mb-2"},Ba=w(" Cancel"),Ea={__name:"EditProfile",async setup(t){let o,r;const a=Y(),i=$a();[o,r]=L(()=>i.hydrate()),await o,r();const{user:c}=M(i);var p;X(()=>{p=new tt({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const u=async f=>{const h={name:f.name,contact_info:p.value()};try{await i.update(h),a.push("/queues/")}catch(x){if(x.response&&x.response.status===422){let g={};if(x.response.data.data){for(const b in x.response.data.data){g[b]="";for(const v of x.response.data.data[b])g[b]=g[b]+v.message+" "}D("userform",["The server rejected this submission. Please correct errors listed above"],g)}else D("userform",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(x)}};return(f,h)=>{const x=q("FormKit"),g=q("router-link");return d(),m("main",null,[Ma,ja,s(x,{id:"userform",type:"form",value:n(c),actions:!1,onSubmit:u},{default:C(()=>[s(x,{type:"text",name:"eid",label:"eID",disabled:!0,help:"Your K-State eID (cannot be changed)",validation:"required"}),s(x,{type:"text",name:"name",label:"Name",help:"Your full name as you'd like it displayed on the site",validation:"required"}),s(x,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact you",rows:"10"}),e("div",Sa,[La,e("div",Qa,[s(g,{to:{name:"queues"},class:"btn btn-secondary"},{default:C(()=>[Ba]),_:1})])])]),_:1},8,["value"])])}}};const Ia={__name:"ProfileView",setup(t){return(o,r)=>(d(),T(Ea))}},Aa={id:"userModal",class:"modal fade",tabindex:"-1","aria-labelledby":"userModalLabel","aria-hidden":"true"},Ra={class:"modal-dialog"},Da={class:"modal-content"},Na=e("div",{class:"modal-header"},[e("h5",{id:"userModalLabel",class:"modal-title"},"Delete User"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Oa={class:"modal-body"},Pa=e("h5",null,"Are you sure you want to delete this user?",-1),Ua=e("strong",null,"eID: ",-1),Fa=e("br",null,null,-1),Ha=e("strong",null,"Name: ",-1),Va={class:"modal-footer"},Ka=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),Ya=w(" Delete User "),Wa=w(" User "),Ja=e("h1",{class:"text-center"},"Users",-1),Za={class:"table table-striped table-hover"},Ga=e("thead",null,[e("tr",null,[e("th",null,"eID"),e("th",null,"Name"),e("th",null,"Roles"),e("th",null,"Actions")])],-1),Xa=["onClick"],tr={__name:"UserAdmin",setup(t){const o=et();o.hydrate();const{users:r}=M(o),a=$();var i=Z({}),c;const p=function(h){i.id=h.id,i.eid=h.eid,i.name=h.name,c=new G("#userModal",{}),c.show()},u=async function(h){await o.deleteUser(h),c.hide()},f=async function(){var h=prompt("Enter an eID to create a user");if(h)try{await o.addUser(h)}catch(x){x.response&&x.response.status===422?alert(JSON.stringify(x.response.data)):alert(x)}};return(h,x)=>{const g=q("font-awesome-icon");return d(),m(k,null,[e("div",Aa,[e("div",Ra,[e("div",Da,[Na,e("div",Oa,[Pa,e("p",null,[Ua,w(z(n(i).eid)+" ",1),Fa,Ha,w(z(n(i).name),1)])]),e("div",Va,[Ka,e("button",{type:"button",class:"btn btn-danger",onClick:x[0]||(x[0]=b=>u(n(i).id))},[s(g,{icon:"trash"}),Ya])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:f},[s(g,{icon:"plus"}),Wa]),Ja,e("table",Za,[Ga,e("tbody",null,[(d(!0),m(k,null,R(n(r),b=>(d(),m("tr",{key:b.id},[e("td",null,z(b.eid),1),e("td",null,z(b.name),1),e("td",null,[(d(!0),m(k,null,R(b.roles,v=>(d(),m("span",{key:v.id,class:"badge rounded-pill bg-success"},z(v.name),1))),128))]),e("td",null,[s(n(Q),{to:{name:"admin_useredit",params:{id:b.id}},class:"btn btn-secondary btn-sm mx-1"},{default:C(()=>[s(g,{icon:"pen-to-square"})]),_:2},1032,["to"]),b.id!=n(a).id?(d(),m("button",{key:0,type:"button",class:"btn btn-danger btn-sm mx-1",onClick:ct(v=>p(b),["prevent"])},[s(g,{icon:"trash"})],8,Xa)):I("",!0)])]))),128))])])],64)}}},er={id:"queueModal",class:"modal fade",tabindex:"-1","aria-labelledby":"queueModalLabel","aria-hidden":"true"},or={class:"modal-dialog"},ar={class:"modal-content"},rr=e("div",{class:"modal-header"},[e("h5",{id:"queueModalLabel",class:"modal-title"},"Delete Queue"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ir={class:"modal-body"},nr=e("h5",null,"Are you sure you want to delete this queue?",-1),dr=e("strong",null,"Name: ",-1),lr={class:"modal-footer"},sr=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),cr=w(" Delete Queue "),mr=w(" Queue "),pr=e("h1",{class:"text-center"},"Queues",-1),br={class:"table table-striped table-hover"},gr=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Actions")])],-1),fr=["onClick"],ur={__name:"QueueAdmin",setup(t){const o=S();o.hydrate();const{queues:r}=M(o);var a=Z({}),i;const c=function(f){a.id=f.id,a.name=f.name,i=new G("#queueModal",{}),i.show()},p=async function(f){await o.deleteQueue(f),i.hide()},u=async function(){var f=prompt("Enter a name for the new queue");if(f)try{await o.addQueue(f)}catch(h){h.response&&h.response.status===422?alert(JSON.stringify(h.response.data)):alert(h)}};return(f,h)=>{const x=q("font-awesome-icon");return d(),m(k,null,[e("div",er,[e("div",or,[e("div",ar,[rr,e("div",ir,[nr,e("p",null,[dr,w(z(n(a).name),1)])]),e("div",lr,[sr,e("button",{type:"button",class:"btn btn-danger",onClick:h[0]||(h[0]=g=>p(n(a).id))},[s(x,{icon:"trash"}),cr])])])])]),e("button",{type:"button",class:"btn btn-success float-end",onClick:u},[s(x,{icon:"plus"}),mr]),pr,e("table",br,[gr,e("tbody",null,[(d(!0),m(k,null,R(n(r),g=>(d(),m("tr",{key:g.id},[e("td",null,z(g.name),1),e("td",null,[e("button",{type:"button",class:"btn btn-danger btn-sm mx-1",onClick:ct(b=>c(g),["prevent"])},[s(x,{icon:"trash"})],8,fr)])]))),128))])])],64)}}},hr={__name:"AdminView",setup(t){return(o,r)=>(d(),m(k,null,[s(ur),s(tr)],64))}},xr=A("roles",{state:()=>({roles:[]}),actions:{async hydrate(){l.info("roles:hydrate"),await _.get("/api/v1/roles").then(t=>{this.roles=t.data})}}});const vr=e("h1",{class:"display-5 text-center"},"Edit User",-1),wr=e("hr",null,null,-1),yr={class:"mb-3"},kr=e("label",{for:"multiselect-roles",class:"form-label"},"Roles",-1),_r=e("div",{class:"form-text"},"Roles assigned to this user",-1),Tr={class:"row row-cols-1 row-cols-md-2"},zr=e("div",{class:"col d-grid mb-2"},[e("button",{class:"btn btn-success"},"Save")],-1),qr={class:"col d-grid mb-2"},Cr=w(" Cancel"),$r={__name:"UserEdit",props:{id:{type:Number,default:-1}},async setup(t){let o,r;const a=t,i=Y(),c=et();[o,r]=L(()=>c.hydrate()),await o,r();const p=c.users.find(g=>g.id===parseInt(a.id)),u=xr();u.hydrate();const{roles:f}=M(u);var h;X(()=>{h=new tt({autoDownloadFontAwesome:!1,blockStyles:{italic:"_"},status:!1,spellChecker:!1})});const x=async g=>{g=(({id:b,name:v})=>({id:b,name:v}))(g),g.contact_info=h.value(),g.roles=[];for(const b of p.roles)g.roles.push({id:b.id});try{await c.update(g),i.push("/admin/")}catch(b){if(b.response&&b.response.status===422){let v={};if(b.response.data.data){for(const y in b.response.data.data){v[y]="";for(const j of b.response.data.data[y])v[y]=v[y]+j.message+" "}D("usersForm",["The server rejected this submission. Please correct errors listed above"],v)}else D("usersForm",["The server rejected this submission due to an SQL Error. Refresh and try again"])}else console.error(b)}};return(g,b)=>{const v=q("FormKit"),y=q("router-link");return d(),m("main",null,[vr,wr,s(v,{id:"userform",type:"form",value:n(p),actions:!1,onSubmit:x},{default:C(()=>[s(v,{type:"text",name:"eid",label:"eID",disabled:!0,help:"The user's K-State eID (cannot be changed)",validation:"required"}),s(v,{type:"text",name:"name",label:"Name",help:"The user's full name as you'd like it displayed on the site",validation:"required"}),s(v,{type:"textarea",name:"contact_info",label:"Contact Information",help:"Any information we should know about how to contact the user",rows:"10"}),e("div",yr,[kr,s(n(st),{id:"multiselect-roles",modelValue:n(p).roles,"onUpdate:modelValue":b[0]||(b[0]=j=>n(p).roles=j),class:"form-control",options:n(f),multiple:!0,"tag-placeholder":"Add this as new role",placeholder:"Type to search or add role",label:"name","track-by":"id"},null,8,["modelValue","options"]),_r]),e("div",Tr,[zr,e("div",qr,[s(y,{to:{name:"admin"},class:"btn btn-secondary"},{default:C(()=>[Cr]),_:1})])])]),_:1},8,["value"])])}}},Mr={__name:"UserEditView",setup(t){return(o,r)=>(d(),T($r))}},ft=A("periods",{state:()=>({queues:[],periods:[]}),actions:{async hydrate(){l.info("periods:hydrate"),await _.get("/api/v1/periods").then(t=>{this.queues=t.data})},async loadPeriods(t){l.info("periods:hydrate - "+t),await _.get("/api/v1/periods/"+t).then(o=>{this.periods=o.data})}}});const jr={__name:"QueueList",async setup(t){let o,r;K.use(mt);const a=ft();[o,r]=L(()=>a.hydrate()),await o,r();const{queues:i}=M(a),c=[{data:"queue_name"},{data:"periods"},{data:"recent",render:function(p){return W(p).format("L")}},{data:null,render:function(){return'<button class="btn btn-sm btn-primary">Test</button>'}}];return(p,u)=>(d(),T(n(K),{columns:c,data:n(i),class:"table table-hover table-striped",width:"100%"},null,8,["data"]))}};var Sr=B(jr,[["__scopeId","data-v-a568cf16"]]);const Lr={__name:"DashboardView",setup(t){return(o,r)=>(d(),T(Sr))}};const Qr={__name:"PeriodList",props:{id:{type:Number,default:-1}},setup(t){const o=t;K.use(mt);const r=ft();r.loadPeriods(o.id);const{periods:a}=M(r),i=[{data:"queue_name"},{data:"periods"},{data:"recent"}];return(c,p)=>(d(),T(n(K),{columns:i,data:n(a),class:"table table-hover table-striped",width:"100%"},null,8,["data"]))}};var Br=B(Qr,[["__scopeId","data-v-ddb09dbc"]]);const Er={__name:"PeriodView",setup(t){return(o,r)=>(d(),T(Br))}},P=()=>$().is_admin,ut=_t({history:Tt("/"),routes:[{path:"/",name:"home",component:Ze,beforeEnter:async()=>{const t=$();if(await t.tryToken(),t.token)return"/queues"}},{path:"/about",name:"about",component:()=>Re(()=>import("./AboutView.2f46499e.js"),["assets/AboutView.2f46499e.js","assets/vendor.770c8b46.js"])},{path:"/queues",name:"queues",component:co},{path:"/queues/:id",name:"queue_single",component:ua,props:t=>({id:Number(t.params.id)})},{path:"/queues/:id/edit",name:"queue_edit",component:Ca,props:!0,beforeEnter:P},{path:"/profile",name:"profile",component:Ia},{path:"/admin",name:"admin",component:hr,beforeEnter:P},{path:"/admin/user/:id/edit",name:"admin_useredit",component:Mr,props:!0,beforeEnter:P},{path:"/data",name:"data",component:Lr,beforeEnter:P},{path:"/data/:id",name:"data_periods",component:Er,beforeEnter:P}]});ut.beforeEach(async function(t){if(t.name!=="home"&&t.name!=="about"){const o=$();if(o.token||await o.tryToken(),!o.token)return"/"}});const Ir=()=>{_.interceptors.request.use(t=>{if(t.url!=="/auth/token"){const o=$();o.token&&(t.headers.Authorization="Bearer "+o.token)}return t},t=>Promise.reject(t)),_.interceptors.response.use(t=>t,async t=>{const o=t.config;if(o.url!=="/auth/token"&&t.response&&t.response.status===401&&!o._retry){o._retry=!0;try{return await $().refreshToken(),_(o)}catch(r){return Promise.reject(r)}}return Promise.reject(t)})};l.useDefaults();l.setLevel(l.WARN);zt.add(qt,Ct,$t,Mt,jt,St,Lt,Qt,Bt,Et,It,At,Rt,Dt,Nt,Ot,Pt,Ut,Ft,Ht,Vt,Kt,Yt,Wt,Jt,Zt,Gt);Xt.watch();Ir();const O=te(Ee);O.use(ee());O.use(ut);O.use(oe,it);O.use(ae,re({config:{classes:{input:"form-control",label:"form-label",help:"form-text",outer:"mb-3"}}}));O.component("FontAwesomeIcon",ie);O.mount("#app");export{B as _};
